var Iw=Object.defineProperty;var Lw=(r,e,t)=>e in r?Iw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ld=(r,e,t)=>Lw(r,typeof e!="symbol"?e+"":e,t);function Rw(r,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in r)){const n=Object.getOwnPropertyDescriptor(s,i);n&&Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();function jx(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Rd={exports:{}},po={},Nd={exports:{}},ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mg;function Nw(){if(mg)return ct;mg=1;var r=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),n=Symbol.for("react.provider"),a=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),p=Symbol.iterator;function g(P){return P===null||typeof P!="object"?null:(P=p&&P[p]||P["@@iterator"],typeof P=="function"?P:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,S={};function b(P,B,oe){this.props=P,this.context=B,this.refs=S,this.updater=oe||v}b.prototype.isReactComponent={},b.prototype.setState=function(P,B){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,B,"setState")},b.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function T(){}T.prototype=b.prototype;function _(P,B,oe){this.props=P,this.context=B,this.refs=S,this.updater=oe||v}var k=_.prototype=new T;k.constructor=_,y(k,b.prototype),k.isPureReactComponent=!0;var I=Array.isArray,C=Object.prototype.hasOwnProperty,$={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function O(P,B,oe){var ie,ne={},le=null,_e=null;if(B!=null)for(ie in B.ref!==void 0&&(_e=B.ref),B.key!==void 0&&(le=""+B.key),B)C.call(B,ie)&&!N.hasOwnProperty(ie)&&(ne[ie]=B[ie]);var Se=arguments.length-2;if(Se===1)ne.children=oe;else if(1<Se){for(var Fe=Array(Se),Ee=0;Ee<Se;Ee++)Fe[Ee]=arguments[Ee+2];ne.children=Fe}if(P&&P.defaultProps)for(ie in Se=P.defaultProps,Se)ne[ie]===void 0&&(ne[ie]=Se[ie]);return{$$typeof:r,type:P,key:le,ref:_e,props:ne,_owner:$.current}}function j(P,B){return{$$typeof:r,type:P.type,key:B,ref:P.ref,props:P.props,_owner:P._owner}}function D(P){return typeof P=="object"&&P!==null&&P.$$typeof===r}function G(P){var B={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(oe){return B[oe]})}var X=/\/+/g;function K(P,B){return typeof P=="object"&&P!==null&&P.key!=null?G(""+P.key):B.toString(36)}function W(P,B,oe,ie,ne){var le=typeof P;(le==="undefined"||le==="boolean")&&(P=null);var _e=!1;if(P===null)_e=!0;else switch(le){case"string":case"number":_e=!0;break;case"object":switch(P.$$typeof){case r:case e:_e=!0}}if(_e)return _e=P,ne=ne(_e),P=ie===""?"."+K(_e,0):ie,I(ne)?(oe="",P!=null&&(oe=P.replace(X,"$&/")+"/"),W(ne,B,oe,"",function(Ee){return Ee})):ne!=null&&(D(ne)&&(ne=j(ne,oe+(!ne.key||_e&&_e.key===ne.key?"":(""+ne.key).replace(X,"$&/")+"/")+P)),B.push(ne)),1;if(_e=0,ie=ie===""?".":ie+":",I(P))for(var Se=0;Se<P.length;Se++){le=P[Se];var Fe=ie+K(le,Se);_e+=W(le,B,oe,Fe,ne)}else if(Fe=g(P),typeof Fe=="function")for(P=Fe.call(P),Se=0;!(le=P.next()).done;)le=le.value,Fe=ie+K(le,Se++),_e+=W(le,B,oe,Fe,ne);else if(le==="object")throw B=String(P),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.");return _e}function te(P,B,oe){if(P==null)return P;var ie=[],ne=0;return W(P,ie,"","",function(le){return B.call(oe,le,ne++)}),ie}function z(P){if(P._status===-1){var B=P._result;B=B(),B.then(function(oe){(P._status===0||P._status===-1)&&(P._status=1,P._result=oe)},function(oe){(P._status===0||P._status===-1)&&(P._status=2,P._result=oe)}),P._status===-1&&(P._status=0,P._result=B)}if(P._status===1)return P._result.default;throw P._result}var M={current:null},F={transition:null},H={ReactCurrentDispatcher:M,ReactCurrentBatchConfig:F,ReactCurrentOwner:$};function Y(){throw Error("act(...) is not supported in production builds of React.")}return ct.Children={map:te,forEach:function(P,B,oe){te(P,function(){B.apply(this,arguments)},oe)},count:function(P){var B=0;return te(P,function(){B++}),B},toArray:function(P){return te(P,function(B){return B})||[]},only:function(P){if(!D(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},ct.Component=b,ct.Fragment=t,ct.Profiler=i,ct.PureComponent=_,ct.StrictMode=s,ct.Suspense=d,ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H,ct.act=Y,ct.cloneElement=function(P,B,oe){if(P==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+P+".");var ie=y({},P.props),ne=P.key,le=P.ref,_e=P._owner;if(B!=null){if(B.ref!==void 0&&(le=B.ref,_e=$.current),B.key!==void 0&&(ne=""+B.key),P.type&&P.type.defaultProps)var Se=P.type.defaultProps;for(Fe in B)C.call(B,Fe)&&!N.hasOwnProperty(Fe)&&(ie[Fe]=B[Fe]===void 0&&Se!==void 0?Se[Fe]:B[Fe])}var Fe=arguments.length-2;if(Fe===1)ie.children=oe;else if(1<Fe){Se=Array(Fe);for(var Ee=0;Ee<Fe;Ee++)Se[Ee]=arguments[Ee+2];ie.children=Se}return{$$typeof:r,type:P.type,key:ne,ref:le,props:ie,_owner:_e}},ct.createContext=function(P){return P={$$typeof:a,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},P.Provider={$$typeof:n,_context:P},P.Consumer=P},ct.createElement=O,ct.createFactory=function(P){var B=O.bind(null,P);return B.type=P,B},ct.createRef=function(){return{current:null}},ct.forwardRef=function(P){return{$$typeof:u,render:P}},ct.isValidElement=D,ct.lazy=function(P){return{$$typeof:m,_payload:{_status:-1,_result:P},_init:z}},ct.memo=function(P,B){return{$$typeof:h,type:P,compare:B===void 0?null:B}},ct.startTransition=function(P){var B=F.transition;F.transition={};try{P()}finally{F.transition=B}},ct.unstable_act=Y,ct.useCallback=function(P,B){return M.current.useCallback(P,B)},ct.useContext=function(P){return M.current.useContext(P)},ct.useDebugValue=function(){},ct.useDeferredValue=function(P){return M.current.useDeferredValue(P)},ct.useEffect=function(P,B){return M.current.useEffect(P,B)},ct.useId=function(){return M.current.useId()},ct.useImperativeHandle=function(P,B,oe){return M.current.useImperativeHandle(P,B,oe)},ct.useInsertionEffect=function(P,B){return M.current.useInsertionEffect(P,B)},ct.useLayoutEffect=function(P,B){return M.current.useLayoutEffect(P,B)},ct.useMemo=function(P,B){return M.current.useMemo(P,B)},ct.useReducer=function(P,B,oe){return M.current.useReducer(P,B,oe)},ct.useRef=function(P){return M.current.useRef(P)},ct.useState=function(P){return M.current.useState(P)},ct.useSyncExternalStore=function(P,B,oe){return M.current.useSyncExternalStore(P,B,oe)},ct.useTransition=function(){return M.current.useTransition()},ct.version="18.3.1",ct}var pg;function uf(){return pg||(pg=1,Nd.exports=Nw()),Nd.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gg;function Cw(){if(gg)return po;gg=1;var r=uf(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function a(u,d,h){var m,p={},g=null,v=null;h!==void 0&&(g=""+h),d.key!==void 0&&(g=""+d.key),d.ref!==void 0&&(v=d.ref);for(m in d)s.call(d,m)&&!n.hasOwnProperty(m)&&(p[m]=d[m]);if(u&&u.defaultProps)for(m in d=u.defaultProps,d)p[m]===void 0&&(p[m]=d[m]);return{$$typeof:e,type:u,key:g,ref:v,props:p,_owner:i.current}}return po.Fragment=t,po.jsx=a,po.jsxs=a,po}var xg;function jw(){return xg||(xg=1,Rd.exports=Cw()),Rd.exports}var l=jw(),L=uf();const Sa=jx(L),Pw=Rw({__proto__:null,default:Sa},[L]);var ql={},Cd={exports:{}},Js={},jd={exports:{}},Pd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vg;function Dw(){return vg||(vg=1,(function(r){function e(F,H){var Y=F.length;F.push(H);e:for(;0<Y;){var P=Y-1>>>1,B=F[P];if(0<i(B,H))F[P]=H,F[Y]=B,Y=P;else break e}}function t(F){return F.length===0?null:F[0]}function s(F){if(F.length===0)return null;var H=F[0],Y=F.pop();if(Y!==H){F[0]=Y;e:for(var P=0,B=F.length,oe=B>>>1;P<oe;){var ie=2*(P+1)-1,ne=F[ie],le=ie+1,_e=F[le];if(0>i(ne,Y))le<B&&0>i(_e,ne)?(F[P]=_e,F[le]=Y,P=le):(F[P]=ne,F[ie]=Y,P=ie);else if(le<B&&0>i(_e,Y))F[P]=_e,F[le]=Y,P=le;else break e}}return H}function i(F,H){var Y=F.sortIndex-H.sortIndex;return Y!==0?Y:F.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;r.unstable_now=function(){return n.now()}}else{var a=Date,u=a.now();r.unstable_now=function(){return a.now()-u}}var d=[],h=[],m=1,p=null,g=3,v=!1,y=!1,S=!1,b=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(F){for(var H=t(h);H!==null;){if(H.callback===null)s(h);else if(H.startTime<=F)s(h),H.sortIndex=H.expirationTime,e(d,H);else break;H=t(h)}}function I(F){if(S=!1,k(F),!y)if(t(d)!==null)y=!0,z(C);else{var H=t(h);H!==null&&M(I,H.startTime-F)}}function C(F,H){y=!1,S&&(S=!1,T(O),O=-1),v=!0;var Y=g;try{for(k(H),p=t(d);p!==null&&(!(p.expirationTime>H)||F&&!G());){var P=p.callback;if(typeof P=="function"){p.callback=null,g=p.priorityLevel;var B=P(p.expirationTime<=H);H=r.unstable_now(),typeof B=="function"?p.callback=B:p===t(d)&&s(d),k(H)}else s(d);p=t(d)}if(p!==null)var oe=!0;else{var ie=t(h);ie!==null&&M(I,ie.startTime-H),oe=!1}return oe}finally{p=null,g=Y,v=!1}}var $=!1,N=null,O=-1,j=5,D=-1;function G(){return!(r.unstable_now()-D<j)}function X(){if(N!==null){var F=r.unstable_now();D=F;var H=!0;try{H=N(!0,F)}finally{H?K():($=!1,N=null)}}else $=!1}var K;if(typeof _=="function")K=function(){_(X)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,te=W.port2;W.port1.onmessage=X,K=function(){te.postMessage(null)}}else K=function(){b(X,0)};function z(F){N=F,$||($=!0,K())}function M(F,H){O=b(function(){F(r.unstable_now())},H)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(F){F.callback=null},r.unstable_continueExecution=function(){y||v||(y=!0,z(C))},r.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<F?Math.floor(1e3/F):5},r.unstable_getCurrentPriorityLevel=function(){return g},r.unstable_getFirstCallbackNode=function(){return t(d)},r.unstable_next=function(F){switch(g){case 1:case 2:case 3:var H=3;break;default:H=g}var Y=g;g=H;try{return F()}finally{g=Y}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(F,H){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var Y=g;g=F;try{return H()}finally{g=Y}},r.unstable_scheduleCallback=function(F,H,Y){var P=r.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?P+Y:P):Y=P,F){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=Y+B,F={id:m++,callback:H,priorityLevel:F,startTime:Y,expirationTime:B,sortIndex:-1},Y>P?(F.sortIndex=Y,e(h,F),t(d)===null&&F===t(h)&&(S?(T(O),O=-1):S=!0,M(I,Y-P))):(F.sortIndex=B,e(d,F),y||v||(y=!0,z(C))),F},r.unstable_shouldYield=G,r.unstable_wrapCallback=function(F){var H=g;return function(){var Y=g;g=H;try{return F.apply(this,arguments)}finally{g=Y}}}})(Pd)),Pd}var yg;function Ow(){return yg||(yg=1,jd.exports=Dw()),jd.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bg;function $w(){if(bg)return Js;bg=1;var r=uf(),e=Ow();function t(o){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+o,f=1;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,i={};function n(o,c){a(o,c),a(o+"Capture",c)}function a(o,c){for(i[o]=c,o=0;o<c.length;o++)s.add(c[o])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},p={};function g(o){return d.call(p,o)?!0:d.call(m,o)?!1:h.test(o)?p[o]=!0:(m[o]=!0,!1)}function v(o,c,f,x){if(f!==null&&f.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return x?!1:f!==null?!f.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function y(o,c,f,x){if(c===null||typeof c>"u"||v(o,c,f,x))return!0;if(x)return!1;if(f!==null)switch(f.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function S(o,c,f,x,w,E,R){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=x,this.attributeNamespace=w,this.mustUseProperty=f,this.propertyName=o,this.type=c,this.sanitizeURL=E,this.removeEmptyString=R}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){b[o]=new S(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var c=o[0];b[c]=new S(c,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){b[o]=new S(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){b[o]=new S(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){b[o]=new S(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){b[o]=new S(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){b[o]=new S(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){b[o]=new S(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){b[o]=new S(o,5,!1,o.toLowerCase(),null,!1,!1)});var T=/[\-:]([a-z])/g;function _(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var c=o.replace(T,_);b[c]=new S(c,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var c=o.replace(T,_);b[c]=new S(c,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var c=o.replace(T,_);b[c]=new S(c,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){b[o]=new S(o,1,!1,o.toLowerCase(),null,!1,!1)}),b.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){b[o]=new S(o,1,!1,o.toLowerCase(),null,!0,!0)});function k(o,c,f,x){var w=b.hasOwnProperty(c)?b[c]:null;(w!==null?w.type!==0:x||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(y(c,f,w,x)&&(f=null),x||w===null?g(c)&&(f===null?o.removeAttribute(c):o.setAttribute(c,""+f)):w.mustUseProperty?o[w.propertyName]=f===null?w.type===3?!1:"":f:(c=w.attributeName,x=w.attributeNamespace,f===null?o.removeAttribute(c):(w=w.type,f=w===3||w===4&&f===!0?"":""+f,x?o.setAttributeNS(x,c,f):o.setAttribute(c,f))))}var I=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,C=Symbol.for("react.element"),$=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),G=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),K=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),M=Symbol.for("react.offscreen"),F=Symbol.iterator;function H(o){return o===null||typeof o!="object"?null:(o=F&&o[F]||o["@@iterator"],typeof o=="function"?o:null)}var Y=Object.assign,P;function B(o){if(P===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);P=c&&c[1]||""}return`
`+P+o}var oe=!1;function ie(o,c){if(!o||oe)return"";oe=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(ae){var x=ae}Reflect.construct(o,[],c)}else{try{c.call()}catch(ae){x=ae}o.call(c.prototype)}else{try{throw Error()}catch(ae){x=ae}o()}}catch(ae){if(ae&&x&&typeof ae.stack=="string"){for(var w=ae.stack.split(`
`),E=x.stack.split(`
`),R=w.length-1,U=E.length-1;1<=R&&0<=U&&w[R]!==E[U];)U--;for(;1<=R&&0<=U;R--,U--)if(w[R]!==E[U]){if(R!==1||U!==1)do if(R--,U--,0>U||w[R]!==E[U]){var V=`
`+w[R].replace(" at new "," at ");return o.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",o.displayName)),V}while(1<=R&&0<=U);break}}}finally{oe=!1,Error.prepareStackTrace=f}return(o=o?o.displayName||o.name:"")?B(o):""}function ne(o){switch(o.tag){case 5:return B(o.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return o=ie(o.type,!1),o;case 11:return o=ie(o.type.render,!1),o;case 1:return o=ie(o.type,!0),o;default:return""}}function le(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case N:return"Fragment";case $:return"Portal";case j:return"Profiler";case O:return"StrictMode";case K:return"Suspense";case W:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case G:return(o.displayName||"Context")+".Consumer";case D:return(o._context.displayName||"Context")+".Provider";case X:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case te:return c=o.displayName||null,c!==null?c:le(o.type)||"Memo";case z:c=o._payload,o=o._init;try{return le(o(c))}catch{}}return null}function _e(o){var c=o.type;switch(o.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=c.render,o=o.displayName||o.name||"",c.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return le(c);case 8:return c===O?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function Se(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Fe(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Ee(o){var c=Fe(o)?"checked":"value",f=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),x=""+o[c];if(!o.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var w=f.get,E=f.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return w.call(this)},set:function(R){x=""+R,E.call(this,R)}}),Object.defineProperty(o,c,{enumerable:f.enumerable}),{getValue:function(){return x},setValue:function(R){x=""+R},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function at(o){o._valueTracker||(o._valueTracker=Ee(o))}function de(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var f=c.getValue(),x="";return o&&(x=Fe(o)?o.checked?"true":"false":o.value),o=x,o!==f?(c.setValue(o),!0):!1}function gt(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function Ct(o,c){var f=c.checked;return Y({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f??o._wrapperState.initialChecked})}function as(o,c){var f=c.defaultValue==null?"":c.defaultValue,x=c.checked!=null?c.checked:c.defaultChecked;f=Se(c.value!=null?c.value:f),o._wrapperState={initialChecked:x,initialValue:f,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function ke(o,c){c=c.checked,c!=null&&k(o,"checked",c,!1)}function be(o,c){ke(o,c);var f=Se(c.value),x=c.type;if(f!=null)x==="number"?(f===0&&o.value===""||o.value!=f)&&(o.value=""+f):o.value!==""+f&&(o.value=""+f);else if(x==="submit"||x==="reset"){o.removeAttribute("value");return}c.hasOwnProperty("value")?Ge(o,c.type,f):c.hasOwnProperty("defaultValue")&&Ge(o,c.type,Se(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(o.defaultChecked=!!c.defaultChecked)}function pe(o,c,f){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var x=c.type;if(!(x!=="submit"&&x!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+o._wrapperState.initialValue,f||c===o.value||(o.value=c),o.defaultValue=c}f=o.name,f!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,f!==""&&(o.name=f)}function Ge(o,c,f){(c!=="number"||gt(o.ownerDocument)!==o)&&(f==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+f&&(o.defaultValue=""+f))}var Ne=Array.isArray;function nt(o,c,f,x){if(o=o.options,c){c={};for(var w=0;w<f.length;w++)c["$"+f[w]]=!0;for(f=0;f<o.length;f++)w=c.hasOwnProperty("$"+o[f].value),o[f].selected!==w&&(o[f].selected=w),w&&x&&(o[f].defaultSelected=!0)}else{for(f=""+Se(f),c=null,w=0;w<o.length;w++){if(o[w].value===f){o[w].selected=!0,x&&(o[w].defaultSelected=!0);return}c!==null||o[w].disabled||(c=o[w])}c!==null&&(c.selected=!0)}}function it(o,c){if(c.dangerouslySetInnerHTML!=null)throw Error(t(91));return Y({},c,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function zt(o,c){var f=c.value;if(f==null){if(f=c.children,c=c.defaultValue,f!=null){if(c!=null)throw Error(t(92));if(Ne(f)){if(1<f.length)throw Error(t(93));f=f[0]}c=f}c==null&&(c=""),f=c}o._wrapperState={initialValue:Se(f)}}function ht(o,c){var f=Se(c.value),x=Se(c.defaultValue);f!=null&&(f=""+f,f!==o.value&&(o.value=f),c.defaultValue==null&&o.defaultValue!==f&&(o.defaultValue=f)),x!=null&&(o.defaultValue=""+x)}function ts(o){var c=o.textContent;c===o._wrapperState.initialValue&&c!==""&&c!==null&&(o.value=c)}function ks(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zs(o,c){return o==null||o==="http://www.w3.org/1999/xhtml"?ks(c):o==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var vs,Te=(function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,f,x,w){MSApp.execUnsafeLocalFunction(function(){return o(c,f,x,w)})}:o})(function(o,c){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=c;else{for(vs=vs||document.createElement("div"),vs.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=vs.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;c.firstChild;)o.appendChild(c.firstChild)}});function ds(o,c){if(c){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=c;return}}o.textContent=c}var Gt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ws=["Webkit","ms","Moz","O"];Object.keys(Gt).forEach(function(o){Ws.forEach(function(c){c=c+o.charAt(0).toUpperCase()+o.substring(1),Gt[c]=Gt[o]})});function sr(o,c,f){return c==null||typeof c=="boolean"||c===""?"":f||typeof c!="number"||c===0||Gt.hasOwnProperty(o)&&Gt[o]?(""+c).trim():c+"px"}function oi(o,c){o=o.style;for(var f in c)if(c.hasOwnProperty(f)){var x=f.indexOf("--")===0,w=sr(f,c[f],x);f==="float"&&(f="cssFloat"),x?o.setProperty(f,w):o[f]=w}}var li=Y({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fe(o,c){if(c){if(li[o]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(t(137,o));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(t(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(t(61))}if(c.style!=null&&typeof c.style!="object")throw Error(t(62))}}function Oe(o,c){if(o.indexOf("-")===-1)return typeof c.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var We=null;function Qe(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var vt=null,yt=null,dt=null;function ft(o){if(o=Za(o)){if(typeof vt!="function")throw Error(t(280));var c=o.stateNode;c&&(c=cl(c),vt(o.stateNode,o.type,c))}}function ys(o){yt?dt?dt.push(o):dt=[o]:yt=o}function Br(){if(yt){var o=yt,c=dt;if(dt=yt=null,ft(o),c)for(o=0;o<c.length;o++)ft(c[o])}}function ki(o,c){return o(c)}function Ai(){}var ci=!1;function zr(o,c,f){if(ci)return o(c,f);ci=!0;try{return ki(o,c,f)}finally{ci=!1,(yt!==null||dt!==null)&&(Ai(),Br())}}function re(o,c){var f=o.stateNode;if(f===null)return null;var x=cl(f);if(x===null)return null;f=x[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(o=o.type,x=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!x;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(t(231,c,typeof f));return f}var ve=!1;if(u)try{var ze={};Object.defineProperty(ze,"passive",{get:function(){ve=!0}}),window.addEventListener("test",ze,ze),window.removeEventListener("test",ze,ze)}catch{ve=!1}function Le(o,c,f,x,w,E,R,U,V){var ae=Array.prototype.slice.call(arguments,3);try{c.apply(f,ae)}catch(me){this.onError(me)}}var mt=!1,wt=null,ss=!1,Gr=null,on={onError:function(o){mt=!0,wt=o}};function et(o,c,f,x,w,E,R,U,V){mt=!1,wt=null,Le.apply(on,arguments)}function Vr(o,c,f,x,w,E,R,U,V){if(et.apply(this,arguments),mt){if(mt){var ae=wt;mt=!1,wt=null}else throw Error(t(198));ss||(ss=!0,Gr=ae)}}function xr(o){var c=o,f=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,(c.flags&4098)!==0&&(f=c.return),o=c.return;while(o)}return c.tag===3?f:null}function Wo(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function Pa(o){if(xr(o)!==o)throw Error(t(188))}function Ho(o){var c=o.alternate;if(!c){if(c=xr(o),c===null)throw Error(t(188));return c!==o?null:o}for(var f=o,x=c;;){var w=f.return;if(w===null)break;var E=w.alternate;if(E===null){if(x=w.return,x!==null){f=x;continue}break}if(w.child===E.child){for(E=w.child;E;){if(E===f)return Pa(w),o;if(E===x)return Pa(w),c;E=E.sibling}throw Error(t(188))}if(f.return!==x.return)f=w,x=E;else{for(var R=!1,U=w.child;U;){if(U===f){R=!0,f=w,x=E;break}if(U===x){R=!0,x=w,f=E;break}U=U.sibling}if(!R){for(U=E.child;U;){if(U===f){R=!0,f=E,x=w;break}if(U===x){R=!0,x=E,f=w;break}U=U.sibling}if(!R)throw Error(t(189))}}if(f.alternate!==x)throw Error(t(190))}if(f.tag!==3)throw Error(t(188));return f.stateNode.current===f?o:c}function Qt(o){return o=Ho(o),o!==null?Ft(o):null}function Ft(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var c=Ft(o);if(c!==null)return c;o=o.sibling}return null}var Ir=e.unstable_scheduleCallback,jt=e.unstable_cancelCallback,Ii=e.unstable_shouldYield,Dn=e.unstable_requestPaint,Pt=e.unstable_now,Xc=e.unstable_getCurrentPriorityLevel,On=e.unstable_ImmediatePriority,q=e.unstable_UserBlockingPriority,ce=e.unstable_NormalPriority,ye=e.unstable_LowPriority,$e=e.unstable_IdlePriority,je=null,we=null;function lt(o){if(we&&typeof we.onCommitFiberRoot=="function")try{we.onCommitFiberRoot(je,o,void 0,(o.current.flags&128)===128)}catch{}}var Ie=Math.clz32?Math.clz32:Os,bt=Math.log,bs=Math.LN2;function Os(o){return o>>>=0,o===0?32:31-(bt(o)/bs|0)|0}var At=64,os=4194304;function As(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function Ke(o,c){var f=o.pendingLanes;if(f===0)return 0;var x=0,w=o.suspendedLanes,E=o.pingedLanes,R=f&268435455;if(R!==0){var U=R&~w;U!==0?x=As(U):(E&=R,E!==0&&(x=As(E)))}else R=f&~w,R!==0?x=As(R):E!==0&&(x=As(E));if(x===0)return 0;if(c!==0&&c!==x&&(c&w)===0&&(w=x&-x,E=c&-c,w>=E||w===16&&(E&4194240)!==0))return c;if((x&4)!==0&&(x|=f&16),c=o.entangledLanes,c!==0)for(o=o.entanglements,c&=x;0<c;)f=31-Ie(c),w=1<<f,x|=o[f],c&=~w;return x}function ln(o,c){switch(o){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vr(o,c){for(var f=o.suspendedLanes,x=o.pingedLanes,w=o.expirationTimes,E=o.pendingLanes;0<E;){var R=31-Ie(E),U=1<<R,V=w[R];V===-1?((U&f)===0||(U&x)!==0)&&(w[R]=ln(U,c)):V<=c&&(o.expiredLanes|=U),E&=~U}}function Dt(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Xt(){var o=At;return At<<=1,(At&4194240)===0&&(At=64),o}function Da(o){for(var c=[],f=0;31>f;f++)c.push(o);return c}function Oa(o,c,f){o.pendingLanes|=c,c!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,c=31-Ie(c),o[c]=f}function Yy(o,c){var f=o.pendingLanes&~c;o.pendingLanes=c,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=c,o.mutableReadLanes&=c,o.entangledLanes&=c,c=o.entanglements;var x=o.eventTimes;for(o=o.expirationTimes;0<f;){var w=31-Ie(f),E=1<<w;c[w]=0,x[w]=-1,o[w]=-1,f&=~E}}function Jc(o,c){var f=o.entangledLanes|=c;for(o=o.entanglements;f;){var x=31-Ie(f),w=1<<x;w&c|o[x]&c&&(o[x]|=c),f&=~w}}var St=0;function Wf(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var Hf,Zc,qf,Yf,Qf,eu=!1,qo=[],Li=null,Ri=null,Ni=null,$a=new Map,Ma=new Map,Ci=[],Qy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xf(o,c){switch(o){case"focusin":case"focusout":Li=null;break;case"dragenter":case"dragleave":Ri=null;break;case"mouseover":case"mouseout":Ni=null;break;case"pointerover":case"pointerout":$a.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ma.delete(c.pointerId)}}function Fa(o,c,f,x,w,E){return o===null||o.nativeEvent!==E?(o={blockedOn:c,domEventName:f,eventSystemFlags:x,nativeEvent:E,targetContainers:[w]},c!==null&&(c=Za(c),c!==null&&Zc(c)),o):(o.eventSystemFlags|=x,c=o.targetContainers,w!==null&&c.indexOf(w)===-1&&c.push(w),o)}function Xy(o,c,f,x,w){switch(c){case"focusin":return Li=Fa(Li,o,c,f,x,w),!0;case"dragenter":return Ri=Fa(Ri,o,c,f,x,w),!0;case"mouseover":return Ni=Fa(Ni,o,c,f,x,w),!0;case"pointerover":var E=w.pointerId;return $a.set(E,Fa($a.get(E)||null,o,c,f,x,w)),!0;case"gotpointercapture":return E=w.pointerId,Ma.set(E,Fa(Ma.get(E)||null,o,c,f,x,w)),!0}return!1}function Jf(o){var c=cn(o.target);if(c!==null){var f=xr(c);if(f!==null){if(c=f.tag,c===13){if(c=Wo(f),c!==null){o.blockedOn=c,Qf(o.priority,function(){qf(f)});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Yo(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var f=su(o.domEventName,o.eventSystemFlags,c[0],o.nativeEvent);if(f===null){f=o.nativeEvent;var x=new f.constructor(f.type,f);We=x,f.target.dispatchEvent(x),We=null}else return c=Za(f),c!==null&&Zc(c),o.blockedOn=f,!1;c.shift()}return!0}function Zf(o,c,f){Yo(o)&&f.delete(c)}function Jy(){eu=!1,Li!==null&&Yo(Li)&&(Li=null),Ri!==null&&Yo(Ri)&&(Ri=null),Ni!==null&&Yo(Ni)&&(Ni=null),$a.forEach(Zf),Ma.forEach(Zf)}function Ua(o,c){o.blockedOn===c&&(o.blockedOn=null,eu||(eu=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Jy)))}function Ba(o){function c(w){return Ua(w,o)}if(0<qo.length){Ua(qo[0],o);for(var f=1;f<qo.length;f++){var x=qo[f];x.blockedOn===o&&(x.blockedOn=null)}}for(Li!==null&&Ua(Li,o),Ri!==null&&Ua(Ri,o),Ni!==null&&Ua(Ni,o),$a.forEach(c),Ma.forEach(c),f=0;f<Ci.length;f++)x=Ci[f],x.blockedOn===o&&(x.blockedOn=null);for(;0<Ci.length&&(f=Ci[0],f.blockedOn===null);)Jf(f),f.blockedOn===null&&Ci.shift()}var $n=I.ReactCurrentBatchConfig,Qo=!0;function Zy(o,c,f,x){var w=St,E=$n.transition;$n.transition=null;try{St=1,tu(o,c,f,x)}finally{St=w,$n.transition=E}}function eb(o,c,f,x){var w=St,E=$n.transition;$n.transition=null;try{St=4,tu(o,c,f,x)}finally{St=w,$n.transition=E}}function tu(o,c,f,x){if(Qo){var w=su(o,c,f,x);if(w===null)yu(o,c,x,Xo,f),Xf(o,x);else if(Xy(w,o,c,f,x))x.stopPropagation();else if(Xf(o,x),c&4&&-1<Qy.indexOf(o)){for(;w!==null;){var E=Za(w);if(E!==null&&Hf(E),E=su(o,c,f,x),E===null&&yu(o,c,x,Xo,f),E===w)break;w=E}w!==null&&x.stopPropagation()}else yu(o,c,x,null,f)}}var Xo=null;function su(o,c,f,x){if(Xo=null,o=Qe(x),o=cn(o),o!==null)if(c=xr(o),c===null)o=null;else if(f=c.tag,f===13){if(o=Wo(c),o!==null)return o;o=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null);return Xo=o,null}function em(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xc()){case On:return 1;case q:return 4;case ce:case ye:return 16;case $e:return 536870912;default:return 16}default:return 16}}var ji=null,ru=null,Jo=null;function tm(){if(Jo)return Jo;var o,c=ru,f=c.length,x,w="value"in ji?ji.value:ji.textContent,E=w.length;for(o=0;o<f&&c[o]===w[o];o++);var R=f-o;for(x=1;x<=R&&c[f-x]===w[E-x];x++);return Jo=w.slice(o,1<x?1-x:void 0)}function Zo(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function el(){return!0}function sm(){return!1}function rr(o){function c(f,x,w,E,R){this._reactName=f,this._targetInst=w,this.type=x,this.nativeEvent=E,this.target=R,this.currentTarget=null;for(var U in o)o.hasOwnProperty(U)&&(f=o[U],this[U]=f?f(E):E[U]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?el:sm,this.isPropagationStopped=sm,this}return Y(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=el)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=el)},persist:function(){},isPersistent:el}),c}var Mn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},iu=rr(Mn),za=Y({},Mn,{view:0,detail:0}),tb=rr(za),nu,au,Ga,tl=Y({},za,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lu,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Ga&&(Ga&&o.type==="mousemove"?(nu=o.screenX-Ga.screenX,au=o.screenY-Ga.screenY):au=nu=0,Ga=o),nu)},movementY:function(o){return"movementY"in o?o.movementY:au}}),rm=rr(tl),sb=Y({},tl,{dataTransfer:0}),rb=rr(sb),ib=Y({},za,{relatedTarget:0}),ou=rr(ib),nb=Y({},Mn,{animationName:0,elapsedTime:0,pseudoElement:0}),ab=rr(nb),ob=Y({},Mn,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),lb=rr(ob),cb=Y({},Mn,{data:0}),im=rr(cb),ub={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},db={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fb(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=hb[o])?!!c[o]:!1}function lu(){return fb}var mb=Y({},za,{key:function(o){if(o.key){var c=ub[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=Zo(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?db[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lu,charCode:function(o){return o.type==="keypress"?Zo(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Zo(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),pb=rr(mb),gb=Y({},tl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nm=rr(gb),xb=Y({},za,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lu}),vb=rr(xb),yb=Y({},Mn,{propertyName:0,elapsedTime:0,pseudoElement:0}),bb=rr(yb),wb=Y({},tl,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),Sb=rr(wb),Eb=[9,13,27,32],cu=u&&"CompositionEvent"in window,Va=null;u&&"documentMode"in document&&(Va=document.documentMode);var Tb=u&&"TextEvent"in window&&!Va,am=u&&(!cu||Va&&8<Va&&11>=Va),om=" ",lm=!1;function cm(o,c){switch(o){case"keyup":return Eb.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function um(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Fn=!1;function _b(o,c){switch(o){case"compositionend":return um(c);case"keypress":return c.which!==32?null:(lm=!0,om);case"textInput":return o=c.data,o===om&&lm?null:o;default:return null}}function kb(o,c){if(Fn)return o==="compositionend"||!cu&&cm(o,c)?(o=tm(),Jo=ru=ji=null,Fn=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return am&&c.locale!=="ko"?null:c.data;default:return null}}var Ab={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dm(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!Ab[o.type]:c==="textarea"}function hm(o,c,f,x){ys(x),c=al(c,"onChange"),0<c.length&&(f=new iu("onChange","change",null,f,x),o.push({event:f,listeners:c}))}var Ka=null,Wa=null;function Ib(o){Rm(o,0)}function sl(o){var c=Vn(o);if(de(c))return o}function Lb(o,c){if(o==="change")return c}var fm=!1;if(u){var uu;if(u){var du="oninput"in document;if(!du){var mm=document.createElement("div");mm.setAttribute("oninput","return;"),du=typeof mm.oninput=="function"}uu=du}else uu=!1;fm=uu&&(!document.documentMode||9<document.documentMode)}function pm(){Ka&&(Ka.detachEvent("onpropertychange",gm),Wa=Ka=null)}function gm(o){if(o.propertyName==="value"&&sl(Wa)){var c=[];hm(c,Wa,o,Qe(o)),zr(Ib,c)}}function Rb(o,c,f){o==="focusin"?(pm(),Ka=c,Wa=f,Ka.attachEvent("onpropertychange",gm)):o==="focusout"&&pm()}function Nb(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return sl(Wa)}function Cb(o,c){if(o==="click")return sl(c)}function jb(o,c){if(o==="input"||o==="change")return sl(c)}function Pb(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var Lr=typeof Object.is=="function"?Object.is:Pb;function Ha(o,c){if(Lr(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var f=Object.keys(o),x=Object.keys(c);if(f.length!==x.length)return!1;for(x=0;x<f.length;x++){var w=f[x];if(!d.call(c,w)||!Lr(o[w],c[w]))return!1}return!0}function xm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function vm(o,c){var f=xm(o);o=0;for(var x;f;){if(f.nodeType===3){if(x=o+f.textContent.length,o<=c&&x>=c)return{node:f,offset:c-o};o=x}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=xm(f)}}function ym(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?ym(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function bm(){for(var o=window,c=gt();c instanceof o.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)o=c.contentWindow;else break;c=gt(o.document)}return c}function hu(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}function Db(o){var c=bm(),f=o.focusedElem,x=o.selectionRange;if(c!==f&&f&&f.ownerDocument&&ym(f.ownerDocument.documentElement,f)){if(x!==null&&hu(f)){if(c=x.start,o=x.end,o===void 0&&(o=c),"selectionStart"in f)f.selectionStart=c,f.selectionEnd=Math.min(o,f.value.length);else if(o=(c=f.ownerDocument||document)&&c.defaultView||window,o.getSelection){o=o.getSelection();var w=f.textContent.length,E=Math.min(x.start,w);x=x.end===void 0?E:Math.min(x.end,w),!o.extend&&E>x&&(w=x,x=E,E=w),w=vm(f,E);var R=vm(f,x);w&&R&&(o.rangeCount!==1||o.anchorNode!==w.node||o.anchorOffset!==w.offset||o.focusNode!==R.node||o.focusOffset!==R.offset)&&(c=c.createRange(),c.setStart(w.node,w.offset),o.removeAllRanges(),E>x?(o.addRange(c),o.extend(R.node,R.offset)):(c.setEnd(R.node,R.offset),o.addRange(c)))}}for(c=[],o=f;o=o.parentNode;)o.nodeType===1&&c.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<c.length;f++)o=c[f],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var Ob=u&&"documentMode"in document&&11>=document.documentMode,Un=null,fu=null,qa=null,mu=!1;function wm(o,c,f){var x=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;mu||Un==null||Un!==gt(x)||(x=Un,"selectionStart"in x&&hu(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),qa&&Ha(qa,x)||(qa=x,x=al(fu,"onSelect"),0<x.length&&(c=new iu("onSelect","select",null,c,f),o.push({event:c,listeners:x}),c.target=Un)))}function rl(o,c){var f={};return f[o.toLowerCase()]=c.toLowerCase(),f["Webkit"+o]="webkit"+c,f["Moz"+o]="moz"+c,f}var Bn={animationend:rl("Animation","AnimationEnd"),animationiteration:rl("Animation","AnimationIteration"),animationstart:rl("Animation","AnimationStart"),transitionend:rl("Transition","TransitionEnd")},pu={},Sm={};u&&(Sm=document.createElement("div").style,"AnimationEvent"in window||(delete Bn.animationend.animation,delete Bn.animationiteration.animation,delete Bn.animationstart.animation),"TransitionEvent"in window||delete Bn.transitionend.transition);function il(o){if(pu[o])return pu[o];if(!Bn[o])return o;var c=Bn[o],f;for(f in c)if(c.hasOwnProperty(f)&&f in Sm)return pu[o]=c[f];return o}var Em=il("animationend"),Tm=il("animationiteration"),_m=il("animationstart"),km=il("transitionend"),Am=new Map,Im="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(o,c){Am.set(o,c),n(c,[o])}for(var gu=0;gu<Im.length;gu++){var xu=Im[gu],$b=xu.toLowerCase(),Mb=xu[0].toUpperCase()+xu.slice(1);Pi($b,"on"+Mb)}Pi(Em,"onAnimationEnd"),Pi(Tm,"onAnimationIteration"),Pi(_m,"onAnimationStart"),Pi("dblclick","onDoubleClick"),Pi("focusin","onFocus"),Pi("focusout","onBlur"),Pi(km,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),n("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),n("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),n("onBeforeInput",["compositionend","keypress","textInput","paste"]),n("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),n("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),n("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ya="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fb=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ya));function Lm(o,c,f){var x=o.type||"unknown-event";o.currentTarget=f,Vr(x,c,void 0,o),o.currentTarget=null}function Rm(o,c){c=(c&4)!==0;for(var f=0;f<o.length;f++){var x=o[f],w=x.event;x=x.listeners;e:{var E=void 0;if(c)for(var R=x.length-1;0<=R;R--){var U=x[R],V=U.instance,ae=U.currentTarget;if(U=U.listener,V!==E&&w.isPropagationStopped())break e;Lm(w,U,ae),E=V}else for(R=0;R<x.length;R++){if(U=x[R],V=U.instance,ae=U.currentTarget,U=U.listener,V!==E&&w.isPropagationStopped())break e;Lm(w,U,ae),E=V}}}if(ss)throw o=Gr,ss=!1,Gr=null,o}function Ot(o,c){var f=c[_u];f===void 0&&(f=c[_u]=new Set);var x=o+"__bubble";f.has(x)||(Nm(c,o,2,!1),f.add(x))}function vu(o,c,f){var x=0;c&&(x|=4),Nm(f,o,x,c)}var nl="_reactListening"+Math.random().toString(36).slice(2);function Qa(o){if(!o[nl]){o[nl]=!0,s.forEach(function(f){f!=="selectionchange"&&(Fb.has(f)||vu(f,!1,o),vu(f,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[nl]||(c[nl]=!0,vu("selectionchange",!1,c))}}function Nm(o,c,f,x){switch(em(c)){case 1:var w=Zy;break;case 4:w=eb;break;default:w=tu}f=w.bind(null,c,f,o),w=void 0,!ve||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(w=!0),x?w!==void 0?o.addEventListener(c,f,{capture:!0,passive:w}):o.addEventListener(c,f,!0):w!==void 0?o.addEventListener(c,f,{passive:w}):o.addEventListener(c,f,!1)}function yu(o,c,f,x,w){var E=x;if((c&1)===0&&(c&2)===0&&x!==null)e:for(;;){if(x===null)return;var R=x.tag;if(R===3||R===4){var U=x.stateNode.containerInfo;if(U===w||U.nodeType===8&&U.parentNode===w)break;if(R===4)for(R=x.return;R!==null;){var V=R.tag;if((V===3||V===4)&&(V=R.stateNode.containerInfo,V===w||V.nodeType===8&&V.parentNode===w))return;R=R.return}for(;U!==null;){if(R=cn(U),R===null)return;if(V=R.tag,V===5||V===6){x=E=R;continue e}U=U.parentNode}}x=x.return}zr(function(){var ae=E,me=Qe(f),ge=[];e:{var he=Am.get(o);if(he!==void 0){var Re=iu,De=o;switch(o){case"keypress":if(Zo(f)===0)break e;case"keydown":case"keyup":Re=pb;break;case"focusin":De="focus",Re=ou;break;case"focusout":De="blur",Re=ou;break;case"beforeblur":case"afterblur":Re=ou;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Re=rm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Re=rb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Re=vb;break;case Em:case Tm:case _m:Re=ab;break;case km:Re=bb;break;case"scroll":Re=tb;break;case"wheel":Re=Sb;break;case"copy":case"cut":case"paste":Re=lb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Re=nm}var Me=(c&4)!==0,rs=!Me&&o==="scroll",ee=Me?he!==null?he+"Capture":null:he;Me=[];for(var Q=ae,se;Q!==null;){se=Q;var xe=se.stateNode;if(se.tag===5&&xe!==null&&(se=xe,ee!==null&&(xe=re(Q,ee),xe!=null&&Me.push(Xa(Q,xe,se)))),rs)break;Q=Q.return}0<Me.length&&(he=new Re(he,De,null,f,me),ge.push({event:he,listeners:Me}))}}if((c&7)===0){e:{if(he=o==="mouseover"||o==="pointerover",Re=o==="mouseout"||o==="pointerout",he&&f!==We&&(De=f.relatedTarget||f.fromElement)&&(cn(De)||De[ui]))break e;if((Re||he)&&(he=me.window===me?me:(he=me.ownerDocument)?he.defaultView||he.parentWindow:window,Re?(De=f.relatedTarget||f.toElement,Re=ae,De=De?cn(De):null,De!==null&&(rs=xr(De),De!==rs||De.tag!==5&&De.tag!==6)&&(De=null)):(Re=null,De=ae),Re!==De)){if(Me=rm,xe="onMouseLeave",ee="onMouseEnter",Q="mouse",(o==="pointerout"||o==="pointerover")&&(Me=nm,xe="onPointerLeave",ee="onPointerEnter",Q="pointer"),rs=Re==null?he:Vn(Re),se=De==null?he:Vn(De),he=new Me(xe,Q+"leave",Re,f,me),he.target=rs,he.relatedTarget=se,xe=null,cn(me)===ae&&(Me=new Me(ee,Q+"enter",De,f,me),Me.target=se,Me.relatedTarget=rs,xe=Me),rs=xe,Re&&De)t:{for(Me=Re,ee=De,Q=0,se=Me;se;se=zn(se))Q++;for(se=0,xe=ee;xe;xe=zn(xe))se++;for(;0<Q-se;)Me=zn(Me),Q--;for(;0<se-Q;)ee=zn(ee),se--;for(;Q--;){if(Me===ee||ee!==null&&Me===ee.alternate)break t;Me=zn(Me),ee=zn(ee)}Me=null}else Me=null;Re!==null&&Cm(ge,he,Re,Me,!1),De!==null&&rs!==null&&Cm(ge,rs,De,Me,!0)}}e:{if(he=ae?Vn(ae):window,Re=he.nodeName&&he.nodeName.toLowerCase(),Re==="select"||Re==="input"&&he.type==="file")var Be=Lb;else if(dm(he))if(fm)Be=jb;else{Be=Nb;var qe=Rb}else(Re=he.nodeName)&&Re.toLowerCase()==="input"&&(he.type==="checkbox"||he.type==="radio")&&(Be=Cb);if(Be&&(Be=Be(o,ae))){hm(ge,Be,f,me);break e}qe&&qe(o,he,ae),o==="focusout"&&(qe=he._wrapperState)&&qe.controlled&&he.type==="number"&&Ge(he,"number",he.value)}switch(qe=ae?Vn(ae):window,o){case"focusin":(dm(qe)||qe.contentEditable==="true")&&(Un=qe,fu=ae,qa=null);break;case"focusout":qa=fu=Un=null;break;case"mousedown":mu=!0;break;case"contextmenu":case"mouseup":case"dragend":mu=!1,wm(ge,f,me);break;case"selectionchange":if(Ob)break;case"keydown":case"keyup":wm(ge,f,me)}var Ye;if(cu)e:{switch(o){case"compositionstart":var tt="onCompositionStart";break e;case"compositionend":tt="onCompositionEnd";break e;case"compositionupdate":tt="onCompositionUpdate";break e}tt=void 0}else Fn?cm(o,f)&&(tt="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(tt="onCompositionStart");tt&&(am&&f.locale!=="ko"&&(Fn||tt!=="onCompositionStart"?tt==="onCompositionEnd"&&Fn&&(Ye=tm()):(ji=me,ru="value"in ji?ji.value:ji.textContent,Fn=!0)),qe=al(ae,tt),0<qe.length&&(tt=new im(tt,o,null,f,me),ge.push({event:tt,listeners:qe}),Ye?tt.data=Ye:(Ye=um(f),Ye!==null&&(tt.data=Ye)))),(Ye=Tb?_b(o,f):kb(o,f))&&(ae=al(ae,"onBeforeInput"),0<ae.length&&(me=new im("onBeforeInput","beforeinput",null,f,me),ge.push({event:me,listeners:ae}),me.data=Ye))}Rm(ge,c)})}function Xa(o,c,f){return{instance:o,listener:c,currentTarget:f}}function al(o,c){for(var f=c+"Capture",x=[];o!==null;){var w=o,E=w.stateNode;w.tag===5&&E!==null&&(w=E,E=re(o,f),E!=null&&x.unshift(Xa(o,E,w)),E=re(o,c),E!=null&&x.push(Xa(o,E,w))),o=o.return}return x}function zn(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Cm(o,c,f,x,w){for(var E=c._reactName,R=[];f!==null&&f!==x;){var U=f,V=U.alternate,ae=U.stateNode;if(V!==null&&V===x)break;U.tag===5&&ae!==null&&(U=ae,w?(V=re(f,E),V!=null&&R.unshift(Xa(f,V,U))):w||(V=re(f,E),V!=null&&R.push(Xa(f,V,U)))),f=f.return}R.length!==0&&o.push({event:c,listeners:R})}var Ub=/\r\n?/g,Bb=/\u0000|\uFFFD/g;function jm(o){return(typeof o=="string"?o:""+o).replace(Ub,`
`).replace(Bb,"")}function ol(o,c,f){if(c=jm(c),jm(o)!==c&&f)throw Error(t(425))}function ll(){}var bu=null,wu=null;function Su(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Eu=typeof setTimeout=="function"?setTimeout:void 0,zb=typeof clearTimeout=="function"?clearTimeout:void 0,Pm=typeof Promise=="function"?Promise:void 0,Gb=typeof queueMicrotask=="function"?queueMicrotask:typeof Pm<"u"?function(o){return Pm.resolve(null).then(o).catch(Vb)}:Eu;function Vb(o){setTimeout(function(){throw o})}function Tu(o,c){var f=c,x=0;do{var w=f.nextSibling;if(o.removeChild(f),w&&w.nodeType===8)if(f=w.data,f==="/$"){if(x===0){o.removeChild(w),Ba(c);return}x--}else f!=="$"&&f!=="$?"&&f!=="$!"||x++;f=w}while(f);Ba(c)}function Di(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return o}function Dm(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return o;c--}else f==="/$"&&c++}o=o.previousSibling}return null}var Gn=Math.random().toString(36).slice(2),Kr="__reactFiber$"+Gn,Ja="__reactProps$"+Gn,ui="__reactContainer$"+Gn,_u="__reactEvents$"+Gn,Kb="__reactListeners$"+Gn,Wb="__reactHandles$"+Gn;function cn(o){var c=o[Kr];if(c)return c;for(var f=o.parentNode;f;){if(c=f[ui]||f[Kr]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(o=Dm(o);o!==null;){if(f=o[Kr])return f;o=Dm(o)}return c}o=f,f=o.parentNode}return null}function Za(o){return o=o[Kr]||o[ui],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Vn(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(t(33))}function cl(o){return o[Ja]||null}var ku=[],Kn=-1;function Oi(o){return{current:o}}function $t(o){0>Kn||(o.current=ku[Kn],ku[Kn]=null,Kn--)}function Rt(o,c){Kn++,ku[Kn]=o.current,o.current=c}var $i={},$s=Oi($i),Hs=Oi(!1),un=$i;function Wn(o,c){var f=o.type.contextTypes;if(!f)return $i;var x=o.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===c)return x.__reactInternalMemoizedMaskedChildContext;var w={},E;for(E in f)w[E]=c[E];return x&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=c,o.__reactInternalMemoizedMaskedChildContext=w),w}function qs(o){return o=o.childContextTypes,o!=null}function ul(){$t(Hs),$t($s)}function Om(o,c,f){if($s.current!==$i)throw Error(t(168));Rt($s,c),Rt(Hs,f)}function $m(o,c,f){var x=o.stateNode;if(c=c.childContextTypes,typeof x.getChildContext!="function")return f;x=x.getChildContext();for(var w in x)if(!(w in c))throw Error(t(108,_e(o)||"Unknown",w));return Y({},f,x)}function dl(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||$i,un=$s.current,Rt($s,o),Rt(Hs,Hs.current),!0}function Mm(o,c,f){var x=o.stateNode;if(!x)throw Error(t(169));f?(o=$m(o,c,un),x.__reactInternalMemoizedMergedChildContext=o,$t(Hs),$t($s),Rt($s,o)):$t(Hs),Rt(Hs,f)}var di=null,hl=!1,Au=!1;function Fm(o){di===null?di=[o]:di.push(o)}function Hb(o){hl=!0,Fm(o)}function Mi(){if(!Au&&di!==null){Au=!0;var o=0,c=St;try{var f=di;for(St=1;o<f.length;o++){var x=f[o];do x=x(!0);while(x!==null)}di=null,hl=!1}catch(w){throw di!==null&&(di=di.slice(o+1)),Ir(On,Mi),w}finally{St=c,Au=!1}}return null}var Hn=[],qn=0,fl=null,ml=0,yr=[],br=0,dn=null,hi=1,fi="";function hn(o,c){Hn[qn++]=ml,Hn[qn++]=fl,fl=o,ml=c}function Um(o,c,f){yr[br++]=hi,yr[br++]=fi,yr[br++]=dn,dn=o;var x=hi;o=fi;var w=32-Ie(x)-1;x&=~(1<<w),f+=1;var E=32-Ie(c)+w;if(30<E){var R=w-w%5;E=(x&(1<<R)-1).toString(32),x>>=R,w-=R,hi=1<<32-Ie(c)+w|f<<w|x,fi=E+o}else hi=1<<E|f<<w|x,fi=o}function Iu(o){o.return!==null&&(hn(o,1),Um(o,1,0))}function Lu(o){for(;o===fl;)fl=Hn[--qn],Hn[qn]=null,ml=Hn[--qn],Hn[qn]=null;for(;o===dn;)dn=yr[--br],yr[br]=null,fi=yr[--br],yr[br]=null,hi=yr[--br],yr[br]=null}var ir=null,nr=null,Ut=!1,Rr=null;function Bm(o,c){var f=Tr(5,null,null,0);f.elementType="DELETED",f.stateNode=c,f.return=o,c=o.deletions,c===null?(o.deletions=[f],o.flags|=16):c.push(f)}function zm(o,c){switch(o.tag){case 5:var f=o.type;return c=c.nodeType!==1||f.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(o.stateNode=c,ir=o,nr=Di(c.firstChild),!0):!1;case 6:return c=o.pendingProps===""||c.nodeType!==3?null:c,c!==null?(o.stateNode=c,ir=o,nr=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(f=dn!==null?{id:hi,overflow:fi}:null,o.memoizedState={dehydrated:c,treeContext:f,retryLane:1073741824},f=Tr(18,null,null,0),f.stateNode=c,f.return=o,o.child=f,ir=o,nr=null,!0):!1;default:return!1}}function Ru(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Nu(o){if(Ut){var c=nr;if(c){var f=c;if(!zm(o,c)){if(Ru(o))throw Error(t(418));c=Di(f.nextSibling);var x=ir;c&&zm(o,c)?Bm(x,f):(o.flags=o.flags&-4097|2,Ut=!1,ir=o)}}else{if(Ru(o))throw Error(t(418));o.flags=o.flags&-4097|2,Ut=!1,ir=o}}}function Gm(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;ir=o}function pl(o){if(o!==ir)return!1;if(!Ut)return Gm(o),Ut=!0,!1;var c;if((c=o.tag!==3)&&!(c=o.tag!==5)&&(c=o.type,c=c!=="head"&&c!=="body"&&!Su(o.type,o.memoizedProps)),c&&(c=nr)){if(Ru(o))throw Vm(),Error(t(418));for(;c;)Bm(o,c),c=Di(c.nextSibling)}if(Gm(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(t(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8){var f=o.data;if(f==="/$"){if(c===0){nr=Di(o.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++}o=o.nextSibling}nr=null}}else nr=ir?Di(o.stateNode.nextSibling):null;return!0}function Vm(){for(var o=nr;o;)o=Di(o.nextSibling)}function Yn(){nr=ir=null,Ut=!1}function Cu(o){Rr===null?Rr=[o]:Rr.push(o)}var qb=I.ReactCurrentBatchConfig;function eo(o,c,f){if(o=f.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(t(309));var x=f.stateNode}if(!x)throw Error(t(147,o));var w=x,E=""+o;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===E?c.ref:(c=function(R){var U=w.refs;R===null?delete U[E]:U[E]=R},c._stringRef=E,c)}if(typeof o!="string")throw Error(t(284));if(!f._owner)throw Error(t(290,o))}return o}function gl(o,c){throw o=Object.prototype.toString.call(c),Error(t(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o))}function Km(o){var c=o._init;return c(o._payload)}function Wm(o){function c(ee,Q){if(o){var se=ee.deletions;se===null?(ee.deletions=[Q],ee.flags|=16):se.push(Q)}}function f(ee,Q){if(!o)return null;for(;Q!==null;)c(ee,Q),Q=Q.sibling;return null}function x(ee,Q){for(ee=new Map;Q!==null;)Q.key!==null?ee.set(Q.key,Q):ee.set(Q.index,Q),Q=Q.sibling;return ee}function w(ee,Q){return ee=Wi(ee,Q),ee.index=0,ee.sibling=null,ee}function E(ee,Q,se){return ee.index=se,o?(se=ee.alternate,se!==null?(se=se.index,se<Q?(ee.flags|=2,Q):se):(ee.flags|=2,Q)):(ee.flags|=1048576,Q)}function R(ee){return o&&ee.alternate===null&&(ee.flags|=2),ee}function U(ee,Q,se,xe){return Q===null||Q.tag!==6?(Q=Ed(se,ee.mode,xe),Q.return=ee,Q):(Q=w(Q,se),Q.return=ee,Q)}function V(ee,Q,se,xe){var Be=se.type;return Be===N?me(ee,Q,se.props.children,xe,se.key):Q!==null&&(Q.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===z&&Km(Be)===Q.type)?(xe=w(Q,se.props),xe.ref=eo(ee,Q,se),xe.return=ee,xe):(xe=Ul(se.type,se.key,se.props,null,ee.mode,xe),xe.ref=eo(ee,Q,se),xe.return=ee,xe)}function ae(ee,Q,se,xe){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==se.containerInfo||Q.stateNode.implementation!==se.implementation?(Q=Td(se,ee.mode,xe),Q.return=ee,Q):(Q=w(Q,se.children||[]),Q.return=ee,Q)}function me(ee,Q,se,xe,Be){return Q===null||Q.tag!==7?(Q=bn(se,ee.mode,xe,Be),Q.return=ee,Q):(Q=w(Q,se),Q.return=ee,Q)}function ge(ee,Q,se){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=Ed(""+Q,ee.mode,se),Q.return=ee,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case C:return se=Ul(Q.type,Q.key,Q.props,null,ee.mode,se),se.ref=eo(ee,null,Q),se.return=ee,se;case $:return Q=Td(Q,ee.mode,se),Q.return=ee,Q;case z:var xe=Q._init;return ge(ee,xe(Q._payload),se)}if(Ne(Q)||H(Q))return Q=bn(Q,ee.mode,se,null),Q.return=ee,Q;gl(ee,Q)}return null}function he(ee,Q,se,xe){var Be=Q!==null?Q.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return Be!==null?null:U(ee,Q,""+se,xe);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case C:return se.key===Be?V(ee,Q,se,xe):null;case $:return se.key===Be?ae(ee,Q,se,xe):null;case z:return Be=se._init,he(ee,Q,Be(se._payload),xe)}if(Ne(se)||H(se))return Be!==null?null:me(ee,Q,se,xe,null);gl(ee,se)}return null}function Re(ee,Q,se,xe,Be){if(typeof xe=="string"&&xe!==""||typeof xe=="number")return ee=ee.get(se)||null,U(Q,ee,""+xe,Be);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case C:return ee=ee.get(xe.key===null?se:xe.key)||null,V(Q,ee,xe,Be);case $:return ee=ee.get(xe.key===null?se:xe.key)||null,ae(Q,ee,xe,Be);case z:var qe=xe._init;return Re(ee,Q,se,qe(xe._payload),Be)}if(Ne(xe)||H(xe))return ee=ee.get(se)||null,me(Q,ee,xe,Be,null);gl(Q,xe)}return null}function De(ee,Q,se,xe){for(var Be=null,qe=null,Ye=Q,tt=Q=0,Es=null;Ye!==null&&tt<se.length;tt++){Ye.index>tt?(Es=Ye,Ye=null):Es=Ye.sibling;var xt=he(ee,Ye,se[tt],xe);if(xt===null){Ye===null&&(Ye=Es);break}o&&Ye&&xt.alternate===null&&c(ee,Ye),Q=E(xt,Q,tt),qe===null?Be=xt:qe.sibling=xt,qe=xt,Ye=Es}if(tt===se.length)return f(ee,Ye),Ut&&hn(ee,tt),Be;if(Ye===null){for(;tt<se.length;tt++)Ye=ge(ee,se[tt],xe),Ye!==null&&(Q=E(Ye,Q,tt),qe===null?Be=Ye:qe.sibling=Ye,qe=Ye);return Ut&&hn(ee,tt),Be}for(Ye=x(ee,Ye);tt<se.length;tt++)Es=Re(Ye,ee,tt,se[tt],xe),Es!==null&&(o&&Es.alternate!==null&&Ye.delete(Es.key===null?tt:Es.key),Q=E(Es,Q,tt),qe===null?Be=Es:qe.sibling=Es,qe=Es);return o&&Ye.forEach(function(Hi){return c(ee,Hi)}),Ut&&hn(ee,tt),Be}function Me(ee,Q,se,xe){var Be=H(se);if(typeof Be!="function")throw Error(t(150));if(se=Be.call(se),se==null)throw Error(t(151));for(var qe=Be=null,Ye=Q,tt=Q=0,Es=null,xt=se.next();Ye!==null&&!xt.done;tt++,xt=se.next()){Ye.index>tt?(Es=Ye,Ye=null):Es=Ye.sibling;var Hi=he(ee,Ye,xt.value,xe);if(Hi===null){Ye===null&&(Ye=Es);break}o&&Ye&&Hi.alternate===null&&c(ee,Ye),Q=E(Hi,Q,tt),qe===null?Be=Hi:qe.sibling=Hi,qe=Hi,Ye=Es}if(xt.done)return f(ee,Ye),Ut&&hn(ee,tt),Be;if(Ye===null){for(;!xt.done;tt++,xt=se.next())xt=ge(ee,xt.value,xe),xt!==null&&(Q=E(xt,Q,tt),qe===null?Be=xt:qe.sibling=xt,qe=xt);return Ut&&hn(ee,tt),Be}for(Ye=x(ee,Ye);!xt.done;tt++,xt=se.next())xt=Re(Ye,ee,tt,xt.value,xe),xt!==null&&(o&&xt.alternate!==null&&Ye.delete(xt.key===null?tt:xt.key),Q=E(xt,Q,tt),qe===null?Be=xt:qe.sibling=xt,qe=xt);return o&&Ye.forEach(function(Aw){return c(ee,Aw)}),Ut&&hn(ee,tt),Be}function rs(ee,Q,se,xe){if(typeof se=="object"&&se!==null&&se.type===N&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case C:e:{for(var Be=se.key,qe=Q;qe!==null;){if(qe.key===Be){if(Be=se.type,Be===N){if(qe.tag===7){f(ee,qe.sibling),Q=w(qe,se.props.children),Q.return=ee,ee=Q;break e}}else if(qe.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===z&&Km(Be)===qe.type){f(ee,qe.sibling),Q=w(qe,se.props),Q.ref=eo(ee,qe,se),Q.return=ee,ee=Q;break e}f(ee,qe);break}else c(ee,qe);qe=qe.sibling}se.type===N?(Q=bn(se.props.children,ee.mode,xe,se.key),Q.return=ee,ee=Q):(xe=Ul(se.type,se.key,se.props,null,ee.mode,xe),xe.ref=eo(ee,Q,se),xe.return=ee,ee=xe)}return R(ee);case $:e:{for(qe=se.key;Q!==null;){if(Q.key===qe)if(Q.tag===4&&Q.stateNode.containerInfo===se.containerInfo&&Q.stateNode.implementation===se.implementation){f(ee,Q.sibling),Q=w(Q,se.children||[]),Q.return=ee,ee=Q;break e}else{f(ee,Q);break}else c(ee,Q);Q=Q.sibling}Q=Td(se,ee.mode,xe),Q.return=ee,ee=Q}return R(ee);case z:return qe=se._init,rs(ee,Q,qe(se._payload),xe)}if(Ne(se))return De(ee,Q,se,xe);if(H(se))return Me(ee,Q,se,xe);gl(ee,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,Q!==null&&Q.tag===6?(f(ee,Q.sibling),Q=w(Q,se),Q.return=ee,ee=Q):(f(ee,Q),Q=Ed(se,ee.mode,xe),Q.return=ee,ee=Q),R(ee)):f(ee,Q)}return rs}var Qn=Wm(!0),Hm=Wm(!1),xl=Oi(null),vl=null,Xn=null,ju=null;function Pu(){ju=Xn=vl=null}function Du(o){var c=xl.current;$t(xl),o._currentValue=c}function Ou(o,c,f){for(;o!==null;){var x=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,x!==null&&(x.childLanes|=c)):x!==null&&(x.childLanes&c)!==c&&(x.childLanes|=c),o===f)break;o=o.return}}function Jn(o,c){vl=o,ju=Xn=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&c)!==0&&(Ys=!0),o.firstContext=null)}function wr(o){var c=o._currentValue;if(ju!==o)if(o={context:o,memoizedValue:c,next:null},Xn===null){if(vl===null)throw Error(t(308));Xn=o,vl.dependencies={lanes:0,firstContext:o}}else Xn=Xn.next=o;return c}var fn=null;function $u(o){fn===null?fn=[o]:fn.push(o)}function qm(o,c,f,x){var w=c.interleaved;return w===null?(f.next=f,$u(c)):(f.next=w.next,w.next=f),c.interleaved=f,mi(o,x)}function mi(o,c){o.lanes|=c;var f=o.alternate;for(f!==null&&(f.lanes|=c),f=o,o=o.return;o!==null;)o.childLanes|=c,f=o.alternate,f!==null&&(f.childLanes|=c),f=o,o=o.return;return f.tag===3?f.stateNode:null}var Fi=!1;function Mu(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ym(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function pi(o,c){return{eventTime:o,lane:c,tag:0,payload:null,callback:null,next:null}}function Ui(o,c,f){var x=o.updateQueue;if(x===null)return null;if(x=x.shared,(pt&2)!==0){var w=x.pending;return w===null?c.next=c:(c.next=w.next,w.next=c),x.pending=c,mi(o,f)}return w=x.interleaved,w===null?(c.next=c,$u(x)):(c.next=w.next,w.next=c),x.interleaved=c,mi(o,f)}function yl(o,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194240)!==0)){var x=c.lanes;x&=o.pendingLanes,f|=x,c.lanes=f,Jc(o,f)}}function Qm(o,c){var f=o.updateQueue,x=o.alternate;if(x!==null&&(x=x.updateQueue,f===x)){var w=null,E=null;if(f=f.firstBaseUpdate,f!==null){do{var R={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};E===null?w=E=R:E=E.next=R,f=f.next}while(f!==null);E===null?w=E=c:E=E.next=c}else w=E=c;f={baseState:x.baseState,firstBaseUpdate:w,lastBaseUpdate:E,shared:x.shared,effects:x.effects},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=c:o.next=c,f.lastBaseUpdate=c}function bl(o,c,f,x){var w=o.updateQueue;Fi=!1;var E=w.firstBaseUpdate,R=w.lastBaseUpdate,U=w.shared.pending;if(U!==null){w.shared.pending=null;var V=U,ae=V.next;V.next=null,R===null?E=ae:R.next=ae,R=V;var me=o.alternate;me!==null&&(me=me.updateQueue,U=me.lastBaseUpdate,U!==R&&(U===null?me.firstBaseUpdate=ae:U.next=ae,me.lastBaseUpdate=V))}if(E!==null){var ge=w.baseState;R=0,me=ae=V=null,U=E;do{var he=U.lane,Re=U.eventTime;if((x&he)===he){me!==null&&(me=me.next={eventTime:Re,lane:0,tag:U.tag,payload:U.payload,callback:U.callback,next:null});e:{var De=o,Me=U;switch(he=c,Re=f,Me.tag){case 1:if(De=Me.payload,typeof De=="function"){ge=De.call(Re,ge,he);break e}ge=De;break e;case 3:De.flags=De.flags&-65537|128;case 0:if(De=Me.payload,he=typeof De=="function"?De.call(Re,ge,he):De,he==null)break e;ge=Y({},ge,he);break e;case 2:Fi=!0}}U.callback!==null&&U.lane!==0&&(o.flags|=64,he=w.effects,he===null?w.effects=[U]:he.push(U))}else Re={eventTime:Re,lane:he,tag:U.tag,payload:U.payload,callback:U.callback,next:null},me===null?(ae=me=Re,V=ge):me=me.next=Re,R|=he;if(U=U.next,U===null){if(U=w.shared.pending,U===null)break;he=U,U=he.next,he.next=null,w.lastBaseUpdate=he,w.shared.pending=null}}while(!0);if(me===null&&(V=ge),w.baseState=V,w.firstBaseUpdate=ae,w.lastBaseUpdate=me,c=w.shared.interleaved,c!==null){w=c;do R|=w.lane,w=w.next;while(w!==c)}else E===null&&(w.shared.lanes=0);gn|=R,o.lanes=R,o.memoizedState=ge}}function Xm(o,c,f){if(o=c.effects,c.effects=null,o!==null)for(c=0;c<o.length;c++){var x=o[c],w=x.callback;if(w!==null){if(x.callback=null,x=f,typeof w!="function")throw Error(t(191,w));w.call(x)}}}var to={},Wr=Oi(to),so=Oi(to),ro=Oi(to);function mn(o){if(o===to)throw Error(t(174));return o}function Fu(o,c){switch(Rt(ro,c),Rt(so,o),Rt(Wr,to),o=c.nodeType,o){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:zs(null,"");break;default:o=o===8?c.parentNode:c,c=o.namespaceURI||null,o=o.tagName,c=zs(c,o)}$t(Wr),Rt(Wr,c)}function Zn(){$t(Wr),$t(so),$t(ro)}function Jm(o){mn(ro.current);var c=mn(Wr.current),f=zs(c,o.type);c!==f&&(Rt(so,o),Rt(Wr,f))}function Uu(o){so.current===o&&($t(Wr),$t(so))}var Vt=Oi(0);function wl(o){for(var c=o;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Bu=[];function zu(){for(var o=0;o<Bu.length;o++)Bu[o]._workInProgressVersionPrimary=null;Bu.length=0}var Sl=I.ReactCurrentDispatcher,Gu=I.ReactCurrentBatchConfig,pn=0,Kt=null,hs=null,ws=null,El=!1,io=!1,no=0,Yb=0;function Ms(){throw Error(t(321))}function Vu(o,c){if(c===null)return!1;for(var f=0;f<c.length&&f<o.length;f++)if(!Lr(o[f],c[f]))return!1;return!0}function Ku(o,c,f,x,w,E){if(pn=E,Kt=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,Sl.current=o===null||o.memoizedState===null?Zb:ew,o=f(x,w),io){E=0;do{if(io=!1,no=0,25<=E)throw Error(t(301));E+=1,ws=hs=null,c.updateQueue=null,Sl.current=tw,o=f(x,w)}while(io)}if(Sl.current=kl,c=hs!==null&&hs.next!==null,pn=0,ws=hs=Kt=null,El=!1,c)throw Error(t(300));return o}function Wu(){var o=no!==0;return no=0,o}function Hr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ws===null?Kt.memoizedState=ws=o:ws=ws.next=o,ws}function Sr(){if(hs===null){var o=Kt.alternate;o=o!==null?o.memoizedState:null}else o=hs.next;var c=ws===null?Kt.memoizedState:ws.next;if(c!==null)ws=c,hs=o;else{if(o===null)throw Error(t(310));hs=o,o={memoizedState:hs.memoizedState,baseState:hs.baseState,baseQueue:hs.baseQueue,queue:hs.queue,next:null},ws===null?Kt.memoizedState=ws=o:ws=ws.next=o}return ws}function ao(o,c){return typeof c=="function"?c(o):c}function Hu(o){var c=Sr(),f=c.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=o;var x=hs,w=x.baseQueue,E=f.pending;if(E!==null){if(w!==null){var R=w.next;w.next=E.next,E.next=R}x.baseQueue=w=E,f.pending=null}if(w!==null){E=w.next,x=x.baseState;var U=R=null,V=null,ae=E;do{var me=ae.lane;if((pn&me)===me)V!==null&&(V=V.next={lane:0,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null}),x=ae.hasEagerState?ae.eagerState:o(x,ae.action);else{var ge={lane:me,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null};V===null?(U=V=ge,R=x):V=V.next=ge,Kt.lanes|=me,gn|=me}ae=ae.next}while(ae!==null&&ae!==E);V===null?R=x:V.next=U,Lr(x,c.memoizedState)||(Ys=!0),c.memoizedState=x,c.baseState=R,c.baseQueue=V,f.lastRenderedState=x}if(o=f.interleaved,o!==null){w=o;do E=w.lane,Kt.lanes|=E,gn|=E,w=w.next;while(w!==o)}else w===null&&(f.lanes=0);return[c.memoizedState,f.dispatch]}function qu(o){var c=Sr(),f=c.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=o;var x=f.dispatch,w=f.pending,E=c.memoizedState;if(w!==null){f.pending=null;var R=w=w.next;do E=o(E,R.action),R=R.next;while(R!==w);Lr(E,c.memoizedState)||(Ys=!0),c.memoizedState=E,c.baseQueue===null&&(c.baseState=E),f.lastRenderedState=E}return[E,x]}function Zm(){}function ep(o,c){var f=Kt,x=Sr(),w=c(),E=!Lr(x.memoizedState,w);if(E&&(x.memoizedState=w,Ys=!0),x=x.queue,Yu(rp.bind(null,f,x,o),[o]),x.getSnapshot!==c||E||ws!==null&&ws.memoizedState.tag&1){if(f.flags|=2048,oo(9,sp.bind(null,f,x,w,c),void 0,null),Ss===null)throw Error(t(349));(pn&30)!==0||tp(f,c,w)}return w}function tp(o,c,f){o.flags|=16384,o={getSnapshot:c,value:f},c=Kt.updateQueue,c===null?(c={lastEffect:null,stores:null},Kt.updateQueue=c,c.stores=[o]):(f=c.stores,f===null?c.stores=[o]:f.push(o))}function sp(o,c,f,x){c.value=f,c.getSnapshot=x,ip(c)&&np(o)}function rp(o,c,f){return f(function(){ip(c)&&np(o)})}function ip(o){var c=o.getSnapshot;o=o.value;try{var f=c();return!Lr(o,f)}catch{return!0}}function np(o){var c=mi(o,1);c!==null&&Pr(c,o,1,-1)}function ap(o){var c=Hr();return typeof o=="function"&&(o=o()),c.memoizedState=c.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:o},c.queue=o,o=o.dispatch=Jb.bind(null,Kt,o),[c.memoizedState,o]}function oo(o,c,f,x){return o={tag:o,create:c,destroy:f,deps:x,next:null},c=Kt.updateQueue,c===null?(c={lastEffect:null,stores:null},Kt.updateQueue=c,c.lastEffect=o.next=o):(f=c.lastEffect,f===null?c.lastEffect=o.next=o:(x=f.next,f.next=o,o.next=x,c.lastEffect=o)),o}function op(){return Sr().memoizedState}function Tl(o,c,f,x){var w=Hr();Kt.flags|=o,w.memoizedState=oo(1|c,f,void 0,x===void 0?null:x)}function _l(o,c,f,x){var w=Sr();x=x===void 0?null:x;var E=void 0;if(hs!==null){var R=hs.memoizedState;if(E=R.destroy,x!==null&&Vu(x,R.deps)){w.memoizedState=oo(c,f,E,x);return}}Kt.flags|=o,w.memoizedState=oo(1|c,f,E,x)}function lp(o,c){return Tl(8390656,8,o,c)}function Yu(o,c){return _l(2048,8,o,c)}function cp(o,c){return _l(4,2,o,c)}function up(o,c){return _l(4,4,o,c)}function dp(o,c){if(typeof c=="function")return o=o(),c(o),function(){c(null)};if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function hp(o,c,f){return f=f!=null?f.concat([o]):null,_l(4,4,dp.bind(null,c,o),f)}function Qu(){}function fp(o,c){var f=Sr();c=c===void 0?null:c;var x=f.memoizedState;return x!==null&&c!==null&&Vu(c,x[1])?x[0]:(f.memoizedState=[o,c],o)}function mp(o,c){var f=Sr();c=c===void 0?null:c;var x=f.memoizedState;return x!==null&&c!==null&&Vu(c,x[1])?x[0]:(o=o(),f.memoizedState=[o,c],o)}function pp(o,c,f){return(pn&21)===0?(o.baseState&&(o.baseState=!1,Ys=!0),o.memoizedState=f):(Lr(f,c)||(f=Xt(),Kt.lanes|=f,gn|=f,o.baseState=!0),c)}function Qb(o,c){var f=St;St=f!==0&&4>f?f:4,o(!0);var x=Gu.transition;Gu.transition={};try{o(!1),c()}finally{St=f,Gu.transition=x}}function gp(){return Sr().memoizedState}function Xb(o,c,f){var x=Vi(o);if(f={lane:x,action:f,hasEagerState:!1,eagerState:null,next:null},xp(o))vp(c,f);else if(f=qm(o,c,f,x),f!==null){var w=Vs();Pr(f,o,x,w),yp(f,c,x)}}function Jb(o,c,f){var x=Vi(o),w={lane:x,action:f,hasEagerState:!1,eagerState:null,next:null};if(xp(o))vp(c,w);else{var E=o.alternate;if(o.lanes===0&&(E===null||E.lanes===0)&&(E=c.lastRenderedReducer,E!==null))try{var R=c.lastRenderedState,U=E(R,f);if(w.hasEagerState=!0,w.eagerState=U,Lr(U,R)){var V=c.interleaved;V===null?(w.next=w,$u(c)):(w.next=V.next,V.next=w),c.interleaved=w;return}}catch{}finally{}f=qm(o,c,w,x),f!==null&&(w=Vs(),Pr(f,o,x,w),yp(f,c,x))}}function xp(o){var c=o.alternate;return o===Kt||c!==null&&c===Kt}function vp(o,c){io=El=!0;var f=o.pending;f===null?c.next=c:(c.next=f.next,f.next=c),o.pending=c}function yp(o,c,f){if((f&4194240)!==0){var x=c.lanes;x&=o.pendingLanes,f|=x,c.lanes=f,Jc(o,f)}}var kl={readContext:wr,useCallback:Ms,useContext:Ms,useEffect:Ms,useImperativeHandle:Ms,useInsertionEffect:Ms,useLayoutEffect:Ms,useMemo:Ms,useReducer:Ms,useRef:Ms,useState:Ms,useDebugValue:Ms,useDeferredValue:Ms,useTransition:Ms,useMutableSource:Ms,useSyncExternalStore:Ms,useId:Ms,unstable_isNewReconciler:!1},Zb={readContext:wr,useCallback:function(o,c){return Hr().memoizedState=[o,c===void 0?null:c],o},useContext:wr,useEffect:lp,useImperativeHandle:function(o,c,f){return f=f!=null?f.concat([o]):null,Tl(4194308,4,dp.bind(null,c,o),f)},useLayoutEffect:function(o,c){return Tl(4194308,4,o,c)},useInsertionEffect:function(o,c){return Tl(4,2,o,c)},useMemo:function(o,c){var f=Hr();return c=c===void 0?null:c,o=o(),f.memoizedState=[o,c],o},useReducer:function(o,c,f){var x=Hr();return c=f!==void 0?f(c):c,x.memoizedState=x.baseState=c,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:c},x.queue=o,o=o.dispatch=Xb.bind(null,Kt,o),[x.memoizedState,o]},useRef:function(o){var c=Hr();return o={current:o},c.memoizedState=o},useState:ap,useDebugValue:Qu,useDeferredValue:function(o){return Hr().memoizedState=o},useTransition:function(){var o=ap(!1),c=o[0];return o=Qb.bind(null,o[1]),Hr().memoizedState=o,[c,o]},useMutableSource:function(){},useSyncExternalStore:function(o,c,f){var x=Kt,w=Hr();if(Ut){if(f===void 0)throw Error(t(407));f=f()}else{if(f=c(),Ss===null)throw Error(t(349));(pn&30)!==0||tp(x,c,f)}w.memoizedState=f;var E={value:f,getSnapshot:c};return w.queue=E,lp(rp.bind(null,x,E,o),[o]),x.flags|=2048,oo(9,sp.bind(null,x,E,f,c),void 0,null),f},useId:function(){var o=Hr(),c=Ss.identifierPrefix;if(Ut){var f=fi,x=hi;f=(x&~(1<<32-Ie(x)-1)).toString(32)+f,c=":"+c+"R"+f,f=no++,0<f&&(c+="H"+f.toString(32)),c+=":"}else f=Yb++,c=":"+c+"r"+f.toString(32)+":";return o.memoizedState=c},unstable_isNewReconciler:!1},ew={readContext:wr,useCallback:fp,useContext:wr,useEffect:Yu,useImperativeHandle:hp,useInsertionEffect:cp,useLayoutEffect:up,useMemo:mp,useReducer:Hu,useRef:op,useState:function(){return Hu(ao)},useDebugValue:Qu,useDeferredValue:function(o){var c=Sr();return pp(c,hs.memoizedState,o)},useTransition:function(){var o=Hu(ao)[0],c=Sr().memoizedState;return[o,c]},useMutableSource:Zm,useSyncExternalStore:ep,useId:gp,unstable_isNewReconciler:!1},tw={readContext:wr,useCallback:fp,useContext:wr,useEffect:Yu,useImperativeHandle:hp,useInsertionEffect:cp,useLayoutEffect:up,useMemo:mp,useReducer:qu,useRef:op,useState:function(){return qu(ao)},useDebugValue:Qu,useDeferredValue:function(o){var c=Sr();return hs===null?c.memoizedState=o:pp(c,hs.memoizedState,o)},useTransition:function(){var o=qu(ao)[0],c=Sr().memoizedState;return[o,c]},useMutableSource:Zm,useSyncExternalStore:ep,useId:gp,unstable_isNewReconciler:!1};function Nr(o,c){if(o&&o.defaultProps){c=Y({},c),o=o.defaultProps;for(var f in o)c[f]===void 0&&(c[f]=o[f]);return c}return c}function Xu(o,c,f,x){c=o.memoizedState,f=f(x,c),f=f==null?c:Y({},c,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var Al={isMounted:function(o){return(o=o._reactInternals)?xr(o)===o:!1},enqueueSetState:function(o,c,f){o=o._reactInternals;var x=Vs(),w=Vi(o),E=pi(x,w);E.payload=c,f!=null&&(E.callback=f),c=Ui(o,E,w),c!==null&&(Pr(c,o,w,x),yl(c,o,w))},enqueueReplaceState:function(o,c,f){o=o._reactInternals;var x=Vs(),w=Vi(o),E=pi(x,w);E.tag=1,E.payload=c,f!=null&&(E.callback=f),c=Ui(o,E,w),c!==null&&(Pr(c,o,w,x),yl(c,o,w))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var f=Vs(),x=Vi(o),w=pi(f,x);w.tag=2,c!=null&&(w.callback=c),c=Ui(o,w,x),c!==null&&(Pr(c,o,x,f),yl(c,o,x))}};function bp(o,c,f,x,w,E,R){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(x,E,R):c.prototype&&c.prototype.isPureReactComponent?!Ha(f,x)||!Ha(w,E):!0}function wp(o,c,f){var x=!1,w=$i,E=c.contextType;return typeof E=="object"&&E!==null?E=wr(E):(w=qs(c)?un:$s.current,x=c.contextTypes,E=(x=x!=null)?Wn(o,w):$i),c=new c(f,E),o.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=Al,o.stateNode=c,c._reactInternals=o,x&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=w,o.__reactInternalMemoizedMaskedChildContext=E),c}function Sp(o,c,f,x){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,x),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,x),c.state!==o&&Al.enqueueReplaceState(c,c.state,null)}function Ju(o,c,f,x){var w=o.stateNode;w.props=f,w.state=o.memoizedState,w.refs={},Mu(o);var E=c.contextType;typeof E=="object"&&E!==null?w.context=wr(E):(E=qs(c)?un:$s.current,w.context=Wn(o,E)),w.state=o.memoizedState,E=c.getDerivedStateFromProps,typeof E=="function"&&(Xu(o,c,E,f),w.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(c=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),c!==w.state&&Al.enqueueReplaceState(w,w.state,null),bl(o,f,w,x),w.state=o.memoizedState),typeof w.componentDidMount=="function"&&(o.flags|=4194308)}function ea(o,c){try{var f="",x=c;do f+=ne(x),x=x.return;while(x);var w=f}catch(E){w=`
Error generating stack: `+E.message+`
`+E.stack}return{value:o,source:c,stack:w,digest:null}}function Zu(o,c,f){return{value:o,source:null,stack:f??null,digest:c??null}}function ed(o,c){try{console.error(c.value)}catch(f){setTimeout(function(){throw f})}}var sw=typeof WeakMap=="function"?WeakMap:Map;function Ep(o,c,f){f=pi(-1,f),f.tag=3,f.payload={element:null};var x=c.value;return f.callback=function(){Pl||(Pl=!0,pd=x),ed(o,c)},f}function Tp(o,c,f){f=pi(-1,f),f.tag=3;var x=o.type.getDerivedStateFromError;if(typeof x=="function"){var w=c.value;f.payload=function(){return x(w)},f.callback=function(){ed(o,c)}}var E=o.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(f.callback=function(){ed(o,c),typeof x!="function"&&(zi===null?zi=new Set([this]):zi.add(this));var R=c.stack;this.componentDidCatch(c.value,{componentStack:R!==null?R:""})}),f}function _p(o,c,f){var x=o.pingCache;if(x===null){x=o.pingCache=new sw;var w=new Set;x.set(c,w)}else w=x.get(c),w===void 0&&(w=new Set,x.set(c,w));w.has(f)||(w.add(f),o=gw.bind(null,o,c,f),c.then(o,o))}function kp(o){do{var c;if((c=o.tag===13)&&(c=o.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return o;o=o.return}while(o!==null);return null}function Ap(o,c,f,x,w){return(o.mode&1)===0?(o===c?o.flags|=65536:(o.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(c=pi(-1,1),c.tag=2,Ui(f,c,1))),f.lanes|=1),o):(o.flags|=65536,o.lanes=w,o)}var rw=I.ReactCurrentOwner,Ys=!1;function Gs(o,c,f,x){c.child=o===null?Hm(c,null,f,x):Qn(c,o.child,f,x)}function Ip(o,c,f,x,w){f=f.render;var E=c.ref;return Jn(c,w),x=Ku(o,c,f,x,E,w),f=Wu(),o!==null&&!Ys?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~w,gi(o,c,w)):(Ut&&f&&Iu(c),c.flags|=1,Gs(o,c,x,w),c.child)}function Lp(o,c,f,x,w){if(o===null){var E=f.type;return typeof E=="function"&&!Sd(E)&&E.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(c.tag=15,c.type=E,Rp(o,c,E,x,w)):(o=Ul(f.type,null,x,c,c.mode,w),o.ref=c.ref,o.return=c,c.child=o)}if(E=o.child,(o.lanes&w)===0){var R=E.memoizedProps;if(f=f.compare,f=f!==null?f:Ha,f(R,x)&&o.ref===c.ref)return gi(o,c,w)}return c.flags|=1,o=Wi(E,x),o.ref=c.ref,o.return=c,c.child=o}function Rp(o,c,f,x,w){if(o!==null){var E=o.memoizedProps;if(Ha(E,x)&&o.ref===c.ref)if(Ys=!1,c.pendingProps=x=E,(o.lanes&w)!==0)(o.flags&131072)!==0&&(Ys=!0);else return c.lanes=o.lanes,gi(o,c,w)}return td(o,c,f,x,w)}function Np(o,c,f){var x=c.pendingProps,w=x.children,E=o!==null?o.memoizedState:null;if(x.mode==="hidden")if((c.mode&1)===0)c.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rt(sa,ar),ar|=f;else{if((f&1073741824)===0)return o=E!==null?E.baseLanes|f:f,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:o,cachePool:null,transitions:null},c.updateQueue=null,Rt(sa,ar),ar|=o,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=E!==null?E.baseLanes:f,Rt(sa,ar),ar|=x}else E!==null?(x=E.baseLanes|f,c.memoizedState=null):x=f,Rt(sa,ar),ar|=x;return Gs(o,c,w,f),c.child}function Cp(o,c){var f=c.ref;(o===null&&f!==null||o!==null&&o.ref!==f)&&(c.flags|=512,c.flags|=2097152)}function td(o,c,f,x,w){var E=qs(f)?un:$s.current;return E=Wn(c,E),Jn(c,w),f=Ku(o,c,f,x,E,w),x=Wu(),o!==null&&!Ys?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~w,gi(o,c,w)):(Ut&&x&&Iu(c),c.flags|=1,Gs(o,c,f,w),c.child)}function jp(o,c,f,x,w){if(qs(f)){var E=!0;dl(c)}else E=!1;if(Jn(c,w),c.stateNode===null)Ll(o,c),wp(c,f,x),Ju(c,f,x,w),x=!0;else if(o===null){var R=c.stateNode,U=c.memoizedProps;R.props=U;var V=R.context,ae=f.contextType;typeof ae=="object"&&ae!==null?ae=wr(ae):(ae=qs(f)?un:$s.current,ae=Wn(c,ae));var me=f.getDerivedStateFromProps,ge=typeof me=="function"||typeof R.getSnapshotBeforeUpdate=="function";ge||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(U!==x||V!==ae)&&Sp(c,R,x,ae),Fi=!1;var he=c.memoizedState;R.state=he,bl(c,x,R,w),V=c.memoizedState,U!==x||he!==V||Hs.current||Fi?(typeof me=="function"&&(Xu(c,f,me,x),V=c.memoizedState),(U=Fi||bp(c,f,U,x,he,V,ae))?(ge||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(c.flags|=4194308)):(typeof R.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=x,c.memoizedState=V),R.props=x,R.state=V,R.context=ae,x=U):(typeof R.componentDidMount=="function"&&(c.flags|=4194308),x=!1)}else{R=c.stateNode,Ym(o,c),U=c.memoizedProps,ae=c.type===c.elementType?U:Nr(c.type,U),R.props=ae,ge=c.pendingProps,he=R.context,V=f.contextType,typeof V=="object"&&V!==null?V=wr(V):(V=qs(f)?un:$s.current,V=Wn(c,V));var Re=f.getDerivedStateFromProps;(me=typeof Re=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(U!==ge||he!==V)&&Sp(c,R,x,V),Fi=!1,he=c.memoizedState,R.state=he,bl(c,x,R,w);var De=c.memoizedState;U!==ge||he!==De||Hs.current||Fi?(typeof Re=="function"&&(Xu(c,f,Re,x),De=c.memoizedState),(ae=Fi||bp(c,f,ae,x,he,De,V)||!1)?(me||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(x,De,V),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(x,De,V)),typeof R.componentDidUpdate=="function"&&(c.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof R.componentDidUpdate!="function"||U===o.memoizedProps&&he===o.memoizedState||(c.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||U===o.memoizedProps&&he===o.memoizedState||(c.flags|=1024),c.memoizedProps=x,c.memoizedState=De),R.props=x,R.state=De,R.context=V,x=ae):(typeof R.componentDidUpdate!="function"||U===o.memoizedProps&&he===o.memoizedState||(c.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||U===o.memoizedProps&&he===o.memoizedState||(c.flags|=1024),x=!1)}return sd(o,c,f,x,E,w)}function sd(o,c,f,x,w,E){Cp(o,c);var R=(c.flags&128)!==0;if(!x&&!R)return w&&Mm(c,f,!1),gi(o,c,E);x=c.stateNode,rw.current=c;var U=R&&typeof f.getDerivedStateFromError!="function"?null:x.render();return c.flags|=1,o!==null&&R?(c.child=Qn(c,o.child,null,E),c.child=Qn(c,null,U,E)):Gs(o,c,U,E),c.memoizedState=x.state,w&&Mm(c,f,!0),c.child}function Pp(o){var c=o.stateNode;c.pendingContext?Om(o,c.pendingContext,c.pendingContext!==c.context):c.context&&Om(o,c.context,!1),Fu(o,c.containerInfo)}function Dp(o,c,f,x,w){return Yn(),Cu(w),c.flags|=256,Gs(o,c,f,x),c.child}var rd={dehydrated:null,treeContext:null,retryLane:0};function id(o){return{baseLanes:o,cachePool:null,transitions:null}}function Op(o,c,f){var x=c.pendingProps,w=Vt.current,E=!1,R=(c.flags&128)!==0,U;if((U=R)||(U=o!==null&&o.memoizedState===null?!1:(w&2)!==0),U?(E=!0,c.flags&=-129):(o===null||o.memoizedState!==null)&&(w|=1),Rt(Vt,w&1),o===null)return Nu(c),o=c.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((c.mode&1)===0?c.lanes=1:o.data==="$!"?c.lanes=8:c.lanes=1073741824,null):(R=x.children,o=x.fallback,E?(x=c.mode,E=c.child,R={mode:"hidden",children:R},(x&1)===0&&E!==null?(E.childLanes=0,E.pendingProps=R):E=Bl(R,x,0,null),o=bn(o,x,f,null),E.return=c,o.return=c,E.sibling=o,c.child=E,c.child.memoizedState=id(f),c.memoizedState=rd,o):nd(c,R));if(w=o.memoizedState,w!==null&&(U=w.dehydrated,U!==null))return iw(o,c,R,x,U,w,f);if(E){E=x.fallback,R=c.mode,w=o.child,U=w.sibling;var V={mode:"hidden",children:x.children};return(R&1)===0&&c.child!==w?(x=c.child,x.childLanes=0,x.pendingProps=V,c.deletions=null):(x=Wi(w,V),x.subtreeFlags=w.subtreeFlags&14680064),U!==null?E=Wi(U,E):(E=bn(E,R,f,null),E.flags|=2),E.return=c,x.return=c,x.sibling=E,c.child=x,x=E,E=c.child,R=o.child.memoizedState,R=R===null?id(f):{baseLanes:R.baseLanes|f,cachePool:null,transitions:R.transitions},E.memoizedState=R,E.childLanes=o.childLanes&~f,c.memoizedState=rd,x}return E=o.child,o=E.sibling,x=Wi(E,{mode:"visible",children:x.children}),(c.mode&1)===0&&(x.lanes=f),x.return=c,x.sibling=null,o!==null&&(f=c.deletions,f===null?(c.deletions=[o],c.flags|=16):f.push(o)),c.child=x,c.memoizedState=null,x}function nd(o,c){return c=Bl({mode:"visible",children:c},o.mode,0,null),c.return=o,o.child=c}function Il(o,c,f,x){return x!==null&&Cu(x),Qn(c,o.child,null,f),o=nd(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function iw(o,c,f,x,w,E,R){if(f)return c.flags&256?(c.flags&=-257,x=Zu(Error(t(422))),Il(o,c,R,x)):c.memoizedState!==null?(c.child=o.child,c.flags|=128,null):(E=x.fallback,w=c.mode,x=Bl({mode:"visible",children:x.children},w,0,null),E=bn(E,w,R,null),E.flags|=2,x.return=c,E.return=c,x.sibling=E,c.child=x,(c.mode&1)!==0&&Qn(c,o.child,null,R),c.child.memoizedState=id(R),c.memoizedState=rd,E);if((c.mode&1)===0)return Il(o,c,R,null);if(w.data==="$!"){if(x=w.nextSibling&&w.nextSibling.dataset,x)var U=x.dgst;return x=U,E=Error(t(419)),x=Zu(E,x,void 0),Il(o,c,R,x)}if(U=(R&o.childLanes)!==0,Ys||U){if(x=Ss,x!==null){switch(R&-R){case 4:w=2;break;case 16:w=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:w=32;break;case 536870912:w=268435456;break;default:w=0}w=(w&(x.suspendedLanes|R))!==0?0:w,w!==0&&w!==E.retryLane&&(E.retryLane=w,mi(o,w),Pr(x,o,w,-1))}return wd(),x=Zu(Error(t(421))),Il(o,c,R,x)}return w.data==="$?"?(c.flags|=128,c.child=o.child,c=xw.bind(null,o),w._reactRetry=c,null):(o=E.treeContext,nr=Di(w.nextSibling),ir=c,Ut=!0,Rr=null,o!==null&&(yr[br++]=hi,yr[br++]=fi,yr[br++]=dn,hi=o.id,fi=o.overflow,dn=c),c=nd(c,x.children),c.flags|=4096,c)}function $p(o,c,f){o.lanes|=c;var x=o.alternate;x!==null&&(x.lanes|=c),Ou(o.return,c,f)}function ad(o,c,f,x,w){var E=o.memoizedState;E===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:x,tail:f,tailMode:w}:(E.isBackwards=c,E.rendering=null,E.renderingStartTime=0,E.last=x,E.tail=f,E.tailMode=w)}function Mp(o,c,f){var x=c.pendingProps,w=x.revealOrder,E=x.tail;if(Gs(o,c,x.children,f),x=Vt.current,(x&2)!==0)x=x&1|2,c.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&$p(o,f,c);else if(o.tag===19)$p(o,f,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}x&=1}if(Rt(Vt,x),(c.mode&1)===0)c.memoizedState=null;else switch(w){case"forwards":for(f=c.child,w=null;f!==null;)o=f.alternate,o!==null&&wl(o)===null&&(w=f),f=f.sibling;f=w,f===null?(w=c.child,c.child=null):(w=f.sibling,f.sibling=null),ad(c,!1,w,f,E);break;case"backwards":for(f=null,w=c.child,c.child=null;w!==null;){if(o=w.alternate,o!==null&&wl(o)===null){c.child=w;break}o=w.sibling,w.sibling=f,f=w,w=o}ad(c,!0,f,null,E);break;case"together":ad(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Ll(o,c){(c.mode&1)===0&&o!==null&&(o.alternate=null,c.alternate=null,c.flags|=2)}function gi(o,c,f){if(o!==null&&(c.dependencies=o.dependencies),gn|=c.lanes,(f&c.childLanes)===0)return null;if(o!==null&&c.child!==o.child)throw Error(t(153));if(c.child!==null){for(o=c.child,f=Wi(o,o.pendingProps),c.child=f,f.return=c;o.sibling!==null;)o=o.sibling,f=f.sibling=Wi(o,o.pendingProps),f.return=c;f.sibling=null}return c.child}function nw(o,c,f){switch(c.tag){case 3:Pp(c),Yn();break;case 5:Jm(c);break;case 1:qs(c.type)&&dl(c);break;case 4:Fu(c,c.stateNode.containerInfo);break;case 10:var x=c.type._context,w=c.memoizedProps.value;Rt(xl,x._currentValue),x._currentValue=w;break;case 13:if(x=c.memoizedState,x!==null)return x.dehydrated!==null?(Rt(Vt,Vt.current&1),c.flags|=128,null):(f&c.child.childLanes)!==0?Op(o,c,f):(Rt(Vt,Vt.current&1),o=gi(o,c,f),o!==null?o.sibling:null);Rt(Vt,Vt.current&1);break;case 19:if(x=(f&c.childLanes)!==0,(o.flags&128)!==0){if(x)return Mp(o,c,f);c.flags|=128}if(w=c.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),Rt(Vt,Vt.current),x)break;return null;case 22:case 23:return c.lanes=0,Np(o,c,f)}return gi(o,c,f)}var Fp,od,Up,Bp;Fp=function(o,c){for(var f=c.child;f!==null;){if(f.tag===5||f.tag===6)o.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===c)break;for(;f.sibling===null;){if(f.return===null||f.return===c)return;f=f.return}f.sibling.return=f.return,f=f.sibling}},od=function(){},Up=function(o,c,f,x){var w=o.memoizedProps;if(w!==x){o=c.stateNode,mn(Wr.current);var E=null;switch(f){case"input":w=Ct(o,w),x=Ct(o,x),E=[];break;case"select":w=Y({},w,{value:void 0}),x=Y({},x,{value:void 0}),E=[];break;case"textarea":w=it(o,w),x=it(o,x),E=[];break;default:typeof w.onClick!="function"&&typeof x.onClick=="function"&&(o.onclick=ll)}fe(f,x);var R;f=null;for(ae in w)if(!x.hasOwnProperty(ae)&&w.hasOwnProperty(ae)&&w[ae]!=null)if(ae==="style"){var U=w[ae];for(R in U)U.hasOwnProperty(R)&&(f||(f={}),f[R]="")}else ae!=="dangerouslySetInnerHTML"&&ae!=="children"&&ae!=="suppressContentEditableWarning"&&ae!=="suppressHydrationWarning"&&ae!=="autoFocus"&&(i.hasOwnProperty(ae)?E||(E=[]):(E=E||[]).push(ae,null));for(ae in x){var V=x[ae];if(U=w!=null?w[ae]:void 0,x.hasOwnProperty(ae)&&V!==U&&(V!=null||U!=null))if(ae==="style")if(U){for(R in U)!U.hasOwnProperty(R)||V&&V.hasOwnProperty(R)||(f||(f={}),f[R]="");for(R in V)V.hasOwnProperty(R)&&U[R]!==V[R]&&(f||(f={}),f[R]=V[R])}else f||(E||(E=[]),E.push(ae,f)),f=V;else ae==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,U=U?U.__html:void 0,V!=null&&U!==V&&(E=E||[]).push(ae,V)):ae==="children"?typeof V!="string"&&typeof V!="number"||(E=E||[]).push(ae,""+V):ae!=="suppressContentEditableWarning"&&ae!=="suppressHydrationWarning"&&(i.hasOwnProperty(ae)?(V!=null&&ae==="onScroll"&&Ot("scroll",o),E||U===V||(E=[])):(E=E||[]).push(ae,V))}f&&(E=E||[]).push("style",f);var ae=E;(c.updateQueue=ae)&&(c.flags|=4)}},Bp=function(o,c,f,x){f!==x&&(c.flags|=4)};function lo(o,c){if(!Ut)switch(o.tailMode){case"hidden":c=o.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var x=null;f!==null;)f.alternate!==null&&(x=f),f=f.sibling;x===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:x.sibling=null}}function Fs(o){var c=o.alternate!==null&&o.alternate.child===o.child,f=0,x=0;if(c)for(var w=o.child;w!==null;)f|=w.lanes|w.childLanes,x|=w.subtreeFlags&14680064,x|=w.flags&14680064,w.return=o,w=w.sibling;else for(w=o.child;w!==null;)f|=w.lanes|w.childLanes,x|=w.subtreeFlags,x|=w.flags,w.return=o,w=w.sibling;return o.subtreeFlags|=x,o.childLanes=f,c}function aw(o,c,f){var x=c.pendingProps;switch(Lu(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fs(c),null;case 1:return qs(c.type)&&ul(),Fs(c),null;case 3:return x=c.stateNode,Zn(),$t(Hs),$t($s),zu(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(o===null||o.child===null)&&(pl(c)?c.flags|=4:o===null||o.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Rr!==null&&(vd(Rr),Rr=null))),od(o,c),Fs(c),null;case 5:Uu(c);var w=mn(ro.current);if(f=c.type,o!==null&&c.stateNode!=null)Up(o,c,f,x,w),o.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!x){if(c.stateNode===null)throw Error(t(166));return Fs(c),null}if(o=mn(Wr.current),pl(c)){x=c.stateNode,f=c.type;var E=c.memoizedProps;switch(x[Kr]=c,x[Ja]=E,o=(c.mode&1)!==0,f){case"dialog":Ot("cancel",x),Ot("close",x);break;case"iframe":case"object":case"embed":Ot("load",x);break;case"video":case"audio":for(w=0;w<Ya.length;w++)Ot(Ya[w],x);break;case"source":Ot("error",x);break;case"img":case"image":case"link":Ot("error",x),Ot("load",x);break;case"details":Ot("toggle",x);break;case"input":as(x,E),Ot("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!E.multiple},Ot("invalid",x);break;case"textarea":zt(x,E),Ot("invalid",x)}fe(f,E),w=null;for(var R in E)if(E.hasOwnProperty(R)){var U=E[R];R==="children"?typeof U=="string"?x.textContent!==U&&(E.suppressHydrationWarning!==!0&&ol(x.textContent,U,o),w=["children",U]):typeof U=="number"&&x.textContent!==""+U&&(E.suppressHydrationWarning!==!0&&ol(x.textContent,U,o),w=["children",""+U]):i.hasOwnProperty(R)&&U!=null&&R==="onScroll"&&Ot("scroll",x)}switch(f){case"input":at(x),pe(x,E,!0);break;case"textarea":at(x),ts(x);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(x.onclick=ll)}x=w,c.updateQueue=x,x!==null&&(c.flags|=4)}else{R=w.nodeType===9?w:w.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=ks(f)),o==="http://www.w3.org/1999/xhtml"?f==="script"?(o=R.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof x.is=="string"?o=R.createElement(f,{is:x.is}):(o=R.createElement(f),f==="select"&&(R=o,x.multiple?R.multiple=!0:x.size&&(R.size=x.size))):o=R.createElementNS(o,f),o[Kr]=c,o[Ja]=x,Fp(o,c,!1,!1),c.stateNode=o;e:{switch(R=Oe(f,x),f){case"dialog":Ot("cancel",o),Ot("close",o),w=x;break;case"iframe":case"object":case"embed":Ot("load",o),w=x;break;case"video":case"audio":for(w=0;w<Ya.length;w++)Ot(Ya[w],o);w=x;break;case"source":Ot("error",o),w=x;break;case"img":case"image":case"link":Ot("error",o),Ot("load",o),w=x;break;case"details":Ot("toggle",o),w=x;break;case"input":as(o,x),w=Ct(o,x),Ot("invalid",o);break;case"option":w=x;break;case"select":o._wrapperState={wasMultiple:!!x.multiple},w=Y({},x,{value:void 0}),Ot("invalid",o);break;case"textarea":zt(o,x),w=it(o,x),Ot("invalid",o);break;default:w=x}fe(f,w),U=w;for(E in U)if(U.hasOwnProperty(E)){var V=U[E];E==="style"?oi(o,V):E==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,V!=null&&Te(o,V)):E==="children"?typeof V=="string"?(f!=="textarea"||V!=="")&&ds(o,V):typeof V=="number"&&ds(o,""+V):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(i.hasOwnProperty(E)?V!=null&&E==="onScroll"&&Ot("scroll",o):V!=null&&k(o,E,V,R))}switch(f){case"input":at(o),pe(o,x,!1);break;case"textarea":at(o),ts(o);break;case"option":x.value!=null&&o.setAttribute("value",""+Se(x.value));break;case"select":o.multiple=!!x.multiple,E=x.value,E!=null?nt(o,!!x.multiple,E,!1):x.defaultValue!=null&&nt(o,!!x.multiple,x.defaultValue,!0);break;default:typeof w.onClick=="function"&&(o.onclick=ll)}switch(f){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return Fs(c),null;case 6:if(o&&c.stateNode!=null)Bp(o,c,o.memoizedProps,x);else{if(typeof x!="string"&&c.stateNode===null)throw Error(t(166));if(f=mn(ro.current),mn(Wr.current),pl(c)){if(x=c.stateNode,f=c.memoizedProps,x[Kr]=c,(E=x.nodeValue!==f)&&(o=ir,o!==null))switch(o.tag){case 3:ol(x.nodeValue,f,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&ol(x.nodeValue,f,(o.mode&1)!==0)}E&&(c.flags|=4)}else x=(f.nodeType===9?f:f.ownerDocument).createTextNode(x),x[Kr]=c,c.stateNode=x}return Fs(c),null;case 13:if($t(Vt),x=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(Ut&&nr!==null&&(c.mode&1)!==0&&(c.flags&128)===0)Vm(),Yn(),c.flags|=98560,E=!1;else if(E=pl(c),x!==null&&x.dehydrated!==null){if(o===null){if(!E)throw Error(t(318));if(E=c.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(t(317));E[Kr]=c}else Yn(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Fs(c),E=!1}else Rr!==null&&(vd(Rr),Rr=null),E=!0;if(!E)return c.flags&65536?c:null}return(c.flags&128)!==0?(c.lanes=f,c):(x=x!==null,x!==(o!==null&&o.memoizedState!==null)&&x&&(c.child.flags|=8192,(c.mode&1)!==0&&(o===null||(Vt.current&1)!==0?fs===0&&(fs=3):wd())),c.updateQueue!==null&&(c.flags|=4),Fs(c),null);case 4:return Zn(),od(o,c),o===null&&Qa(c.stateNode.containerInfo),Fs(c),null;case 10:return Du(c.type._context),Fs(c),null;case 17:return qs(c.type)&&ul(),Fs(c),null;case 19:if($t(Vt),E=c.memoizedState,E===null)return Fs(c),null;if(x=(c.flags&128)!==0,R=E.rendering,R===null)if(x)lo(E,!1);else{if(fs!==0||o!==null&&(o.flags&128)!==0)for(o=c.child;o!==null;){if(R=wl(o),R!==null){for(c.flags|=128,lo(E,!1),x=R.updateQueue,x!==null&&(c.updateQueue=x,c.flags|=4),c.subtreeFlags=0,x=f,f=c.child;f!==null;)E=f,o=x,E.flags&=14680066,R=E.alternate,R===null?(E.childLanes=0,E.lanes=o,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=R.childLanes,E.lanes=R.lanes,E.child=R.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=R.memoizedProps,E.memoizedState=R.memoizedState,E.updateQueue=R.updateQueue,E.type=R.type,o=R.dependencies,E.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),f=f.sibling;return Rt(Vt,Vt.current&1|2),c.child}o=o.sibling}E.tail!==null&&Pt()>ra&&(c.flags|=128,x=!0,lo(E,!1),c.lanes=4194304)}else{if(!x)if(o=wl(R),o!==null){if(c.flags|=128,x=!0,f=o.updateQueue,f!==null&&(c.updateQueue=f,c.flags|=4),lo(E,!0),E.tail===null&&E.tailMode==="hidden"&&!R.alternate&&!Ut)return Fs(c),null}else 2*Pt()-E.renderingStartTime>ra&&f!==1073741824&&(c.flags|=128,x=!0,lo(E,!1),c.lanes=4194304);E.isBackwards?(R.sibling=c.child,c.child=R):(f=E.last,f!==null?f.sibling=R:c.child=R,E.last=R)}return E.tail!==null?(c=E.tail,E.rendering=c,E.tail=c.sibling,E.renderingStartTime=Pt(),c.sibling=null,f=Vt.current,Rt(Vt,x?f&1|2:f&1),c):(Fs(c),null);case 22:case 23:return bd(),x=c.memoizedState!==null,o!==null&&o.memoizedState!==null!==x&&(c.flags|=8192),x&&(c.mode&1)!==0?(ar&1073741824)!==0&&(Fs(c),c.subtreeFlags&6&&(c.flags|=8192)):Fs(c),null;case 24:return null;case 25:return null}throw Error(t(156,c.tag))}function ow(o,c){switch(Lu(c),c.tag){case 1:return qs(c.type)&&ul(),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return Zn(),$t(Hs),$t($s),zu(),o=c.flags,(o&65536)!==0&&(o&128)===0?(c.flags=o&-65537|128,c):null;case 5:return Uu(c),null;case 13:if($t(Vt),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(t(340));Yn()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return $t(Vt),null;case 4:return Zn(),null;case 10:return Du(c.type._context),null;case 22:case 23:return bd(),null;case 24:return null;default:return null}}var Rl=!1,Us=!1,lw=typeof WeakSet=="function"?WeakSet:Set,Pe=null;function ta(o,c){var f=o.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(x){Jt(o,c,x)}else f.current=null}function ld(o,c,f){try{f()}catch(x){Jt(o,c,x)}}var zp=!1;function cw(o,c){if(bu=Qo,o=bm(),hu(o)){if("selectionStart"in o)var f={start:o.selectionStart,end:o.selectionEnd};else e:{f=(f=o.ownerDocument)&&f.defaultView||window;var x=f.getSelection&&f.getSelection();if(x&&x.rangeCount!==0){f=x.anchorNode;var w=x.anchorOffset,E=x.focusNode;x=x.focusOffset;try{f.nodeType,E.nodeType}catch{f=null;break e}var R=0,U=-1,V=-1,ae=0,me=0,ge=o,he=null;t:for(;;){for(var Re;ge!==f||w!==0&&ge.nodeType!==3||(U=R+w),ge!==E||x!==0&&ge.nodeType!==3||(V=R+x),ge.nodeType===3&&(R+=ge.nodeValue.length),(Re=ge.firstChild)!==null;)he=ge,ge=Re;for(;;){if(ge===o)break t;if(he===f&&++ae===w&&(U=R),he===E&&++me===x&&(V=R),(Re=ge.nextSibling)!==null)break;ge=he,he=ge.parentNode}ge=Re}f=U===-1||V===-1?null:{start:U,end:V}}else f=null}f=f||{start:0,end:0}}else f=null;for(wu={focusedElem:o,selectionRange:f},Qo=!1,Pe=c;Pe!==null;)if(c=Pe,o=c.child,(c.subtreeFlags&1028)!==0&&o!==null)o.return=c,Pe=o;else for(;Pe!==null;){c=Pe;try{var De=c.alternate;if((c.flags&1024)!==0)switch(c.tag){case 0:case 11:case 15:break;case 1:if(De!==null){var Me=De.memoizedProps,rs=De.memoizedState,ee=c.stateNode,Q=ee.getSnapshotBeforeUpdate(c.elementType===c.type?Me:Nr(c.type,Me),rs);ee.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var se=c.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(xe){Jt(c,c.return,xe)}if(o=c.sibling,o!==null){o.return=c.return,Pe=o;break}Pe=c.return}return De=zp,zp=!1,De}function co(o,c,f){var x=c.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var w=x=x.next;do{if((w.tag&o)===o){var E=w.destroy;w.destroy=void 0,E!==void 0&&ld(c,f,E)}w=w.next}while(w!==x)}}function Nl(o,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var f=c=c.next;do{if((f.tag&o)===o){var x=f.create;f.destroy=x()}f=f.next}while(f!==c)}}function cd(o){var c=o.ref;if(c!==null){var f=o.stateNode;switch(o.tag){case 5:o=f;break;default:o=f}typeof c=="function"?c(o):c.current=o}}function Gp(o){var c=o.alternate;c!==null&&(o.alternate=null,Gp(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&(delete c[Kr],delete c[Ja],delete c[_u],delete c[Kb],delete c[Wb])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function Vp(o){return o.tag===5||o.tag===3||o.tag===4}function Kp(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Vp(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function ud(o,c,f){var x=o.tag;if(x===5||x===6)o=o.stateNode,c?f.nodeType===8?f.parentNode.insertBefore(o,c):f.insertBefore(o,c):(f.nodeType===8?(c=f.parentNode,c.insertBefore(o,f)):(c=f,c.appendChild(o)),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=ll));else if(x!==4&&(o=o.child,o!==null))for(ud(o,c,f),o=o.sibling;o!==null;)ud(o,c,f),o=o.sibling}function dd(o,c,f){var x=o.tag;if(x===5||x===6)o=o.stateNode,c?f.insertBefore(o,c):f.appendChild(o);else if(x!==4&&(o=o.child,o!==null))for(dd(o,c,f),o=o.sibling;o!==null;)dd(o,c,f),o=o.sibling}var Is=null,Cr=!1;function Bi(o,c,f){for(f=f.child;f!==null;)Wp(o,c,f),f=f.sibling}function Wp(o,c,f){if(we&&typeof we.onCommitFiberUnmount=="function")try{we.onCommitFiberUnmount(je,f)}catch{}switch(f.tag){case 5:Us||ta(f,c);case 6:var x=Is,w=Cr;Is=null,Bi(o,c,f),Is=x,Cr=w,Is!==null&&(Cr?(o=Is,f=f.stateNode,o.nodeType===8?o.parentNode.removeChild(f):o.removeChild(f)):Is.removeChild(f.stateNode));break;case 18:Is!==null&&(Cr?(o=Is,f=f.stateNode,o.nodeType===8?Tu(o.parentNode,f):o.nodeType===1&&Tu(o,f),Ba(o)):Tu(Is,f.stateNode));break;case 4:x=Is,w=Cr,Is=f.stateNode.containerInfo,Cr=!0,Bi(o,c,f),Is=x,Cr=w;break;case 0:case 11:case 14:case 15:if(!Us&&(x=f.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){w=x=x.next;do{var E=w,R=E.destroy;E=E.tag,R!==void 0&&((E&2)!==0||(E&4)!==0)&&ld(f,c,R),w=w.next}while(w!==x)}Bi(o,c,f);break;case 1:if(!Us&&(ta(f,c),x=f.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=f.memoizedProps,x.state=f.memoizedState,x.componentWillUnmount()}catch(U){Jt(f,c,U)}Bi(o,c,f);break;case 21:Bi(o,c,f);break;case 22:f.mode&1?(Us=(x=Us)||f.memoizedState!==null,Bi(o,c,f),Us=x):Bi(o,c,f);break;default:Bi(o,c,f)}}function Hp(o){var c=o.updateQueue;if(c!==null){o.updateQueue=null;var f=o.stateNode;f===null&&(f=o.stateNode=new lw),c.forEach(function(x){var w=vw.bind(null,o,x);f.has(x)||(f.add(x),x.then(w,w))})}}function jr(o,c){var f=c.deletions;if(f!==null)for(var x=0;x<f.length;x++){var w=f[x];try{var E=o,R=c,U=R;e:for(;U!==null;){switch(U.tag){case 5:Is=U.stateNode,Cr=!1;break e;case 3:Is=U.stateNode.containerInfo,Cr=!0;break e;case 4:Is=U.stateNode.containerInfo,Cr=!0;break e}U=U.return}if(Is===null)throw Error(t(160));Wp(E,R,w),Is=null,Cr=!1;var V=w.alternate;V!==null&&(V.return=null),w.return=null}catch(ae){Jt(w,c,ae)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)qp(c,o),c=c.sibling}function qp(o,c){var f=o.alternate,x=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(jr(c,o),qr(o),x&4){try{co(3,o,o.return),Nl(3,o)}catch(Me){Jt(o,o.return,Me)}try{co(5,o,o.return)}catch(Me){Jt(o,o.return,Me)}}break;case 1:jr(c,o),qr(o),x&512&&f!==null&&ta(f,f.return);break;case 5:if(jr(c,o),qr(o),x&512&&f!==null&&ta(f,f.return),o.flags&32){var w=o.stateNode;try{ds(w,"")}catch(Me){Jt(o,o.return,Me)}}if(x&4&&(w=o.stateNode,w!=null)){var E=o.memoizedProps,R=f!==null?f.memoizedProps:E,U=o.type,V=o.updateQueue;if(o.updateQueue=null,V!==null)try{U==="input"&&E.type==="radio"&&E.name!=null&&ke(w,E),Oe(U,R);var ae=Oe(U,E);for(R=0;R<V.length;R+=2){var me=V[R],ge=V[R+1];me==="style"?oi(w,ge):me==="dangerouslySetInnerHTML"?Te(w,ge):me==="children"?ds(w,ge):k(w,me,ge,ae)}switch(U){case"input":be(w,E);break;case"textarea":ht(w,E);break;case"select":var he=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!E.multiple;var Re=E.value;Re!=null?nt(w,!!E.multiple,Re,!1):he!==!!E.multiple&&(E.defaultValue!=null?nt(w,!!E.multiple,E.defaultValue,!0):nt(w,!!E.multiple,E.multiple?[]:"",!1))}w[Ja]=E}catch(Me){Jt(o,o.return,Me)}}break;case 6:if(jr(c,o),qr(o),x&4){if(o.stateNode===null)throw Error(t(162));w=o.stateNode,E=o.memoizedProps;try{w.nodeValue=E}catch(Me){Jt(o,o.return,Me)}}break;case 3:if(jr(c,o),qr(o),x&4&&f!==null&&f.memoizedState.isDehydrated)try{Ba(c.containerInfo)}catch(Me){Jt(o,o.return,Me)}break;case 4:jr(c,o),qr(o);break;case 13:jr(c,o),qr(o),w=o.child,w.flags&8192&&(E=w.memoizedState!==null,w.stateNode.isHidden=E,!E||w.alternate!==null&&w.alternate.memoizedState!==null||(md=Pt())),x&4&&Hp(o);break;case 22:if(me=f!==null&&f.memoizedState!==null,o.mode&1?(Us=(ae=Us)||me,jr(c,o),Us=ae):jr(c,o),qr(o),x&8192){if(ae=o.memoizedState!==null,(o.stateNode.isHidden=ae)&&!me&&(o.mode&1)!==0)for(Pe=o,me=o.child;me!==null;){for(ge=Pe=me;Pe!==null;){switch(he=Pe,Re=he.child,he.tag){case 0:case 11:case 14:case 15:co(4,he,he.return);break;case 1:ta(he,he.return);var De=he.stateNode;if(typeof De.componentWillUnmount=="function"){x=he,f=he.return;try{c=x,De.props=c.memoizedProps,De.state=c.memoizedState,De.componentWillUnmount()}catch(Me){Jt(x,f,Me)}}break;case 5:ta(he,he.return);break;case 22:if(he.memoizedState!==null){Xp(ge);continue}}Re!==null?(Re.return=he,Pe=Re):Xp(ge)}me=me.sibling}e:for(me=null,ge=o;;){if(ge.tag===5){if(me===null){me=ge;try{w=ge.stateNode,ae?(E=w.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(U=ge.stateNode,V=ge.memoizedProps.style,R=V!=null&&V.hasOwnProperty("display")?V.display:null,U.style.display=sr("display",R))}catch(Me){Jt(o,o.return,Me)}}}else if(ge.tag===6){if(me===null)try{ge.stateNode.nodeValue=ae?"":ge.memoizedProps}catch(Me){Jt(o,o.return,Me)}}else if((ge.tag!==22&&ge.tag!==23||ge.memoizedState===null||ge===o)&&ge.child!==null){ge.child.return=ge,ge=ge.child;continue}if(ge===o)break e;for(;ge.sibling===null;){if(ge.return===null||ge.return===o)break e;me===ge&&(me=null),ge=ge.return}me===ge&&(me=null),ge.sibling.return=ge.return,ge=ge.sibling}}break;case 19:jr(c,o),qr(o),x&4&&Hp(o);break;case 21:break;default:jr(c,o),qr(o)}}function qr(o){var c=o.flags;if(c&2){try{e:{for(var f=o.return;f!==null;){if(Vp(f)){var x=f;break e}f=f.return}throw Error(t(160))}switch(x.tag){case 5:var w=x.stateNode;x.flags&32&&(ds(w,""),x.flags&=-33);var E=Kp(o);dd(o,E,w);break;case 3:case 4:var R=x.stateNode.containerInfo,U=Kp(o);ud(o,U,R);break;default:throw Error(t(161))}}catch(V){Jt(o,o.return,V)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function uw(o,c,f){Pe=o,Yp(o)}function Yp(o,c,f){for(var x=(o.mode&1)!==0;Pe!==null;){var w=Pe,E=w.child;if(w.tag===22&&x){var R=w.memoizedState!==null||Rl;if(!R){var U=w.alternate,V=U!==null&&U.memoizedState!==null||Us;U=Rl;var ae=Us;if(Rl=R,(Us=V)&&!ae)for(Pe=w;Pe!==null;)R=Pe,V=R.child,R.tag===22&&R.memoizedState!==null?Jp(w):V!==null?(V.return=R,Pe=V):Jp(w);for(;E!==null;)Pe=E,Yp(E),E=E.sibling;Pe=w,Rl=U,Us=ae}Qp(o)}else(w.subtreeFlags&8772)!==0&&E!==null?(E.return=w,Pe=E):Qp(o)}}function Qp(o){for(;Pe!==null;){var c=Pe;if((c.flags&8772)!==0){var f=c.alternate;try{if((c.flags&8772)!==0)switch(c.tag){case 0:case 11:case 15:Us||Nl(5,c);break;case 1:var x=c.stateNode;if(c.flags&4&&!Us)if(f===null)x.componentDidMount();else{var w=c.elementType===c.type?f.memoizedProps:Nr(c.type,f.memoizedProps);x.componentDidUpdate(w,f.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var E=c.updateQueue;E!==null&&Xm(c,E,x);break;case 3:var R=c.updateQueue;if(R!==null){if(f=null,c.child!==null)switch(c.child.tag){case 5:f=c.child.stateNode;break;case 1:f=c.child.stateNode}Xm(c,R,f)}break;case 5:var U=c.stateNode;if(f===null&&c.flags&4){f=U;var V=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":V.autoFocus&&f.focus();break;case"img":V.src&&(f.src=V.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var ae=c.alternate;if(ae!==null){var me=ae.memoizedState;if(me!==null){var ge=me.dehydrated;ge!==null&&Ba(ge)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Us||c.flags&512&&cd(c)}catch(he){Jt(c,c.return,he)}}if(c===o){Pe=null;break}if(f=c.sibling,f!==null){f.return=c.return,Pe=f;break}Pe=c.return}}function Xp(o){for(;Pe!==null;){var c=Pe;if(c===o){Pe=null;break}var f=c.sibling;if(f!==null){f.return=c.return,Pe=f;break}Pe=c.return}}function Jp(o){for(;Pe!==null;){var c=Pe;try{switch(c.tag){case 0:case 11:case 15:var f=c.return;try{Nl(4,c)}catch(V){Jt(c,f,V)}break;case 1:var x=c.stateNode;if(typeof x.componentDidMount=="function"){var w=c.return;try{x.componentDidMount()}catch(V){Jt(c,w,V)}}var E=c.return;try{cd(c)}catch(V){Jt(c,E,V)}break;case 5:var R=c.return;try{cd(c)}catch(V){Jt(c,R,V)}}}catch(V){Jt(c,c.return,V)}if(c===o){Pe=null;break}var U=c.sibling;if(U!==null){U.return=c.return,Pe=U;break}Pe=c.return}}var dw=Math.ceil,Cl=I.ReactCurrentDispatcher,hd=I.ReactCurrentOwner,Er=I.ReactCurrentBatchConfig,pt=0,Ss=null,ls=null,Ls=0,ar=0,sa=Oi(0),fs=0,uo=null,gn=0,jl=0,fd=0,ho=null,Qs=null,md=0,ra=1/0,xi=null,Pl=!1,pd=null,zi=null,Dl=!1,Gi=null,Ol=0,fo=0,gd=null,$l=-1,Ml=0;function Vs(){return(pt&6)!==0?Pt():$l!==-1?$l:$l=Pt()}function Vi(o){return(o.mode&1)===0?1:(pt&2)!==0&&Ls!==0?Ls&-Ls:qb.transition!==null?(Ml===0&&(Ml=Xt()),Ml):(o=St,o!==0||(o=window.event,o=o===void 0?16:em(o.type)),o)}function Pr(o,c,f,x){if(50<fo)throw fo=0,gd=null,Error(t(185));Oa(o,f,x),((pt&2)===0||o!==Ss)&&(o===Ss&&((pt&2)===0&&(jl|=f),fs===4&&Ki(o,Ls)),Xs(o,x),f===1&&pt===0&&(c.mode&1)===0&&(ra=Pt()+500,hl&&Mi()))}function Xs(o,c){var f=o.callbackNode;vr(o,c);var x=Ke(o,o===Ss?Ls:0);if(x===0)f!==null&&jt(f),o.callbackNode=null,o.callbackPriority=0;else if(c=x&-x,o.callbackPriority!==c){if(f!=null&&jt(f),c===1)o.tag===0?Hb(eg.bind(null,o)):Fm(eg.bind(null,o)),Gb(function(){(pt&6)===0&&Mi()}),f=null;else{switch(Wf(x)){case 1:f=On;break;case 4:f=q;break;case 16:f=ce;break;case 536870912:f=$e;break;default:f=ce}f=lg(f,Zp.bind(null,o))}o.callbackPriority=c,o.callbackNode=f}}function Zp(o,c){if($l=-1,Ml=0,(pt&6)!==0)throw Error(t(327));var f=o.callbackNode;if(ia()&&o.callbackNode!==f)return null;var x=Ke(o,o===Ss?Ls:0);if(x===0)return null;if((x&30)!==0||(x&o.expiredLanes)!==0||c)c=Fl(o,x);else{c=x;var w=pt;pt|=2;var E=sg();(Ss!==o||Ls!==c)&&(xi=null,ra=Pt()+500,vn(o,c));do try{mw();break}catch(U){tg(o,U)}while(!0);Pu(),Cl.current=E,pt=w,ls!==null?c=0:(Ss=null,Ls=0,c=fs)}if(c!==0){if(c===2&&(w=Dt(o),w!==0&&(x=w,c=xd(o,w))),c===1)throw f=uo,vn(o,0),Ki(o,x),Xs(o,Pt()),f;if(c===6)Ki(o,x);else{if(w=o.current.alternate,(x&30)===0&&!hw(w)&&(c=Fl(o,x),c===2&&(E=Dt(o),E!==0&&(x=E,c=xd(o,E))),c===1))throw f=uo,vn(o,0),Ki(o,x),Xs(o,Pt()),f;switch(o.finishedWork=w,o.finishedLanes=x,c){case 0:case 1:throw Error(t(345));case 2:yn(o,Qs,xi);break;case 3:if(Ki(o,x),(x&130023424)===x&&(c=md+500-Pt(),10<c)){if(Ke(o,0)!==0)break;if(w=o.suspendedLanes,(w&x)!==x){Vs(),o.pingedLanes|=o.suspendedLanes&w;break}o.timeoutHandle=Eu(yn.bind(null,o,Qs,xi),c);break}yn(o,Qs,xi);break;case 4:if(Ki(o,x),(x&4194240)===x)break;for(c=o.eventTimes,w=-1;0<x;){var R=31-Ie(x);E=1<<R,R=c[R],R>w&&(w=R),x&=~E}if(x=w,x=Pt()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*dw(x/1960))-x,10<x){o.timeoutHandle=Eu(yn.bind(null,o,Qs,xi),x);break}yn(o,Qs,xi);break;case 5:yn(o,Qs,xi);break;default:throw Error(t(329))}}}return Xs(o,Pt()),o.callbackNode===f?Zp.bind(null,o):null}function xd(o,c){var f=ho;return o.current.memoizedState.isDehydrated&&(vn(o,c).flags|=256),o=Fl(o,c),o!==2&&(c=Qs,Qs=f,c!==null&&vd(c)),o}function vd(o){Qs===null?Qs=o:Qs.push.apply(Qs,o)}function hw(o){for(var c=o;;){if(c.flags&16384){var f=c.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var x=0;x<f.length;x++){var w=f[x],E=w.getSnapshot;w=w.value;try{if(!Lr(E(),w))return!1}catch{return!1}}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Ki(o,c){for(c&=~fd,c&=~jl,o.suspendedLanes|=c,o.pingedLanes&=~c,o=o.expirationTimes;0<c;){var f=31-Ie(c),x=1<<f;o[f]=-1,c&=~x}}function eg(o){if((pt&6)!==0)throw Error(t(327));ia();var c=Ke(o,0);if((c&1)===0)return Xs(o,Pt()),null;var f=Fl(o,c);if(o.tag!==0&&f===2){var x=Dt(o);x!==0&&(c=x,f=xd(o,x))}if(f===1)throw f=uo,vn(o,0),Ki(o,c),Xs(o,Pt()),f;if(f===6)throw Error(t(345));return o.finishedWork=o.current.alternate,o.finishedLanes=c,yn(o,Qs,xi),Xs(o,Pt()),null}function yd(o,c){var f=pt;pt|=1;try{return o(c)}finally{pt=f,pt===0&&(ra=Pt()+500,hl&&Mi())}}function xn(o){Gi!==null&&Gi.tag===0&&(pt&6)===0&&ia();var c=pt;pt|=1;var f=Er.transition,x=St;try{if(Er.transition=null,St=1,o)return o()}finally{St=x,Er.transition=f,pt=c,(pt&6)===0&&Mi()}}function bd(){ar=sa.current,$t(sa)}function vn(o,c){o.finishedWork=null,o.finishedLanes=0;var f=o.timeoutHandle;if(f!==-1&&(o.timeoutHandle=-1,zb(f)),ls!==null)for(f=ls.return;f!==null;){var x=f;switch(Lu(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&ul();break;case 3:Zn(),$t(Hs),$t($s),zu();break;case 5:Uu(x);break;case 4:Zn();break;case 13:$t(Vt);break;case 19:$t(Vt);break;case 10:Du(x.type._context);break;case 22:case 23:bd()}f=f.return}if(Ss=o,ls=o=Wi(o.current,null),Ls=ar=c,fs=0,uo=null,fd=jl=gn=0,Qs=ho=null,fn!==null){for(c=0;c<fn.length;c++)if(f=fn[c],x=f.interleaved,x!==null){f.interleaved=null;var w=x.next,E=f.pending;if(E!==null){var R=E.next;E.next=w,x.next=R}f.pending=x}fn=null}return o}function tg(o,c){do{var f=ls;try{if(Pu(),Sl.current=kl,El){for(var x=Kt.memoizedState;x!==null;){var w=x.queue;w!==null&&(w.pending=null),x=x.next}El=!1}if(pn=0,ws=hs=Kt=null,io=!1,no=0,hd.current=null,f===null||f.return===null){fs=1,uo=c,ls=null;break}e:{var E=o,R=f.return,U=f,V=c;if(c=Ls,U.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){var ae=V,me=U,ge=me.tag;if((me.mode&1)===0&&(ge===0||ge===11||ge===15)){var he=me.alternate;he?(me.updateQueue=he.updateQueue,me.memoizedState=he.memoizedState,me.lanes=he.lanes):(me.updateQueue=null,me.memoizedState=null)}var Re=kp(R);if(Re!==null){Re.flags&=-257,Ap(Re,R,U,E,c),Re.mode&1&&_p(E,ae,c),c=Re,V=ae;var De=c.updateQueue;if(De===null){var Me=new Set;Me.add(V),c.updateQueue=Me}else De.add(V);break e}else{if((c&1)===0){_p(E,ae,c),wd();break e}V=Error(t(426))}}else if(Ut&&U.mode&1){var rs=kp(R);if(rs!==null){(rs.flags&65536)===0&&(rs.flags|=256),Ap(rs,R,U,E,c),Cu(ea(V,U));break e}}E=V=ea(V,U),fs!==4&&(fs=2),ho===null?ho=[E]:ho.push(E),E=R;do{switch(E.tag){case 3:E.flags|=65536,c&=-c,E.lanes|=c;var ee=Ep(E,V,c);Qm(E,ee);break e;case 1:U=V;var Q=E.type,se=E.stateNode;if((E.flags&128)===0&&(typeof Q.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(zi===null||!zi.has(se)))){E.flags|=65536,c&=-c,E.lanes|=c;var xe=Tp(E,U,c);Qm(E,xe);break e}}E=E.return}while(E!==null)}ig(f)}catch(Be){c=Be,ls===f&&f!==null&&(ls=f=f.return);continue}break}while(!0)}function sg(){var o=Cl.current;return Cl.current=kl,o===null?kl:o}function wd(){(fs===0||fs===3||fs===2)&&(fs=4),Ss===null||(gn&268435455)===0&&(jl&268435455)===0||Ki(Ss,Ls)}function Fl(o,c){var f=pt;pt|=2;var x=sg();(Ss!==o||Ls!==c)&&(xi=null,vn(o,c));do try{fw();break}catch(w){tg(o,w)}while(!0);if(Pu(),pt=f,Cl.current=x,ls!==null)throw Error(t(261));return Ss=null,Ls=0,fs}function fw(){for(;ls!==null;)rg(ls)}function mw(){for(;ls!==null&&!Ii();)rg(ls)}function rg(o){var c=og(o.alternate,o,ar);o.memoizedProps=o.pendingProps,c===null?ig(o):ls=c,hd.current=null}function ig(o){var c=o;do{var f=c.alternate;if(o=c.return,(c.flags&32768)===0){if(f=aw(f,c,ar),f!==null){ls=f;return}}else{if(f=ow(f,c),f!==null){f.flags&=32767,ls=f;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{fs=6,ls=null;return}}if(c=c.sibling,c!==null){ls=c;return}ls=c=o}while(c!==null);fs===0&&(fs=5)}function yn(o,c,f){var x=St,w=Er.transition;try{Er.transition=null,St=1,pw(o,c,f,x)}finally{Er.transition=w,St=x}return null}function pw(o,c,f,x){do ia();while(Gi!==null);if((pt&6)!==0)throw Error(t(327));f=o.finishedWork;var w=o.finishedLanes;if(f===null)return null;if(o.finishedWork=null,o.finishedLanes=0,f===o.current)throw Error(t(177));o.callbackNode=null,o.callbackPriority=0;var E=f.lanes|f.childLanes;if(Yy(o,E),o===Ss&&(ls=Ss=null,Ls=0),(f.subtreeFlags&2064)===0&&(f.flags&2064)===0||Dl||(Dl=!0,lg(ce,function(){return ia(),null})),E=(f.flags&15990)!==0,(f.subtreeFlags&15990)!==0||E){E=Er.transition,Er.transition=null;var R=St;St=1;var U=pt;pt|=4,hd.current=null,cw(o,f),qp(f,o),Db(wu),Qo=!!bu,wu=bu=null,o.current=f,uw(f),Dn(),pt=U,St=R,Er.transition=E}else o.current=f;if(Dl&&(Dl=!1,Gi=o,Ol=w),E=o.pendingLanes,E===0&&(zi=null),lt(f.stateNode),Xs(o,Pt()),c!==null)for(x=o.onRecoverableError,f=0;f<c.length;f++)w=c[f],x(w.value,{componentStack:w.stack,digest:w.digest});if(Pl)throw Pl=!1,o=pd,pd=null,o;return(Ol&1)!==0&&o.tag!==0&&ia(),E=o.pendingLanes,(E&1)!==0?o===gd?fo++:(fo=0,gd=o):fo=0,Mi(),null}function ia(){if(Gi!==null){var o=Wf(Ol),c=Er.transition,f=St;try{if(Er.transition=null,St=16>o?16:o,Gi===null)var x=!1;else{if(o=Gi,Gi=null,Ol=0,(pt&6)!==0)throw Error(t(331));var w=pt;for(pt|=4,Pe=o.current;Pe!==null;){var E=Pe,R=E.child;if((Pe.flags&16)!==0){var U=E.deletions;if(U!==null){for(var V=0;V<U.length;V++){var ae=U[V];for(Pe=ae;Pe!==null;){var me=Pe;switch(me.tag){case 0:case 11:case 15:co(8,me,E)}var ge=me.child;if(ge!==null)ge.return=me,Pe=ge;else for(;Pe!==null;){me=Pe;var he=me.sibling,Re=me.return;if(Gp(me),me===ae){Pe=null;break}if(he!==null){he.return=Re,Pe=he;break}Pe=Re}}}var De=E.alternate;if(De!==null){var Me=De.child;if(Me!==null){De.child=null;do{var rs=Me.sibling;Me.sibling=null,Me=rs}while(Me!==null)}}Pe=E}}if((E.subtreeFlags&2064)!==0&&R!==null)R.return=E,Pe=R;else e:for(;Pe!==null;){if(E=Pe,(E.flags&2048)!==0)switch(E.tag){case 0:case 11:case 15:co(9,E,E.return)}var ee=E.sibling;if(ee!==null){ee.return=E.return,Pe=ee;break e}Pe=E.return}}var Q=o.current;for(Pe=Q;Pe!==null;){R=Pe;var se=R.child;if((R.subtreeFlags&2064)!==0&&se!==null)se.return=R,Pe=se;else e:for(R=Q;Pe!==null;){if(U=Pe,(U.flags&2048)!==0)try{switch(U.tag){case 0:case 11:case 15:Nl(9,U)}}catch(Be){Jt(U,U.return,Be)}if(U===R){Pe=null;break e}var xe=U.sibling;if(xe!==null){xe.return=U.return,Pe=xe;break e}Pe=U.return}}if(pt=w,Mi(),we&&typeof we.onPostCommitFiberRoot=="function")try{we.onPostCommitFiberRoot(je,o)}catch{}x=!0}return x}finally{St=f,Er.transition=c}}return!1}function ng(o,c,f){c=ea(f,c),c=Ep(o,c,1),o=Ui(o,c,1),c=Vs(),o!==null&&(Oa(o,1,c),Xs(o,c))}function Jt(o,c,f){if(o.tag===3)ng(o,o,f);else for(;c!==null;){if(c.tag===3){ng(c,o,f);break}else if(c.tag===1){var x=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(zi===null||!zi.has(x))){o=ea(f,o),o=Tp(c,o,1),c=Ui(c,o,1),o=Vs(),c!==null&&(Oa(c,1,o),Xs(c,o));break}}c=c.return}}function gw(o,c,f){var x=o.pingCache;x!==null&&x.delete(c),c=Vs(),o.pingedLanes|=o.suspendedLanes&f,Ss===o&&(Ls&f)===f&&(fs===4||fs===3&&(Ls&130023424)===Ls&&500>Pt()-md?vn(o,0):fd|=f),Xs(o,c)}function ag(o,c){c===0&&((o.mode&1)===0?c=1:(c=os,os<<=1,(os&130023424)===0&&(os=4194304)));var f=Vs();o=mi(o,c),o!==null&&(Oa(o,c,f),Xs(o,f))}function xw(o){var c=o.memoizedState,f=0;c!==null&&(f=c.retryLane),ag(o,f)}function vw(o,c){var f=0;switch(o.tag){case 13:var x=o.stateNode,w=o.memoizedState;w!==null&&(f=w.retryLane);break;case 19:x=o.stateNode;break;default:throw Error(t(314))}x!==null&&x.delete(c),ag(o,f)}var og;og=function(o,c,f){if(o!==null)if(o.memoizedProps!==c.pendingProps||Hs.current)Ys=!0;else{if((o.lanes&f)===0&&(c.flags&128)===0)return Ys=!1,nw(o,c,f);Ys=(o.flags&131072)!==0}else Ys=!1,Ut&&(c.flags&1048576)!==0&&Um(c,ml,c.index);switch(c.lanes=0,c.tag){case 2:var x=c.type;Ll(o,c),o=c.pendingProps;var w=Wn(c,$s.current);Jn(c,f),w=Ku(null,c,x,o,w,f);var E=Wu();return c.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,qs(x)?(E=!0,dl(c)):E=!1,c.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,Mu(c),w.updater=Al,c.stateNode=w,w._reactInternals=c,Ju(c,x,o,f),c=sd(null,c,x,!0,E,f)):(c.tag=0,Ut&&E&&Iu(c),Gs(null,c,w,f),c=c.child),c;case 16:x=c.elementType;e:{switch(Ll(o,c),o=c.pendingProps,w=x._init,x=w(x._payload),c.type=x,w=c.tag=bw(x),o=Nr(x,o),w){case 0:c=td(null,c,x,o,f);break e;case 1:c=jp(null,c,x,o,f);break e;case 11:c=Ip(null,c,x,o,f);break e;case 14:c=Lp(null,c,x,Nr(x.type,o),f);break e}throw Error(t(306,x,""))}return c;case 0:return x=c.type,w=c.pendingProps,w=c.elementType===x?w:Nr(x,w),td(o,c,x,w,f);case 1:return x=c.type,w=c.pendingProps,w=c.elementType===x?w:Nr(x,w),jp(o,c,x,w,f);case 3:e:{if(Pp(c),o===null)throw Error(t(387));x=c.pendingProps,E=c.memoizedState,w=E.element,Ym(o,c),bl(c,x,null,f);var R=c.memoizedState;if(x=R.element,E.isDehydrated)if(E={element:x,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},c.updateQueue.baseState=E,c.memoizedState=E,c.flags&256){w=ea(Error(t(423)),c),c=Dp(o,c,x,f,w);break e}else if(x!==w){w=ea(Error(t(424)),c),c=Dp(o,c,x,f,w);break e}else for(nr=Di(c.stateNode.containerInfo.firstChild),ir=c,Ut=!0,Rr=null,f=Hm(c,null,x,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(Yn(),x===w){c=gi(o,c,f);break e}Gs(o,c,x,f)}c=c.child}return c;case 5:return Jm(c),o===null&&Nu(c),x=c.type,w=c.pendingProps,E=o!==null?o.memoizedProps:null,R=w.children,Su(x,w)?R=null:E!==null&&Su(x,E)&&(c.flags|=32),Cp(o,c),Gs(o,c,R,f),c.child;case 6:return o===null&&Nu(c),null;case 13:return Op(o,c,f);case 4:return Fu(c,c.stateNode.containerInfo),x=c.pendingProps,o===null?c.child=Qn(c,null,x,f):Gs(o,c,x,f),c.child;case 11:return x=c.type,w=c.pendingProps,w=c.elementType===x?w:Nr(x,w),Ip(o,c,x,w,f);case 7:return Gs(o,c,c.pendingProps,f),c.child;case 8:return Gs(o,c,c.pendingProps.children,f),c.child;case 12:return Gs(o,c,c.pendingProps.children,f),c.child;case 10:e:{if(x=c.type._context,w=c.pendingProps,E=c.memoizedProps,R=w.value,Rt(xl,x._currentValue),x._currentValue=R,E!==null)if(Lr(E.value,R)){if(E.children===w.children&&!Hs.current){c=gi(o,c,f);break e}}else for(E=c.child,E!==null&&(E.return=c);E!==null;){var U=E.dependencies;if(U!==null){R=E.child;for(var V=U.firstContext;V!==null;){if(V.context===x){if(E.tag===1){V=pi(-1,f&-f),V.tag=2;var ae=E.updateQueue;if(ae!==null){ae=ae.shared;var me=ae.pending;me===null?V.next=V:(V.next=me.next,me.next=V),ae.pending=V}}E.lanes|=f,V=E.alternate,V!==null&&(V.lanes|=f),Ou(E.return,f,c),U.lanes|=f;break}V=V.next}}else if(E.tag===10)R=E.type===c.type?null:E.child;else if(E.tag===18){if(R=E.return,R===null)throw Error(t(341));R.lanes|=f,U=R.alternate,U!==null&&(U.lanes|=f),Ou(R,f,c),R=E.sibling}else R=E.child;if(R!==null)R.return=E;else for(R=E;R!==null;){if(R===c){R=null;break}if(E=R.sibling,E!==null){E.return=R.return,R=E;break}R=R.return}E=R}Gs(o,c,w.children,f),c=c.child}return c;case 9:return w=c.type,x=c.pendingProps.children,Jn(c,f),w=wr(w),x=x(w),c.flags|=1,Gs(o,c,x,f),c.child;case 14:return x=c.type,w=Nr(x,c.pendingProps),w=Nr(x.type,w),Lp(o,c,x,w,f);case 15:return Rp(o,c,c.type,c.pendingProps,f);case 17:return x=c.type,w=c.pendingProps,w=c.elementType===x?w:Nr(x,w),Ll(o,c),c.tag=1,qs(x)?(o=!0,dl(c)):o=!1,Jn(c,f),wp(c,x,w),Ju(c,x,w,f),sd(null,c,x,!0,o,f);case 19:return Mp(o,c,f);case 22:return Np(o,c,f)}throw Error(t(156,c.tag))};function lg(o,c){return Ir(o,c)}function yw(o,c,f,x){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tr(o,c,f,x){return new yw(o,c,f,x)}function Sd(o){return o=o.prototype,!(!o||!o.isReactComponent)}function bw(o){if(typeof o=="function")return Sd(o)?1:0;if(o!=null){if(o=o.$$typeof,o===X)return 11;if(o===te)return 14}return 2}function Wi(o,c){var f=o.alternate;return f===null?(f=Tr(o.tag,c,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=c,f.type=o.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=o.flags&14680064,f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,c=o.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f}function Ul(o,c,f,x,w,E){var R=2;if(x=o,typeof o=="function")Sd(o)&&(R=1);else if(typeof o=="string")R=5;else e:switch(o){case N:return bn(f.children,w,E,c);case O:R=8,w|=8;break;case j:return o=Tr(12,f,c,w|2),o.elementType=j,o.lanes=E,o;case K:return o=Tr(13,f,c,w),o.elementType=K,o.lanes=E,o;case W:return o=Tr(19,f,c,w),o.elementType=W,o.lanes=E,o;case M:return Bl(f,w,E,c);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case D:R=10;break e;case G:R=9;break e;case X:R=11;break e;case te:R=14;break e;case z:R=16,x=null;break e}throw Error(t(130,o==null?o:typeof o,""))}return c=Tr(R,f,c,w),c.elementType=o,c.type=x,c.lanes=E,c}function bn(o,c,f,x){return o=Tr(7,o,x,c),o.lanes=f,o}function Bl(o,c,f,x){return o=Tr(22,o,x,c),o.elementType=M,o.lanes=f,o.stateNode={isHidden:!1},o}function Ed(o,c,f){return o=Tr(6,o,null,c),o.lanes=f,o}function Td(o,c,f){return c=Tr(4,o.children!==null?o.children:[],o.key,c),c.lanes=f,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}function ww(o,c,f,x,w){this.tag=c,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Da(0),this.expirationTimes=Da(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Da(0),this.identifierPrefix=x,this.onRecoverableError=w,this.mutableSourceEagerHydrationData=null}function _d(o,c,f,x,w,E,R,U,V){return o=new ww(o,c,f,U,V),c===1?(c=1,E===!0&&(c|=8)):c=0,E=Tr(3,null,null,c),o.current=E,E.stateNode=o,E.memoizedState={element:x,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mu(E),o}function Sw(o,c,f){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$,key:x==null?null:""+x,children:o,containerInfo:c,implementation:f}}function cg(o){if(!o)return $i;o=o._reactInternals;e:{if(xr(o)!==o||o.tag!==1)throw Error(t(170));var c=o;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(qs(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(t(171))}if(o.tag===1){var f=o.type;if(qs(f))return $m(o,f,c)}return c}function ug(o,c,f,x,w,E,R,U,V){return o=_d(f,x,!0,o,w,E,R,U,V),o.context=cg(null),f=o.current,x=Vs(),w=Vi(f),E=pi(x,w),E.callback=c??null,Ui(f,E,w),o.current.lanes=w,Oa(o,w,x),Xs(o,x),o}function zl(o,c,f,x){var w=c.current,E=Vs(),R=Vi(w);return f=cg(f),c.context===null?c.context=f:c.pendingContext=f,c=pi(E,R),c.payload={element:o},x=x===void 0?null:x,x!==null&&(c.callback=x),o=Ui(w,c,R),o!==null&&(Pr(o,w,R,E),yl(o,w,R)),R}function Gl(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function dg(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<c?f:c}}function kd(o,c){dg(o,c),(o=o.alternate)&&dg(o,c)}function Ew(){return null}var hg=typeof reportError=="function"?reportError:function(o){console.error(o)};function Ad(o){this._internalRoot=o}Vl.prototype.render=Ad.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(t(409));zl(o,c,null,null)},Vl.prototype.unmount=Ad.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;xn(function(){zl(null,o,null,null)}),c[ui]=null}};function Vl(o){this._internalRoot=o}Vl.prototype.unstable_scheduleHydration=function(o){if(o){var c=Yf();o={blockedOn:null,target:o,priority:c};for(var f=0;f<Ci.length&&c!==0&&c<Ci[f].priority;f++);Ci.splice(f,0,o),f===0&&Jf(o)}};function Id(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function Kl(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function fg(){}function Tw(o,c,f,x,w){if(w){if(typeof x=="function"){var E=x;x=function(){var ae=Gl(R);E.call(ae)}}var R=ug(c,x,o,0,null,!1,!1,"",fg);return o._reactRootContainer=R,o[ui]=R.current,Qa(o.nodeType===8?o.parentNode:o),xn(),R}for(;w=o.lastChild;)o.removeChild(w);if(typeof x=="function"){var U=x;x=function(){var ae=Gl(V);U.call(ae)}}var V=_d(o,0,!1,null,null,!1,!1,"",fg);return o._reactRootContainer=V,o[ui]=V.current,Qa(o.nodeType===8?o.parentNode:o),xn(function(){zl(c,V,f,x)}),V}function Wl(o,c,f,x,w){var E=f._reactRootContainer;if(E){var R=E;if(typeof w=="function"){var U=w;w=function(){var V=Gl(R);U.call(V)}}zl(c,R,o,w)}else R=Tw(f,c,o,w,x);return Gl(R)}Hf=function(o){switch(o.tag){case 3:var c=o.stateNode;if(c.current.memoizedState.isDehydrated){var f=As(c.pendingLanes);f!==0&&(Jc(c,f|1),Xs(c,Pt()),(pt&6)===0&&(ra=Pt()+500,Mi()))}break;case 13:xn(function(){var x=mi(o,1);if(x!==null){var w=Vs();Pr(x,o,1,w)}}),kd(o,1)}},Zc=function(o){if(o.tag===13){var c=mi(o,134217728);if(c!==null){var f=Vs();Pr(c,o,134217728,f)}kd(o,134217728)}},qf=function(o){if(o.tag===13){var c=Vi(o),f=mi(o,c);if(f!==null){var x=Vs();Pr(f,o,c,x)}kd(o,c)}},Yf=function(){return St},Qf=function(o,c){var f=St;try{return St=o,c()}finally{St=f}},vt=function(o,c,f){switch(c){case"input":if(be(o,f),c=f.name,f.type==="radio"&&c!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<f.length;c++){var x=f[c];if(x!==o&&x.form===o.form){var w=cl(x);if(!w)throw Error(t(90));de(x),be(x,w)}}}break;case"textarea":ht(o,f);break;case"select":c=f.value,c!=null&&nt(o,!!f.multiple,c,!1)}},ki=yd,Ai=xn;var _w={usingClientEntryPoint:!1,Events:[Za,Vn,cl,ys,Br,yd]},mo={findFiberByHostInstance:cn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kw={bundleType:mo.bundleType,version:mo.version,rendererPackageName:mo.rendererPackageName,rendererConfig:mo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=Qt(o),o===null?null:o.stateNode},findFiberByHostInstance:mo.findFiberByHostInstance||Ew,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hl.isDisabled&&Hl.supportsFiber)try{je=Hl.inject(kw),we=Hl}catch{}}return Js.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_w,Js.createPortal=function(o,c){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Id(c))throw Error(t(200));return Sw(o,c,null,f)},Js.createRoot=function(o,c){if(!Id(o))throw Error(t(299));var f=!1,x="",w=hg;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onRecoverableError!==void 0&&(w=c.onRecoverableError)),c=_d(o,1,!1,null,null,f,!1,x,w),o[ui]=c.current,Qa(o.nodeType===8?o.parentNode:o),new Ad(c)},Js.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(t(188)):(o=Object.keys(o).join(","),Error(t(268,o)));return o=Qt(c),o=o===null?null:o.stateNode,o},Js.flushSync=function(o){return xn(o)},Js.hydrate=function(o,c,f){if(!Kl(c))throw Error(t(200));return Wl(null,o,c,!0,f)},Js.hydrateRoot=function(o,c,f){if(!Id(o))throw Error(t(405));var x=f!=null&&f.hydratedSources||null,w=!1,E="",R=hg;if(f!=null&&(f.unstable_strictMode===!0&&(w=!0),f.identifierPrefix!==void 0&&(E=f.identifierPrefix),f.onRecoverableError!==void 0&&(R=f.onRecoverableError)),c=ug(c,null,o,1,f??null,w,!1,E,R),o[ui]=c.current,Qa(o),x)for(o=0;o<x.length;o++)f=x[o],w=f._getVersion,w=w(f._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[f,w]:c.mutableSourceEagerHydrationData.push(f,w);return new Vl(c)},Js.render=function(o,c,f){if(!Kl(c))throw Error(t(200));return Wl(null,o,c,!1,f)},Js.unmountComponentAtNode=function(o){if(!Kl(o))throw Error(t(40));return o._reactRootContainer?(xn(function(){Wl(null,null,o,!1,function(){o._reactRootContainer=null,o[ui]=null})}),!0):!1},Js.unstable_batchedUpdates=yd,Js.unstable_renderSubtreeIntoContainer=function(o,c,f,x){if(!Kl(f))throw Error(t(200));if(o==null||o._reactInternals===void 0)throw Error(t(38));return Wl(o,c,f,!1,x)},Js.version="18.3.1-next-f1338f8080-20240426",Js}var wg;function Px(){if(wg)return Cd.exports;wg=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Cd.exports=$w(),Cd.exports}var Sg;function Mw(){if(Sg)return ql;Sg=1;var r=Px();return ql.createRoot=r.createRoot,ql.hydrateRoot=r.hydrateRoot,ql}var Fw=Mw();const Uw=jx(Fw);var Bw=Px();/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ao(){return Ao=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Ao.apply(this,arguments)}var en;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(en||(en={}));const Eg="popstate";function zw(r){r===void 0&&(r={});function e(s,i){let{pathname:n,search:a,hash:u}=s.location;return Ac("",{pathname:n,search:a,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(s,i){return typeof i=="string"?i:Io(i)}return Dx(e,t,null,r)}function Gw(r){r===void 0&&(r={});function e(i,n){let{pathname:a="/",search:u="",hash:d=""}=Cn(i.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),Ac("",{pathname:a,search:u,hash:d},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(i,n){let a=i.document.querySelector("base"),u="";if(a&&a.getAttribute("href")){let d=i.location.href,h=d.indexOf("#");u=h===-1?d:d.slice(0,h)}return u+"#"+(typeof n=="string"?n:Io(n))}function s(i,n){Gc(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(n)+")")}return Dx(e,t,s,r)}function us(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Gc(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Vw(){return Math.random().toString(36).substr(2,8)}function Tg(r,e){return{usr:r.state,key:r.key,idx:e}}function Ac(r,e,t,s){return t===void 0&&(t=null),Ao({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?Cn(e):e,{state:t,key:e&&e.key||s||Vw()})}function Io(r){let{pathname:e="/",search:t="",hash:s=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Cn(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let s=r.indexOf("?");s>=0&&(e.search=r.substr(s),r=r.substr(0,s)),r&&(e.pathname=r)}return e}function Dx(r,e,t,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:n=!1}=s,a=i.history,u=en.Pop,d=null,h=m();h==null&&(h=0,a.replaceState(Ao({},a.state,{idx:h}),""));function m(){return(a.state||{idx:null}).idx}function p(){u=en.Pop;let b=m(),T=b==null?null:b-h;h=b,d&&d({action:u,location:S.location,delta:T})}function g(b,T){u=en.Push;let _=Ac(S.location,b,T);t&&t(_,b),h=m()+1;let k=Tg(_,h),I=S.createHref(_);try{a.pushState(k,"",I)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(I)}n&&d&&d({action:u,location:S.location,delta:1})}function v(b,T){u=en.Replace;let _=Ac(S.location,b,T);t&&t(_,b),h=m();let k=Tg(_,h),I=S.createHref(_);a.replaceState(k,"",I),n&&d&&d({action:u,location:S.location,delta:0})}function y(b){let T=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof b=="string"?b:Io(b);return _=_.replace(/ $/,"%20"),us(T,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,T)}let S={get action(){return u},get location(){return r(i,a)},listen(b){if(d)throw new Error("A history only accepts one active listener");return i.addEventListener(Eg,p),d=b,()=>{i.removeEventListener(Eg,p),d=null}},createHref(b){return e(i,b)},createURL:y,encodeLocation(b){let T=y(b);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:g,replace:v,go(b){return a.go(b)}};return S}var _g;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(_g||(_g={}));function Kw(r,e,t){return t===void 0&&(t="/"),Ww(r,e,t)}function Ww(r,e,t,s){let i=typeof e=="string"?Cn(e):e,n=df(i.pathname||"/",t);if(n==null)return null;let a=Ox(r);Hw(a);let u=null;for(let d=0;u==null&&d<a.length;++d){let h=n1(n);u=s1(a[d],h)}return u}function Ox(r,e,t,s){e===void 0&&(e=[]),t===void 0&&(t=[]),s===void 0&&(s="");let i=(n,a,u)=>{let d={relativePath:u===void 0?n.path||"":u,caseSensitive:n.caseSensitive===!0,childrenIndex:a,route:n};d.relativePath.startsWith("/")&&(us(d.relativePath.startsWith(s),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(s.length));let h=tn([s,d.relativePath]),m=t.concat(d);n.children&&n.children.length>0&&(us(n.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),Ox(n.children,e,m,h)),!(n.path==null&&!n.index)&&e.push({path:h,score:e1(h,n.index),routesMeta:m})};return r.forEach((n,a)=>{var u;if(n.path===""||!((u=n.path)!=null&&u.includes("?")))i(n,a);else for(let d of $x(n.path))i(n,a,d)}),e}function $x(r){let e=r.split("/");if(e.length===0)return[];let[t,...s]=e,i=t.endsWith("?"),n=t.replace(/\?$/,"");if(s.length===0)return i?[n,""]:[n];let a=$x(s.join("/")),u=[];return u.push(...a.map(d=>d===""?n:[n,d].join("/"))),i&&u.push(...a),u.map(d=>r.startsWith("/")&&d===""?"/":d)}function Hw(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:t1(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}const qw=/^:[\w-]+$/,Yw=3,Qw=2,Xw=1,Jw=10,Zw=-2,kg=r=>r==="*";function e1(r,e){let t=r.split("/"),s=t.length;return t.some(kg)&&(s+=Zw),e&&(s+=Qw),t.filter(i=>!kg(i)).reduce((i,n)=>i+(qw.test(n)?Yw:n===""?Xw:Jw),s)}function t1(r,e){return r.length===e.length&&r.slice(0,-1).every((s,i)=>s===e[i])?r[r.length-1]-e[e.length-1]:0}function s1(r,e,t){let{routesMeta:s}=r,i={},n="/",a=[];for(let u=0;u<s.length;++u){let d=s[u],h=u===s.length-1,m=n==="/"?e:e.slice(n.length)||"/",p=r1({path:d.relativePath,caseSensitive:d.caseSensitive,end:h},m),g=d.route;if(!p)return null;Object.assign(i,p.params),a.push({params:i,pathname:tn([n,p.pathname]),pathnameBase:u1(tn([n,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(n=tn([n,p.pathnameBase]))}return a}function r1(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,s]=i1(r.path,r.caseSensitive,r.end),i=e.match(t);if(!i)return null;let n=i[0],a=n.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:s.reduce((h,m,p)=>{let{paramName:g,isOptional:v}=m;if(g==="*"){let S=u[p]||"";a=n.slice(0,n.length-S.length).replace(/(.)\/+$/,"$1")}const y=u[p];return v&&!y?h[g]=void 0:h[g]=(y||"").replace(/%2F/g,"/"),h},{}),pathname:n,pathnameBase:a,pattern:r}}function i1(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Gc(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let s=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,u,d)=>(s.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(s.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function n1(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Gc(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function df(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=r.charAt(t);return s&&s!=="/"?null:r.slice(t)||"/"}const a1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,o1=r=>a1.test(r);function l1(r,e){e===void 0&&(e="/");let{pathname:t,search:s="",hash:i=""}=typeof r=="string"?Cn(r):r,n;if(t)if(o1(t))n=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),Gc(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+t))}t.startsWith("/")?n=Ag(t.substring(1),"/"):n=Ag(t,e)}else n=e;return{pathname:n,search:d1(s),hash:h1(i)}}function Ag(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Dd(r,e,t,s){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function c1(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Mx(r,e){let t=c1(r);return e?t.map((s,i)=>i===t.length-1?s.pathname:s.pathnameBase):t.map(s=>s.pathnameBase)}function Fx(r,e,t,s){s===void 0&&(s=!1);let i;typeof r=="string"?i=Cn(r):(i=Ao({},r),us(!i.pathname||!i.pathname.includes("?"),Dd("?","pathname","search",i)),us(!i.pathname||!i.pathname.includes("#"),Dd("#","pathname","hash",i)),us(!i.search||!i.search.includes("#"),Dd("#","search","hash",i)));let n=r===""||i.pathname==="",a=n?"/":i.pathname,u;if(a==null)u=t;else{let p=e.length-1;if(!s&&a.startsWith("..")){let g=a.split("/");for(;g[0]==="..";)g.shift(),p-=1;i.pathname=g.join("/")}u=p>=0?e[p]:"/"}let d=l1(i,u),h=a&&a!=="/"&&a.endsWith("/"),m=(n||a===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(h||m)&&(d.pathname+="/"),d}const tn=r=>r.join("/").replace(/\/\/+/g,"/"),u1=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),d1=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,h1=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function f1(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const Ux=["post","put","patch","delete"];new Set(Ux);const m1=["get",...Ux];new Set(m1);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Lo(){return Lo=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Lo.apply(this,arguments)}const hf=L.createContext(null),p1=L.createContext(null),jn=L.createContext(null),Vc=L.createContext(null),an=L.createContext({outlet:null,matches:[],isDataRoute:!1}),Bx=L.createContext(null);function g1(r,e){let{relative:t}=e===void 0?{}:e;Vo()||us(!1);let{basename:s,navigator:i}=L.useContext(jn),{hash:n,pathname:a,search:u}=Gx(r,{relative:t}),d=a;return s!=="/"&&(d=a==="/"?s:tn([s,a])),i.createHref({pathname:d,search:u,hash:n})}function Vo(){return L.useContext(Vc)!=null}function Ur(){return Vo()||us(!1),L.useContext(Vc).location}function zx(r){L.useContext(jn).static||L.useLayoutEffect(r)}function Bt(){let{isDataRoute:r}=L.useContext(an);return r?L1():x1()}function x1(){Vo()||us(!1);let r=L.useContext(hf),{basename:e,future:t,navigator:s}=L.useContext(jn),{matches:i}=L.useContext(an),{pathname:n}=Ur(),a=JSON.stringify(Mx(i,t.v7_relativeSplatPath)),u=L.useRef(!1);return zx(()=>{u.current=!0}),L.useCallback(function(h,m){if(m===void 0&&(m={}),!u.current)return;if(typeof h=="number"){s.go(h);return}let p=Fx(h,JSON.parse(a),n,m.relative==="path");r==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:tn([e,p.pathname])),(m.replace?s.replace:s.push)(p,m.state,m)},[e,s,a,n,r])}function Pn(){let{matches:r}=L.useContext(an),e=r[r.length-1];return e?e.params:{}}function Gx(r,e){let{relative:t}=e===void 0?{}:e,{future:s}=L.useContext(jn),{matches:i}=L.useContext(an),{pathname:n}=Ur(),a=JSON.stringify(Mx(i,s.v7_relativeSplatPath));return L.useMemo(()=>Fx(r,JSON.parse(a),n,t==="path"),[r,a,n,t])}function v1(r,e){return y1(r,e)}function y1(r,e,t,s){Vo()||us(!1);let{navigator:i}=L.useContext(jn),{matches:n}=L.useContext(an),a=n[n.length-1],u=a?a.params:{};a&&a.pathname;let d=a?a.pathnameBase:"/";a&&a.route;let h=Ur(),m;if(e){var p;let b=typeof e=="string"?Cn(e):e;d==="/"||(p=b.pathname)!=null&&p.startsWith(d)||us(!1),m=b}else m=h;let g=m.pathname||"/",v=g;if(d!=="/"){let b=d.replace(/^\//,"").split("/");v="/"+g.replace(/^\//,"").split("/").slice(b.length).join("/")}let y=Kw(r,{pathname:v}),S=T1(y&&y.map(b=>Object.assign({},b,{params:Object.assign({},u,b.params),pathname:tn([d,i.encodeLocation?i.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?d:tn([d,i.encodeLocation?i.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),n,t,s);return e&&S?L.createElement(Vc.Provider,{value:{location:Lo({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:en.Pop}},S):S}function b1(){let r=I1(),e=f1(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return L.createElement(L.Fragment,null,L.createElement("h2",null,"Unexpected Application Error!"),L.createElement("h3",{style:{fontStyle:"italic"}},e),t?L.createElement("pre",{style:i},t):null,null)}const w1=L.createElement(b1,null);class S1 extends L.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?L.createElement(an.Provider,{value:this.props.routeContext},L.createElement(Bx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function E1(r){let{routeContext:e,match:t,children:s}=r,i=L.useContext(hf);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),L.createElement(an.Provider,{value:e},s)}function T1(r,e,t,s){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),s===void 0&&(s=null),r==null){var n;if(!t)return null;if(t.errors)r=t.matches;else if((n=s)!=null&&n.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let a=r,u=(i=t)==null?void 0:i.errors;if(u!=null){let m=a.findIndex(p=>p.route.id&&(u==null?void 0:u[p.route.id])!==void 0);m>=0||us(!1),a=a.slice(0,Math.min(a.length,m+1))}let d=!1,h=-1;if(t&&s&&s.v7_partialHydration)for(let m=0;m<a.length;m++){let p=a[m];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=m),p.route.id){let{loaderData:g,errors:v}=t,y=p.route.loader&&g[p.route.id]===void 0&&(!v||v[p.route.id]===void 0);if(p.route.lazy||y){d=!0,h>=0?a=a.slice(0,h+1):a=[a[0]];break}}}return a.reduceRight((m,p,g)=>{let v,y=!1,S=null,b=null;t&&(v=u&&p.route.id?u[p.route.id]:void 0,S=p.route.errorElement||w1,d&&(h<0&&g===0?(R1("route-fallback"),y=!0,b=null):h===g&&(y=!0,b=p.route.hydrateFallbackElement||null)));let T=e.concat(a.slice(0,g+1)),_=()=>{let k;return v?k=S:y?k=b:p.route.Component?k=L.createElement(p.route.Component,null):p.route.element?k=p.route.element:k=m,L.createElement(E1,{match:p,routeContext:{outlet:m,matches:T,isDataRoute:t!=null},children:k})};return t&&(p.route.ErrorBoundary||p.route.errorElement||g===0)?L.createElement(S1,{location:t.location,revalidation:t.revalidation,component:S,error:v,children:_(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):_()},null)}var Vx=(function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r})(Vx||{}),Kx=(function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r})(Kx||{});function _1(r){let e=L.useContext(hf);return e||us(!1),e}function k1(r){let e=L.useContext(p1);return e||us(!1),e}function A1(r){let e=L.useContext(an);return e||us(!1),e}function Wx(r){let e=A1(),t=e.matches[e.matches.length-1];return t.route.id||us(!1),t.route.id}function I1(){var r;let e=L.useContext(Bx),t=k1(),s=Wx();return e!==void 0?e:(r=t.errors)==null?void 0:r[s]}function L1(){let{router:r}=_1(Vx.UseNavigateStable),e=Wx(Kx.UseNavigateStable),t=L.useRef(!1);return zx(()=>{t.current=!0}),L.useCallback(function(i,n){n===void 0&&(n={}),t.current&&(typeof i=="number"?r.navigate(i):r.navigate(i,Lo({fromRouteId:e},n)))},[r,e])}const Ig={};function R1(r,e,t){Ig[r]||(Ig[r]=!0)}function Hx(r,e){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function _t(r){us(!1)}function qx(r){let{basename:e="/",children:t=null,location:s,navigationType:i=en.Pop,navigator:n,static:a=!1,future:u}=r;Vo()&&us(!1);let d=e.replace(/^\/*/,"/"),h=L.useMemo(()=>({basename:d,navigator:n,static:a,future:Lo({v7_relativeSplatPath:!1},u)}),[d,u,n,a]);typeof s=="string"&&(s=Cn(s));let{pathname:m="/",search:p="",hash:g="",state:v=null,key:y="default"}=s,S=L.useMemo(()=>{let b=df(m,d);return b==null?null:{location:{pathname:b,search:p,hash:g,state:v,key:y},navigationType:i}},[d,m,p,g,v,y,i]);return S==null?null:L.createElement(jn.Provider,{value:h},L.createElement(Vc.Provider,{children:t,value:S}))}function N1(r){let{children:e,location:t}=r;return v1(Ih(e),t)}new Promise(()=>{});function Ih(r,e){e===void 0&&(e=[]);let t=[];return L.Children.forEach(r,(s,i)=>{if(!L.isValidElement(s))return;let n=[...e,i];if(s.type===L.Fragment){t.push.apply(t,Ih(s.props.children,n));return}s.type!==_t&&us(!1),!s.props.index||!s.props.children||us(!1);let a={id:s.props.id||n.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(a.children=Ih(s.props.children,n)),t.push(a)}),t}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Lh(){return Lh=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Lh.apply(this,arguments)}function C1(r,e){if(r==null)return{};var t={},s=Object.keys(r),i,n;for(n=0;n<s.length;n++)i=s[n],!(e.indexOf(i)>=0)&&(t[i]=r[i]);return t}function j1(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function P1(r,e){return r.button===0&&(!e||e==="_self")&&!j1(r)}function Rh(r){return r===void 0&&(r=""),new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((e,t)=>{let s=r[t];return e.concat(Array.isArray(s)?s.map(i=>[t,i]):[[t,s]])},[]))}function D1(r,e){let t=Rh(r);return e&&e.forEach((s,i)=>{t.has(i)||e.getAll(i).forEach(n=>{t.append(i,n)})}),t}const O1=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],$1="6";try{window.__reactRouterVersion=$1}catch{}const M1="startTransition",Ic=Pw[M1];function F1(r){let{basename:e,children:t,future:s,window:i}=r,n=L.useRef();n.current==null&&(n.current=zw({window:i,v5Compat:!0}));let a=n.current,[u,d]=L.useState({action:a.action,location:a.location}),{v7_startTransition:h}=s||{},m=L.useCallback(p=>{h&&Ic?Ic(()=>d(p)):d(p)},[d,h]);return L.useLayoutEffect(()=>a.listen(m),[a,m]),L.useEffect(()=>Hx(s),[s]),L.createElement(qx,{basename:e,children:t,location:u.location,navigationType:u.action,navigator:a,future:s})}function U1(r){let{basename:e,children:t,future:s,window:i}=r,n=L.useRef();n.current==null&&(n.current=Gw({window:i,v5Compat:!0}));let a=n.current,[u,d]=L.useState({action:a.action,location:a.location}),{v7_startTransition:h}=s||{},m=L.useCallback(p=>{h&&Ic?Ic(()=>d(p)):d(p)},[d,h]);return L.useLayoutEffect(()=>a.listen(m),[a,m]),L.useEffect(()=>Hx(s),[s]),L.createElement(qx,{basename:e,children:t,location:u.location,navigationType:u.action,navigator:a,future:s})}const B1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",z1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,He=L.forwardRef(function(e,t){let{onClick:s,relative:i,reloadDocument:n,replace:a,state:u,target:d,to:h,preventScrollReset:m,viewTransition:p}=e,g=C1(e,O1),{basename:v}=L.useContext(jn),y,S=!1;if(typeof h=="string"&&z1.test(h)&&(y=h,B1))try{let k=new URL(window.location.href),I=h.startsWith("//")?new URL(k.protocol+h):new URL(h),C=df(I.pathname,v);I.origin===k.origin&&C!=null?h=C+I.search+I.hash:S=!0}catch{}let b=g1(h,{relative:i}),T=G1(h,{replace:a,state:u,target:d,preventScrollReset:m,relative:i,viewTransition:p});function _(k){s&&s(k),k.defaultPrevented||T(k)}return L.createElement("a",Lh({},g,{href:y||b,onClick:S||n?s:_,ref:t,target:d}))});var Lg;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(Lg||(Lg={}));var Rg;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(Rg||(Rg={}));function G1(r,e){let{target:t,replace:s,state:i,preventScrollReset:n,relative:a,viewTransition:u}=e===void 0?{}:e,d=Bt(),h=Ur(),m=Gx(r,{relative:a});return L.useCallback(p=>{if(P1(p,t)){p.preventDefault();let g=s!==void 0?s:Io(h)===Io(m);d(r,{replace:g,state:i,preventScrollReset:n,relative:a,viewTransition:u})}},[h,d,m,s,i,t,r,n,a,u])}function kr(r){let e=L.useRef(Rh(r)),t=L.useRef(!1),s=Ur(),i=L.useMemo(()=>D1(s.search,t.current?null:e.current),[s.search]),n=Bt(),a=L.useCallback((u,d)=>{const h=Rh(typeof u=="function"?u(i):u);t.current=!0,n("?"+h,d)},[n,i]);return[i,a]}function Kc(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t}function V1(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(m){try{h(s.next(m))}catch(p){a(p)}}function d(m){try{h(s.throw(m))}catch(p){a(p)}}function h(m){m.done?n(m.value):i(m.value).then(u,d)}h((s=s.apply(r,e||[])).next())})}const K1=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);class ff extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class W1 extends ff{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ng extends ff{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Cg extends ff{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Nh;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Nh||(Nh={}));class H1{constructor(e,{headers:t={},customFetch:s,region:i=Nh.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=K1(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return V1(this,arguments,void 0,function*(t,s={}){var i;let n,a;try{const{headers:u,method:d,body:h,signal:m,timeout:p}=s;let g={},{region:v}=s;v||(v=this.region);const y=new URL(`${this.url}/${t}`);v&&v!=="any"&&(g["x-region"]=v,y.searchParams.set("forceFunctionRegion",v));let S;h&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(g["Content-Type"]="application/octet-stream",S=h):typeof h=="string"?(g["Content-Type"]="text/plain",S=h):typeof FormData<"u"&&h instanceof FormData?S=h:(g["Content-Type"]="application/json",S=JSON.stringify(h)):h&&typeof h!="string"&&!(typeof Blob<"u"&&h instanceof Blob)&&!(h instanceof ArrayBuffer)&&!(typeof FormData<"u"&&h instanceof FormData)?S=JSON.stringify(h):S=h;let b=m;p&&(a=new AbortController,n=setTimeout(()=>a.abort(),p),m?(b=a.signal,m.addEventListener("abort",()=>a.abort())):b=a.signal);const T=yield this.fetch(y.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},g),this.headers),u),body:S,signal:b}).catch(C=>{throw new W1(C)}),_=T.headers.get("x-relay-error");if(_&&_==="true")throw new Ng(T);if(!T.ok)throw new Cg(T);let k=((i=T.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),I;return k==="application/json"?I=yield T.json():k==="application/octet-stream"||k==="application/pdf"?I=yield T.blob():k==="text/event-stream"?I=T:k==="multipart/form-data"?I=yield T.formData():I=yield T.text(),{data:I,error:null,response:T}}catch(u){return{data:null,error:u,response:u instanceof Cg||u instanceof Ng?u.context:void 0}}finally{n&&clearTimeout(n)}})}}var q1=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}},Y1=class{constructor(r){var e,t;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(e=r.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=r.signal,this.isMaybeSingle=(t=r.isMaybeSingle)!==null&&t!==void 0?t:!1,r.fetch?this.fetch=r.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,e){return this.headers=new Headers(this.headers),this.headers.set(r,e),this}then(r,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{let a=null,u=null,d=null,h=n.status,m=n.statusText;if(n.ok){var p,g;if(t.method!=="HEAD"){var v;const T=await n.text();T===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((v=t.headers.get("Accept"))===null||v===void 0)&&v.includes("application/vnd.pgrst.plan+text"))?u=T:u=JSON.parse(T))}const S=(p=t.headers.get("Prefer"))===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),b=(g=n.headers.get("content-range"))===null||g===void 0?void 0:g.split("/");S&&b&&b.length>1&&(d=parseInt(b[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(u)&&(u.length>1?(a={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,h=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{var y;const S=await n.text();try{a=JSON.parse(S),Array.isArray(a)&&n.status===404&&(u=[],a=null,h=200,m="OK")}catch{n.status===404&&S===""?(h=204,m="No Content"):a={message:S}}if(a&&t.isMaybeSingle&&(!(a==null||(y=a.details)===null||y===void 0)&&y.includes("0 rows"))&&(a=null,h=200,m="OK"),a&&t.shouldThrowOnError)throw new q1(a)}return{error:a,data:u,count:d,status:h,statusText:m}});return this.shouldThrowOnError||(i=i.catch(n=>{var a;let u="";const d=n==null?void 0:n.cause;if(d){var h,m,p,g;const y=(h=d==null?void 0:d.message)!==null&&h!==void 0?h:"",S=(m=d==null?void 0:d.code)!==null&&m!==void 0?m:"";u=`${(p=n==null?void 0:n.name)!==null&&p!==void 0?p:"FetchError"}: ${n==null?void 0:n.message}`,u+=`

Caused by: ${(g=d==null?void 0:d.name)!==null&&g!==void 0?g:"Error"}: ${y}`,S&&(u+=` (${S})`),d!=null&&d.stack&&(u+=`
${d.stack}`)}else{var v;u=(v=n==null?void 0:n.stack)!==null&&v!==void 0?v:""}return{error:{message:`${(a=n==null?void 0:n.name)!==null&&a!==void 0?a:"FetchError"}: ${n==null?void 0:n.message}`,details:u,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),i.then(r,e)}returns(){return this}overrideTypes(){return this}},Q1=class extends Y1{select(r){let e=!1;const t=(r??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:s,referencedTable:i=s}={}){const n=i?`${i}.order`:"order",a=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${a?`${a},`:""}${r}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e,referencedTable:t=e}={}){const s=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(s,`${r}`),this}range(r,e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"offset":`${s}.offset`,n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${r}`),this.url.searchParams.set(n,`${e-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:s=!1,wal:i=!1,format:n="text"}={}){var a;const u=[r?"analyze":null,e?"verbose":null,t?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${d}"; options=${u};`),n==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};const jg=new RegExp("[,()]");var va=class extends Q1{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}regexMatch(r,e){return this.url.searchParams.append(r,`match.${e}`),this}regexIMatch(r,e){return this.url.searchParams.append(r,`imatch.${e}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}isDistinct(r,e){return this.url.searchParams.append(r,`isdistinct.${e}`),this}in(r,e){const t=Array.from(new Set(e)).map(s=>typeof s=="string"&&jg.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}notIn(r,e){const t=Array.from(new Set(e)).map(s=>typeof s=="string"&&jg.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(r,`not.in.(${t})`),this}contains(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return typeof e=="string"?this.url.searchParams.append(r,`ov.${e}`):this.url.searchParams.append(r,`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const n=t===void 0?"":`(${t})`;return this.url.searchParams.append(r,`${i}fts${n}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e,referencedTable:t=e}={}){const s=t?`${t}.or`:"or";return this.url.searchParams.append(s,`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}},X1=class{constructor(r,{headers:e={},schema:t,fetch:s}){this.url=r,this.headers=new Headers(e),this.schema=t,this.fetch=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(r,e){const{head:t=!1,count:s}=e??{},i=t?"HEAD":"GET";let n=!1;const a=(r??"*").split("").map(h=>/\s/.test(h)&&!n?"":(h==='"'&&(n=!n),h)).join(""),{url:u,headers:d}=this.cloneRequestState();return u.searchParams.set("select",a),s&&d.append("Prefer",`count=${s}`),new va({method:i,url:u,headers:d,schema:this.schema,fetch:this.fetch})}insert(r,{count:e,defaultToNull:t=!0}={}){var s;const i="POST",{url:n,headers:a}=this.cloneRequestState();if(e&&a.append("Prefer",`count=${e}`),t||a.append("Prefer","missing=default"),Array.isArray(r)){const u=r.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(u.length>0){const d=[...new Set(u)].map(h=>`"${h}"`);n.searchParams.set("columns",d.join(","))}}return new va({method:i,url:n,headers:a,schema:this.schema,body:r,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:s,defaultToNull:i=!0}={}){var n;const a="POST",{url:u,headers:d}=this.cloneRequestState();if(d.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&u.searchParams.set("on_conflict",e),s&&d.append("Prefer",`count=${s}`),i||d.append("Prefer","missing=default"),Array.isArray(r)){const h=r.reduce((m,p)=>m.concat(Object.keys(p)),[]);if(h.length>0){const m=[...new Set(h)].map(p=>`"${p}"`);u.searchParams.set("columns",m.join(","))}}return new va({method:a,url:u,headers:d,schema:this.schema,body:r,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}update(r,{count:e}={}){var t;const s="PATCH",{url:i,headers:n}=this.cloneRequestState();return e&&n.append("Prefer",`count=${e}`),new va({method:s,url:i,headers:n,schema:this.schema,body:r,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}delete({count:r}={}){var e;const t="DELETE",{url:s,headers:i}=this.cloneRequestState();return r&&i.append("Prefer",`count=${r}`),new va({method:t,url:s,headers:i,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},J1=class Yx{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=i}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new X1(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Yx(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:n}={}){var a;let u;const d=new URL(`${this.url}/rpc/${e}`);let h;const m=v=>v!==null&&typeof v=="object"&&(!Array.isArray(v)||v.some(m)),p=s&&Object.values(t).some(m);p?(u="POST",h=t):s||i?(u=s?"HEAD":"GET",Object.entries(t).filter(([v,y])=>y!==void 0).map(([v,y])=>[v,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([v,y])=>{d.searchParams.append(v,y)})):(u="POST",h=t);const g=new Headers(this.headers);return p?g.set("Prefer",n?`count=${n},return=minimal`:"return=minimal"):n&&g.set("Prefer",`count=${n}`),new va({method:u,url:d,headers:g,schema:this.schemaName,body:h,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}};class Z1{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const s=t.versions;if(s&&s.node){const i=s.node,n=parseInt(i.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const eS="2.91.1",tS=`realtime-js/${eS}`,sS="1.0.0",Qx="2.0.0",Pg=Qx,Ch=1e4,rS=1e3,iS=100;var Qi;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Qi||(Qi={}));var ps;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(ps||(ps={}));var Fr;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Fr||(Fr={}));var jh;(function(r){r.websocket="websocket"})(jh||(jh={}));var An;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(An||(An={}));class nS{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;const i=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var t,s;const i=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:{},a=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(e,t,s){var i,n;const a=e.topic,u=(i=e.ref)!==null&&i!==void 0?i:"",d=(n=e.join_ref)!==null&&n!==void 0?n:"",h=e.payload.event,m=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},p=Object.keys(m).length===0?"":JSON.stringify(m);if(d.length>255)throw new Error(`joinRef length ${d.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`topic length ${a.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`metadata length ${p.length} exceeds maximum of 255`);const g=this.USER_BROADCAST_PUSH_META_LENGTH+d.length+u.length+a.length+h.length+p.length,v=new ArrayBuffer(this.HEADER_LENGTH+g);let y=new DataView(v),S=0;y.setUint8(S++,this.KINDS.userBroadcastPush),y.setUint8(S++,d.length),y.setUint8(S++,u.length),y.setUint8(S++,a.length),y.setUint8(S++,h.length),y.setUint8(S++,p.length),y.setUint8(S++,t),Array.from(d,T=>y.setUint8(S++,T.charCodeAt(0))),Array.from(u,T=>y.setUint8(S++,T.charCodeAt(0))),Array.from(a,T=>y.setUint8(S++,T.charCodeAt(0))),Array.from(h,T=>y.setUint8(S++,T.charCodeAt(0))),Array.from(p,T=>y.setUint8(S++,T.charCodeAt(0)));var b=new Uint8Array(v.byteLength+s.byteLength);return b.set(new Uint8Array(v),0),b.set(new Uint8Array(s),v.byteLength),b.buffer}decode(e,t){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return t(s)}if(typeof e=="string"){const s=JSON.parse(e),[i,n,a,u,d]=s;return t({join_ref:i,ref:n,topic:a,event:u,payload:d})}return t({})}_binaryDecode(e){const t=new DataView(e),s=t.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,i)}}_decodeUserBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2),a=t.getUint8(3),u=t.getUint8(4);let d=this.HEADER_LENGTH+4;const h=s.decode(e.slice(d,d+i));d=d+i;const m=s.decode(e.slice(d,d+n));d=d+n;const p=s.decode(e.slice(d,d+a));d=d+a;const g=e.slice(d,e.byteLength),v=u===this.JSON_ENCODING?JSON.parse(s.decode(g)):g,y={type:this.BROADCAST_EVENT,event:m,payload:v};return a>0&&(y.meta=JSON.parse(p)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:y}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>t.includes(s)))}}class Xx{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Nt;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Nt||(Nt={}));const Dg=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((n,a)=>(n[a]=aS(a,r,e,i),n),{}):{}},aS=(r,e,t,s)=>{const i=e.find(u=>u.name===r),n=i==null?void 0:i.type,a=t[r];return n&&!s.includes(n)?Jx(n,a):Ph(a)},Jx=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return uS(e,t)}switch(r){case Nt.bool:return oS(e);case Nt.float4:case Nt.float8:case Nt.int2:case Nt.int4:case Nt.int8:case Nt.numeric:case Nt.oid:return lS(e);case Nt.json:case Nt.jsonb:return cS(e);case Nt.timestamp:return dS(e);case Nt.abstime:case Nt.date:case Nt.daterange:case Nt.int4range:case Nt.int8range:case Nt.money:case Nt.reltime:case Nt.text:case Nt.time:case Nt.timestamptz:case Nt.timetz:case Nt.tsrange:case Nt.tstzrange:return Ph(e);default:return Ph(e)}},Ph=r=>r,oS=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},lS=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},cS=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch{return r}return r},uS=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const a=r.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(u=>Jx(e,u))}return r},dS=r=>typeof r=="string"?r.replace(" ","T"):r,Zx=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Od{constructor(e,t,s={},i=Ch){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Og;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Og||(Og={}));class wo{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:a,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=wo.syncState(this.state,i,n,a),this.pendingDiffs.forEach(d=>{this.state=wo.syncDiff(this.state,d,n,a)}),this.pendingDiffs=[],u()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:a,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=wo.syncDiff(this.state,i,n,a),u())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),a=this.transformState(t),u={},d={};return this.map(n,(h,m)=>{a[h]||(d[h]=m)}),this.map(a,(h,m)=>{const p=n[h];if(p){const g=m.map(b=>b.presence_ref),v=p.map(b=>b.presence_ref),y=m.filter(b=>v.indexOf(b.presence_ref)<0),S=p.filter(b=>g.indexOf(b.presence_ref)<0);y.length>0&&(u[h]=y),S.length>0&&(d[h]=S)}else u[h]=m}),this.syncDiff(n,{joins:u,leaves:d},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(u,d)=>{var h;const m=(h=e[u])!==null&&h!==void 0?h:[];if(e[u]=this.cloneDeep(d),m.length>0){const p=e[u].map(v=>v.presence_ref),g=m.filter(v=>p.indexOf(v.presence_ref)<0);e[u].unshift(...g)}s(u,m,d)}),this.map(a,(u,d)=>{let h=e[u];if(!h)return;const m=d.map(p=>p.presence_ref);h=h.filter(p=>m.indexOf(p.presence_ref)<0),e[u]=h,i(u,h,d),h.length===0&&delete e[u]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var $g;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})($g||($g={}));var So;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(So||(So={}));var bi;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(bi||(bi={}));class Ea{constructor(e,t={config:{}},s){var i,n;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=ps.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Od(this,Fr.join,this.params,this.timeout),this.rejoinTimer=new Xx(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ps.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ps.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=ps.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ps.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=ps.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Fr.reply,{},(a,u)=>{this._trigger(this._replyEventName(u),a)}),this.presence=new wo(this),this.broadcastEndpointURL=Zx(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((n=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||n===void 0)&&n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==ps.closed){const{config:{broadcast:a,presence:u,private:d}}=this.params,h=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(v=>v.filter))!==null&&i!==void 0?i:[],m=!!this.bindings[So.PRESENCE]&&this.bindings[So.PRESENCE].length>0||((n=this.params.config.presence)===null||n===void 0?void 0:n.enabled)===!0,p={},g={broadcast:a,presence:Object.assign(Object.assign({},u),{enabled:m}),postgres_changes:h,private:d};this.socket.accessTokenValue&&(p.access_token=this.socket.accessTokenValue),this._onError(v=>e==null?void 0:e(bi.CHANNEL_ERROR,v)),this._onClose(()=>e==null?void 0:e(bi.CLOSED)),this.updateJoinPayload(Object.assign({config:g},p)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:v})=>{var y;if(this.socket._isManualToken()||this.socket.setAuth(),v===void 0){e==null||e(bi.SUBSCRIBED);return}else{const S=this.bindings.postgres_changes,b=(y=S==null?void 0:S.length)!==null&&y!==void 0?y:0,T=[];for(let _=0;_<b;_++){const k=S[_],{filter:{event:I,schema:C,table:$,filter:N}}=k,O=v&&v[_];if(O&&O.event===I&&Ea.isFilterValueEqual(O.schema,C)&&Ea.isFilterValueEqual(O.table,$)&&Ea.isFilterValueEqual(O.filter,N))T.push(Object.assign(Object.assign({},k),{id:O.id}));else{this.unsubscribe(),this.state=ps.errored,e==null||e(bi.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=T,e&&e(bi.SUBSCRIBED);return}}).receive("error",v=>{this.state=ps.errored,e==null||e(bi.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(bi.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===ps.joined&&e===So.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var i;if(t==null)return Promise.reject("Payload is required for httpSend()");const n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(i=s.timeout)!==null&&i!==void 0?i:this.timeout);if(u.status===202)return{success:!0};let d=u.statusText;try{const h=await u.json();d=h.error||h.message||d}catch{}return Promise.reject(new Error(d))}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:n,payload:a}=e,u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=h.body)===null||i===void 0?void 0:i.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,u,d;const h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((d=(u=(a=this.params)===null||a===void 0?void 0:a.config)===null||u===void 0?void 0:u.broadcast)===null||d===void 0)&&d.ack)&&n("ok"),h.receive("ok",()=>n("ok")),h.receive("error",()=>n("error")),h.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ps.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Fr.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new Od(this,Fr.leave,{},e),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ps.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Od(this,e,t,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>iS){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const a=e.toLocaleLowerCase(),{close:u,error:d,leave:h,join:m}=Fr;if(s&&[u,d,h,m].indexOf(a)>=0&&s!==this._joinRef())return;let g=this._onMessage(a,t,s);if(t&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(v=>{var y,S,b;return((y=v.filter)===null||y===void 0?void 0:y.event)==="*"||((b=(S=v.filter)===null||S===void 0?void 0:S.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===a}).map(v=>v.callback(g,s)):(n=this.bindings[a])===null||n===void 0||n.filter(v=>{var y,S,b,T,_,k,I,C;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in v){const $=v.id,N=(y=v.filter)===null||y===void 0?void 0:y.event;return $&&((S=t.ids)===null||S===void 0?void 0:S.includes($))&&(N==="*"||(N==null?void 0:N.toLocaleLowerCase())===((b=t.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))&&(!(!((T=v.filter)===null||T===void 0)&&T.table)||v.filter.table===((_=t.data)===null||_===void 0?void 0:_.table))}else{const $=(I=(k=v==null?void 0:v.filter)===null||k===void 0?void 0:k.event)===null||I===void 0?void 0:I.toLocaleLowerCase();return $==="*"||$===((C=t==null?void 0:t.event)===null||C===void 0?void 0:C.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===a}).map(v=>{if(typeof g=="object"&&"ids"in g){const y=g.data,{schema:S,table:b,commit_timestamp:T,type:_,errors:k}=y;g=Object.assign(Object.assign({},{schema:S,table:b,commit_timestamp:T,eventType:_,new:{},old:{},errors:k}),this._getPayloadRecords(y))}v.callback(g,s)})}_isClosed(){return this.state===ps.closed}_isJoined(){return this.state===ps.joined}_isJoining(){return this.state===ps.joining}_isLeaving(){return this.state===ps.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&Ea.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Fr.close,{},e)}_onError(e){this._on(Fr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ps.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Dg(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Dg(e.columns,e.old_record)),t}}const $d=()=>{},Yl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},hS=[1e3,2e3,5e3,1e4],fS=1e4,mS=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class pS{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ch,this.transport=null,this.heartbeatIntervalMs=Yl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=$d,this.ref=0,this.reconnectTimer=null,this.vsn=Pg,this.logger=$d,this.conn=null,this.sendBuffer=[],this.serializer=new nS,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${jh.websocket}`,this.httpEndpoint=Zx(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Z1.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Qi.connecting:return An.Connecting;case Qi.open:return An.Open;case Qi.closing:return An.Closing;default:return An.Closed}}isConnected(){return this.connectionState()===An.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===s);if(i)return i;{const n=new Ea(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:s,payload:i,ref:n}=e,a=()=>{this.encode(e,u=>{var d;(d=this.conn)===null||d===void 0||d.send(u)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(rS,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Yl.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){const h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",h)}catch(m){this.log("error","error in heartbeat callback",m)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:i,payload:n,ref:a}=t,u=a?`(${a})`:"",d=n.status||"";this.log("receive",`${d} ${s} ${i} ${u}`.trim(),n),this.channels.filter(h=>h._isMember(s)).forEach(h=>h._trigger(i,n,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Qi.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Qi.open||this.conn.readyState===Qi.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Fr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([mS],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,s=!1;if(e)t=e,s=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),t=this.accessTokenValue}else t=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{const n={access_token:t,version:tS};t&&i.updateJoinPayload(n),i.joinedOnce&&i._isJoined()&&i._push(Fr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Xx(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Yl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,i,n,a,u,d,h,m,p,g,v;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:Ch,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:Yl.HEARTBEAT_INTERVAL,this.worker=(n=e==null?void 0:e.worker)!==null&&n!==void 0?n:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(u=e==null?void 0:e.heartbeatCallback)!==null&&u!==void 0?u:$d,this.vsn=(d=e==null?void 0:e.vsn)!==null&&d!==void 0?d:Pg,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e==null?void 0:e.reconnectAfterMs)!==null&&h!==void 0?h:(y=>hS[y-1]||fS),this.vsn){case sS:this.encode=(m=e==null?void 0:e.encode)!==null&&m!==void 0?m:((y,S)=>S(JSON.stringify(y))),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:((y,S)=>S(JSON.parse(y)));break;case Qx:this.encode=(g=e==null?void 0:e.encode)!==null&&g!==void 0?g:this.serializer.encode.bind(this.serializer),this.decode=(v=e==null?void 0:e.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Ro=class extends Error{constructor(r,e){var t;super(r),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((t=e.icebergType)==null?void 0:t.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function gS(r,e,t){const s=new URL(e,r);if(t)for(const[i,n]of Object.entries(t))n!==void 0&&s.searchParams.set(i,n);return s.toString()}async function xS(r){return!r||r.type==="none"?{}:r.type==="bearer"?{Authorization:`Bearer ${r.token}`}:r.type==="header"?{[r.name]:r.value}:r.type==="custom"?await r.getHeaders():{}}function vS(r){const e=r.fetchImpl??globalThis.fetch;return{async request({method:t,path:s,query:i,body:n,headers:a}){const u=gS(r.baseUrl,s,i),d=await xS(r.auth),h=await e(u,{method:t,headers:{...n?{"Content-Type":"application/json"}:{},...d,...a},body:n?JSON.stringify(n):void 0}),m=await h.text(),p=(h.headers.get("content-type")||"").includes("application/json"),g=p&&m?JSON.parse(m):m;if(!h.ok){const v=p?g:void 0,y=v==null?void 0:v.error;throw new Ro((y==null?void 0:y.message)??`Request failed with status ${h.status}`,{status:h.status,icebergType:y==null?void 0:y.type,icebergCode:y==null?void 0:y.code,details:v})}return{status:h.status,headers:h.headers,data:g}}}}function Ql(r){return r.join("")}var yS=class{constructor(r,e=""){this.client=r,this.prefix=e}async listNamespaces(r){const e=r?{parent:Ql(r.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(r,e){const t={namespace:r.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ql(r.namespace)}`})}async loadNamespaceMetadata(r){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ql(r.namespace)}`})).data.properties}}async namespaceExists(r){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ql(r.namespace)}`}),!0}catch(e){if(e instanceof Ro&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(r,e){try{return await this.createNamespace(r,e)}catch(t){if(t instanceof Ro&&t.status===409)return;throw t}}};function na(r){return r.join("")}var bS=class{constructor(r,e="",t){this.client=r,this.prefix=e,this.accessDelegation=t}async listTables(r){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${na(r.namespace)}/tables`})).data.identifiers}async createTable(r,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${na(r.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(r,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${na(r.namespace)}/tables/${r.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(r,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${na(r.namespace)}/tables/${r.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(r){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${na(r.namespace)}/tables/${r.name}`,headers:e})).data.metadata}async tableExists(r){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${na(r.namespace)}/tables/${r.name}`,headers:e}),!0}catch(t){if(t instanceof Ro&&t.status===404)return!1;throw t}}async createTableIfNotExists(r,e){try{return await this.createTable(r,e)}catch(t){if(t instanceof Ro&&t.status===409)return await this.loadTable({namespace:r.namespace,name:e.name});throw t}}},wS=class{constructor(r){var s;let e="v1";r.catalogName&&(e+=`/${r.catalogName}`);const t=r.baseUrl.endsWith("/")?r.baseUrl:`${r.baseUrl}/`;this.client=vS({baseUrl:t,auth:r.auth,fetchImpl:r.fetch}),this.accessDelegation=(s=r.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new yS(this.client,e),this.tableOps=new bS(this.client,e,this.accessDelegation)}async listNamespaces(r){return this.namespaceOps.listNamespaces(r)}async createNamespace(r,e){return this.namespaceOps.createNamespace(r,e)}async dropNamespace(r){await this.namespaceOps.dropNamespace(r)}async loadNamespaceMetadata(r){return this.namespaceOps.loadNamespaceMetadata(r)}async listTables(r){return this.tableOps.listTables(r)}async createTable(r,e){return this.tableOps.createTable(r,e)}async updateTable(r,e){return this.tableOps.updateTable(r,e)}async dropTable(r,e){await this.tableOps.dropTable(r,e)}async loadTable(r){return this.tableOps.loadTable(r)}async namespaceExists(r){return this.namespaceOps.namespaceExists(r)}async tableExists(r){return this.tableOps.tableExists(r)}async createNamespaceIfNotExists(r,e){return this.namespaceOps.createNamespaceIfNotExists(r,e)}async createTableIfNotExists(r,e){return this.tableOps.createTableIfNotExists(r,e)}},Wc=class extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}};function Ht(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var SS=class extends Wc{constructor(r,e,t){super(r),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Dh=class extends Wc{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}};const mf=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),ES=()=>Response,Oh=r=>{if(Array.isArray(r))return r.map(t=>Oh(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=Oh(s)}),e},TS=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},_S=r=>!r||typeof r!="string"||r.length===0||r.length>100||r.trim()!==r||r.includes("/")||r.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(r);function No(r){"@babel/helpers - typeof";return No=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},No(r)}function kS(r,e){if(No(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e);if(No(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function AS(r){var e=kS(r,"string");return No(e)=="symbol"?e:e+""}function IS(r,e,t){return(e=AS(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Mg(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,s)}return t}function Je(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Mg(Object(t),!0).forEach(function(s){IS(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Mg(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}const Md=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},LS=async(r,e,t)=>{r instanceof await ES()&&!(t!=null&&t.noResolveJson)?r.json().then(s=>{const i=r.status||500,n=(s==null?void 0:s.statusCode)||i+"";e(new SS(Md(s),i,n))}).catch(s=>{e(new Dh(Md(s),s))}):e(new Dh(Md(r),r))},RS=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!s?i:(TS(s)?(i.headers=Je({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s)):i.body=s,e!=null&&e.duplex&&(i.duplex=e.duplex),Je(Je({},i),t))};async function Ko(r,e,t,s,i,n){return new Promise((a,u)=>{r(t,RS(e,s,i,n)).then(d=>{if(!d.ok)throw d;return s!=null&&s.noResolveJson?d:d.json()}).then(d=>a(d)).catch(d=>LS(d,u,s))})}async function Co(r,e,t,s){return Ko(r,"GET",e,t,s)}async function Mr(r,e,t,s,i){return Ko(r,"POST",e,s,i,t)}async function $h(r,e,t,s,i){return Ko(r,"PUT",e,s,i,t)}async function NS(r,e,t,s){return Ko(r,"HEAD",e,Je(Je({},t),{},{noResolveJson:!0}),s)}async function pf(r,e,t,s,i){return Ko(r,"DELETE",e,s,i,t)}var CS=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e}then(r,e){return this.execute().then(r,e)}async execute(){var r=this;try{return{data:(await r.downloadFn()).body,error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Ht(e))return{data:null,error:e};throw e}}};let ev;ev=Symbol.toStringTag;var jS=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e,this[ev]="BlobDownloadBuilder",this.promise=null}asStream(){return new CS(this.downloadFn,this.shouldThrowOnError)}then(r,e){return this.getPromise().then(r,e)}catch(r){return this.getPromise().catch(r)}finally(r){return this.getPromise().finally(r)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var r=this;try{return{data:await(await r.downloadFn()).blob(),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Ht(e))return{data:null,error:e};throw e}}};const PS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Fg={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var DS=class{constructor(r,e={},t,s){this.shouldThrowOnError=!1,this.url=r,this.headers=e,this.bucketId=t,this.fetch=mf(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(r,e,t,s){var i=this;try{let n;const a=Je(Je({},Fg),s);let u=Je(Je({},i.headers),r==="POST"&&{"x-upsert":String(a.upsert)});const d=a.metadata;typeof Blob<"u"&&t instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),d&&n.append("metadata",i.encodeMetadata(d)),n.append("",t)):typeof FormData<"u"&&t instanceof FormData?(n=t,n.has("cacheControl")||n.append("cacheControl",a.cacheControl),d&&!n.has("metadata")&&n.append("metadata",i.encodeMetadata(d))):(n=t,u["cache-control"]=`max-age=${a.cacheControl}`,u["content-type"]=a.contentType,d&&(u["x-metadata"]=i.toBase64(i.encodeMetadata(d))),(typeof ReadableStream<"u"&&n instanceof ReadableStream||n&&typeof n=="object"&&"pipe"in n&&typeof n.pipe=="function")&&!a.duplex&&(a.duplex="half")),s!=null&&s.headers&&(u=Je(Je({},u),s.headers));const h=i._removeEmptyFolders(e),m=i._getFinalPath(h),p=await(r=="PUT"?$h:Mr)(i.fetch,`${i.url}/object/${m}`,n,Je({headers:u},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:h,id:p.Id,fullPath:p.Key},error:null}}catch(n){if(i.shouldThrowOnError)throw n;if(Ht(n))return{data:null,error:n};throw n}}async upload(r,e,t){return this.uploadOrUpdate("POST",r,e,t)}async uploadToSignedUrl(r,e,t,s){var i=this;const n=i._removeEmptyFolders(r),a=i._getFinalPath(n),u=new URL(i.url+`/object/upload/sign/${a}`);u.searchParams.set("token",e);try{let d;const h=Je({upsert:Fg.upsert},s),m=Je(Je({},i.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&t instanceof Blob?(d=new FormData,d.append("cacheControl",h.cacheControl),d.append("",t)):typeof FormData<"u"&&t instanceof FormData?(d=t,d.append("cacheControl",h.cacheControl)):(d=t,m["cache-control"]=`max-age=${h.cacheControl}`,m["content-type"]=h.contentType),{data:{path:n,fullPath:(await $h(i.fetch,u.toString(),d,{headers:m})).Key},error:null}}catch(d){if(i.shouldThrowOnError)throw d;if(Ht(d))return{data:null,error:d};throw d}}async createSignedUploadUrl(r,e){var t=this;try{let s=t._getFinalPath(r);const i=Je({},t.headers);e!=null&&e.upsert&&(i["x-upsert"]="true");const n=await Mr(t.fetch,`${t.url}/object/upload/sign/${s}`,{},{headers:i}),a=new URL(t.url+n.url),u=a.searchParams.get("token");if(!u)throw new Wc("No token returned by API");return{data:{signedUrl:a.toString(),path:r,token:u},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Ht(s))return{data:null,error:s};throw s}}async update(r,e,t){return this.uploadOrUpdate("PUT",r,e,t)}async move(r,e,t){var s=this;try{return{data:await Mr(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:s.headers}),error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Ht(i))return{data:null,error:i};throw i}}async copy(r,e,t){var s=this;try{return{data:{path:(await Mr(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:s.headers})).Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Ht(i))return{data:null,error:i};throw i}}async createSignedUrl(r,e,t){var s=this;try{let i=s._getFinalPath(r),n=await Mr(s.fetch,`${s.url}/object/sign/${i}`,Je({expiresIn:e},t!=null&&t.transform?{transform:t.transform}:{}),{headers:s.headers});const a=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return n={signedUrl:encodeURI(`${s.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Ht(i))return{data:null,error:i};throw i}}async createSignedUrls(r,e,t){var s=this;try{const i=await Mr(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:r},{headers:s.headers}),n=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return{data:i.map(a=>Je(Je({},a),{},{signedUrl:a.signedURL?encodeURI(`${s.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Ht(i))return{data:null,error:i};throw i}}download(r,e){const t=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),i=s?`?${s}`:"",n=this._getFinalPath(r),a=()=>Co(this.fetch,`${this.url}/${t}/${n}${i}`,{headers:this.headers,noResolveJson:!0});return new jS(a,this.shouldThrowOnError)}async info(r){var e=this;const t=e._getFinalPath(r);try{return{data:Oh(await Co(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})),error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(Ht(s))return{data:null,error:s};throw s}}async exists(r){var e=this;const t=e._getFinalPath(r);try{return await NS(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(Ht(s)&&s instanceof Dh){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}}getPublicUrl(r,e){const t=this._getFinalPath(r),s=[],i=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&s.push(i);const n=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});a!==""&&s.push(a);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${t}${u}`)}}}async remove(r){var e=this;try{return{data:await pf(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}async list(r,e,t){var s=this;try{const i=Je(Je(Je({},PS),e),{},{prefix:r||""});return{data:await Mr(s.fetch,`${s.url}/object/list/${s.bucketId}`,i,{headers:s.headers},t),error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Ht(i))return{data:null,error:i};throw i}}async listV2(r,e){var t=this;try{const s=Je({},r);return{data:await Mr(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,s,{headers:t.headers},e),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Ht(s))return{data:null,error:s};throw s}}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}};const tv="2.91.1",sv={"X-Client-Info":`storage-js/${tv}`};var OS=class{constructor(r,e={},t,s){this.shouldThrowOnError=!1;const i=new URL(r);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Je(Je({},sv),e),this.fetch=mf(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(r){var e=this;try{const t=e.listBucketOptionsToQueryString(r);return{data:await Co(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await Co(e.fetch,`${e.url}/bucket/${r}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}async createBucket(r,e={public:!1}){var t=this;try{return{data:await Mr(t.fetch,`${t.url}/bucket`,{id:r,name:r,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Ht(s))return{data:null,error:s};throw s}}async updateBucket(r,e){var t=this;try{return{data:await $h(t.fetch,`${t.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Ht(s))return{data:null,error:s};throw s}}async emptyBucket(r){var e=this;try{return{data:await Mr(e.fetch,`${e.url}/bucket/${r}/empty`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await pf(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}listBucketOptionsToQueryString(r){const e={};return r&&("limit"in r&&(e.limit=String(r.limit)),"offset"in r&&(e.offset=String(r.offset)),r.search&&(e.search=r.search),r.sortColumn&&(e.sortColumn=r.sortColumn),r.sortOrder&&(e.sortOrder=r.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},$S=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=Je(Je({},sv),e),this.fetch=mf(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await Mr(e.fetch,`${e.url}/bucket`,{name:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}async listBuckets(r){var e=this;try{const t=new URLSearchParams;(r==null?void 0:r.limit)!==void 0&&t.set("limit",r.limit.toString()),(r==null?void 0:r.offset)!==void 0&&t.set("offset",r.offset.toString()),r!=null&&r.sortColumn&&t.set("sortColumn",r.sortColumn),r!=null&&r.sortOrder&&t.set("sortOrder",r.sortOrder),r!=null&&r.search&&t.set("search",r.search);const s=t.toString(),i=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return{data:await Co(e.fetch,i,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await pf(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ht(t))return{data:null,error:t};throw t}}from(r){var e=this;if(!_S(r))throw new Wc("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new wS({baseUrl:this.url,catalogName:r,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(t,{get(i,n){const a=i[n];return typeof a!="function"?a:async(...u)=>{try{return{data:await a.apply(i,u),error:null}}catch(d){if(s)throw d;return{data:null,error:d}}}}})}};const gf={"X-Client-Info":`storage-js/${tv}`,"Content-Type":"application/json"};var rv=class extends Error{constructor(r){super(r),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function fr(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}var Fd=class extends rv{constructor(r,e,t){super(r),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},MS=class extends rv{constructor(r,e){super(r),this.name="StorageVectorsUnknownError",this.originalError=e}};const xf=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),FS=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Ug=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),US=async(r,e,t)=>{if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!(t!=null&&t.noResolveJson)){const s=r.status||500,i=r;if(typeof i.json=="function")i.json().then(n=>{const a=(n==null?void 0:n.statusCode)||(n==null?void 0:n.code)||s+"";e(new Fd(Ug(n),s,a))}).catch(()=>{const n=s+"";e(new Fd(i.statusText||`HTTP ${s} error`,s,n))});else{const n=s+"";e(new Fd(i.statusText||`HTTP ${s} error`,s,n))}}else e(new MS(Ug(r),r))},BS=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return s?(FS(s)?(i.headers=Je({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(s)):i.body=s,Je(Je({},i),t)):i};async function zS(r,e,t,s,i,n){return new Promise((a,u)=>{r(t,BS(e,s,i,n)).then(d=>{if(!d.ok)throw d;if(s!=null&&s.noResolveJson)return d;const h=d.headers.get("content-type");return!h||!h.includes("application/json")?{}:d.json()}).then(d=>a(d)).catch(d=>US(d,u,s))})}async function mr(r,e,t,s,i){return zS(r,"POST",e,s,i,t)}var GS=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=Je(Je({},gf),e),this.fetch=xf(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(r){var e=this;try{return{data:await mr(e.fetch,`${e.url}/CreateIndex`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async getIndex(r,e){var t=this;try{return{data:await mr(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(fr(s))return{data:null,error:s};throw s}}async listIndexes(r){var e=this;try{return{data:await mr(e.fetch,`${e.url}/ListIndexes`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async deleteIndex(r,e){var t=this;try{return{data:await mr(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(fr(s))return{data:null,error:s};throw s}}},VS=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=Je(Je({},gf),e),this.fetch=xf(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(r){var e=this;try{if(r.vectors.length<1||r.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await mr(e.fetch,`${e.url}/PutVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async getVectors(r){var e=this;try{return{data:await mr(e.fetch,`${e.url}/GetVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async listVectors(r){var e=this;try{if(r.segmentCount!==void 0){if(r.segmentCount<1||r.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(r.segmentIndex!==void 0&&(r.segmentIndex<0||r.segmentIndex>=r.segmentCount))throw new Error(`segmentIndex must be between 0 and ${r.segmentCount-1}`)}return{data:await mr(e.fetch,`${e.url}/ListVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async queryVectors(r){var e=this;try{return{data:await mr(e.fetch,`${e.url}/QueryVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async deleteVectors(r){var e=this;try{if(r.keys.length<1||r.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await mr(e.fetch,`${e.url}/DeleteVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}},KS=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=Je(Je({},gf),e),this.fetch=xf(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await mr(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await mr(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async listBuckets(r={}){var e=this;try{return{data:await mr(e.fetch,`${e.url}/ListVectorBuckets`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await mr(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fr(t))return{data:null,error:t};throw t}}},WS=class extends KS{constructor(r,e={}){super(r,e.headers||{},e.fetch)}from(r){return new HS(this.url,this.headers,r,this.fetch)}async createBucket(r){var e=()=>super.createBucket,t=this;return e().call(t,r)}async getBucket(r){var e=()=>super.getBucket,t=this;return e().call(t,r)}async listBuckets(r={}){var e=()=>super.listBuckets,t=this;return e().call(t,r)}async deleteBucket(r){var e=()=>super.deleteBucket,t=this;return e().call(t,r)}},HS=class extends GS{constructor(r,e,t,s){super(r,e,s),this.vectorBucketName=t}async createIndex(r){var e=()=>super.createIndex,t=this;return e().call(t,Je(Je({},r),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(r={}){var e=()=>super.listIndexes,t=this;return e().call(t,Je(Je({},r),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(r){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,r)}async deleteIndex(r){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,r)}index(r){return new qS(this.url,this.headers,this.vectorBucketName,r,this.fetch)}},qS=class extends VS{constructor(r,e,t,s,i){super(r,e,i),this.vectorBucketName=t,this.indexName=s}async putVectors(r){var e=()=>super.putVectors,t=this;return e().call(t,Je(Je({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(r){var e=()=>super.getVectors,t=this;return e().call(t,Je(Je({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(r={}){var e=()=>super.listVectors,t=this;return e().call(t,Je(Je({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(r){var e=()=>super.queryVectors,t=this;return e().call(t,Je(Je({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(r){var e=()=>super.deleteVectors,t=this;return e().call(t,Je(Je({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},YS=class extends OS{constructor(r,e={},t,s){super(r,e,t,s)}from(r){return new DS(this.url,this.headers,r,this.fetch)}get vectors(){return new WS(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new $S(this.url+"/iceberg",this.headers,this.fetch)}};const iv="2.91.1",ya=30*1e3,Mh=3,Ud=Mh*ya,QS="http://localhost:9999",XS="supabase.auth.token",JS={"X-Client-Info":`gotrue-js/${iv}`},Fh="X-Supabase-Api-Version",nv={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ZS=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,eE=600*1e3;class jo extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Ve(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class tE extends jo{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function sE(r){return Ve(r)&&r.name==="AuthApiError"}class In extends jo{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ti extends jo{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class lr extends Ti{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function rE(r){return Ve(r)&&r.name==="AuthSessionMissingError"}class aa extends Ti{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Xl extends Ti{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Jl extends Ti{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function iE(r){return Ve(r)&&r.name==="AuthImplicitGrantRedirectError"}class Bg extends Ti{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class nE extends Ti{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Uh extends Ti{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Bd(r){return Ve(r)&&r.name==="AuthRetryableFetchError"}class zg extends Ti{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Bh extends Ti{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Lc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Gg=` 	
\r=`.split(""),aE=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Gg.length;e+=1)r[Gg[e].charCodeAt(0)]=-2;for(let e=0;e<Lc.length;e+=1)r[Lc[e].charCodeAt(0)]=e;return r})();function Vg(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Lc[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Lc[s]),e.queuedBits-=6}}function av(r,e,t){const s=aE[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Kg(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=a=>{cE(a,s,t)};for(let a=0;a<r.length;a+=1)av(r.charCodeAt(a),i,n);return e.join("")}function oE(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function lE(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}oE(s,e)}}function cE(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if((r>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function _a(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)av(r.charCodeAt(i),t,s);return new Uint8Array(e)}function uE(r){const e=[];return lE(r,t=>e.push(t)),new Uint8Array(e)}function Ln(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return r.forEach(i=>Vg(i,t,s)),Vg(null,t,s),e.join("")}function dE(r){return Math.round(Date.now()/1e3)+r}function hE(){return Symbol("auth-callback")}const Cs=()=>typeof window<"u"&&typeof document<"u",wn={tested:!1,writable:!1},ov=()=>{if(!Cs())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(wn.tested)return wn.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),wn.tested=!0,wn.writable=!0}catch{wn.tested=!0,wn.writable=!1}return wn.writable};function fE(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const lv=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),mE=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",ba=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Sn=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Rs=async(r,e)=>{await r.removeItem(e)};class Hc{constructor(){this.promise=new Hc.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Hc.promiseConstructor=Promise;function zd(r){const e=r.split(".");if(e.length!==3)throw new Bh("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!ZS.test(e[s]))throw new Bh("JWT not in base64url format");return{header:JSON.parse(Kg(e[0])),payload:JSON.parse(Kg(e[1])),signature:_a(e[2]),raw:{header:e[0],payload:e[1]}}}async function pE(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function gE(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await r(n);if(!e(n,null,a)){s(a);return}}catch(a){if(!e(n,a)){i(a);return}}})()})}function xE(r){return("0"+r.toString(16)).substr(-2)}function vE(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,xE).join("")}async function yE(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function bE(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await yE(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function oa(r,e,t=!1){const s=vE();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await ba(r,`${e}-code-verifier`,i);const n=await bE(s);return[n,s===n?"plain":"s256"]}const wE=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function SE(r){const e=r.headers.get(Fh);if(!e||!e.match(wE))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function EE(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function TE(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const _E=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function la(r){if(!_E.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Gd(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function kE(r,e){return new Proxy(r,{get:(t,s,i)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const n=s.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)"||n==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,s,i)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,s,i)}})}function Wg(r){return JSON.parse(JSON.stringify(r))}const _n=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),AE=[502,503,504];async function Hg(r){var e;if(!mE(r))throw new Uh(_n(r),0);if(AE.includes(r.status))throw new Uh(_n(r),r.status);let t;try{t=await r.json()}catch(n){throw new In(_n(n),n)}let s;const i=SE(r);if(i&&i.getTime()>=nv["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new zg(_n(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new lr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new zg(_n(t),r.status,t.weak_password.reasons);throw new tE(_n(t),r.status||500,s)}const IE=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function Xe(r,e,t,s){var i;const n=Object.assign({},s==null?void 0:s.headers);n[Fh]||(n[Fh]=nv["2024-01-01"].name),s!=null&&s.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const a=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const u=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",d=await LE(r,e,t+u,{headers:n,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(d):{data:Object.assign({},d),error:null}}async function LE(r,e,t,s,i,n){const a=IE(e,s,i,n);let u;try{u=await r(t,Object.assign({},a))}catch(d){throw console.error(d),new Uh(_n(d),0)}if(u.ok||await Hg(u),s!=null&&s.noResolveJson)return u;try{return await u.json()}catch(d){await Hg(d)}}function Or(r){var e;let t=null;CE(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=dE(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function qg(r){const e=Or(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Zi(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function RE(r){return{data:r,error:null}}function NE(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,a=Kc(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},d=Object.assign({},a);return{data:{properties:u,user:d},error:null}}function Yg(r){return r}function CE(r){return r.access_token&&r.refresh_token&&r.expires_in}const Vd=["global","local","others"];class jE{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=lv(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Vd[0]){if(Vd.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Vd.join(", ")}`);try{return await Xe(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ve(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Xe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Zi})}catch(s){if(Ve(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Kc(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await Xe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:NE,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Ve(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Xe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Zi})}catch(t){if(Ve(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,a,u,d;try{const h={nextPage:null,lastPage:0,total:0},m=await Xe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:Yg});if(m.error)throw m.error;const p=await m.json(),g=(a=m.headers.get("x-total-count"))!==null&&a!==void 0?a:0,v=(d=(u=m.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return v.length>0&&(v.forEach(y=>{const S=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(y.split(";")[1].split("=")[1]);h[`${b}Page`]=S}),h.total=parseInt(g)),{data:Object.assign(Object.assign({},p),h),error:null}}catch(h){if(Ve(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){la(e);try{return await Xe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Zi})}catch(t){if(Ve(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){la(e);try{return await Xe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Zi})}catch(s){if(Ve(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){la(e);try{return await Xe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Zi})}catch(s){if(Ve(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){la(e.userId);try{const{data:t,error:s}=await Xe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _deleteFactor(e){la(e.userId),la(e.id);try{return{data:await Xe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,i,n,a,u,d;try{const h={nextPage:null,lastPage:0,total:0},m=await Xe(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:Yg});if(m.error)throw m.error;const p=await m.json(),g=(a=m.headers.get("x-total-count"))!==null&&a!==void 0?a:0,v=(d=(u=m.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return v.length>0&&(v.forEach(y=>{const S=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(y.split(";")[1].split("=")[1]);h[`${b}Page`]=S}),h.total=parseInt(g)),{data:Object.assign(Object.assign({},p),h),error:null}}catch(h){if(Ve(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await Xe(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Xe(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await Xe(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ve(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await Xe(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Ve(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Xe(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Ve(t))return{data:null,error:t};throw t}}}function Qg(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const ca={debug:!!(globalThis&&ov()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class cv extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class PE extends cv{}async function DE(r,e,t){ca.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ca.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){ca.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{ca.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw ca.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new PE(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(ca.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function OE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function uv(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function $E(r){return parseInt(r,16)}function ME(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function FE(r){var e;const{chainId:t,domain:s,expirationTime:i,issuedAt:n=new Date,nonce:a,notBefore:u,requestId:d,resources:h,scheme:m,uri:p,version:g}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!p)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(g!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${g}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const v=uv(r.address),y=m?`${m}://${s}`:s,S=r.statement?`${r.statement}
`:"",b=`${y} wants you to sign in with your Ethereum account:
${v}

${S}`;let T=`URI: ${p}
Version: ${g}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${n.toISOString()}`;if(i&&(T+=`
Expiration Time: ${i.toISOString()}`),u&&(T+=`
Not Before: ${u.toISOString()}`),d&&(T+=`
Request ID: ${d}`),h){let _=`
Resources:`;for(const k of h){if(!k||typeof k!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${k}`);_+=`
- ${k}`}T+=_}return`${b}
${T}`}class cs extends Error{constructor({message:e,code:t,cause:s,name:i}){var n;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(n=i??(s instanceof Error?s.name:void 0))!==null&&n!==void 0?n:"Unknown Error",this.code=t}}class Rc extends cs{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function UE({error:r,options:e}){var t,s,i;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new cs({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=n.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new cs({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=n.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new cs({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((i=n.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new cs({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new cs({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new cs({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return n.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new cs({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new cs({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const a=window.location.hostname;if(dv(a)){if(n.rp.id!==a)return new cs({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new cs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new cs({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new cs({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new cs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function BE({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new cs({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new cs({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const s=window.location.hostname;if(dv(s)){if(t.rpId!==s)return new cs({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new cs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new cs({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new cs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class zE{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const GE=new zE;function VE(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:s}=r,i=Kc(r,["challenge","user","excludeCredentials"]),n=_a(e).buffer,a=Object.assign(Object.assign({},t),{id:_a(t.id).buffer}),u=Object.assign(Object.assign({},i),{challenge:n,user:a});if(s&&s.length>0){u.excludeCredentials=new Array(s.length);for(let d=0;d<s.length;d++){const h=s[d];u.excludeCredentials[d]=Object.assign(Object.assign({},h),{id:_a(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return u}function KE(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,s=Kc(r,["challenge","allowCredentials"]),i=_a(e).buffer,n=Object.assign(Object.assign({},s),{challenge:i});if(t&&t.length>0){n.allowCredentials=new Array(t.length);for(let a=0;a<t.length;a++){const u=t[a];n.allowCredentials[a]=Object.assign(Object.assign({},u),{id:_a(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return n}function WE(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:Ln(new Uint8Array(r.response.attestationObject)),clientDataJSON:Ln(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function HE(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,s=r.getClientExtensionResults(),i=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:Ln(new Uint8Array(i.authenticatorData)),clientDataJSON:Ln(new Uint8Array(i.clientDataJSON)),signature:Ln(new Uint8Array(i.signature)),userHandle:i.userHandle?Ln(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function dv(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Xg(){var r,e;return!!(Cs()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function qE(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Rc("Browser returned unexpected credential type",e)}:{data:null,error:new Rc("Empty credential response",e)}}catch(e){return{data:null,error:UE({error:e,options:r})}}}async function YE(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Rc("Browser returned unexpected credential type",e)}:{data:null,error:new Rc("Empty credential response",e)}}catch(e){return{data:null,error:BE({error:e,options:r})}}}const QE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},XE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Nc(...r){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),s={};for(const i of r)if(i)for(const n in i){const a=i[n];if(a!==void 0)if(Array.isArray(a))s[n]=a;else if(t(a))s[n]=a;else if(e(a)){const u=s[n];e(u)?s[n]=Nc(u,a):s[n]=Nc(a)}else s[n]=a}return s}function JE(r,e){return Nc(QE,r,e||{})}function ZE(r,e){return Nc(XE,r,e||{})}class eT{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:i},n){try{const{data:a,error:u}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:u};const d=i??GE.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:h}=a.webauthn.credential_options.publicKey;h.name||(h.name=`${h.id}:${s}`),h.displayName||(h.displayName=h.name)}switch(a.webauthn.type){case"create":{const h=JE(a.webauthn.credential_options.publicKey,n==null?void 0:n.create),{data:m,error:p}=await qE({publicKey:h,signal:d});return m?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:m}},error:null}:{data:null,error:p}}case"request":{const h=ZE(a.webauthn.credential_options.publicKey,n==null?void 0:n.request),{data:m,error:p}=await YE(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:h,signal:d}));return m?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:m}},error:null}:{data:null,error:p}}}}catch(a){return Ve(a)?{data:null,error:a}:{data:null,error:new In("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!t)return{data:null,error:new jo("rpId is required for WebAuthn authentication")};try{if(!Xg())return{data:null,error:new In("Browser does not support WebAuthn",null)};const{data:a,error:u}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:i},{request:n});if(!a)return{data:null,error:u};const{webauthn:d}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:d.type,rpId:t,rpOrigins:s,credential_response:d.credential_response}})}catch(a){return Ve(a)?{data:null,error:a}:{data:null,error:new In("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!t)return{data:null,error:new jo("rpId is required for WebAuthn registration")};try{if(!Xg())return{data:null,error:new In("Browser does not support WebAuthn",null)};const{data:a,error:u}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(m=>{var p;return(p=m.data)===null||p===void 0?void 0:p.all.find(g=>g.factor_type==="webauthn"&&g.friendly_name===e&&g.status!=="unverified")}).then(m=>m?this.client.mfa.unenroll({factorId:m==null?void 0:m.id}):void 0),{data:null,error:u};const{data:d,error:h}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:i},{create:n});return d?this._verify({factorId:a.id,challengeId:d.challengeId,webauthn:{rpId:t,rpOrigins:s,type:d.webauthn.type,credential_response:d.webauthn.credential_response}}):{data:null,error:h}}catch(a){return Ve(a)?{data:null,error:a}:{data:null,error:new In("Unexpected error in register",a)}}}}OE();const tT={url:QS,storageKey:XS,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:JS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Jg(r,e,t){return await t()}const ua={};class Po{get jwks(){var e,t;return(t=(e=ua[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){ua[this.storageKey]=Object.assign(Object.assign({},ua[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=ua[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ua[this.storageKey]=Object.assign(Object.assign({},ua[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const n=Object.assign(Object.assign({},tT),e);if(this.storageKey=n.storageKey,this.instanceID=(t=Po.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,Po.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.instanceID>0&&Cs()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new jE({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=lv(n.fetch),this.lock=n.lock||Jg,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,this.lockAcquireTimeout=n.lockAcquireTimeout,n.lock?this.lock=n.lock:this.persistSession&&Cs()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=DE:this.lock=Jg,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new eT(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:ov()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Qg(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Qg(this.memoryStorage)),Cs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${iv}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},s="none";if(Cs()&&(t=fE(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),Cs()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),iE(n)){const d=(e=n.details)===null||e===void 0?void 0:e.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:n}}return{error:n}}const{session:a,redirectType:u}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",u),await this._saveSession(a),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ve(t)?this._returnResult({error:t}):this._returnResult({error:new In("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const n=await Xe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Or}),{data:a,error:u}=n;if(u||!a)return this._returnResult({data:{user:null,session:null},error:u});const d=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(n){if(Ve(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signUp(e){var t,s,i;try{let n;if("email"in e){const{email:m,password:p,options:g}=e;let v=null,y=null;this.flowType==="pkce"&&([v,y]=await oa(this.storage,this.storageKey)),n=await Xe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:m,password:p,data:(t=g==null?void 0:g.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:v,code_challenge_method:y},xform:Or})}else if("phone"in e){const{phone:m,password:p,options:g}=e;n=await Xe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:p,data:(s=g==null?void 0:g.data)!==null&&s!==void 0?s:{},channel:(i=g==null?void 0:g.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:Or})}else throw new Xl("You must provide either an email or phone number and a password");const{data:a,error:u}=n;if(u||!a)return await Rs(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const d=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(n){if(await Rs(this.storage,`${this.storageKey}-code-verifier`),Ve(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:a,options:u}=e;t=await Xe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:qg})}else if("phone"in e){const{phone:n,password:a,options:u}=e;t=await Xe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:qg})}else throw new Xl("You must provide either an email or phone number and a password");const{data:s,error:i}=t;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){const n=new aa;return this._returnResult({data:{user:null,session:null},error:n})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(Ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,i,n,a,u,d,h,m,p,g;let v,y;if("message"in e)v=e.message,y=e.signature;else{const{chain:S,wallet:b,statement:T,options:_}=e;let k;if(Cs())if(typeof b=="object")k=b;else{const j=window;if("ethereum"in j&&typeof j.ethereum=="object"&&"request"in j.ethereum&&typeof j.ethereum.request=="function")k=j.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=b}const I=new URL((t=_==null?void 0:_.url)!==null&&t!==void 0?t:window.location.href),C=await k.request({method:"eth_requestAccounts"}).then(j=>j).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!C||C.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const $=uv(C[0]);let N=(s=_==null?void 0:_.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!N){const j=await k.request({method:"eth_chainId"});N=$E(j)}const O={domain:I.host,address:$,statement:T,uri:I.href,version:"1",chainId:N,nonce:(i=_==null?void 0:_.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(a=(n=_==null?void 0:_.signInWithEthereum)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(u=_==null?void 0:_.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(d=_==null?void 0:_.signInWithEthereum)===null||d===void 0?void 0:d.notBefore,requestId:(h=_==null?void 0:_.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(m=_==null?void 0:_.signInWithEthereum)===null||m===void 0?void 0:m.resources};v=FE(O),y=await k.request({method:"personal_sign",params:[ME(v),$]})}try{const{data:S,error:b}=await Xe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:y},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Or});if(b)throw b;if(!S||!S.session||!S.user){const T=new aa;return this._returnResult({data:{user:null,session:null},error:T})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:b})}catch(S){if(Ve(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async signInWithSolana(e){var t,s,i,n,a,u,d,h,m,p,g,v;let y,S;if("message"in e)y=e.message,S=e.signature;else{const{chain:b,wallet:T,statement:_,options:k}=e;let I;if(Cs())if(typeof T=="object")I=T;else{const $=window;if("solana"in $&&typeof $.solana=="object"&&("signIn"in $.solana&&typeof $.solana.signIn=="function"||"signMessage"in $.solana&&typeof $.solana.signMessage=="function"))I=$.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof T!="object"||!(k!=null&&k.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");I=T}const C=new URL((t=k==null?void 0:k.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in I&&I.signIn){const $=await I.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},k==null?void 0:k.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),_?{statement:_}:null));let N;if(Array.isArray($)&&$[0]&&typeof $[0]=="object")N=$[0];else if($&&typeof $=="object"&&"signedMessage"in $&&"signature"in $)N=$;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in N&&"signature"in N&&(typeof N.signedMessage=="string"||N.signedMessage instanceof Uint8Array)&&N.signature instanceof Uint8Array)y=typeof N.signedMessage=="string"?N.signedMessage:new TextDecoder().decode(N.signedMessage),S=N.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in I)||typeof I.signMessage!="function"||!("publicKey"in I)||typeof I!="object"||!I.publicKey||!("toBase58"in I.publicKey)||typeof I.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${C.host} wants you to sign in with your Solana account:`,I.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(i=(s=k==null?void 0:k.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=k==null?void 0:k.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${k.signInWithSolana.notBefore}`]:[],...!((a=k==null?void 0:k.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${k.signInWithSolana.expirationTime}`]:[],...!((u=k==null?void 0:k.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${k.signInWithSolana.chainId}`]:[],...!((d=k==null?void 0:k.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${k.signInWithSolana.nonce}`]:[],...!((h=k==null?void 0:k.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${k.signInWithSolana.requestId}`]:[],...!((p=(m=k==null?void 0:k.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||p===void 0)&&p.length?["Resources",...k.signInWithSolana.resources.map(N=>`- ${N}`)]:[]].join(`
`);const $=await I.signMessage(new TextEncoder().encode(y),"utf8");if(!$||!($ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");S=$}}try{const{data:b,error:T}=await Xe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:Ln(S)},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:Or});if(T)throw T;if(!b||!b.session||!b.user){const _=new aa;return this._returnResult({data:{user:null,session:null},error:_})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:T})}catch(b){if(Ve(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async _exchangeCodeForSession(e){const t=await Sn(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{if(!s&&this.flowType==="pkce")throw new nE;const{data:n,error:a}=await Xe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Or});if(await Rs(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!n||!n.session||!n.user){const u=new aa;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}catch(n){if(await Rs(this.storage,`${this.storageKey}-code-verifier`),Ve(n))return this._returnResult({data:{user:null,session:null,redirectType:null},error:n});throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:n,nonce:a}=e,u=await Xe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Or}),{data:d,error:h}=u;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!d||!d.session||!d.user){const m=new aa;return this._returnResult({data:{user:null,session:null},error:m})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:d,error:h})}catch(t){if(Ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,i,n,a;try{if("email"in e){const{email:u,options:d}=e;let h=null,m=null;this.flowType==="pkce"&&([h,m]=await oa(this.storage,this.storageKey));const{error:p}=await Xe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},create_user:(s=d==null?void 0:d.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:h,code_challenge_method:m},redirectTo:d==null?void 0:d.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:p})}if("phone"in e){const{phone:u,options:d}=e,{data:h,error:m}=await Xe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(i=d==null?void 0:d.data)!==null&&i!==void 0?i:{},create_user:(n=d==null?void 0:d.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},channel:(a=d==null?void 0:d.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:m})}throw new Xl("You must provide either an email or phone number.")}catch(u){if(await Rs(this.storage,`${this.storageKey}-code-verifier`),Ve(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(e){var t,s;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:u}=await Xe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:Or});if(u)throw u;if(!a)throw new Error("An error occurred on token verification.");const d=a.session,h=a.user;return d!=null&&d.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(i){if(Ve(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var t,s,i,n,a;try{let u=null,d=null;this.flowType==="pkce"&&([u,d]=await oa(this.storage,this.storageKey));const h=await Xe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:d}),headers:this.headers,xform:RE});return!((n=h.data)===null||n===void 0)&&n.url&&Cs()&&!(!((a=e.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(u){if(await Rs(this.storage,`${this.storageKey}-code-verifier`),Ve(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new lr;const{error:i}=await Xe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(Ve(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:a}=await Xe(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:a,error:u}=await Xe(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:u})}throw new Xl("You must provide either an email or phone number and a type")}catch(t){if(Ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Sn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Ud:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const a=await Sn(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Gd()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=kE(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{session:null},error:n}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await Xe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Zi}):await this._useSession(async t=>{var s,i,n;const{data:a,error:u}=t;if(u)throw u;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new lr}:await Xe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:Zi})})}catch(t){if(Ve(t))return rE(t)&&(await this._removeSession(),await Rs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new lr;const a=i.session;let u=null,d=null;this.flowType==="pkce"&&e.email!=null&&([u,d]=await oa(this.storage,this.storageKey));const{data:h,error:m}=await Xe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:d}),jwt:a.access_token,xform:Zi});if(m)throw m;return a.user=h.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(s){if(await Rs(this.storage,`${this.storageKey}-code-verifier`),Ve(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new lr;const t=Date.now()/1e3;let s=t,i=!0,n=null;const{payload:a}=zd(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{data:u,error:d}=await this._callRefreshToken(e.refresh_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!u)return{data:{user:null,session:null},error:null};n=u}else{const{data:u,error:d}=await this._getUser(e.access_token);if(d)throw d;n={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(t){if(Ve(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:u}=t;if(u)throw u;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new lr;const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(Ve(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!Cs())throw new Jl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Jl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Bg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Jl("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Bg("No code detected.");const{data:_,error:k}=await this._exchangeCodeForSession(e.code);if(k)throw k;const I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:u,expires_at:d,token_type:h}=e;if(!n||!u||!a||!h)throw new Jl("No session defined in URL");const m=Math.round(Date.now()/1e3),p=parseInt(u);let g=m+p;d&&(g=parseInt(d));const v=g-m;v*1e3<=ya&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${p}s`);const y=g-p;m-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,g,m):m-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,g,m);const{data:S,error:b}=await this._getUser(n);if(b)throw b;const T={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:p,expires_at:g,refresh_token:a,token_type:h,user:S.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:T,redirectType:e.type},error:null})}catch(s){if(Ve(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Sn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return this._returnResult({error:n});const a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:u}=await this.admin.signOut(a,e);if(u&&!(sE(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return e!=="others"&&(await this._removeSession(),await Rs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=hE(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await oa(this.storage,this.storageKey,!0));try{return await Xe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(await Rs(this.storage,`${this.storageKey}-code-verifier`),Ve(n))return this._returnResult({data:null,error:n});throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var a,u,d,h,m;const{data:p,error:g}=n;if(g)throw g;const v=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await Xe(this.fetch,"GET",v,{headers:this.headers,jwt:(m=(h=p.session)===null||h===void 0?void 0:h.access_token)!==null&&m!==void 0?m:void 0})});if(i)throw i;return Cs()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:e.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(Ve(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:i,data:{session:n}}=t;if(i)throw i;const{options:a,provider:u,token:d,access_token:h,nonce:m}=e,p=await Xe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=n==null?void 0:n.access_token)!==null&&s!==void 0?s:void 0,body:{provider:u,id_token:d,access_token:h,nonce:m,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Or}),{data:g,error:v}=p;return v?this._returnResult({data:{user:null,session:null},error:v}):!g||!g.session||!g.user?this._returnResult({data:{user:null,session:null},error:new aa}):(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("USER_UPDATED",g.session)),this._returnResult({data:g,error:v}))}catch(i){if(await Rs(this.storage,`${this.storageKey}-code-verifier`),Ve(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await Xe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await gE(async i=>(i>0&&await pE(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await Xe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Or})),(i,n)=>{const a=200*Math.pow(2,i);return n&&Bd(n)&&Date.now()+a-s<ya})}catch(s){if(this._debug(t,"error",s),Ve(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Cs()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await Sn(this.storage,this.storageKey);if(i&&this.userStorage){let a=await Sn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:i.user},await ba(this.userStorage,this.storageKey+"-user",a)),i.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Gd()}else if(i&&!i.user&&!i.user){const a=await Sn(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(i.user=a.user,await Rs(this.storage,this.storageKey+"-user"),await ba(this.storage,this.storageKey,i)):i.user=Gd()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const n=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Ud;if(this._debug(s,`session has${n?"":" not"} expired with margin of ${Ud}s`),n){if(this.autoRefreshToken&&i.refresh_token){const{error:a}=await this._callRefreshToken(i.refresh_token);a&&(console.error(a),Bd(a)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:u}=await this._getUser(i.access_token);!u&&(a!=null&&a.user)?(i.user=a.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(s,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new lr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Hc;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new lr;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const u={data:n.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(n){if(this._debug(i,"error",n),Ve(n)){const a={data:null,error:n};return Bd(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(e,t)}catch(d){n.push(d)}});if(await Promise.all(a),n.length>0){for(let u=0;u<n.length;u+=1)console.error(n[u]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Rs(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await ba(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const n=Wg(i);await ba(this.storage,this.storageKey,n)}else{const i=Wg(t);await ba(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Rs(this.storage,this.storageKey),await Rs(this.storage,this.storageKey+"-code-verifier"),await Rs(this.storage,this.storageKey+"-user"),this.userStorage&&await Rs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Cs()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ya);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/ya);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${ya}ms, refresh threshold is ${Mh} ticks`),i<=Mh&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof cv)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Cs()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,a]=await oa(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(u.toString())}if(s!=null&&s.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?this._returnResult({data:null,error:n}):await Xe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)return this._returnResult({data:null,error:a});const u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:d,error:h}=await Xe(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&d.type==="totp"&&(!((i=d==null?void 0:d.totp)===null||i===void 0)&&i.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),this._returnResult({data:d,error:null}))})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return this._returnResult({data:null,error:n});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?WE(e.webauthn.credential_response):HE(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:d}=await Xe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return d?this._returnResult({data:null,error:d}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:d}))})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return this._returnResult({data:null,error:n});const a=await Xe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});if(a.error)return a;const{data:u}=a;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:VE(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:KE(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const i={all:[],phone:[],totp:[],webauthn:[]};for(const n of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])i.all.push(n),n.status==="verified"&&i[n.factor_type].push(n);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:s},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=zd(s.access_token);let a=null;n.aal&&(a=n.aal);let u=a;((t=(e=s.user.factors)===null||e===void 0?void 0:e.filter(m=>m.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(u="aal2");const h=n.amr||[];return{data:{currentLevel:a,nextLevel:u,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:s},error:i}=t;return i?this._returnResult({data:null,error:i}):s?await Xe(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new lr})})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:i},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new lr});const a=await Xe(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return a.data&&a.data.redirect_url&&Cs()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(s){if(Ve(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:i},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new lr});const a=await Xe(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return a.data&&a.data.redirect_url&&Cs()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(s){if(Ve(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;return s?this._returnResult({data:null,error:s}):t?await Xe(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new lr})})}catch(e){if(Ve(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:s},error:i}=t;return i?this._returnResult({data:null,error:i}):s?(await Xe(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new lr})})}catch(t){if(Ve(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(u=>u.kid===e);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(u=>u.kid===e),s&&this.jwks_cached_at+eE>i)return s;const{data:n,error:a}=await Xe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!n.keys||n.keys.length===0||(this.jwks=n,this.jwks_cached_at=i,s=n.keys.find(u=>u.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:v,error:y}=await this.getSession();if(y||!v.session)return this._returnResult({data:null,error:y});s=v.session.access_token}const{header:i,payload:n,signature:a,raw:{header:u,payload:d}}=zd(s);t!=null&&t.allowExpired||EE(n.exp);const h=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!h){const{error:v}=await this.getUser(s);if(v)throw v;return{data:{claims:n,header:i,signature:a},error:null}}const m=TE(i.alg),p=await crypto.subtle.importKey("jwk",h,m,!0,["verify"]);if(!await crypto.subtle.verify(m,p,a,uE(`${u}.${d}`)))throw new Bh("Invalid JWT signature");return{data:{claims:n,header:i,signature:a},error:null}}catch(s){if(Ve(s))return this._returnResult({data:null,error:s});throw s}}}Po.nextInstanceID={};const sT=Po,rT="2.91.1";let vo="";typeof Deno<"u"?vo="deno":typeof document<"u"?vo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?vo="react-native":vo="node";const iT={"X-Client-Info":`supabase-js-${vo}/${rT}`},nT={headers:iT},aT={schema:"public"},oT={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},lT={};function Do(r){"@babel/helpers - typeof";return Do=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Do(r)}function cT(r,e){if(Do(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e);if(Do(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function uT(r){var e=cT(r,"string");return Do(e)=="symbol"?e:e+""}function dT(r,e,t){return(e=uT(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Zg(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,s)}return t}function es(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Zg(Object(t),!0).forEach(function(s){dT(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Zg(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}const hT=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),fT=()=>Headers,mT=(r,e,t)=>{const s=hT(t),i=fT();return async(n,a)=>{var u;const d=(u=await e())!==null&&u!==void 0?u:r;let h=new i(a==null?void 0:a.headers);return h.has("apikey")||h.set("apikey",r),h.has("Authorization")||h.set("Authorization",`Bearer ${d}`),s(n,es(es({},a),{},{headers:h}))}};function pT(r){return r.endsWith("/")?r:r+"/"}function gT(r,e){var t,s;const{db:i,auth:n,realtime:a,global:u}=r,{db:d,auth:h,realtime:m,global:p}=e,g={db:es(es({},d),i),auth:es(es({},h),n),realtime:es(es({},m),a),storage:{},global:es(es(es({},p),u),{},{headers:es(es({},(t=p==null?void 0:p.headers)!==null&&t!==void 0?t:{}),(s=u==null?void 0:u.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return r.accessToken?g.accessToken=r.accessToken:delete g.accessToken,g}function xT(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(pT(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var vT=class extends sT{constructor(r){super(r)}},yT=class{constructor(r,e,t){var s,i;this.supabaseUrl=r,this.supabaseKey=e;const n=xT(r);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);const a=`sb-${n.hostname.split(".")[0]}-auth-token`,u={db:aT,realtime:lT,auth:es(es({},oT),{},{storageKey:a}),global:nT},d=gT(t??{},u);if(this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken)this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(m,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=d.auth)!==null&&h!==void 0?h:{},this.headers,d.global.fetch)}this.fetch=mT(e,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(es({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(m=>this.realtime.setAuth(m)).catch(m=>console.warn("Failed to set initial Realtime auth token:",m)),this.rest=new J1(new URL("rest/v1",n).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new YS(this.storageUrl.href,this.headers,this.fetch,t==null?void 0:t.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new H1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var r=this,e,t;if(r.accessToken)return await r.accessToken();const{data:s}=await r.auth.getSession();return(e=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:s,userStorage:i,storageKey:n,flowType:a,lock:u,debug:d,throwOnError:h},m,p){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new vT({url:this.authUrl.href,headers:es(es({},g),m),storageKey:n,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:s,userStorage:i,flowType:a,lock:u,debug:d,throwOnError:h,fetch:p,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(r){return new pS(this.realtimeUrl.href,es(es({},r),{},{params:es(es({},{apikey:this.supabaseKey}),r==null?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,e)=>{this._handleTokenChanged(r,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(r,e,t){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):r==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const bT=(r,e,t)=>new yT(r,e,t);function wT(){if(typeof window<"u")return!1;const r=globalThis.process;if(!r)return!1;const e=r.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}wT()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ST="https://bsijwefemueiagzwckmd.supabase.co",ET="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzaWp3ZWZlbXVlaWFnendja21kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MDkwODIsImV4cCI6MjA4MTM4NTA4Mn0.4mFVbVmh6pGzePfXKRsMBfVRuyadqyfZkE7y4ufFG0o",Ei=bT(ST,ET,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage}}),hv=Object.freeze(Object.defineProperty({__proto__:null,supabase:Ei},Symbol.toStringTag,{value:"Module"})),e0=r=>{let e;const t=new Set,s=(h,m)=>{const p=typeof h=="function"?h(e):h;if(!Object.is(p,e)){const g=e;e=m??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(v=>v(e,g))}},i=()=>e,u={setState:s,getState:i,getInitialState:()=>d,subscribe:h=>(t.add(h),()=>t.delete(h))},d=e=r(s,i,u);return u},TT=(r=>r?e0(r):e0),_T=r=>r;function kT(r,e=_T){const t=Sa.useSyncExternalStore(r.subscribe,Sa.useCallback(()=>e(r.getState()),[r,e]),Sa.useCallback(()=>e(r.getInitialState()),[r,e]));return Sa.useDebugValue(t),t}const t0=r=>{const e=TT(r),t=s=>kT(e,s);return Object.assign(t,e),t},fv=(r=>r?t0(r):t0),Mt=fv(r=>({user:null,session:null,plan:null,setAuth:e=>r({session:e,user:(e==null?void 0:e.user)??null}),setPlan:e=>r({plan:e}),logout:()=>r({user:null,session:null,plan:null})}));function AT(){const r=new Date().getFullYear();return l.jsxs("footer",{className:"bg-gradient-to-b from-black via-black/95 to-black border-t border-white/10 mt-auto backdrop-blur-md relative overflow-hidden",style:{boxShadow:"0 -4px 30px rgba(0, 0, 0, 0.5), 0 -2px 10px rgba(0, 0, 0, 0.3)"},children:[l.jsx("div",{className:"absolute inset-0 opacity-5 pointer-events-none",style:{background:"radial-gradient(circle at 50% 0%, rgba(240, 166, 255, 0.1) 0%, transparent 50%)"}}),l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-8 md:py-12 relative z-10",children:[l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 md:gap-8 lg:gap-12 mb-8 md:mb-10 text-center sm:text-left",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-xl md:text-2xl font-bold text-white mb-3 md:mb-4 bg-gradient-to-r from-white to-white/80 bg-clip-text text-transparent",style:{textShadow:"0 0 20px rgba(240, 166, 255, 0.3)"},children:"NEBULA"}),l.jsx("p",{className:"text-xs sm:text-sm text-white/70 leading-relaxed",children:"La tua piattaforma di streaming preferita per film e serie TV. Streaming illimitato, quando vuoi, dove vuoi."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-sm font-semibold text-white mb-4 uppercase tracking-wider",children:"Informazioni"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx(He,{to:"/about",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Chi siamo"})}),l.jsx("li",{children:l.jsx(He,{to:"/contact",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Contatti"})}),l.jsx("li",{children:l.jsx(He,{to:"/faq",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"FAQ"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-sm font-semibold text-white mb-4 uppercase tracking-wider",children:"Legale"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx(He,{to:"/terms",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Termini e Condizioni"})}),l.jsx("li",{children:l.jsx(He,{to:"/privacy",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Privacy Policy"})}),l.jsx("li",{children:l.jsx(He,{to:"/cookies",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Cookie Policy"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-sm font-semibold text-white mb-4 uppercase tracking-wider",children:"Supporto"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"https://t.me/NebulaSystem",target:"_blank",rel:"noopener noreferrer",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Telegram"})}),l.jsx("li",{children:l.jsx("a",{href:"https://www.instagram.com/ask_nebuladev",target:"_blank",rel:"noopener noreferrer",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Instagram"})}),l.jsx("li",{children:l.jsx("a",{href:"https://x.com/AskNebulaDev",target:"_blank",rel:"noopener noreferrer",className:"text-white/70 hover:text-white transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] hover:translate-x-1 inline-block",style:{transition:"color 0.5s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)"},children:"X (Twitter)"})})]})]})]}),l.jsx("div",{className:"border-t border-white/10 pt-6 md:pt-8 text-center md:text-left",children:l.jsxs("p",{className:"text-xs sm:text-sm text-white/60",children:[" ",r," Nebula Streaming. Tutti i diritti riservati."]})})]})]})}function IT(){L.useEffect(()=>{const r=Array.from(document.querySelectorAll(".reveal-on-scroll"));if(r.length===0)return;const e=new IntersectionObserver(t=>{t.forEach(s=>{s.isIntersecting&&s.target.classList.add("is-visible")})},{threshold:.15,rootMargin:"0px 0px -10% 0px"});return r.forEach(t=>e.observe(t)),()=>{e.disconnect()}},[])}const LT="https://api.asknebula.it";function ns({children:r,hideTopSpacer:e=!1}){const{user:t,plan:s}=Mt(),i=Bt(),[n,a]=L.useState(!1),[u,d]=L.useState(""),[h,m]=L.useState([]),[p,g]=L.useState(!1),v=L.useRef(null),[y,S]=L.useState(!1),[b,T]=L.useState([]),_=L.useRef(null),k=L.useRef(null),[I,C]=L.useState(!1),$=L.useRef(null),[N,O]=L.useState(!1),[j,D]=L.useState(!1);IT(),L.useEffect(()=>{const W=()=>{const te=window.scrollY;O(te>50)};return window.addEventListener("scroll",W,{passive:!0}),W(),()=>{window.removeEventListener("scroll",W)}},[]);const G=()=>{a(!0)},X=async W=>{W&&W.preventDefault();const te=u.trim();te&&(i(`/browse?search=${encodeURIComponent(te)}`),a(!1),m([]))};L.useEffect(()=>{async function W(){try{const te=await fetch(`${LT}/genres`);if(te.ok){const z=await te.json();T(z.genres||[])}}catch{}}W()},[]),L.useEffect(()=>{function W(te){v.current&&!v.current.contains(te.target)&&(a(!1),d(""),m([]));const z=_.current&&_.current.contains(te.target),M=k.current&&k.current.contains(te.target);!z&&!M&&S(!1),$.current&&!$.current.contains(te.target)&&C(!1)}if(n||y||j)return document.addEventListener("mousedown",W),()=>document.removeEventListener("mousedown",W)},[n,y,I,j]);const K=async()=>{try{await Ei.auth.signOut()}catch{}Mt.getState().logout(),i("/")};return l.jsxs("div",{className:"min-h-screen bg-[#0f0f0f] text-white",children:[l.jsxs("header",{className:"fixed top-0 left-0 right-0 z-[100] flex items-center justify-between px-3 sm:px-4 md:px-6 lg:px-8 py-1.5 sm:py-2 md:py-2.5 transition-all duration-[500ms] ease-[cubic-bezier(0.16,1,0.3,1)]",style:{transition:"background-color 250ms ease-out, backdrop-filter 300ms ease-out",willChange:"background-color, backdrop-filter",position:"fixed",top:0,left:0,right:0,backgroundColor:"transparent",backdropFilter:N?"blur(8px)":"none",WebkitBackdropFilter:N?"blur(8px)":"none",borderBottom:"1px solid transparent",boxShadow:"none"},children:[l.jsxs("div",{className:"flex items-center gap-3 md:gap-6",children:[l.jsxs(He,{to:"/",className:"flex items-center gap-2 md:gap-3 text-xl md:text-2xl font-bold text-white transition-all duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 active:scale-95 gpu-accelerated",style:{textShadow:"0 0 20px rgba(255, 255, 255, 0.1), 0 2px 8px rgba(0, 0, 0, 0.5)",transition:"transform 0.7s cubic-bezier(0.16, 1, 0.3, 1), text-shadow 0.6s cubic-bezier(0.16, 1, 0.3, 1)"},children:[l.jsx("img",{src:window.location.origin+"/Nebula.jpg",alt:"Nebula Logo",className:"h-6 md:h-8 w-auto object-contain",style:{filter:"drop-shadow(0 0 10px rgba(255, 255, 255, 0.2))"},onError:W=>{const te=W.target;return te.style.display="none",te.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg"%3E%3C/svg%3E',W.preventDefault(),W.stopPropagation(),!1}}),l.jsx("span",{className:"hidden sm:inline",children:"NEBULA"})]}),l.jsxs("div",{ref:_,className:"relative hidden md:block",children:[l.jsxs("button",{onClick:()=>S(!y),className:"text-white hover:text-white/70 transition-all duration-600 ease-[cubic-bezier(0.16,1,0.3,1)] flex items-center gap-1 text-sm",style:{transition:"color 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)"},children:["Generi",l.jsx("svg",{className:`w-4 h-4 transition-transform ${y?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),y&&b.length>0&&l.jsxs("div",{className:"absolute top-full left-0 mt-2 w-[90vw] md:w-[700px] max-w-[700px] bg-black/95 backdrop-blur-md border border-white/10 rounded-lg shadow-2xl p-4 md:p-6 z-50",style:{boxShadow:"0 20px 60px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255, 255, 255, 0.1) inset",transition:"opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1), transform 0.3s cubic-bezier(0.16, 1, 0.3, 1)"},children:[l.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:["Generi",l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-x-4 md:gap-x-6 gap-y-2 max-h-[400px] overflow-y-auto",children:b.map(W=>{const te=W.type==="both"?"both":W.type;return l.jsx(He,{to:`/genre/${W.id}?name=${encodeURIComponent(W.name)}&type=${te}`,onClick:()=>S(!1),className:"text-left text-white hover:text-nebula-300 transition-colors text-sm py-1.5 whitespace-nowrap block",children:W.name},W.id)})})]})]})]}),l.jsxs("nav",{className:"flex items-center gap-2 md:gap-6",children:[l.jsx("div",{ref:v,className:"relative",children:n?l.jsxs("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 z-50 w-[calc(100vw-2rem)] sm:w-80 md:w-96",style:{transform:"translateY(-50%) translateZ(0)",willChange:"transform"},children:[l.jsxs("form",{onSubmit:X,className:"flex gap-2",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40",children:l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),l.jsx("input",{type:"text",placeholder:"Cerca titolo",value:u,onChange:W=>d(W.target.value),autoFocus:!0,className:"w-full rounded-[2px] bg-[#1a1a1a] border border-white/5 pl-10 pr-4 py-2.5 text-sm text-white placeholder-white/30 outline-none focus:border-white/10 focus:bg-[#202020] transition-all duration-300 shadow-inner",style:{boxShadow:"inset 0 2px 4px 0 rgba(0, 0, 0, 0.3)"}})]}),l.jsx("button",{type:"submit",className:"rounded-[2px] bg-[#018850] hover:bg-[#016d40] px-5 py-2.5 text-sm font-bold text-white shadow-none transition-all duration-300 hover:scale-105 active:scale-95 whitespace-nowrap border border-white/5",children:p?l.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):"Cerca"})]}),h.length>0&&l.jsx("div",{className:"mt-2 max-h-96 overflow-y-auto rounded-lg bg-black/95 border-2 border-white/20 backdrop-blur-sm",children:h.map(W=>l.jsxs(He,{to:`/title/${W.tmdb_id}?type=${W.type}`,onClick:()=>{a(!1),d(""),m([])},className:"block px-4 py-3 hover:bg-white/10 transition-colors border-b border-white/10 last:border-b-0",children:[l.jsx("div",{className:"font-semibold text-sm",children:W.title}),l.jsxs("div",{className:"text-xs text-white/60 mt-1",children:[W.year&&`${W.year}  `,W.type==="tv"?"Serie TV":"Film"]})]},`${W.tmdb_id}-${W.type}`))})]}):l.jsx("button",{onClick:G,className:"p-2 hover:bg-white/10 rounded-lg transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 active:scale-95",style:{transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), background-color 0.8s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},"aria-label":"Cerca",children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),l.jsxs("div",{className:"hidden md:flex items-center gap-6",children:[l.jsx(He,{to:"/",className:"text-sm text-white hover:text-white/70 transition-all duration-600 ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 active:scale-95 transform",style:{transition:"color 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Home"}),l.jsx(He,{to:"/browse",className:"text-sm text-white hover:text-white/70 transition-all duration-600 ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 active:scale-95 transform",style:{transition:"color 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Esplora"}),l.jsx(He,{to:"/plans",className:"text-sm text-white hover:text-white/70 transition-all duration-600 ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 active:scale-95 transform",style:{transition:"color 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Piani"})]}),l.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[l.jsx("a",{href:"https://t.me/OfficialNebulaStreaming",target:"_blank",rel:"noopener noreferrer",className:"text-white hover:text-white/70 transition-all duration-600 ease-[cubic-bezier(0.16,1,0.3,1)]",style:{transition:"color 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1)"},"aria-label":"Telegram",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),l.jsx("a",{href:"https://www.instagram.com/ask_nebuladev",target:"_blank",rel:"noopener noreferrer",className:"text-white hover:text-white/70 transition-all duration-600 ease-[cubic-bezier(0.16,1,0.3,1)]",style:{transition:"color 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1)"},"aria-label":"Instagram",children:l.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})}),l.jsx("a",{href:"https://x.com/AskNebulaDev",target:"_blank",rel:"noopener noreferrer",className:"text-white hover:text-white/70 transition-all duration-600 ease-[cubic-bezier(0.16,1,0.3,1)]",style:{transition:"color 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1)"},"aria-label":"X (Twitter)",children:l.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})})]}),t?l.jsxs("div",{ref:$,className:"relative hidden md:flex items-center gap-3",children:[s&&l.jsx("span",{className:"text-xs text-white/60 uppercase hidden lg:inline",children:s.plan}),l.jsxs("button",{onClick:()=>C(W=>!W),className:"flex items-center gap-2 text-sm text-white/80 hover:text-white transition-colors",children:[l.jsx("span",{className:"hidden lg:inline",children:t.email?t.email.split("@")[0].replace(/\./g,""):"Utente"}),l.jsx("span",{className:"lg:hidden",children:t.email?t.email.split("@")[0].replace(/\./g,""):"Utente"}),l.jsx("svg",{className:`w-4 h-4 transition-transform ${I?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),I&&l.jsxs("div",{className:"absolute right-0 top-full mt-2 w-44 rounded-lg bg-black/95 backdrop-blur-md border border-white/10 shadow-2xl z-50",style:{boxShadow:"0 20px 60px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255, 255, 255, 0.1) inset",transition:"opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1), transform 0.3s cubic-bezier(0.16, 1, 0.3, 1)"},children:[l.jsx("button",{onClick:()=>{C(!1),i("/account")},className:"w-full text-left px-4 py-2 text-sm hover:bg-white/10 transition-colors",children:"Account"}),l.jsx("button",{onClick:K,className:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:"Logout"})]})]}):l.jsx(He,{to:"/login",className:"hidden md:inline-block px-4 py-2 text-sm font-medium text-white hover:text-white/70 transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 active:scale-95",style:{transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), color 0.8s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Entra"}),l.jsx("button",{onClick:()=>D(!j),className:"md:hidden p-2 text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Menu",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:j?l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]}),l.jsx("div",{className:`absolute top-full left-0 right-0 bg-black/95 backdrop-blur-xl border-b border-white/10 md:hidden z-40 overflow-hidden transition-all duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] ${j?"max-h-screen opacity-100 translate-y-0":"max-h-0 opacity-0 -translate-y-4 pointer-events-none"}`,onClick:W=>{W.target===W.currentTarget&&D(!1)},children:l.jsxs("div",{className:"px-4 py-6 space-y-4",children:[l.jsx(He,{to:"/",onClick:()=>D(!1),className:"block text-lg font-medium text-white hover:text-nebula-300 transition-colors py-2 border-b border-white/5",children:"Home"}),l.jsx(He,{to:"/browse",onClick:()=>D(!1),className:"block text-lg font-medium text-white hover:text-nebula-300 transition-colors py-2 border-b border-white/5",children:"Esplora"}),l.jsxs("div",{ref:k,className:"relative border-b border-white/5",children:[l.jsxs("button",{onClick:()=>S(!y),className:"w-full text-left text-lg font-medium text-white hover:text-nebula-300 transition-colors py-2 flex items-center justify-between",children:["Generi",l.jsx("svg",{className:`w-5 h-5 transition-transform duration-300 ${y?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${y?"max-h-[300px] opacity-100 mt-2 pb-2":"max-h-0 opacity-0"}`,children:l.jsx("div",{className:"grid grid-cols-2 gap-2",children:b.map(W=>{const te=W.type==="both"?"both":W.type;return l.jsx(He,{to:`/genre/${W.id}?name=${encodeURIComponent(W.name)}&type=${te}`,onClick:()=>{S(!1),D(!1)},className:"text-left text-white/70 hover:text-white transition-colors text-sm py-1.5 block",children:W.name},W.id)})})})]}),t?l.jsxs(l.Fragment,{children:[l.jsx(He,{to:"/account",onClick:()=>D(!1),className:"block text-lg font-medium text-white hover:text-nebula-300 transition-colors py-2 border-b border-white/5",children:"Account"}),l.jsx("button",{onClick:()=>{K(),D(!1)},className:"w-full text-left text-lg font-medium text-red-400 hover:text-red-300 transition-colors py-2",children:"Logout"})]}):l.jsx(He,{to:"/login",onClick:()=>D(!1),className:"block text-lg font-medium text-white hover:text-nebula-300 transition-colors py-2",children:"Entra"})]})})]}),!e&&l.jsx("div",{className:"h-[48px] sm:h-[56px] md:h-[64px]","aria-hidden":"true"}),l.jsx("main",{className:"pb-10 min-h-screen flex flex-col animate-[fade-in-up_0.5s_ease-out]",children:r}),l.jsx(AT,{})]})}const Kd="https://api.asknebula.it",Wd=new Map;function Ze(r,e="large"){if(!r||typeof r!="string")return null;const t=`${r}:${e}`;if(Wd.has(t))return Wd.get(t);let s=null;const n={small:"w300",medium:"w500",large:"w780",xlarge:"w1280",xxlarge:"w1920",original:"original"}[e];if(r.startsWith("http://")||r.startsWith("https://")){let a=r;r.includes("image.tmdb.org")&&r.includes("/t/p/")&&(a=r.replace(/\/w\d+\//,`/${n}/`)),s=`${Kd}/proxy-image?url=${encodeURIComponent(a)}`}else if(r.startsWith("/"))if(r.includes("/t/p/")){const u=`https://image.tmdb.org${r.replace(/\/w\d+\//,`/${n}/`)}`;s=`${Kd}/proxy-image?url=${encodeURIComponent(u)}`}else{const a=`https://image.tmdb.org/t/p/${n}${r}`;s=`${Kd}/proxy-image?url=${encodeURIComponent(a)}`}return Wd.set(t,s),s}function mv(r,e,t=!0){return e&&t?Ze(e,"original"):Ze(r,t?"xxlarge":"xlarge")}const RT="https://api.asknebula.it";function NT({item:r,onClose:e}){var S,b,T,_;const[t,s]=L.useState(null),[i,n]=L.useState(null),[a,u]=L.useState(!0),[d,h]=L.useState(!1);L.useEffect(()=>(document.body.style.overflow="hidden",(async()=>{var I,C;try{const N=await(await fetch(`${RT}/title/${r.tmdb_id}?type=${r.type}`)).json();s(N.raw);const j=(((C=(I=N.raw)==null?void 0:I.videos)==null?void 0:C.results)||[]).find(D=>D.type==="Trailer"&&D.site==="YouTube");j!=null&&j.key&&(n(j.key),setTimeout(()=>h(!0),500))}catch($){console.error("Error fetching details",$)}})(),()=>{document.body.style.overflow=""}),[r]);const m=()=>{e()},p=(t==null?void 0:t.backdrop_original)||(t==null?void 0:t.backdrop)||r.backdrop,g=(t==null?void 0:t.poster)||r.poster,v=Ze(p||g||void 0),y=((T=(b=(S=t==null?void 0:t.images)==null?void 0:S.logos)==null?void 0:b.find(k=>k.iso_639_1==="en"))==null?void 0:T.file_path)||(t==null?void 0:t.logo_path)||r.logo||void 0;return l.jsxs("div",{className:"fixed inset-0 z-[100] bg-[#141414] overflow-y-auto animate-in fade-in duration-200",children:[l.jsx("button",{onClick:m,className:"absolute top-4 right-4 z-50 w-10 h-10 flex items-center justify-center rounded-full bg-black/50 text-white backdrop-blur-md",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),l.jsxs("div",{className:"relative w-full aspect-video bg-black",children:[d&&i?l.jsxs("div",{className:"absolute inset-0 z-0",children:[l.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${i}?autoplay=1&mute=${a?1:0}&loop=1&playlist=${i}&controls=0&showinfo=0&rel=0&modestbranding=1&playsinline=1&enablejsapi=1&iv_load_policy=3&fs=0&disablekb=1&cc_load_policy=0&vq=hd720&origin=${window.location.origin}`,allow:"autoplay; encrypted-media; gyroscope; picture-in-picture",style:{border:"none"}}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#141414] to-transparent pointer-events-none"})]}):l.jsxs("div",{className:"absolute inset-0 z-0",children:[l.jsx("img",{src:v||"",alt:r.title,className:"w-full h-full object-cover"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#141414] to-transparent"})]}),d&&i&&l.jsx("button",{onClick:()=>u(!a),className:"absolute bottom-4 right-4 z-20 w-8 h-8 rounded-full bg-black/50 flex items-center justify-center text-white",children:a?l.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})})]}),l.jsxs("div",{className:"px-4 pb-8 space-y-4",children:[y?l.jsx("img",{src:Ze(y,"original")||"",alt:r.title,className:"max-w-[70%] max-h-20 object-contain -mt-8 relative z-10"}):l.jsx("h1",{className:"text-2xl font-bold text-white -mt-4 relative z-10 drop-shadow-lg",children:r.title}),l.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[l.jsxs(He,{to:`/title/${r.tmdb_id}?type=${r.type}`,className:"w-full py-3 bg-white text-black font-bold text-center rounded text-lg flex items-center justify-center gap-2",children:[l.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})}),"Riproduci"]}),l.jsxs("button",{className:"w-full py-3 bg-[#2a2a2a] text-white font-bold text-center rounded text-lg flex items-center justify-center gap-2",onClick:()=>{},children:[l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"La mia lista"]})]}),l.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-400 font-medium",children:[l.jsxs("span",{className:"text-green-500 font-bold",children:[Math.round((r.rating||(t==null?void 0:t.vote_average))*10),"% Match"]}),l.jsx("span",{children:r.year||(t!=null&&t.release_date?new Date(t.release_date).getFullYear():"")}),l.jsx("span",{className:"border border-gray-600 px-1 rounded text-xs",children:"HD"})]}),l.jsx("p",{className:"text-white text-sm leading-relaxed text-gray-300",children:(t==null?void 0:t.overview)||r.overview}),l.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-gray-400",children:(_=t==null?void 0:t.genres)==null?void 0:_.map(k=>k.name).join("  ")})]})]})}const s0=L.memo(function({src:e,alt:t,className:s="",fallbackTitle:i,priority:n=!1,aspectRatio:a,sizes:u="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",imgStyle:d}){const[h,m]=L.useState(null),[p,g]=L.useState(!1),[v,y]=L.useState(!1),[S,b]=L.useState(n),T=L.useRef(null),_=L.useRef(null);L.useEffect(()=>{if(n||S)return;const N=new IntersectionObserver(O=>{O.forEach(j=>{j.isIntersecting&&(b(!0),_.current&&(_.current.disconnect(),_.current=null))})},{rootMargin:"50px",threshold:.01});return T.current&&(N.observe(T.current),_.current=N),()=>{_.current&&(_.current.disconnect(),_.current=null)}},[n,S]),L.useEffect(()=>{S&&e&&!h&&m(e)},[S,e,h]);const I=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`<svg width="400" height="600" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#16213e;stop-opacity:1" />
        </linearGradient>
      </defs>
      <rect width="400" height="600" fill="url(#grad)"/>
      <text x="50%" y="50%" font-family="Arial" font-size="24" fill="#888" text-anchor="middle" dy=".3em"></text>
    </svg>`)}`,C=()=>{g(!0)},$=()=>{y(!0),g(!1)};return v||!e&&!n?l.jsxs("div",{className:`${s} flex flex-col items-center justify-center text-center p-4 bg-gradient-to-br from-slate-800 via-slate-900 to-black`,style:a?{aspectRatio:a}:void 0,children:[l.jsx("div",{className:"text-4xl mb-2 opacity-50",children:""}),l.jsx("p",{className:"text-sm font-semibold text-white/70 line-clamp-3",children:i||t})]}):l.jsxs("div",{ref:T,className:`relative overflow-hidden ${s}`,style:a?{aspectRatio:a}:void 0,children:[!p&&h&&l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-800 via-slate-900 to-black animate-pulse",style:{backgroundImage:`url(${I})`,backgroundSize:"cover",backgroundPosition:"center",filter:"blur(20px)",transform:"scale(1.1)"}}),h&&l.jsx("img",{src:h,alt:t,className:`h-full w-full object-cover transition-opacity duration-500 ${p?"opacity-100":"opacity-0"}`,loading:n?"eager":"lazy",decoding:"async",onLoad:C,onError:$,sizes:u,style:{imageRendering:"-webkit-optimize-contrast",transform:"translateZ(0)",...d}}),!S&&!h&&l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-800 via-slate-900 to-black flex items-center justify-center",style:{backgroundImage:`url(${I})`,backgroundSize:"cover",backgroundPosition:"center"},children:l.jsx("div",{className:"text-4xl opacity-30",children:""})})]})});function vf({isOpen:r,onClose:e,currentPlan:t="free"}){const s=Bt();if(L.useEffect(()=>{if(!r)return;const a=u=>{u.key==="Escape"&&e()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[r,e]),!r)return null;const i=a=>{e(),s(`/checkout?plan=${a}&duration=month`)},n=a=>{a.target===a.currentTarget&&e()};return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",onClick:n,children:l.jsxs("div",{className:"bg-neutral-900 rounded-xl border border-white/20 max-w-md w-full p-4 sm:p-6 animate-fade-in max-h-[90vh] overflow-y-auto",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"text-5xl mb-4",children:""}),l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Limite Preferiti Raggiunto"}),l.jsxs("p",{className:"text-white/70 text-sm",children:["Hai raggiunto il limite massimo di preferiti per il piano ",l.jsx("span",{className:"font-semibold text-green-400 uppercase",children:t}),"."]})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("p",{className:"text-white/90 text-center mb-4",children:"Passa a uno dei nostri piani premium per aggiungere preferiti illimitati:"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("button",{onClick:()=>i("basic"),className:"w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors text-left flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("div",{className:"font-bold",children:"Basic"}),l.jsx("div",{className:"text-xs text-white/80",children:"Preferiti illimitati"})]}),l.jsx("span",{className:"text-sm",children:""})]}),l.jsxs("button",{onClick:()=>i("premium"),className:"w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors text-left flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("div",{className:"font-bold",children:"Premium"}),l.jsx("div",{className:"text-xs text-white/80",children:"Preferiti illimitati + Download"})]}),l.jsx("span",{className:"text-sm",children:""})]}),l.jsxs("button",{onClick:()=>i("premium-plus"),className:"w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors text-left flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("div",{className:"font-bold",children:"Ultra"}),l.jsx("div",{className:"text-xs text-white/80",children:"Preferiti illimitati + Tutti i vantaggi"})]}),l.jsx("span",{className:"text-sm",children:""})]})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:()=>s("/plans"),className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 text-white font-medium rounded-lg transition-colors",children:"Vedi tutti i piani"}),l.jsx("button",{onClick:e,className:"flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 text-white font-medium rounded-lg transition-colors",children:"Chiudi"})]})]})})}function _i(){var r;return typeof window<"u"&&((r=window.Capacitor)==null?void 0:r.isNativePlatform())}const CT="https://api.asknebula.it",da=new Map,zh="nebula_fanart_v1:",jT=10080*60*1e3;function PT(r){try{const e=localStorage.getItem(zh+r);if(!e)return;const t=JSON.parse(e);if(!t||typeof t.exp!="number")return;if(t.exp<Date.now()){localStorage.removeItem(zh+r);return}return t.v}catch{return}}function Hd(r,e){try{localStorage.setItem(zh+r,JSON.stringify({v:e,exp:Date.now()+jT}))}catch{}}async function Oo(r,e,t){const s=e==="tv"?"tv":"movie",i=`${s}-${r}-${t}`;if(da.has(i))return da.get(i)||null;const n=PT(i);if(n!==void 0)return da.set(i,n),n||null;try{const a=await fetch(`${CT}/fanart2/${s}/${r}?asset=${t}`,{cache:"force-cache"});if(!a.ok)return da.set(i,null),Hd(i,null),null;const u=await a.json(),d=(u==null?void 0:u.url)||null;return da.set(i,d),Hd(i,d),d}catch(a){return console.warn("Fanart proxy fetch error",a),da.set(i,null),Hd(i,null),null}}const go="https://api.asknebula.it",DT=({item:r,rect:e,titleDetails:t,onClose:s,onMouseLeave:i,onClick:n,isFavorite:a,onToggleFavorite:u,isMuted:d,onToggleMute:h,progressPercent:m,episodeInfo:p,durationSeconds:g,positionSeconds:v,category:y,onRemoveProgress:S,top10Mode:b=!1})=>{var Se,Fe;const[T,_]=L.useState(!1),[k,I]=L.useState(!0),C=L.useRef(null),$=1.5,N=1/$,O=2.5;let j=e.width,D=e.height;if(b){const Ee=1.7777777777777777,at=250;j=at,D=at/Ee}const G=j*$,X=D*O,K=e.top+window.scrollY,W=e.left+window.scrollX,te=K-(X-e.height)/2,z=W-(G-e.width)/2;L.useLayoutEffect(()=>{requestAnimationFrame(()=>{I(!1)})},[]),L.useEffect(()=>{var Ee;if(t){const de=(((Ee=t.videos)==null?void 0:Ee.results)||[]).find(gt=>gt.type==="Trailer"&&gt.site==="YouTube");if(de!=null&&de.key){_(!0);const gt=()=>{if(C.current){const Ct=C.current,as=Ct.src;Ct.src="",setTimeout(()=>{Ct.src=as+"&autoplay=1"},50)}};setTimeout(gt,100),setTimeout(gt,500),setTimeout(gt,1e3)}}},[t]);const F=(((Se=t==null?void 0:t.videos)==null?void 0:Se.results)||[]).find(Ee=>Ee.type==="Trailer"&&Ee.site==="YouTube"),H=F==null?void 0:F.key,Y=r.year||(t!=null&&t.release_date?new Date(t.release_date).getFullYear():null)||(t!=null&&t.first_air_date?new Date(t.first_air_date).getFullYear():null),P=r.rating||(t==null?void 0:t.vote_average),B=P?P.toFixed(1):"N/A",oe=((t==null?void 0:t.genres)||[]).slice(0,3).map(Ee=>Ee.name).join("  "),ie=(t==null?void 0:t.backdrop_original)||(t==null?void 0:t.backdrop)||(t==null?void 0:t.backdrop_path)||r.backdrop,ne=ie?mv(ie,t==null?void 0:t.backdrop_original):Ze(r.poster||"","large"),le=(t==null?void 0:t.runtime)||(t==null?void 0:t.episode_run_time)&&t.episode_run_time[0],_e=le?`${le} min`:null;return(Fe=t==null?void 0:t.seasons)==null||Fe.length,Bw.createPortal(l.jsx("div",{className:"absolute z-[9999] pointer-events-auto",style:{top:te,left:z,width:G,height:X,transformOrigin:"center center",transform:k?`scale(${N})`:"scale(1)",opacity:1,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},onMouseLeave:i,onClick:n,children:l.jsxs("div",{className:"w-full h-full rounded-[4px] shadow-2xl bg-[#141414]/95 backdrop-blur-xl overflow-hidden flex flex-col relative border border-white/10 group",children:[l.jsxs("div",{className:"relative h-[50%] bg-black overflow-hidden",children:[T&&H?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"absolute inset-0 overflow-hidden",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:l.jsx("iframe",{ref:C,className:"pointer-events-none",src:`https://www.youtube.com/embed/${H}?autoplay=1&mute=${d?1:0}&loop=1&playlist=${H}&controls=0&modestbranding=1&rel=0&showinfo=0&iv_load_policy=3&disablekb=1&fs=0&cc_load_policy=0&playsinline=1&enablejsapi=1&vq=hd1080&origin=${window.location.origin}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!1,style:{pointerEvents:"none",border:"none",width:"125%",height:"70.3125%",minWidth:"222.22%",minHeight:"125%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},`trailer-${H}-${d}`)}),l.jsx("div",{className:"absolute top-0 left-0 right-0 h-16 z-[2] pointer-events-none bg-gradient-to-b from-black/95 via-black/80 to-transparent"}),l.jsx("div",{className:"absolute top-0 bottom-0 left-0 w-8 z-[2] pointer-events-none bg-gradient-to-r from-black/90 via-black/60 to-transparent"}),l.jsx("div",{className:"absolute top-0 bottom-0 right-0 w-8 z-[2] pointer-events-none bg-gradient-to-l from-black/90 via-black/60 to-transparent"}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-18 z-[2] pointer-events-none bg-gradient-to-t from-black/95 via-black/80 to-transparent"}),l.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 z-[3] pointer-events-none bg-gradient-to-bl from-black/95 via-black/70 to-transparent"}),l.jsx("div",{className:"absolute bottom-0 right-0 w-24 h-24 z-[3] pointer-events-none bg-gradient-to-tl from-black/95 via-black/70 to-transparent"}),l.jsx("div",{className:"absolute top-0 left-1/4 right-1/4 h-20 z-[3] pointer-events-none bg-gradient-to-b from-black/90 via-black/70 to-transparent"}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-12 z-[4] pointer-events-none bg-gradient-to-t from-[#141414]/80 via-[#141414]/40 to-transparent"}),l.jsx("button",{onClick:h,className:"absolute bottom-3 right-3 z-30 w-8 h-8 rounded-full bg-black/50 border border-white/30 flex items-center justify-center hover:bg-black/70 transition",children:d?l.jsxs("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):l.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})})]}):l.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${ne})`}}),l.jsx("div",{className:"absolute inset-x-0 bottom-0 h-24 bg-gradient-to-t from-[#141414] via-[#141414]/60 to-transparent pointer-events-none"})]}),l.jsxs("div",{className:"px-4 py-3 pb-4 flex flex-col h-[50%] bg-[#141414] text-white justify-center",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx("button",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-white hover:bg-neutral-200 flex items-center justify-center transition-colors shadow-md group/btn",onClick:n,children:l.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-black fill-current ml-0.5 group-active/btn:scale-90 transition-transform",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})})}),y==="continue-watching"&&l.jsx("button",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-white/50 hover:border-white bg-[#2a2a2a]/60 hover:bg-[#2a2a2a] flex items-center justify-center transition-all group/btn",onClick:Ee=>{Ee.stopPropagation()},title:"Completato",children:l.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white",fill:"none",stroke:"currentColor",strokeWidth:2.5,viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),y!=="continue-watching"&&l.jsx("button",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-white/50 hover:border-white bg-[#2a2a2a]/60 hover:bg-[#2a2a2a] flex items-center justify-center transition-all group/btn",onClick:u,title:a?"Rimuovi dalla lista":"Aggiungi alla lista",children:a?l.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white",fill:"none",stroke:"currentColor",strokeWidth:2.5,viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):l.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white",fill:"none",stroke:"currentColor",strokeWidth:2.5,viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),y==="continue-watching"&&S&&l.jsx("button",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-white/50 hover:border-white bg-[#2a2a2a]/60 hover:bg-[#2a2a2a] flex items-center justify-center transition-all group/btn",onClick:Ee=>{Ee.stopPropagation(),S()},title:"Rimuovi dai guardati di recente",children:l.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white",fill:"none",stroke:"currentColor",strokeWidth:2.5,viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),l.jsx("button",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-white/50 hover:border-white bg-[#2a2a2a]/60 hover:bg-[#2a2a2a] flex items-center justify-center transition-all ml-auto group/btn",onClick:Ee=>{n(Ee)},children:l.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white group-active/btn:translate-y-1 transition-transform",fill:"none",stroke:"currentColor",strokeWidth:2.5,viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),y==="continue-watching"&&p&&l.jsx("div",{className:"text-sm text-white mb-2 font-medium",children:p}),y==="continue-watching"&&m!==void 0&&m>0&&g&&v&&l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"flex items-center justify-between text-xs text-white/70 mb-1",children:l.jsxs("span",{children:[Math.floor(v/60)," di ",Math.floor(g/60)," min"]})}),l.jsx("div",{className:"h-1 bg-gray-700/50 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-[#018850]",style:{width:`${m}%`}})})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold mb-1",children:[l.jsxs("span",{className:"text-[#059669]",children:["Valutazione ",B]}),Y&&l.jsx("span",{className:"text-gray-400",children:Y}),_e&&l.jsx("span",{className:"text-gray-400",children:_e}),l.jsx("span",{className:"border border-white/40 rounded px-1 text-[10px] text-white/80",children:"HD"})]}),l.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-white",children:l.jsx("span",{className:"text-white",children:oe})})]})]})}),document.body)},yf=L.memo(function({item:e,category:t,rank:s,showBadge:i=!1,badgeText:n,badgePosition:a="top-left",platform:u=null,customUrl:d,progressPercent:h,disableDetails:m=!1,episodeInfo:p,durationSeconds:g,positionSeconds:v,season:y,episode:S,onCardClick:b,overlayTitle:T=!1,fluid:_=!1,showSubBadge:k=!1,top10Mode:I=!1}){const{session:C,plan:$}=Mt(),N=Bt(),O=_i(),[j,D]=L.useState(!1),[G,X]=L.useState(!1),[K,W]=L.useState(null),[te,z]=L.useState(null),[M,F]=L.useState(!1),[H,Y]=L.useState(!1),[P,B]=L.useState(!1),[oe,ie]=L.useState(!1),ne=L.useRef(null),le=L.useRef(),_e=d||`/title/${e.tmdb_id}?type=${e.type}`,[Se,Fe]=L.useState(null);L.useEffect(()=>{const ke=I||O?"poster":"thumb";if(!e.tmdb_id)return;let be=!0;return Fe(null),Oo(e.tmdb_id,e.type,ke).then(pe=>{be&&Fe(pe||null)}),()=>{be=!1}},[e.tmdb_id,e.type,I,O]);const Ee=O?e.poster||e.profile_path||e.backdrop:e.backdrop||e.poster||e.profile_path,at=Se||Ze(Ee,O?"large":"medium")||"",de=I?.98:1;L.useEffect(()=>{const ke=window.matchMedia("(hover: hover)").matches;if(j&&ke){const be=setTimeout(()=>{if(ne.current){const pe=ne.current.getBoundingClientRect();if(W(pe),X(!0),!te&&!m&&fetch(`${go}/title/${e.tmdb_id}?type=${e.type}`).then(Ge=>Ge.json()).then(Ge=>z(Ge.raw)).catch(()=>{}),C){const Ge={Authorization:`Bearer ${C.access_token}`};fetch(`${go}/me/favorites/${e.tmdb_id}?type=${e.type}`,{headers:Ge}).then(Ne=>Ne.json()).then(Ne=>Y(Ne.is_favorite)).catch(()=>{})}}},1e3);le.current=be}else le.current&&clearTimeout(le.current);return()=>{le.current&&clearTimeout(le.current)}},[j,e.tmdb_id,e.type,m,te,C]);const gt=ke=>{if(window.innerWidth<768&&!O){ke.preventDefault(),F(!0);return}b?b(e,ke):N(_e)},Ct=async()=>{if(!C){console.warn("Nessuna sessione per rimuovere progresso");return}try{const ke={Authorization:`Bearer ${C.access_token}`};let be=y,pe=S;if((be==null||be===-1)&&p){const nt=p.match(/S(\d+)/),it=p.match(/E(\d+)/);nt&&nt[1]&&(be=parseInt(nt[1])),it&&it[1]&&(pe=parseInt(it[1]))}let Ge=`${go}/me/progress/${e.tmdb_id}?type=${e.type}`;be!=null&&be!==-1&&(Ge+=`&season=${be}`),pe!=null&&pe!==-1&&(Ge+=`&episode=${pe}`),console.log("Rimozione progresso:",{url:Ge,seasonValue:be,episodeValue:pe,episodeInfo:p});const Ne=await fetch(Ge,{method:"DELETE",headers:ke});if(Ne.ok||Ne.status===404)window.dispatchEvent(new CustomEvent("progress-removed")),X(!1),D(!1);else{const nt=await Ne.text().catch(()=>"");console.error("Errore rimozione progresso:",Ne.status,nt),alert("Errore nella rimozione del progresso. Riprova.")}}catch(ke){console.error("Errore rimozione progresso:",ke),alert("Errore nella rimozione del progresso. Riprova.")}},as=async ke=>{if(ke.stopPropagation(),!C)return;const be=!H;Y(be);try{const pe={"Content-Type":"application/json",Authorization:`Bearer ${C.access_token}`};let Ge;if(H?Ge=await fetch(`${go}/me/favorites/${e.tmdb_id}?type=${e.type}`,{method:"DELETE",headers:pe}):Ge=await fetch(`${go}/me/favorites`,{method:"POST",headers:pe,body:JSON.stringify({tmdb_id:e.tmdb_id,type:e.type,title:e.title,poster:e.poster})}),!Ge.ok){if(Ge.status===403){Y(!be),ie(!0);return}const Ne=await Ge.text();throw new Error(`Failed to update favorite: ${Ne}`)}window.dispatchEvent(new Event("favorites-updated"))}catch(pe){console.error("Error toggling favorite:",pe),Y(!be)}};return l.jsxs(l.Fragment,{children:[l.jsxs("div",{ref:ne,className:"relative group transition-transform duration-300 ease-in-out cursor-pointer z-0",onMouseEnter:()=>D(!0),onMouseLeave:()=>{D(!1)},onClick:gt,children:[l.jsxs("div",{className:`relative rounded-[4px] overflow-hidden ${I?"bg-transparent":"bg-[#202020]"} 
          ${O?"aspect-[2/3] w-[130px] sm:w-[160px]":I?"aspect-[4/3] w-[140px] sm:w-[210px] md:w-[250px] lg:w-[280px]":_?"aspect-video w-full":"aspect-video w-[140px] sm:w-[210px] md:w-[250px] lg:w-[280px]"}
          shadow-lg transition-all duration-300 border border-transparent mx-auto`,style:{touchAction:"pan-y"},children:[I&&s?l.jsxs("div",{className:"flex w-full h-full",children:[l.jsx("div",{className:"w-1/2 h-full bg-transparent flex items-center justify-end relative z-0",children:l.jsx("svg",{viewBox:"0 0 100 140",className:"w-full h-full overflow-visible",preserveAspectRatio:"xMaxYMid meet",children:l.jsx("text",{x:"100",y:"50%",dominantBaseline:"central",textAnchor:"end",fill:"transparent",stroke:"#595959",strokeWidth:"2",className:"font-black tracking-tighter",style:{fontFamily:"Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif",fontSize:"170px",transform:"translateX(8%)"},children:s})})}),l.jsx("div",{className:"w-1/2 h-full relative z-10 flex items-center justify-center rounded-r-[4px] overflow-hidden",children:at?l.jsxs(l.Fragment,{children:[l.jsx(s0,{src:at,alt:e.title,className:"absolute inset-0 w-full h-full object-cover object-center",fallbackTitle:e.title,imgStyle:{transform:`scale(${de})`}}),e.logo&&l.jsx("div",{className:"absolute inset-0 flex items-end justify-center pb-2 px-1 z-20",children:l.jsx("img",{src:e.logo,alt:e.title,className:"max-w-[85%] max-h-[40%] object-contain drop-shadow-md"})})]}):l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-[#202020] text-xs text-gray-500 p-2 text-center",children:e.title})})]}):l.jsx(l.Fragment,{children:at?l.jsxs(l.Fragment,{children:[l.jsx(s0,{src:at,alt:e.title,className:"relative z-10 w-full h-full object-cover",fallbackTitle:e.title,imgStyle:{transform:`scale(${de})`}}),e.logo&&!Se&&!T&&!I&&l.jsx("div",{className:"absolute inset-0 flex items-end justify-center pb-2 px-2 z-20 bg-gradient-to-t from-black/60 via-transparent to-transparent",children:l.jsx("img",{src:e.logo,alt:e.title,className:"max-w-[80%] max-h-[50%] object-contain drop-shadow-lg"})})]}):l.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 text-center text-xs text-gray-400",children:e.title})}),T&&!I&&l.jsxs("div",{className:"absolute inset-x-0 bottom-0 h-1/2 min-h-[60px] bg-gradient-to-t from-black via-black/80 to-transparent flex flex-col justify-end p-2 sm:p-3 md:p-4 z-20",children:[e.logo?l.jsx("img",{src:e.logo,alt:e.title,className:"max-w-[90%] max-h-[40px] md:max-h-[50px] object-contain self-start mb-1 drop-shadow-md"}):l.jsx("h3",{className:"text-white font-bold text-xs sm:text-sm md:text-base leading-tight drop-shadow-md line-clamp-2 mb-0.5 sm:mb-1",children:e.title}),l.jsxs("div",{className:"flex items-center gap-2 mt-0.5 sm:mt-1",children:[k&&l.jsx("span",{className:"bg-white text-black text-[9px] font-extrabold px-1 py-0.5 rounded-[2px] leading-none",children:"SUB"}),n&&a==="bottom-right"&&l.jsx("span",{className:"bg-red-600 text-white text-[9px] font-bold px-1.5 sm:px-2 py-0.5 uppercase tracking-wider rounded-[2px] shadow-sm leading-none",children:n})]})]}),s&&!I&&l.jsx("div",{className:"absolute top-0 right-0 p-2 z-20",children:l.jsx("span",{className:"text-3xl md:text-5xl font-black text-white drop-shadow-md",style:{textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontFamily:"'Impact', sans-serif",WebkitTextStroke:"1px rgba(0,0,0,0.5)"},children:s})}),u&&!s&&l.jsx("div",{className:"absolute top-2 right-2 z-20",children:u==="netflix"&&l.jsx("div",{className:"text-[10px] font-bold text-red-600 bg-white/90 px-1 rounded",children:"N"})}),i&&!T&&n&&l.jsx("div",{className:`absolute z-20 ${a==="top-left"?"top-2 left-2":"bottom-0 right-0 bg-red-600 px-2 py-1"}`,children:a==="top-left"?l.jsx("span",{className:"bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded uppercase",children:n}):l.jsx("span",{className:"text-white text-[10px] font-bold uppercase",children:n})}),k&&l.jsx("div",{className:"absolute bottom-1.5 right-1.5 z-20 bg-white text-black text-[9px] font-bold px-1.5 py-0.5 rounded-[2px] shadow-sm tracking-tighter",children:"SUB"})]}),h&&h>0&&l.jsx("div",{className:"absolute -bottom-1 left-0 right-0 h-1 bg-gray-700/50 z-30 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-[#018850]",style:{width:`${h}%`}})})]}),G&&K&&l.jsx(DT,{item:e,rect:K,titleDetails:te,top10Mode:I,onClose:()=>{X(!1),D(!1)},onMouseLeave:()=>{X(!1),D(!1)},onClick:gt,isFavorite:H,onToggleFavorite:as,isMuted:P,onToggleMute:ke=>{ke.stopPropagation(),B(!P)},progressPercent:h,episodeInfo:p,durationSeconds:g,positionSeconds:v,category:t,onRemoveProgress:t==="continue-watching"?Ct:void 0}),l.jsx(vf,{isOpen:oe,onClose:()=>ie(!1),currentPlan:($==null?void 0:$.plan)||"free"}),M&&l.jsx(NT,{item:e,onClose:()=>F(!1)})]})}),qd=3,ei=L.memo(function({items:e,category:t,showBadge:s=!1,isTop10:i=!1,onItemHover:n,onCardClick:a,loop:u=!0,overlayTitle:d=!1}){const h=L.useRef(null),[m,p]=L.useState(!1),[g,v]=L.useState(!0),[y,S]=L.useState(null),{duplicatedItems:b,itemsPerSection:T,isLooping:_}=L.useMemo(()=>{if(e.length===0)return{duplicatedItems:[],itemsPerSection:0,isLooping:!1};const N=new Map,O=[];for(const X of e){const K=`${X.tmdb_id}-${X.type}`;N.has(K)||(N.set(K,X),O.push(X))}const D=O.slice(0,20);if(!u)return{duplicatedItems:D,itemsPerSection:D.length,isLooping:!1};const G=[];for(let X=0;X<qd;X++)G.push(...D);return{duplicatedItems:G,itemsPerSection:D.length,isLooping:!0}},[e,u]),k=L.useCallback(()=>{if(!h.current||T===0||!_)return;const N=h.current;N.scrollLeft;const j=N.scrollWidth/qd;requestAnimationFrame(()=>{if(!h.current)return;const D=h.current.scrollLeft;D>=j*2-10?h.current.scrollTo({left:D-j,behavior:"auto"}):D<=10&&h.current.scrollTo({left:D+j,behavior:"auto"})}),p(!0),v(!0)},[T,_]);L.useEffect(()=>{if(h.current&&T>0){if(!_){h.current.scrollLeft=0;return}h.current.scrollLeft=0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{if(h.current&&T>0){const O=h.current.scrollWidth/qd,j=O+O*.15;h.current.scrollLeft=j,h.current.scrollTo({left:j,behavior:"auto"}),requestAnimationFrame(()=>{if(h.current&&T>0){const D=h.current.scrollLeft,G=O,X=O*1.5;(D<G||D>X)&&(h.current.scrollLeft=O+O*.15)}})}},200)})})}},[T,e.length,_]),L.useEffect(()=>{const N=h.current;if(!N)return;let O=!1;const j=()=>{O||(requestAnimationFrame(()=>{k(),O=!1}),O=!0)};return N.addEventListener("scroll",j,{passive:!0}),()=>N.removeEventListener("scroll",j)},[k]),L.useEffect(()=>{const N=h.current;if(!N)return;let O=0,j=0;const D=X=>{X.touches.length>0&&(O=X.touches[0].clientY,j=X.touches[0].clientX)},G=X=>{if(X.touches.length===0)return;const K=X.touches[0].clientY,W=X.touches[0].clientX,te=Math.abs(K-O),z=Math.abs(W-j);te>z&&te>5||z>te&&z>5&&X.cancelable&&X.preventDefault()};return N.addEventListener("touchstart",D,{passive:!0}),N.addEventListener("touchmove",G,{passive:!1}),()=>{N.removeEventListener("touchstart",D),N.removeEventListener("touchmove",G)}},[]);const I=L.useCallback(N=>{const O=h.current;if(!O)return;const j=O.clientWidth*.75,D=N==="left"?O.scrollLeft-j:O.scrollLeft+j;O.scrollTo({left:D,behavior:"smooth"})},[]),C=L.useRef(new Map),$=L.useCallback(N=>{if(C.current.has(N))return C.current.get(N);const O=N.toLowerCase();let j=null;return O.includes("stranger things")||O.includes("love is blind")||O.includes("vita da carlo")||O.includes("emily in paris")?j="netflix":O.includes("percy jackson")||O.includes("disney")?j="disney":(O.includes("masterchef")||O.includes("sky"))&&(j="sky"),C.current.set(N,j),j},[]);return e.length===0?null:l.jsxs("div",{className:"relative group/carousel",children:[l.jsx("button",{onClick:()=>I("left"),className:"flex absolute left-0 top-0 bottom-0 z-40 w-8 md:w-12 bg-transparent hover:bg-black/50 items-center justify-center transition-colors duration-300 backdrop-blur-sm group-hover/carousel:opacity-100 opacity-0","aria-label":"Scorri a sinistra",children:l.jsx("svg",{className:"w-6 h-6 md:w-8 md:h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),l.jsx("button",{onClick:()=>I("right"),className:"flex absolute right-0 top-0 bottom-0 z-40 w-8 md:w-12 bg-transparent hover:bg-black/50 items-center justify-center transition-colors duration-300 backdrop-blur-sm group-hover/carousel:opacity-100 opacity-0","aria-label":"Scorri a destra",children:l.jsx("svg",{className:"w-6 h-6 md:w-8 md:h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),l.jsx("div",{ref:h,className:"flex gap-1 md:gap-1.5 overflow-x-scroll overflow-y-hidden no-scrollbar pb-4 pt-4 infinite-carousel carousel-container gpu-accelerated px-[4%]",style:{scrollbarWidth:"none",msOverflowStyle:"none",touchAction:"pan-y",overscrollBehaviorY:"auto",overscrollBehaviorX:"contain",scrollBehavior:"smooth",transform:"translateZ(0)",WebkitTransform:"translateZ(0)",WebkitOverflowScrolling:"touch"},children:b.map((N,O)=>{const j=$(N.title),D=T>0?O%T:O;if(i&&D>=10)return null;const G=`${t}-${N.tmdb_id}-${O}`;return l.jsx("div",{className:"px-0.5 flex-shrink-0 relative",onMouseEnter:X=>n==null?void 0:n(N,X),onMouseLeave:()=>n==null?void 0:n(null),children:l.jsx(yf,{item:N,category:t,showBadge:s,platform:j,onCardClick:a,progressPercent:N.progressPercent,episodeInfo:N.episodeInfo,durationSeconds:N.durationSeconds,positionSeconds:N.positionSeconds,season:N.season,episode:N.episode,top10Mode:i,rank:i?D+1:void 0,overlayTitle:d})},G)})})]})}),OT=L.memo(function({rating:e,showLabel:t=!1,size:s="md",className:i=""}){const n={sm:"text-xs",md:"text-sm",lg:"text-base"},a={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"},u=d=>d>=8?"text-green-500":d>=6?"text-yellow-500":d>=4?"text-orange-500":"text-red-500";return l.jsxs("div",{className:`flex items-center gap-2 ${i}`,children:[l.jsx("span",{className:`${u(e)} font-semibold ${n[s]}`,children:t?`Valutazione ${e.toFixed(1)}`:e.toFixed(1)}),l.jsx("svg",{className:`${a[s]} text-yellow-400 fill-current`,viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})]})}),$T=L.memo(function({item:e,position:t,onClose:s}){const i=L.useRef(null);L.useEffect(()=>{if(!e||!t)return;const u=h=>{i.current&&!i.current.contains(h.target)&&s()},d=h=>{h.key==="Escape"&&s()};return document.addEventListener("mousedown",u),document.addEventListener("keydown",d),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("keydown",d)}},[e,t,s]);const n=e!=null&&e.backdrop?Ze(e.backdrop):e!=null&&e.poster?Ze(e.poster):null,a=L.useMemo(()=>{if(!t)return{left:0,top:0,width:380,height:500};const u=380,d=500,h=16;let m=t.x,p=t.y+20;return m+u>window.innerWidth-h&&(m=window.innerWidth-u-h),m<h&&(m=h),p+d>window.innerHeight-h&&(p=t.y-d-20),p<h&&(p=h),{left:m,top:p,width:u,height:d}},[t]);return!e||!t?null:l.jsxs("div",{ref:i,className:"fixed z-50 bg-black/90 backdrop-blur-lg rounded-lg overflow-hidden shadow-2xl border border-white/20 animate-fade-in-up hidden md:block pointer-events-auto",style:{left:`${a.left}px`,top:`${a.top}px`,width:`${a.width}px`,maxHeight:`${a.height}px`,transform:"translateY(0)",animation:"fade-in-up 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:[n&&l.jsxs("div",{className:"relative w-full h-48 overflow-hidden",children:[l.jsx("img",{src:n,alt:e.title,className:"w-full h-full object-cover",loading:"eager"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"})]}),l.jsxs("div",{className:"p-4",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h3",{className:"text-xl font-bold text-white line-clamp-2 flex-1",children:e.title}),e.year&&l.jsx("span",{className:"text-white/60 text-sm ml-2 flex-shrink-0",children:e.year})]}),e.rating&&l.jsx("div",{className:"mb-3",children:l.jsx(OT,{rating:e.rating,showLabel:!0,size:"md"})}),e.overview&&l.jsx("p",{className:"text-white/80 text-sm mb-4 line-clamp-3",children:e.overview.length>192?`${e.overview.substring(0,189)}...`:e.overview}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(He,{to:`/title/${e.tmdb_id}?type=${e.type}`,className:"flex-1 flex items-center justify-center gap-2 bg-white text-black px-4 py-2 rounded-lg font-semibold text-sm hover:bg-white/90 transition-all duration-700 ease-out hover:scale-105 active:scale-95",onClick:s,children:[l.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})}),"Riproduci"]}),l.jsxs(He,{to:`/title/${e.tmdb_id}?type=${e.type}`,className:"flex items-center justify-center gap-2 bg-white/20 text-white px-4 py-2 rounded-lg font-semibold text-sm hover:bg-white/30 transition-all duration-700 ease-out hover:scale-105 active:scale-95 backdrop-blur-md border border-white/30",onClick:s,children:[l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Info"]})]})]})]})});function _s(r){const e=new Map,t=[];for(const s of r){const i=`${s.tmdb_id}-${s.type}`;e.has(i)||(e.set(i,s),t.push(s))}return t}const yo="https://api.asknebula.it",Zl={trending:"I titoli del momento",recent:"Aggiunti di recente",top10:"Top 10 titoli oggi","popular-movies":"Film popolari","popular-tv":"Serie TV popolari","top-rated-movies":"Film meglio valutati","top-rated-tv":"Serie TV meglio valutate",action:"Azione",comedy:"Commedia",drama:"Drammatici","sci-fi":"Fantascienza",horror:"Horror",thriller:"Thriller",romance:"Romantici",animation:"Animazione","tv-action":"Serie TV - Azione","tv-comedy":"Serie TV - Commedia","tv-drama":"Serie TV - Drammatiche"},MT=L.memo(function({rows:e}){var y,S,b,T,_,k;const[t,s]=L.useState([]),[i,n]=L.useState(0),[a,u]=L.useState(!0),[d,h]=L.useState(!0),[m,p]=L.useState(!1);L.useEffect(()=>{async function I(){var O;if(u(!0),!e.trending||e.trending.length===0){const j=[];if(e["popular-movies"]&&e["popular-movies"].length>0&&j.push(...e["popular-movies"].slice(0,5)),e["popular-tv"]&&e["popular-tv"].length>0&&j.push(...e["popular-tv"].slice(0,3)),j.length>0){s(j.map(D=>({tmdb_id:D.tmdb_id,type:D.type,backdrop:void 0,poster:D.poster,title:D.title}))),u(!1);return}}const C=((O=e.trending)==null?void 0:O.slice(0,8))||[];C.length===0&&u(!1);const N=(await Promise.all(C.map(async j=>{var D,G,X,K,W,te,z,M,F;try{const H=await fetch(`${yo}/title/${j.tmdb_id}?type=${j.type}`);if(H.ok){const Y=await H.json(),P=((D=Y.raw)==null?void 0:D.backdrop)||((G=Y.raw)==null?void 0:G.backdrop_path),B=(X=Y.raw)==null?void 0:X.backdrop_original,oe=await Oo(j.tmdb_id,j.type,"logo"),ie=await Oo(j.tmdb_id,j.type,"background"),le=(((W=(K=Y.raw)==null?void 0:K.videos)==null?void 0:W.results)||[]).find(Se=>Se.type==="Trailer"&&Se.site==="YouTube"),_e=le==null?void 0:le.key;return{tmdb_id:j.tmdb_id,type:j.type,backdrop:P,backdrop_original:B,fanartBackground:ie||void 0,poster:j.poster||((te=Y.raw)==null?void 0:te.poster_path),logo:oe,title:j.title,overview:((z=Y.raw)==null?void 0:z.overview)||j.overview,seasons:(F=(M=Y.raw)==null?void 0:M.seasons)==null?void 0:F.length,trailerKey:_e}}}catch{}return{tmdb_id:j.tmdb_id,type:j.type,backdrop:void 0,poster:j.poster,title:j.title,trailerKey:void 0}}))).filter(j=>j.backdrop||j.poster);s(N),u(!1)}I()},[e.trending,e["popular-movies"],e["popular-tv"]]),L.useEffect(()=>{if(t.length<=1)return;const I=setInterval(()=>{n(C=>(C+1)%t.length)},300*1e3);return()=>clearInterval(I)},[t.length]),L.useEffect(()=>{const I=t[i];if(p(!1),!(I!=null&&I.trailerKey))return;const C=setTimeout(()=>p(!0),15e3);return()=>clearTimeout(C)},[i,t]);const g=t[i];g!=null&&g.fanartBackground||(g!=null&&g.backdrop?Ze(g.backdrop):Ze(g==null?void 0:g.poster));const v=((S=(y=e.trending)==null?void 0:y[0])==null?void 0:S.poster)||((T=(b=e["popular-movies"])==null?void 0:b[0])==null?void 0:T.poster)||((k=(_=e["popular-tv"])==null?void 0:_[0])==null?void 0:k.poster);return l.jsxs("section",{className:"relative min-h-[70vh] sm:min-h-[82vh] md:min-h-[95vh] lg:min-h-[98vh] flex items-start overflow-hidden mb-0 w-screen left-1/2 right-1/2 -ml-[50vw] -mr-[50vw] -mt-[48px] sm:-mt-[56px] md:-mt-[64px]",children:[l.jsxs("div",{className:"absolute inset-0 overflow-hidden w-full",children:[t.length>0?l.jsx(l.Fragment,{children:t.map((I,C)=>{const $=C===i,N=(i-1+t.length)%t.length,O=(i+1)%t.length;if(!$&&C!==N&&C!==O)return null;const j=I.fanartBackground||mv(I.backdrop,I.backdrop_original)||Ze(I.poster);return l.jsxs("div",{className:"absolute inset-0",children:[I.trailerKey&&$&&m?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:`absolute inset-0 overflow-hidden transition-opacity duration-[4000ms] ease-out ${$?"opacity-100":"opacity-0"}`,style:{display:"flex",alignItems:"center",justifyContent:"center"},children:l.jsx("iframe",{src:`https://www.youtube.com/embed/${I.trailerKey}?autoplay=1&mute=${d?1:0}&loop=1&playlist=${I.trailerKey}&controls=0&modestbranding=1&rel=0&showinfo=0&iv_load_policy=3&disablekb=1&fs=0&cc_load_policy=0&playsinline=1&enablejsapi=1&vq=hd1080&origin=${window.location.origin}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!1,loading:"lazy",style:{pointerEvents:"none",border:"none",width:"100vw",height:"56.25vw",minWidth:"177.77vh",minHeight:"100vh",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},`trailer-${I.tmdb_id}-${d}`)}),l.jsx("div",{className:"absolute top-0 left-0 right-0 h-12 z-[2] pointer-events-none bg-gradient-to-b from-black/90 via-black/60 to-transparent"}),l.jsx("div",{className:"absolute top-0 bottom-0 left-0 w-6 z-[2] pointer-events-none bg-gradient-to-r from-black/80 via-black/40 to-transparent"}),l.jsx("div",{className:"absolute top-0 bottom-0 right-0 w-6 z-[2] pointer-events-none bg-gradient-to-l from-black/80 via-black/40 to-transparent"}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-16 z-[2] pointer-events-none bg-gradient-to-t from-black/90 via-black/60 to-transparent"}),l.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 z-[3] pointer-events-none bg-gradient-to-bl from-black/95 via-black/70 to-transparent"}),l.jsx("div",{className:"absolute bottom-0 right-0 w-20 h-20 z-[3] pointer-events-none bg-gradient-to-tl from-black/95 via-black/70 to-transparent"}),l.jsx("div",{className:"absolute inset-y-0 left-0 w-[50%] z-[4] pointer-events-none bg-gradient-to-r from-black/70 via-black/30 to-transparent"})]}):j?l.jsx("div",{className:`absolute inset-0 transition-opacity duration-[4000ms] ease-out ${$?"opacity-100":"opacity-0"}`,style:{backgroundImage:`url(${j})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",transform:$?"scale(1.05)":"scale(1)",transition:"opacity 4s cubic-bezier(0.16, 1, 0.3, 1), transform 4s cubic-bezier(0.16, 1, 0.3, 1)"},children:l.jsx("div",{className:"absolute inset-y-0 left-0 w-[60%] z-[1] pointer-events-none bg-gradient-to-r from-black/80 via-black/40 to-transparent"})}):l.jsx("div",{className:`absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-black transition-opacity duration-[4000ms] ${$?"opacity-100":"opacity-0"}`}),$&&l.jsx("div",{className:"absolute inset-0 z-[1]",style:{background:"linear-gradient(to bottom, transparent 0%, transparent 20%, rgba(0,0,0,0.1) 40%, rgba(0,0,0,0.3) 60%, rgba(0,0,0,0.6) 80%, rgba(0,0,0,0.95) 95%, rgba(15,15,15,1) 100%)"}})]},`${I.tmdb_id}-${C}`)})}):v?l.jsx("div",{className:"absolute inset-0 z-0 opacity-30",style:{backgroundImage:`url(${Ze(v)})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",filter:"blur(60px) brightness(0.4)"}}):null,l.jsx("div",{className:"absolute inset-0 z-[2]",style:{background:"linear-gradient(to bottom, transparent 0%, transparent 60%, rgba(0,0,0,0.2) 75%, rgba(0,0,0,0.6) 88%, rgba(0,0,0,0.9) 95%, rgba(15,15,15,1) 100%)"}}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 sm:h-40 md:h-48 z-[4] pointer-events-none",style:{background:"linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(15,15,15,0.1) 35%, rgba(15,15,15,0.5) 85%, rgba(15,15,15,1) 100%)",backdropFilter:"blur(1px)",WebkitBackdropFilter:"blur(1px)"}}),(g==null?void 0:g.trailerKey)&&m&&l.jsx("button",{onClick:()=>h(!d),className:"absolute bottom-40 right-4 md:right-12 z-30 w-12 h-12 md:w-14 md:h-14 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-md border-2 border-white/30 flex items-center justify-center transition-all duration-700 ease-out hover:scale-110 active:scale-95","aria-label":d?"Attiva audio":"Disattiva audio",children:d?l.jsxs("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}):l.jsx("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})})]}),t.length===0&&!v&&l.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-br from-nebula-900/50 via-purple-900/50 to-fuchsia-900/50 rounded-b-3xl"}),g&&l.jsx("div",{className:"relative z-10 w-full px-4 sm:pl-10 md:pl-12 lg:pl-16 xl:pl-20 mt-[12vh] sm:mt-[14vh] md:mt-[16vh]",children:l.jsxs("div",{className:"max-w-2xl flex flex-col items-center text-center sm:items-start sm:text-left",children:[l.jsx("div",{className:`transition-all duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] ${m?"translate-y-2":"translate-y-0"}`,children:g.logo?l.jsx("img",{src:g.logo,alt:g.title,className:"w-full max-w-[280px] md:max-w-[420px] lg:max-w-[500px] object-contain drop-shadow-2xl mx-auto sm:mx-0",style:{filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.5))"}}):l.jsx("h1",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black leading-tight text-white drop-shadow-2xl font-serif tracking-tight",style:{textShadow:"2px 2px 8px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5)"},children:g.title})}),l.jsx("p",{className:`text-base md:text-lg text-white/90 drop-shadow-lg line-clamp-3 md:line-clamp-4 max-w-xl leading-relaxed font-medium transition-all duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] ${m?"opacity-0 -translate-y-2 pointer-events-none h-0 overflow-hidden":"opacity-100 translate-y-0 mb-6"}`,style:{textShadow:"1px 1px 3px rgba(0,0,0,0.8)",fontSize:"1rem"},children:g.overview&&g.overview.length>192?`${g.overview.substring(0,189)}...`:g.overview}),l.jsxs("div",{className:"flex flex-row gap-3 mt-6 sm:mt-8 justify-center sm:justify-start w-full",children:[l.jsxs(He,{to:`/title/${g.tmdb_id}?type=${g.type}`,className:"flex items-center justify-center gap-2 bg-[#018850] text-white px-5 py-2.5 sm:px-8 sm:py-3.5 rounded-[3px] font-bold text-sm sm:text-base md:text-lg hover:bg-[#016d40] active:bg-[#015c36] transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg shadow-[#018850]/30",children:[l.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})}),l.jsx("span",{children:"GUARDA ORA"})]}),l.jsxs(He,{to:`/title/${g.tmdb_id}?type=${g.type}`,className:"flex items-center justify-center gap-2 bg-[#292929] text-white px-5 py-2.5 sm:px-8 sm:py-3.5 rounded-[3px] font-bold text-sm sm:text-base md:text-lg hover:bg-[#333] transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg backdrop-blur-sm border border-white/5",children:[l.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),l.jsx("span",{children:"ALTRE INFO"})]})]})]})})]})});function Yd({isMobile:r=!1}){const{user:e,session:t}=Mt(),s=Bt(),[i,n]=L.useState({}),[a,u]=L.useState([]),[d,h]=L.useState([]),[m,p]=L.useState(0),[g,v]=L.useState(!0),[y,S]=L.useState(1),[b,T]=L.useState(!1),[_,k]=L.useState(!0),I=L.useRef(null),[C,$]=L.useState(null),[N,O]=L.useState(null),j=L.useRef(),D=L.useMemo(()=>Object.keys(i),[i]);L.useCallback((z,M)=>{j.current&&(clearTimeout(j.current),j.current=void 0),z&&M?window.innerWidth>=768&&(j.current=setTimeout(()=>{O({x:M.clientX,y:M.clientY}),$(z),j.current=void 0},800)):($(null),O(null))},[]),L.useCallback((z,M)=>{j.current&&(clearTimeout(j.current),j.current=void 0),O({x:M.clientX,y:M.clientY}),$(z)},[]),L.useEffect(()=>()=>{j.current&&(clearTimeout(j.current),j.current=void 0)},[]);const G=L.useCallback(async()=>{if(!t){u([]);return}try{const z={Authorization:`Bearer ${t.access_token}`},M=await fetch(`${yo}/me/progress?limit=50`,{headers:z});if(M.ok){const H=(await M.json()).filter(ne=>{if(!ne||ne.position_seconds!==void 0&&ne.position_seconds===0)return!1;if(!ne.duration_seconds||ne.duration_seconds<=0)return!0;const le=ne.position_seconds/ne.duration_seconds,_e=ne.duration_seconds-ne.position_seconds;return!(le>=.98&&_e<=10)});H.sort((ne,le)=>{const _e=ne.updated_at?new Date(ne.updated_at).getTime():0;return(le.updated_at?new Date(le.updated_at).getTime():0)-_e});const Y=new Map,P=[];H.forEach(ne=>{if(ne.season!==null&&ne.season!==void 0&&ne.season!==-1&&ne.episode!==null&&ne.episode!==void 0&&ne.episode!==-1){const _e=Y.get(ne.content_id);if(!_e)Y.set(ne.content_id,ne);else{const Se=_e.updated_at?new Date(_e.updated_at).getTime():0;(ne.updated_at?new Date(ne.updated_at).getTime():0)>Se&&Y.set(ne.content_id,ne)}}else P.push(ne)});const B=[...Array.from(Y.values()),...P];B.sort((ne,le)=>{const _e=ne.updated_at?new Date(ne.updated_at).getTime():0;return(le.updated_at?new Date(le.updated_at).getTime():0)-_e});const oe=new Set,ie=B.filter(ne=>oe.has(ne.content_id)?!1:(oe.add(ne.content_id),!0));u(ie)}else{const F=await M.text();u([])}}catch{u([])}},[t]);L.useEffect(()=>{G()},[G]);const X=L.useCallback(async()=>{if(!t){h([]);return}try{const z={Authorization:`Bearer ${t.access_token}`},M=await fetch(`${yo}/me/favorites?limit=20&_t=${Date.now()}`,{headers:z});if(M.ok){const F=await M.json(),H=_s(F);h(H),p(Y=>Y+1)}else h([])}catch{h([])}},[t]);L.useEffect(()=>{const z=()=>{G()};return window.addEventListener("progress-updated",z),()=>{window.removeEventListener("progress-updated",z)}},[G]),L.useEffect(()=>{const z=()=>{G()};return window.addEventListener("progress-removed",z),()=>window.removeEventListener("progress-removed",z)},[G]),L.useEffect(()=>{X();let z;const M=()=>{z&&clearTimeout(z),z=setTimeout(()=>{X()},500)};return window.addEventListener("favorites-updated",M),()=>{z&&clearTimeout(z),window.removeEventListener("favorites-updated",M)}},[X]),L.useEffect(()=>{async function z(){try{const M=Math.floor(Date.now()/864e5),F=await fetch(`${yo}/home-rows?page=1&variation=${M}`);if(F.ok){const H=await F.json(),Y={};for(const[P,B]of Object.entries(H)){const oe=B.map(ie=>{var ne,le;return{title:ie.title,tmdb_id:ie.tmdb_id,type:ie.type,year:ie.year,poster:ie.poster,backdrop:((ne=ie.raw)==null?void 0:ne.backdrop_path)||ie.backdrop||null,rating:(le=ie.raw)==null?void 0:le.vote_average,overview:ie.overview}});Y[P]=_s(oe)}n(Y),k(Object.keys(Y).length>0)}}catch{}finally{v(!1)}}z()},[]);const K=L.useCallback(async()=>{if(!(b||!_)){T(!0);try{const z=y+1,M=Math.floor(Date.now()/(1440*60*1e3)),F=await fetch(`${yo}/home-rows?page=${z}&variation=${M}`);if(F.ok){const H=await F.json();if(Object.keys(H).length===0){k(!1);return}const Y={};for(const[P,B]of Object.entries(H)){const oe=B.map(ie=>{var ne,le;return{title:ie.title,tmdb_id:ie.tmdb_id,type:ie.type,year:ie.year,poster:ie.poster,backdrop:((ne=ie.raw)==null?void 0:ne.backdrop_path)||ie.backdrop,rating:(le=ie.raw)==null?void 0:le.vote_average,overview:ie.overview}});Y[P]=_s(oe)}n(P=>{const B={...P};for(const[oe,ie]of Object.entries(Y))B[oe]?B[oe]=_s([...B[oe],...ie]):B[oe]=ie;return B}),S(z)}else k(!1)}catch{k(!1)}finally{T(!1)}}},[y,b,_]),W=L.useCallback(z=>{z[0].isIntersecting&&!b&&_&&K()},[K,b,_]);L.useEffect(()=>{const z=new IntersectionObserver(W,{threshold:.1}),M=I.current;return M&&z.observe(M),()=>{M&&z.unobserve(M)}},[W]);const te=l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative",children:l.jsx(MT,{rows:i})}),g?l.jsxs("div",{className:"max-w-full mx-auto px-4 md:px-6 py-8 md:py-12 text-center",children:[l.jsx("div",{className:"inline-block animate-spin rounded-full h-10 w-10 md:h-12 md:w-12 border-t-2 border-b-2 border-green-500"}),l.jsx("p",{className:"mt-4 text-sm md:text-base text-white/60",children:"Caricamento contenuti..."})]}):l.jsxs("div",{className:"max-w-full mx-auto px-2 sm:px-4 md:px-6 lg:px-8 py-4 md:py-6 space-y-3 sm:space-y-4 md:space-y-5 lg:space-y-6 relative z-20",children:[e&&a.length>0&&l.jsxs("section",{className:"space-y-3 sm:space-y-3 md:space-y-4 relative z-20 -mt-32 sm:-mt-36 md:-mt-40 lg:-mt-44",children:[l.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-white mb-2 sm:mb-2 md:mb-3 px-2 sm:px-4 md:px-0 transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 cursor-default",style:{textShadow:"1px 1px 3px rgba(0,0,0,0.5)",transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:"Guardati di recente"}),l.jsx(ei,{category:"continue-watching",loop:!1,items:_s(a.map(z=>{let M=0;if(z.duration_seconds&&z.duration_seconds>0)M=Math.min(100,z.position_seconds/z.duration_seconds*100);else if(z.position_seconds>0){const P=z.season&&z.episode?2700:5400;M=Math.min(95,z.position_seconds/P*100)}const F=z.season!==null&&z.season!==void 0&&z.season!==-1,H=parseInt(z.content_id),Y=F?`S${z.season} E${z.episode}`:void 0;return{title:z.title||"Contenuto",tmdb_id:isNaN(H)?0:H,type:F?"tv":"movie",poster:z.poster||void 0,overview:"",episodeInfo:Y,progressPercent:M,durationSeconds:z.duration_seconds,positionSeconds:z.position_seconds,season:z.season!==null&&z.season!==void 0&&z.season!==-1?z.season:void 0,episode:z.episode!==null&&z.episode!==void 0&&z.episode!==-1?z.episode:void 0}}).filter(z=>z.tmdb_id>0)),onCardClick:(z,M)=>{const F=a.find(H=>{const Y=parseInt(H.content_id);return!isNaN(Y)&&Y===z.tmdb_id});if(F){const Y=F.season!==null&&F.season!==void 0&&F.season!==-1?`/watch/${z.tmdb_id}?type=tv&season=${F.season}&episode=${F.episode}`:`/watch/${z.tmdb_id}?type=movie`;s(Y)}else s(`/title/${z.tmdb_id}?type=${z.type}`)}})]}),i.trending&&i.trending.length>0&&l.jsxs("div",{className:"space-y-3 sm:space-y-3 md:space-y-4 section-enter relative z-30 -mt-24 sm:-mt-28 md:-mt-32 lg:-mt-36",children:[l.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-white mb-2 sm:mb-2 md:mb-3 px-2 sm:px-4 md:px-0 transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 cursor-default",style:{transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)",textShadow:"1px 1px 3px rgba(0,0,0,0.5)"},children:Zl.trending}),l.jsx("div",{className:"relative",children:l.jsx(ei,{items:_s(i.trending),category:"trending",showBadge:!1,isTop10:!1})})]}),i.recent&&i.recent.length>0&&l.jsxs("div",{className:"space-y-3 sm:space-y-3 md:space-y-4 section-enter relative z-30",children:[l.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-white mb-2 sm:mb-2 md:mb-3 px-2 sm:px-4 md:px-0 transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 cursor-default",style:{transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)",textShadow:"1px 1px 3px rgba(0,0,0,0.5)"},children:Zl.recent}),l.jsx("div",{className:"relative",children:l.jsx(ei,{items:_s(i.recent),category:"recent",showBadge:!0,isTop10:!1})})]}),i.top10&&i.top10.length>0&&l.jsxs("div",{className:"space-y-3 sm:space-y-3 md:space-y-4 section-enter relative z-30",children:[l.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-white mb-2 sm:mb-2 md:mb-3 px-2 sm:px-4 md:px-0 transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 cursor-default",style:{transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)",textShadow:"1px 1px 3px rgba(0,0,0,0.5)"},children:Zl.top10}),l.jsx("div",{className:"relative",children:l.jsx(ei,{items:_s(i.top10),category:"top10",showBadge:!1,isTop10:!0})})]}),e&&d.length>0&&l.jsxs("section",{className:"space-y-3 sm:space-y-3 md:space-y-4 relative z-20",children:[l.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-white mb-2 sm:mb-2 md:mb-3 px-2 sm:px-4 md:px-0 transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 cursor-default",style:{textShadow:"1px 1px 3px rgba(0,0,0,0.5)",transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:"I tuoi preferiti"}),l.jsx(ei,{category:"favorites",loop:!1,items:d.map(z=>({title:z.title,tmdb_id:z.tmdb_id,type:z.type,poster:z.poster||void 0,overview:""}))},`favorites-${m}`)]}),Object.entries(i).map(([z,M])=>{if(M.length===0||z==="top10"||z==="recent"||z==="trending")return null;const F=z==="recent";return l.jsxs("div",{className:"space-y-3 sm:space-y-3 md:space-y-4 section-enter",style:{animationDelay:`${D.indexOf(z)*.1}s`},children:[l.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-white mb-2 sm:mb-2 md:mb-3 px-2 sm:px-4 md:px-0 transition-all duration-[1000ms] ease-[cubic-bezier(0.16,1,0.3,1)] hover:scale-105 cursor-default",style:{transition:"transform 1s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1)",textShadow:"1px 1px 3px rgba(0,0,0,0.5)"},children:Zl[z]||z}),l.jsx("div",{className:"",children:l.jsx(ei,{items:_s(M),category:z,showBadge:F,isTop10:!1})})]},z)})]}),l.jsx($T,{item:C,position:N,onClose:()=>{$(null),O(null),j.current&&clearTimeout(j.current)}}),b&&l.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 text-center",children:[l.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),l.jsx("p",{className:"mt-2 text-sm text-white/60",children:"Caricamento altri contenuti..."})]}),_&&l.jsx("div",{ref:I,className:"h-20"})]});return l.jsx(ns,{hideTopSpacer:!0,children:te})}function FT(){const[r]=kr(),e=r.get("mode")==="register"?"register":"login",[t,s]=L.useState(""),[i,n]=L.useState(""),[a,u]=L.useState(!1),[d,h]=L.useState(null),[m,p]=L.useState(null),g=Mt(S=>S.setAuth),v=Bt();async function y(S){S.preventDefault(),h(null),u(!0),p(null);try{if(e==="register"){const{data:b,error:T}=await Ei.auth.signUp({email:t,password:i});if(T)throw T;p("Ti abbiamo inviato un codice di verifica via email. Inseriscilo nella prossima schermata per attivare il tuo account."),v(`/verify-email?email=${encodeURIComponent(t)}`);return}else{const{data:b,error:T}=await Ei.auth.signInWithPassword({email:t,password:i});if(T)throw T;b.session&&g(b.session)}v("/"),v("/")}catch(b){let T=b.message??"Errore durante l'autenticazione";(T.includes("User already registered")||T.includes("already registered"))&&(T="Sei gi registrato. Accedi invece."),h(T)}finally{u(!1)}}return l.jsx(ns,{children:l.jsx("div",{className:"min-h-[85vh] flex items-center justify-center bg-[#070707]",children:l.jsxs("div",{className:"w-full max-w-[400px] bg-[#1a1a1a] p-10 shadow-2xl rounded-[4px]",children:[l.jsx("h1",{className:"text-3xl font-bold mb-8 text-white text-center",children:e==="login"?"Accedi":"Registrati"}),l.jsxs("form",{onSubmit:y,className:"space-y-5",children:[l.jsx("div",{className:"space-y-2",children:l.jsx("input",{type:"email",value:t,onChange:S=>s(S.target.value),required:!0,placeholder:"Email",className:"w-full rounded-[3px] bg-[#333333] border-none px-4 py-3.5 text-base text-white placeholder-gray-400 outline-none focus:bg-[#454545] transition-colors"})}),l.jsx("div",{className:"space-y-2",children:l.jsx("input",{type:"password",value:i,onChange:S=>n(S.target.value),required:!0,placeholder:"Password",className:"w-full rounded-[3px] bg-[#333333] border-none px-4 py-3.5 text-base text-white placeholder-gray-400 outline-none focus:bg-[#454545] transition-colors"})}),d&&l.jsx("p",{className:"text-sm text-[#e87c03]",children:d}),m&&!d&&l.jsx("p",{className:"text-sm text-green-500",children:m}),l.jsx("button",{type:"submit",disabled:a,className:"w-full rounded-[3px] bg-[#018850] hover:bg-[#016d40] py-3.5 text-base font-bold text-white shadow-none transition-colors disabled:opacity-60 mt-6",children:a?"Attendere...":e==="login"?"Accedi":"Registrati"}),l.jsx("div",{className:"flex justify-between items-center mt-2",children:l.jsxs("div",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",id:"remember",className:"rounded bg-[#333333] border-none text-[#018850] focus:ring-0 mr-2"}),l.jsx("label",{htmlFor:"remember",className:"text-sm text-[#b3b3b3]",children:"Ricordami"})]})})]}),l.jsx("div",{className:"mt-10 text-base text-[#737373]",children:e==="login"?l.jsxs("span",{children:["Prima volta su Nebula?"," ",l.jsx(He,{to:"/login?mode=register",className:"text-white hover:underline",children:"Registrati ora"}),"."]}):l.jsxs("span",{children:["Hai gi un account?"," ",l.jsx(He,{to:"/login",className:"text-white hover:underline",children:"Accedi"}),"."]})})]})})})}const r0={28:"Azione",12:"Avventura",16:"Animazione",35:"Commedia",80:"Crime",99:"Documentario",18:"Drammatico",10751:"Famiglia",14:"Fantasy",36:"Storia",27:"Horror",10402:"Musica",9648:"Mistero",10749:"Romance",878:"Fantascienza",10770:"TV Movie",53:"Thriller",10752:"Guerra",37:"Western",10759:"Action & Adventure",10762:"Kids",10763:"News",10764:"Reality",10765:"Sci-Fi & Fantasy",10766:"Soap",10767:"Talk",10768:"War & Politics"},i0="https://api.asknebula.it",UT=[{id:"type",label:"Tipo",options:["Tutti","Film","Serie TV"]},{id:"genre",label:"Genere",options:["Tutti","Azione","Avventura","Commedia","Drammatico","Fantascienza","Horror","Thriller","Documentario","Animazione","Fantasy","Crime"]},{id:"year",label:"Anno",options:["Tutti","2024","2023","2022","2021","2020","2010-2019","Prima del 2010"]},{id:"rating",label:"Valutazione",options:["Tutti","9+","8+","7+","6+"]},{id:"views",label:"Views",options:["Popolari","Meno visti"]},{id:"age",label:"Et",options:["Tutti","18+","16+","12+","0+"]}],Qd=40;function BT(){const{user:r}=Mt(),[e,t]=kr(),s=e.get("search")||"",[i,n]=L.useState([]),[a,u]=L.useState(!0),[d,h]=L.useState(0),[m,p]=L.useState(Qd),g=L.useRef(null),[v,y]=L.useState({});L.useEffect(()=>{async function T(){if(s)return;try{const k=localStorage.getItem("nebula_browse_cache");if(k){const I=JSON.parse(k);I.timestamp>Date.now()-36e5&&Array.isArray(I.items)&&I.items.length>0&&(n(I.items),u(!1))}}catch{}i.length===0&&u(!0),h(0);const _=new Set;i.length>0&&i.forEach(k=>_.add(`${k.tmdb_id}-${k.type}`));try{let $=0,N=[];const O=async(G,X)=>{try{const K=await fetch(`${i0}/home-rows?page=${G}&variation=${X}`);if(!K.ok)return;const W=await K.json(),te=[];if(Object.values(W).forEach(z=>{Array.isArray(z)&&z.forEach(M=>{var H,Y,P,B,oe,ie;if(!M.poster)return;const F=`${M.tmdb_id}-${M.type}`;_.has(F)||(_.add(F),te.push({title:M.title,tmdb_id:M.tmdb_id,type:M.type,year:M.year,poster:M.poster,backdrop:M.backdrop||((H=M.raw)==null?void 0:H.backdrop_path),rating:(Y=M.raw)==null?void 0:Y.vote_average,overview:M.overview,genre_ids:(P=M.raw)==null?void 0:P.genre_ids,popularity:(B=M.raw)==null?void 0:B.popularity,vote_count:(oe=M.raw)==null?void 0:oe.vote_count,adult:(ie=M.raw)==null?void 0:ie.adult}))})}),te.length>0){const z=_s(te);z.length>0&&(N=[...N,...z],n(M=>_s([...M,...z])))}}catch{}finally{$++,h(Math.round($/40*100)),$>=1&&u(!1),$>=38&&N.length>0&&n(K=>{try{localStorage.setItem("nebula_browse_cache",JSON.stringify({timestamp:Date.now(),items:K}))}catch{}return K})}};await O(1,0);const j=[];for(let G=1;G<8;G++)j.push(O(1,G));await Promise.all(j);const D=[];for(let G=2;G<=5;G++)for(let X=0;X<8;X++)D.push(new Promise(K=>setTimeout(K,(G-2)*200)).then(()=>O(G,X)));Promise.all(D)}catch{u(!1)}}T()},[s]),L.useEffect(()=>{s&&(u(!0),fetch(`${i0}/search?q=${encodeURIComponent(s)}`).then(T=>T.json()).then(T=>{const _=T.map(k=>{var I,C,$,N,O;return{title:k.title,tmdb_id:k.tmdb_id,type:k.type,year:k.year,poster:k.poster,backdrop:k.backdrop||((I=k.raw)==null?void 0:I.backdrop_path),rating:(C=k.raw)==null?void 0:C.vote_average,overview:k.overview,genre_ids:($=k.raw)==null?void 0:$.genre_ids,popularity:(N=k.raw)==null?void 0:N.popularity,adult:(O=k.raw)==null?void 0:O.adult}});n(_),u(!1)}).catch(()=>u(!1)))},[s]);const S=L.useMemo(()=>{let T=i;return Object.keys(v).length>0&&(T=T.filter(k=>{var I;if(v.type&&v.type!=="Tutti"){const C={Film:"movie","Serie TV":"tv"};if(k.type!==C[v.type])return!1}if(v.genre&&v.genre!=="Tutti"){const C=v.genre,$=Object.keys(r0).find(N=>r0[Number(N)]===C);if($&&!((I=k.genre_ids)!=null&&I.includes(Number($))))return!1}if(v.year&&v.year!=="Tutti"&&k.year){const C=v.year;if(C==="Prima del 2010"&&k.year>=2010)return!1;if(C.includes("-")){const[$,N]=C.split("-").map(Number);if(k.year<$||k.year>N)return!1}else if(!isNaN(Number(C))&&k.year!==Number(C))return!1}if(v.rating&&v.rating!=="Tutti"){const C=parseInt(v.rating);if((k.rating||0)<C)return!1}return!(v.age&&v.age!=="Tutti"&&(v.age==="18+"&&!k.adult||v.age!=="18+"&&k.adult))})),v.views==="Meno visti"?T.sort((k,I)=>(k.popularity||0)-(I.popularity||0)):T.sort((k,I)=>(I.popularity||0)-(k.popularity||0)),T},[i,v]),b=L.useMemo(()=>{const T=S.slice(0,m);return T.length>0,T},[S,m]);return L.useEffect(()=>{const T=new IntersectionObserver(_=>{_[0].isIntersecting&&m<S.length&&!a&&p(k=>Math.min(k+Qd,S.length))},{rootMargin:"200px"});return g.current&&T.observe(g.current),()=>T.disconnect()},[m,S.length,a]),L.useEffect(()=>{p(Qd)},[v,s]),l.jsx(ns,{children:l.jsx("div",{className:"min-h-screen pt-24 px-4 sm:px-6 lg:px-8 pb-12 bg-[#0f0f0f]",children:l.jsxs("div",{className:"max-w-[1920px] mx-auto",children:[l.jsx("div",{className:"flex flex-col gap-4 mb-8",children:l.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[l.jsxs("div",{className:"relative w-full sm:w-auto min-w-[240px]",children:[l.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:l.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),l.jsx("input",{type:"text",placeholder:"Cerca...",value:s,onChange:T=>t({search:T.target.value}),className:"w-full bg-[#141414] text-white text-sm rounded px-3 pl-10 py-2.5 border border-[#333] focus:outline-none focus:border-white/20 transition-all placeholder-gray-500 hover:bg-[#1a1a1a]"})]}),UT.map(T=>l.jsxs("div",{className:"relative",children:[l.jsxs("select",{className:"appearance-none bg-[#141414] text-gray-300 text-sm rounded px-4 py-2.5 pr-10 border border-[#333] hover:bg-[#1a1a1a] focus:outline-none cursor-pointer transition-colors min-w-[100px]",onChange:_=>y(k=>({...k,[T.id]:_.target.value})),value:v[T.id]||"",children:[l.jsx("option",{value:"",children:T.label}),T.options.map(_=>l.jsx("option",{value:_,children:_},_))]}),l.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500",children:l.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]},T.id))]})}),l.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:[b.map((T,_)=>l.jsx("div",{className:"flex justify-center w-full",children:l.jsx(yf,{item:T,platform:null,overlayTitle:!1,badgePosition:"bottom-right",fluid:!0})},`${T.tmdb_id}-${T.type}-${_}`)),a&&l.jsxs(l.Fragment,{children:[[...Array(40)].map((T,_)=>l.jsx("div",{className:"aspect-video bg-[#1a1a1a] animate-pulse rounded-lg border border-white/5"},_)),d>0&&d<100&&l.jsxs("div",{className:"col-span-full flex flex-col items-center gap-2 py-4",children:[l.jsx("div",{className:"w-64 h-2 bg-[#1a1a1a] rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-[#059669] transition-all duration-300",style:{width:`${d}%`}})}),l.jsxs("div",{className:"text-sm text-gray-400",children:["Caricamento: ",d,"%"]})]})]})]}),!a&&m<S.length&&l.jsx("div",{ref:g,className:"py-12 flex justify-center w-full",children:l.jsx("div",{className:"text-gray-500 text-sm",children:"Caricamento..."})}),!a&&S.length===0&&l.jsx("div",{className:"py-20 text-center text-gray-500",children:"Nessun risultato trovato"})]})})})}const zT="modulepreload",GT=function(r){return"/"+r},n0={},er=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let a=function(h){return Promise.all(h.map(m=>Promise.resolve(m).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),d=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=a(t.map(h=>{if(h=GT(h),h in n0)return;n0[h]=!0;const m=h.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${p}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":zT,m||(g.as="script"),g.crossOrigin="",g.href=h,d&&g.setAttribute("nonce",d),document.head.appendChild(g),m)return new Promise((v,y)=>{g.addEventListener("load",v),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return i.then(a=>{for(const u of a||[])u.status==="rejected"&&n(u.reason);return e().catch(n)})},Yr="https://api.asknebula.it";function Xd({isMobile:r=!1}){var ds,Gt,Ws,sr,oi,li;const{tmdb_id:e}=Pn(),[t]=kr(),s=t.get("type")||"movie",{session:i,plan:n}=Mt(),[a,u]=L.useState(null),[d,h]=L.useState(!0),[m,p]=L.useState(null),[g,v]=L.useState(1),[y,S]=L.useState(null),[b,T]=L.useState(!1),[_,k]=L.useState(null),[I,C]=L.useState(!1),[$,N]=L.useState(!1),[O,j]=L.useState("overview"),[D,G]=L.useState(!1),[X,K]=L.useState([]),[W,te]=L.useState("720p"),[z,M]=L.useState(!1),[F,H]=L.useState(null),[Y,P]=L.useState(!1),[B,oe]=L.useState(null),[ie,ne]=L.useState(null),le=Bt();L.useEffect(()=>{window.scrollTo(0,0)},[e,s]),L.useEffect(()=>{async function fe(){var Oe;if(!e){p("TMDB ID mancante"),h(!1);return}try{const We=parseInt(e);if(isNaN(We))throw new Error("TMDB ID non valido");const Qe=await fetch(`${Yr}/title/${We}?type=${s}`);if(!Qe.ok){if(Qe.status===404)throw new Error(`Titolo non trovato. L'ID ${We} potrebbe non esistere pi su TMDB o potrebbe essere temporaneamente non disponibile.`);const yt=await Qe.text().catch(()=>""),dt=yt?JSON.parse(yt).detail||yt:`Errore ${Qe.status}`;throw new Error(`Errore ${Qe.status}: ${dt||"Impossibile caricare il titolo. Riprova pi tardi."}`)}const vt=await Qe.json();if(!vt||!vt.raw)throw new Error("Dati del titolo non validi dal server");if(vt.raw.type&&vt.raw.type!==s){const yt=new URLSearchParams(t);yt.set("type",vt.raw.type),window.history.replaceState({},"",`${window.location.pathname}?${yt.toString()}`)}u(vt);try{const yt=((Oe=vt.raw)==null?void 0:Oe.type)||s,[dt,ft]=await Promise.all([Oo(We,yt,"logo"),Oo(We,yt,"background")]);oe(dt),ne(ft)}catch{oe(null),ne(null)}if(vt.raw.type==="tv"&&vt.raw.seasons&&vt.raw.seasons.length>0){const yt=vt.raw.seasons.find(dt=>dt.season_number===1)||vt.raw.seasons[0];v(yt.season_number),_e(yt.season_number,We)}i&&(Se(We.toString()),Fe(We))}catch(We){p(We.message??"Errore nel caricamento del titolo. Riprova pi tardi.")}finally{h(!1)}}fe()},[e,s,i]),L.useEffect(()=>{async function fe(){if(!(!(a!=null&&a.raw)||!e))try{const Oe=await fetch(`${Yr}/title/${e}/similar?type=${s}`);if(Oe.ok){const We=await Oe.json(),Qe=_s(We);K(Qe.slice(0,15))}else{const We=await fetch(`${Yr}/featured`);if(We.ok){const vt=(await We.json()).filter(dt=>dt.tmdb_id!==parseInt(e||"0")),yt=_s(vt);K(yt.slice(0,15))}}}catch{}}fe()},[a,e,s]);async function _e(fe,Oe){T(!0);try{const We=await fetch(`${Yr}/tv/${Oe}/season/${fe}`);if(We.ok){const Qe=await We.json();S(Qe)}}catch{}finally{T(!1)}}async function Se(fe){if(i)try{const Oe={Authorization:`Bearer ${i.access_token}`},We=await fetch(`${Yr}/me/progress/${fe}`,{headers:Oe});if(We.ok){const Qe=await We.json();Qe&&k(Qe)}}catch{}}async function Fe(fe){if(i)try{const Oe={Authorization:`Bearer ${i.access_token}`},We=await fetch(`${Yr}/me/favorites/${fe}?type=${s}`,{headers:Oe});if(We.ok){const Qe=await We.json();C(Qe.is_favorite)}}catch{}}async function Ee(){if(!(!i||!(a!=null&&a.raw)||$)){N(!0);try{const fe={Authorization:`Bearer ${i.access_token}`,"Content-Type":"application/json"};if(I)(await fetch(`${Yr}/me/favorites/${e}?type=${s}`,{method:"DELETE",headers:fe})).ok&&(C(!1),window.dispatchEvent(new CustomEvent("favorites-updated")));else{const Oe=a.raw,We=(Oe==null?void 0:Oe.poster)||(Oe==null?void 0:Oe.poster_path)||null,Qe={tmdb_id:parseInt(e),type:s,title:(Oe==null?void 0:Oe.title)||(Oe==null?void 0:Oe.name)||"Titolo sconosciuto",poster:We},vt=await fetch(`${Yr}/me/favorites`,{method:"POST",headers:fe,body:JSON.stringify(Qe)});vt.ok?(C(!0),window.dispatchEvent(new CustomEvent("favorites-updated"))):vt.status===403&&P(!0)}}catch{}finally{N(!1)}}}function at(fe,Oe){const We=a==null?void 0:a.raw,Qe=(We==null?void 0:We.type)==="tv";le(Qe&&fe&&Oe?`/watch/${e}?type=tv&season=${fe}&episode=${Oe}`:Qe&&y?`/watch/${e}?type=tv&season=${g}&episode=1`:`/watch/${e}?type=${s}`)}if(d)return l.jsx(ns,{children:l.jsx("div",{className:"min-h-screen flex items-center justify-center",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-nebula-500"})})});if(m||!a||!a.raw)return l.jsx(ns,{children:l.jsx("div",{className:"max-w-4xl mx-auto py-20 px-4",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-6xl mb-4",children:""}),l.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white mb-4",children:"Contenuto non disponibile"}),l.jsx("p",{className:"text-white/80 mb-6 max-w-md mx-auto",children:m??"Il contenuto richiesto non  stato trovato. Potrebbe essere stato rimosso o l'ID non  pi valido."}),l.jsxs("button",{onClick:()=>le("/"),className:"inline-flex items-center gap-2 px-6 py-3 bg-nebula-600 hover:bg-nebula-500 text-white font-semibold rounded-xl transition-colors",children:[l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Torna alla Home"]})]})})});const de=a==null?void 0:a.raw;if(!de)return l.jsx(ns,{children:l.jsx("div",{className:"min-h-screen flex items-center justify-center",children:l.jsx("div",{className:"text-white",children:"Caricamento..."})})});const gt=(de==null?void 0:de.type)==="tv";Ze((de==null?void 0:de.poster)||(de==null?void 0:de.poster_path));const Ct=(de==null?void 0:de.runtime)||((ds=de==null?void 0:de.episode_run_time)==null?void 0:ds[0])||null,as=Ct?`${Ct} min`:null,ke=de!=null&&de.vote_average?Math.round(de.vote_average*10)/10:null,be=de!=null&&de.adult?"18+":(de==null?void 0:de.certification)||"16+",pe=((Gt=de==null?void 0:de.release_date)==null?void 0:Gt.split("-")[0])||((Ws=de==null?void 0:de.first_air_date)==null?void 0:Ws.split("-")[0])||null,Ge=((sr=de==null?void 0:de.genres)==null?void 0:sr.map(fe=>fe.name||fe))||[],Ne=(de==null?void 0:de.overview)??(de==null?void 0:de.plot)??(de==null?void 0:de.description)??"",nt=Ne.length>192?Ne.substring(0,189)+"...":Ne,it=Ne.length>192,ht=(((oi=de==null?void 0:de.videos)==null?void 0:oi.results)||[]).find(fe=>fe.type==="Trailer"&&fe.site==="YouTube"),ts=ht==null?void 0:ht.key,ks=n?n.plan==="basic"||n.plan==="premium"||n.plan==="ultra"||n.plan==="pro"||n.plan==="premium-plus":!1,zs=n?n.plan==="premium"||n.plan==="ultra"||n.plan==="pro"||n.plan==="premium-plus":!1;async function vs(fe,Oe){if(!(!i||!e||z)){er(async()=>{const{useDownloadStore:We}=await Promise.resolve().then(()=>wL);return{useDownloadStore:We}},void 0).then(({useDownloadStore:We})=>{const{addDownload:Qe,isDownloaded:vt}=We.getState(),yt=parseInt(e);vt(yt,s)||Qe({tmdb_id:yt,type:s,title:(de==null?void 0:de.title)||(de==null?void 0:de.name)||"Video",poster_path:(de==null?void 0:de.poster_path)||void 0,year:pe?parseInt(pe):void 0})}),M(!0),H(null);try{const We={tmdb_id:parseInt(e),quality:W};fe!==void 0&&Oe!==void 0&&(We.season=fe,We.episode=Oe);const Qe=await fetch(`${Yr}/download/token`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify(We)});if(!Qe.ok){let ys="Errore durante la creazione del token di download";try{const Br=await Qe.json();ys=Br.detail||Br.message||ys}catch{ys=Qe.statusText||`Errore ${Qe.status}`}throw new Error(ys)}const yt=(await Qe.json()).token,dt=`${Yr}/download?token=${encodeURIComponent(yt)}`,ft=document.createElement("a");ft.href=dt,ft.download="",ft.style.display="none",document.body.appendChild(ft),ft.click(),document.body.removeChild(ft),setTimeout(()=>{M(!1),H(null)},1e3)}catch(We){let Qe=We.message||"Errore durante il download";Qe.includes("Token")||Qe.includes("token")?Qe="Token di download non valido. Per favore, riprova.":Qe.includes("non disponibile")||Qe.includes("non  disponibile")?Qe="Il file non  disponibile sul server. Riprova pi tardi.":(Qe.includes("authorization")||Qe.includes("autorizzazione"))&&(Qe="Autorizzazione richiesta. Verifica di essere loggato e di avere i permessi necessari."),H(Qe),M(!1)}}}const Te=l.jsxs("div",{className:"relative min-h-screen bg-[#070707]",children:[(ie||(de==null?void 0:de.backdrop_path))&&l.jsxs("div",{className:"absolute inset-0 z-0 -mt-[48px] sm:-mt-[56px] md:-mt-[64px]",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/80 to-black/30 z-10"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/60 to-transparent z-10"}),l.jsx("img",{src:ie||Ze(de.backdrop_path||void 0,"original")||void 0,alt:de.title||de.name,className:"w-full h-[70vh] sm:h-[82vh] md:h-[95vh] lg:h-[98vh] object-cover opacity-60"})]}),l.jsx("div",{className:"relative z-10 pt-[calc(48px+12vh)] sm:pt-[calc(56px+14vh)] md:pt-[calc(64px+16vh)] pb-20 animate-fade-in",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsx("div",{className:"grid grid-cols-1 gap-8 items-start",children:l.jsxs("div",{className:"space-y-6 max-w-3xl",children:[l.jsxs("div",{className:"animate-fade-in-up",children:[B?l.jsx("img",{src:B,alt:(de==null?void 0:de.title)??(de==null?void 0:de.name)??"Titolo",className:"w-full max-w-[340px] md:max-w-[480px] object-contain drop-shadow-2xl mb-4",style:{filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.55))"}}):l.jsx("h1",{className:"text-3xl sm:text-5xl md:text-6xl font-black mb-4 text-white leading-tight tracking-tight drop-shadow-lg",children:(de==null?void 0:de.title)??(de==null?void 0:de.name)??"Titolo non disponibile"}),l.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-7",children:[l.jsx("span",{className:"text-white/90",children:pe}),as&&l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-white/50",children:"-"}),l.jsx("span",{className:"text-white/90",children:as})]}),l.jsx("span",{className:"text-white/50",children:"-"}),l.jsx("span",{className:"text-white/90",children:"59K views"}),l.jsx("span",{className:"px-2.5 py-1 text-xs font-semibold bg-white/10 text-white rounded border border-white/20",children:be}),l.jsx("span",{className:"px-2.5 py-1 text-xs font-semibold bg-white/10 text-white rounded border border-white/20",children:"HD"})]})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-7",children:[l.jsxs("button",{onClick:()=>at(),className:"flex items-center gap-3 bg-white hover:bg-neutral-200 text-black px-10 py-4 font-bold text-lg transition-all rounded-lg shadow-lg hover:shadow-xl w-full sm:w-auto justify-center",children:[l.jsx("svg",{className:"w-6 h-6 fill-black",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})}),l.jsx("span",{children:"Riproduci"})]}),ke&&l.jsxs("div",{className:"h-14 w-14 rounded-full bg-[#292929] flex items-center justify-center border-2 border-transparent relative overflow-hidden",children:[l.jsx("svg",{className:"absolute inset-0 w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#018850",strokeWidth:"8",strokeDasharray:`${ke/10*283} 283`})}),l.jsx("span",{className:"text-white font-bold text-sm relative z-10",children:ke.toFixed(1)})]}),l.jsx("button",{onClick:Ee,disabled:$,className:`w-14 h-14 rounded-full border-2 ${I?"bg-[#018850] border-[#018850] hover:bg-[#016d40]":"bg-[#292929] border-white/50 hover:border-white"} flex items-center justify-center transition-all active:scale-95`,title:I?"Rimuovi dai preferiti":"Aggiungi ai preferiti",children:l.jsx("span",{className:"text-white text-xl font-bold",children:I?"":"+"})}),l.jsxs("button",{onClick:()=>j("details"),className:"flex items-center gap-2 bg-[#292929] hover:bg-[#333] text-white px-6 py-4 font-bold text-lg transition-all rounded-lg border border-white/10 w-full sm:w-auto justify-center",children:[l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),l.jsx("span",{children:"Altre info"})]})]}),l.jsx("div",{className:"mb-7 animate-fade-in-up",style:{animationDelay:"0.3s"},children:l.jsxs("p",{className:"text-base lg:text-lg text-white/90 leading-relaxed font-light",children:[D?Ne:nt,it&&l.jsx("button",{onClick:()=>G(!D),className:"ml-2 text-[#018850] hover:text-[#016d40] font-bold uppercase text-sm",children:D?"LEGGI MENO":"LEGGI TUTTO"})]})}),l.jsxs("div",{className:"space-y-2.5 mb-9 animate-fade-in-up",style:{animationDelay:"0.4s"},children:[((li=de==null?void 0:de.credits)==null?void 0:li.cast)&&de.credits.cast.length>0&&l.jsxs("div",{children:[l.jsx("span",{className:"text-sm text-white/70",children:"Cast: "}),l.jsx("span",{className:"text-sm text-white/90",children:de.credits.cast.slice(0,3).map(fe=>fe.name).join(", ")})]}),Ge.length>0&&l.jsxs("div",{children:[l.jsx("span",{className:"text-sm text-white/70",children:"Genere: "}),l.jsx("span",{className:"text-sm text-white/90",children:Ge.slice(0,2).join(", ")})]})]}),l.jsx("div",{className:"border-b border-white/10 mb-8 animate-fade-in-up",style:{animationDelay:"0.5s"},children:l.jsx("div",{className:"flex gap-8 overflow-x-auto no-scrollbar pb-0 -mb-px",children:["overview","details","trailer","download"].map(fe=>l.jsxs("button",{onClick:()=>j(fe),className:`pb-4 px-1 text-sm font-bold transition-all uppercase tracking-wide whitespace-nowrap border-b-[3px] ${O===fe?"text-white border-[#059669]":"text-white/40 border-transparent hover:text-white hover:border-white/20"}`,children:[fe==="overview"&&"Panoramica",fe==="details"&&"Dettagli",fe==="trailer"&&"Trailer",fe==="download"&&"Scarica"]},fe))})}),l.jsxs("div",{className:"mb-12",children:[O==="overview"&&l.jsxs("div",{className:"space-y-4",children:[_&&_.duration_seconds&&l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"flex items-center justify-between text-xs text-white/70",children:l.jsxs("span",{children:[Math.floor(_.position_seconds/60)," di ",Math.floor(_.duration_seconds/60)," min"]})}),l.jsx("div",{className:"h-1 bg-white/20 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:`${_.position_seconds/_.duration_seconds*100}%`}})})]}),gt&&(de==null?void 0:de.seasons)&&de.seasons.length>0&&l.jsxs("div",{className:"space-y-4 pt-4",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("label",{className:"text-sm font-semibold text-white/90",children:"Stagione:"}),l.jsx("select",{value:g,onChange:fe=>{const Oe=parseInt(fe.target.value);v(Oe),_e(Oe,parseInt(e))},className:"bg-black/80 backdrop-blur-sm border border-white/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500",style:{color:"white"},children:de.seasons.filter(fe=>fe.season_number>0).map(fe=>l.jsx("option",{value:fe.season_number,style:{backgroundColor:"#000",color:"#fff"},children:fe.name||`Stagione ${fe.season_number}`},fe.season_number))})]}),b?l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"})}):y&&y.episodes.length>0?l.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto pr-2",children:y.episodes.map(fe=>{const Oe=(_==null?void 0:_.season)===g&&(_==null?void 0:_.episode)===fe.episode_number?_:null;return l.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 backdrop-blur-sm rounded-lg hover:bg-white/10 transition-all cursor-pointer group",onClick:()=>at(g,fe.episode_number),children:[l.jsx("div",{className:"flex-shrink-0 w-16 text-center text-white/70 group-hover:text-white transition-colors",children:fe.episode_number}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("h4",{className:"font-semibold text-white group-hover:text-green-400 transition-colors",children:fe.name}),fe.runtime&&l.jsxs("span",{className:"text-xs text-white/50",children:[fe.runtime," min"]})]}),fe.overview&&l.jsx("p",{className:"text-sm text-white/70 line-clamp-2",children:fe.overview}),Oe&&l.jsx("div",{className:"mt-2 h-1 bg-white/20 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-green-500",style:{width:Oe.duration_seconds?`${Oe.position_seconds/Oe.duration_seconds*100}%`:"0%"}})})]}),l.jsx("button",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all",children:l.jsx("span",{className:"text-lg",children:""})})]},fe.id)})}):null]})]}),O==="details"&&l.jsxs("div",{className:"text-white/90 space-y-3",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-white/70",children:"Anno di uscita: "}),l.jsx("span",{children:pe||"N/A"})]}),as&&l.jsxs("div",{children:[l.jsx("span",{className:"text-white/70",children:"Durata: "}),l.jsx("span",{children:as})]}),ke&&l.jsxs("div",{children:[l.jsx("span",{className:"text-white/70",children:"Rating: "}),l.jsxs("span",{children:[ke,"/10"]})]}),Ge.length>0&&l.jsxs("div",{children:[l.jsx("span",{className:"text-white/70",children:"Generi: "}),l.jsx("span",{children:Ge.join(", ")})]})]}),O==="trailer"&&l.jsx("div",{className:"text-white/90",children:ts?l.jsx("div",{className:"aspect-video w-full max-w-4xl",children:l.jsx("iframe",{className:"w-full h-full rounded-lg",src:`https://www.youtube.com/embed/${ts}`,title:"Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):l.jsx("div",{className:"aspect-video w-full max-w-4xl bg-white/5 rounded-lg flex items-center justify-center",children:l.jsx("p",{className:"text-white/60",children:"Trailer non disponibile per questo contenuto."})})}),O==="download"&&l.jsx("div",{className:"text-white/90 space-y-6",children:ks?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-lg font-semibold",children:"Download disponibile"}),l.jsx("p",{className:"text-white/70 text-sm",children:zs?l.jsxs(l.Fragment,{children:["Il download  disponibile con il tuo piano ",l.jsx("span",{className:"font-semibold text-green-400 uppercase",children:(n==null?void 0:n.plan)||"basic"}),". Download illimitati."]}):l.jsxs(l.Fragment,{children:["Il download  disponibile con il tuo piano ",l.jsx("span",{className:"font-semibold text-green-400 uppercase",children:(n==null?void 0:n.plan)||"basic"}),". Puoi scaricare fino a 3 contenuti al giorno."]})})]}),gt?l.jsx("div",{className:"space-y-4",children:y&&y.episodes&&y.episodes.length>0?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"space-y-3 bg-white/5 rounded-lg p-4 border border-white/10",children:[l.jsx("label",{className:"text-sm font-medium text-white/90",children:"Seleziona qualit:"}),l.jsx("div",{className:"flex gap-2",children:["420p","720p","1080p"].map(fe=>l.jsx("button",{onClick:()=>te(fe),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${W===fe?"bg-green-600 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:fe},fe))})]}),l.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[l.jsxs("p",{className:"text-sm font-medium text-white/90",children:["Episodi Stagione ",g,":"]}),y.episodes.map(fe=>l.jsxs("div",{className:"flex items-center justify-between bg-white/5 rounded-lg p-3 border border-white/10 hover:bg-white/10 transition-colors",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("p",{className:"text-sm font-medium text-white",children:["Episodio ",fe.episode_number,": ",fe.name]}),fe.overview&&l.jsx("p",{className:"text-xs text-white/60 mt-1 line-clamp-2",children:fe.overview})]}),l.jsx("button",{onClick:()=>vs(g,fe.episode_number),disabled:z,className:"ml-4 px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:z?l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}):l.jsxs(l.Fragment,{children:[l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),l.jsx("span",{children:"Scarica"})]})})]},fe.id))]}),F&&l.jsx("p",{className:"text-sm text-red-400",children:F})]}):l.jsx("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:l.jsx("p",{className:"text-white/70 text-sm",children:"Caricamento episodi..."})})}):l.jsxs("div",{className:"space-y-4 bg-white/5 rounded-lg p-4 border border-white/10",children:[l.jsxs("div",{className:"space-y-3",children:[l.jsx("label",{className:"text-sm font-medium text-white/90",children:"Seleziona qualit:"}),l.jsx("div",{className:"flex gap-2",children:["420p","720p","1080p"].map(fe=>l.jsx("button",{onClick:()=>te(fe),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${W===fe?"bg-green-600 text-white":"bg-white/10 text-white/70 hover:bg-white/20"}`,children:fe},fe))})]}),l.jsx("button",{onClick:()=>vs(),disabled:z,className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:z?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}),l.jsx("span",{children:"Download in corso..."})]}):l.jsxs(l.Fragment,{children:[l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),l.jsxs("span",{children:["Scarica Film (",W,")"]})]})}),F&&l.jsx("p",{className:"text-sm text-red-400",children:F})]})]}):l.jsxs("div",{className:"space-y-4",children:[l.jsx("p",{className:"text-lg font-semibold",children:"Download non disponibile"}),l.jsxs("p",{className:"text-white/70",children:["Il download  disponibile per gli abbonati ",l.jsx("span",{className:"font-semibold text-green-400",children:"Basic"}),", ",l.jsx("span",{className:"font-semibold text-green-400",children:"Premium"})," e ",l.jsx("span",{className:"font-semibold text-green-400",children:"Ultra"}),"."]})]})})]})]})})})}),X.length>0&&l.jsx("div",{className:"relative z-10 pb-20 pt-8",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-6 lg:px-8",children:[l.jsx("h2",{className:"text-2xl lg:text-3xl font-bold text-white mb-7 animate-fade-in-up",children:"Correlati"}),l.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-3 scroll-smooth",onWheel:fe=>{fe.stopPropagation(),fe.nativeEvent.stopImmediatePropagation();const Oe=fe.currentTarget;if(Math.abs(fe.deltaY)>Math.abs(fe.deltaX)){Oe.scrollLeft+=fe.deltaY;const We=Oe.scrollWidth-Oe.clientWidth;Oe.scrollLeft>=We-5&&Oe.scrollTo({left:0,behavior:"smooth"}),Oe.scrollLeft<=0&&fe.deltaY<0&&We>0&&Oe.scrollTo({left:We,behavior:"instant"})}},children:X.map((fe,Oe)=>l.jsx("div",{className:"flex-shrink-0 cursor-pointer group animate-fade-in-up",style:{animationDelay:`${Oe*.05}s`},onClick:()=>le(`/title/${fe.tmdb_id}?type=${fe.type}`),children:l.jsx("div",{className:"w-[180px] lg:w-[200px] aspect-[2/3] rounded-lg overflow-hidden bg-black shadow-xl transition-all duration-800 ease-out group-hover:scale-110 group-hover:shadow-2xl group-hover:z-20 relative",children:fe.poster?l.jsxs(l.Fragment,{children:[l.jsx("img",{src:Ze(fe.poster)||"",alt:fe.title,className:"w-full h-full object-cover transition-transform duration-1000 ease-out group-hover:scale-110"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-800 ease-out"}),l.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 transform translate-y-full group-hover:translate-y-0 transition-transform duration-800 ease-out",children:[l.jsx("p",{className:"text-white text-sm font-semibold line-clamp-2",children:fe.title}),fe.year&&l.jsx("p",{className:"text-white/70 text-xs mt-1",children:fe.year})]})]}):l.jsx("div",{className:"w-full h-full bg-gradient-to-br from-slate-800 to-black flex items-center justify-center",children:l.jsx("div",{className:"text-4xl",children:""})})})},`${fe.tmdb_id}-${fe.type}`))})]})})]});return l.jsxs(ns,{children:[Te,l.jsx(vf,{isOpen:Y,onClose:()=>P(!1),currentPlan:(n==null?void 0:n.plan)||"free"})]})}const pv="vixsrc.to",VT=[],Eo="nebula_cors_proxy";let pr="api.codetabs.com/v1/proxy?quest=";if(typeof window<"u"){const r=localStorage.getItem(Eo);r&&!r.includes("corsproxy.io")&&!r.includes("cors.bridged.cc")&&!r.includes("thingproxy.freeboard.io")?(pr=r.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest="),pr!==r&&localStorage.setItem(Eo,pr)):r&&(r.includes("corsproxy.io")||r.includes("cors.bridged.cc")||r.includes("thingproxy.freeboard.io"))&&(pr="api.codetabs.com/v1/proxy?quest=",localStorage.setItem(Eo,pr))}function KT(r,e=pr){const t=VT.some(i=>e===i);let s=r;return r.includes(e)&&(t?s=decodeURIComponent(r.split(e)[1]):s=r.split(e)[1]),!s.startsWith("http://")&&!s.startsWith("https://")&&(s=WT(s)),s.startsWith("data:")||s.startsWith("blob:")||!s.startsWith("https://vixsrc.to")?r:(e.includes("corsproxy.io")&&(e="api.codetabs.com/v1/proxy?quest="),e.includes("api.codetabs.com/v1/proxy?quest=")?`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(s)}`:e.includes("api.allorigins.win/raw?url=")?`https://api.allorigins.win/raw?url=${encodeURIComponent(s)}`:t?`https://${e}${encodeURIComponent(s)}`:`https://${e}${s}`)}function WT(r,e=`https://${pv}`){return r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/")?e+r:e+"/"+r}function HT(r,e=pr){try{let t=r;r.includes(e)&&(t=r.split(e)[1]);const s=new URL(t);return`${s.protocol}//${s.host}`}catch{return""}}async function qT(r){const{tmdbId:e,isMovie:t,season:s,episode:i,corsProxy:n=pr,onLoading:a}=r;if(n){let u=n.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest=");(u.includes("corsproxy.io")||u.includes("cors.bridged.cc")||u.includes("thingproxy.freeboard.io"))&&(u="api.codetabs.com/v1/proxy?quest="),pr=u,typeof window<"u"&&localStorage.setItem(Eo,u)}try{a==null||a("Connessione al server...");let u=`https://${pv}/${t?"movie":"tv"}/${e}`;!t&&s!==null&&s!==void 0&&i!==null&&i!==void 0&&(u+=`/${s}/${i}`),a==null||a("");const d=new AbortController,h=setTimeout(()=>d.abort(),3e4);let m;try{m=await fetch(KT(u,pr),{signal:d.signal}),clearTimeout(h)}catch(G){throw clearTimeout(h),G.name==="AbortError"?new Error("Timeout: il server non risponde. Riprova pi tardi."):G}if(!m.ok)throw new Error(`Errore HTTP: ${m.status} ${m.statusText}`);const p=await m.text();a==null||a("Estrazione parametri stream...");const g=/params\s*:\s*({[\s\S]*?})/;let v=p.match(g);if(!v){const G=/params\s*:\s*({[^}]+})/,X=p.match(G);if(!X)throw new Error("  '  ");v=X}let y=v[1].replace(/'/g,'"').replace(/\s+/g,"").replace(/\n/g,"").replace(/\\n/g,"").replace(/,}/g,"}"),S;try{S=JSON.parse(y)}catch(G){try{const X=y.replace(/([{,])(\w+):/g,'$1"$2":');S=JSON.parse(X)}catch{throw new Error("Errore nel parsing dei parametri: "+G.message)}}const b=/url\s*:\s*['"]([^'"]+)['"]/,T=p.match(b);if(!T)throw new Error("Impossibile trovare l'URL della playlist");const _=T[1],k=/window\.canPlayFHD\s+?=\s+?(\w+)/,I=p.match(k),C=I&&I[1]==="true",N=/\?[^#]+/.test(_)?"&":"?";let O=_+N+"expires="+S.expires+"&token="+S.token+(C?"&h=1":"");const j=O,D=HT(O,pr);return a==null||a(void 0),{iframeUrl:u,m3u8Url:j,baseStreamUrl:D}}catch(u){if(a==null||a(void 0),u instanceof Error){const d=new Error(u.message.replace(/vixsrc\.to[^\s]*/gi,"[URL nascosto]").replace(/https?:\/\/[^\/]*vixsrc[^\s]*/gi,"[URL nascosto]"));throw d.name=u.name,d}throw u}}function a0(r){r=r.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest="),(r.includes("corsproxy.io")||r.includes("cors.bridged.cc")||r.includes("thingproxy.freeboard.io"))&&(r="api.codetabs.com/v1/proxy?quest="),pr=r,typeof window<"u"&&localStorage.setItem(Eo,r)}function ec(){return pr}const Ae=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},YT=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=QT},QT=Number.MAX_SAFE_INTEGER||9007199254740991;let Ue=(function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r})({}),Z=(function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r})({}),A=(function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r})({});var ut={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ce={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ha{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class XT{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ha(e),this.fast_=new ha(t),this.defaultTTFB_=i,this.ttfb_=new ha(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:n}=this;s.halfLife!==e&&(this.slow_=new ha(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new ha(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new ha(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,i=e/1e3,n=s/i;this.fast_.sample(i,n),this.slow_.sample(i,n)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function JT(r,e,t){return(e=e_(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function kt(){return kt=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},kt.apply(null,arguments)}function o0(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,s)}return t}function Et(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?o0(Object(t),!0).forEach(function(s){JT(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):o0(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}function ZT(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function e_(r){var e=ZT(r,"string");return typeof e=="symbol"?e:e+""}class Ar{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Xi,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Xi=function(){},t_={trace:Xi,debug:Xi,log:Xi,warn:Xi,info:Xi,error:Xi};function Gh(){return kt({},t_)}function s_(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):Xi}function l0(r,e,t){return e[r]?e[r].bind(e):s_(r,t)}const Vh=Gh();function r_(r,e,t){const s=Gh();if(typeof console=="object"&&r===!0||typeof r=="object"){const i=["debug","log","info","warn","error"];i.forEach(n=>{s[n]=l0(n,r,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Gh()}i.forEach(n=>{Vh[n]=l0(n,r)})}else kt(Vh,s);return s}const Tt=Vh;function rn(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function i_(r){return typeof self<"u"&&r===self.ManagedMediaSource}function gv(r,e){const t=Object.keys(r),s=Object.keys(e),i=t.length,n=s.length;return!i||!n||i===n&&!t.some(a=>s.indexOf(a)===-1)}function gr(r,e=!1){if(typeof TextDecoder<"u"){const h=new TextDecoder("utf-8").decode(r);if(e){const m=h.indexOf("\0");return m!==-1?h.substring(0,m):h}return h.replace(/\0/g,"")}const t=r.length;let s,i,n,a="",u=0;for(;u<t;){if(s=r[u++],s===0&&e)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:i=r[u++],a+=String.fromCharCode((s&31)<<6|i&63);break;case 14:i=r[u++],n=r[u++],a+=String.fromCharCode((s&15)<<12|(i&63)<<6|(n&63)<<0);break}}return a}function Ps(r){let e="";for(let t=0;t<r.length;t++){let s=r[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function xv(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function n_(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Jd={exports:{}},c0;function a_(){return c0||(c0=1,(function(r,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(d,h,m){if(m=m||{},d=d.trim(),h=h.trim(),!h){if(!m.alwaysNormalize)return d;var p=u.parseURL(d);if(!p)throw new Error("Error trying to parse base URL.");return p.path=u.normalizePath(p.path),u.buildURLFromParts(p)}var g=u.parseURL(h);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return m.alwaysNormalize?(g.path=u.normalizePath(g.path),u.buildURLFromParts(g)):h;var v=u.parseURL(d);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var y=i.exec(v.path);v.netLoc=y[1],v.path=y[2]}v.netLoc&&!v.path&&(v.path="/");var S={scheme:v.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(S.netLoc=v.netLoc,g.path[0]!=="/"))if(!g.path)S.path=v.path,g.params||(S.params=v.params,g.query||(S.query=v.query));else{var b=v.path,T=b.substring(0,b.lastIndexOf("/")+1)+g.path;S.path=u.normalizePath(T)}return S.path===null&&(S.path=m.alwaysNormalize?u.normalizePath(g.path):g.path),u.buildURLFromParts(S)},parseURL:function(d){var h=s.exec(d);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(n,"");d.length!==(d=d.replace(a,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};r.exports=u})()})(Jd)),Jd.exports}var bf=a_();class wf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var It={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class vv{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,l_(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;s.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[It.AUDIO]:null,[It.VIDEO]:null,[It.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new wf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=bf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[It.AUDIO]=null,e[It.VIDEO]=null,e[It.AUDIOVIDEO]=null}}function is(r){return r.sn!=="initSegment"}class Zd extends vv{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ae(e)&&Ae(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const i=this._decryptdata=t[s[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ae(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),i=s.length;if(i>1||i===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ae(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return is(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const i=t[e];i&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,i,n,a=!1){const{elementaryStreams:u}=this,d=u[e];if(!d){u[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:n,partial:a};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,s),d.startDTS=Math.min(d.startDTS,i),d.endDTS=Math.max(d.endDTS,n)}}class o_ extends vv{constructor(e,t,s,i,n){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function yv(r,e){const t=Object.getPrototypeOf(r);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||yv(t,e)}}function l_(r,e){const t=yv(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const u0=Math.pow(2,32)-1,c_=[].push,bv={video:1,audio:2,id3:3,text:4};function gs(r){return String.fromCharCode.apply(null,r)}function wv(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function st(r,e){const t=Sv(r,e);return t<0?4294967296+t:t}function d0(r,e){let t=st(r,e);return t*=Math.pow(2,32),t+=st(r,e+4),t}function Sv(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function u_(r){const e=r.byteLength;for(let t=0;t<e;){const s=st(r,t);if(s>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=s>1?t+s:e}return!1}function ot(r,e){const t=[];if(!e.length)return t;const s=r.byteLength;for(let i=0;i<s;){const n=st(r,i),a=gs(r.subarray(i+4,i+8)),u=n>1?i+n:s;if(a===e[0])if(e.length===1)t.push(r.subarray(i+8,u));else{const d=ot(r.subarray(i+8,u),e.slice(1));d.length&&c_.apply(t,d)}i=u}return t}function d_(r){const e=[],t=r[0];let s=8;const i=st(r,s);s+=4;let n=0,a=0;t===0?(n=st(r,s),a=st(r,s+4),s+=8):(n=d0(r,s),a=d0(r,s+8),s+=16),s+=2;let u=r.length+a;const d=wv(r,s);s+=2;for(let h=0;h<d;h++){let m=s;const p=st(r,m);m+=4;const g=p&2147483647;if((p&2147483648)>>>31===1)return Tt.warn("SIDX has hierarchical references (not supported)"),null;const y=st(r,m);m+=4,e.push({referenceSize:g,subsegmentDuration:y,info:{duration:y/i,start:u,end:u+g-1}}),u+=g,m+=4,s=m}return{earliestPresentationTime:n,timescale:i,version:t,referencesCount:d,references:e}}function Ev(r){const e=[],t=ot(r,["moov","trak"]);for(let i=0;i<t.length;i++){const n=t[i],a=ot(n,["tkhd"])[0];if(a){let u=a[0];const d=st(a,u===0?12:20),h=ot(n,["mdia","mdhd"])[0];if(h){u=h[0];const m=st(h,u===0?12:20),p=ot(n,["mdia","hdlr"])[0];if(p){const g=gs(p.subarray(8,12)),v={soun:It.AUDIO,vide:It.VIDEO}[g],y=ot(n,["mdia","minf","stbl","stsd"])[0],S=h_(y);v?(e[d]={timescale:m,type:v,stsd:S},e[v]=Et({timescale:m,id:d},S)):e[d]={timescale:m,type:g,stsd:S}}}}}return ot(r,["moov","mvex","trex"]).forEach(i=>{const n=st(i,4),a=e[n];a&&(a.default={duration:st(i,12),flags:st(i,20)})}),e}function h_(r){const e=r.subarray(8),t=e.subarray(86),s=gs(e.subarray(4,8));let i=s,n;const a=s==="enca"||s==="encv";if(a){const h=ot(e,[s])[0].subarray(s==="enca"?28:78);ot(h,["sinf"]).forEach(p=>{const g=ot(p,["schm"])[0];if(g){const v=gs(g.subarray(4,8));if(v==="cbcs"||v==="cenc"){const y=ot(p,["frma"])[0];y&&(i=gs(y))}}})}const u=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const d=ot(t,["avcC"])[0];d&&d.length>3&&(i+="."+sc(d[1])+sc(d[2])+sc(d[3]),n=tc(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=ot(e,[s])[0],h=ot(d.subarray(28),["esds"])[0];if(h&&h.length>7){let m=4;if(h[m++]!==3)break;m=eh(h,m),m+=2;const p=h[m++];if(p&128&&(m+=2),p&64&&(m+=h[m++]),h[m++]!==4)break;m=eh(h,m);const g=h[m++];if(g===64)i+="."+sc(g);else break;if(m+=12,h[m++]!==5)break;m=eh(h,m);const v=h[m++];let y=(v&248)>>3;y===31&&(y+=1+((v&7)<<3)+((h[m]&224)>>5)),i+="."+y}break}case"hvc1":case"hev1":{const d=ot(t,["hvcC"])[0];if(d&&d.length>12){const h=d[1],m=["","A","B","C"][h>>6],p=h&31,g=st(d,2),v=(h&32)>>5?"H":"L",y=d[12],S=d.subarray(6,12);i+="."+m+p,i+="."+f_(g).toString(16).toUpperCase(),i+="."+v+y;let b="";for(let T=S.length;T--;){const _=S[T];(_||b)&&(b="."+_.toString(16).toUpperCase()+b)}i+=b}n=tc(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=tc(i,t)||i;break}case"vp09":{const d=ot(t,["vpcC"])[0];if(d&&d.length>6){const h=d[4],m=d[5],p=d[6]>>4&15;i+="."+Zr(h)+"."+Zr(m)+"."+Zr(p)}break}case"av01":{const d=ot(t,["av1C"])[0];if(d&&d.length>2){const h=d[1]>>>5,m=d[1]&31,p=d[2]>>>7?"H":"M",g=(d[2]&64)>>6,v=(d[2]&32)>>5,y=h===2&&g?v?12:10:g?10:8,S=(d[2]&16)>>4,b=(d[2]&8)>>3,T=(d[2]&4)>>2,_=d[2]&3;i+="."+h+"."+Zr(m)+p+"."+Zr(y)+"."+S+"."+b+T+_+"."+Zr(1)+"."+Zr(1)+"."+Zr(1)+"."+0,n=tc("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:n}}function tc(r,e){const t=ot(e,["dvvC"]),s=t.length?t[0]:ot(e,["dvcC"])[0];if(s){const i=s[2]>>1&127,n=s[2]<<5&32|s[3]>>3&31;return r+"."+Zr(i)+"."+Zr(n)}}function f_(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function eh(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function sc(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Zr(r){return(r<10?"0":"")+r}function m_(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Tv(r,(s,i)=>{const n=s.subarray(8,24);n.some(a=>a!==0)||(Tt.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${Ps(n)} -> ${Ps(t)}`),s.set(t,8))})}function p_(r){const e=[];return Tv(r,t=>e.push(t.subarray(8,24))),e}function Tv(r,e){ot(r,["moov","trak"]).forEach(s=>{const i=ot(s,["mdia","minf","stbl","stsd"])[0];if(!i)return;const n=i.subarray(8);let a=ot(n,["enca"]);const u=a.length>0;u||(a=ot(n,["encv"])),a.forEach(d=>{const h=u?d.subarray(28):d.subarray(78);ot(h,["sinf"]).forEach(p=>{const g=_v(p);g&&e(g,u)})})})}function _v(r){const e=ot(r,["schm"])[0];if(e){const t=gs(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=ot(r,["schi","tenc"])[0];if(s)return s}}}function g_(r,e,t){const s={},i=ot(r,["moof","traf"]);for(let n=0;n<i.length;n++){const a=i[n],u=ot(a,["tfhd"])[0],d=st(u,4),h=e[d];if(!h)continue;s[d]||(s[d]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type});const m=s[d],p=ot(a,["tfdt"])[0];if(p){const k=p[0];let I=st(p,4);k===1&&(I===u0?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(I*=u0+1,I+=st(p,8))),Ae(I)&&(!Ae(m.start)||I<m.start)&&(m.start=I)}const g=h.default,v=st(u,0)|(g==null?void 0:g.flags);let y=(g==null?void 0:g.duration)||0;v&8&&(v&2?y=st(u,12):y=st(u,8));const S=ot(a,["trun"]);let b=m.start||0,T=0,_=y;for(let k=0;k<S.length;k++){const I=S[k],C=st(I,4),$=m.sampleCount;m.sampleCount+=C;const N=I[3]&1,O=I[3]&4,j=I[2]&1,D=I[2]&2,G=I[2]&4,X=I[2]&8;let K=8,W=C;for(N&&(K+=4),O&&C&&(!(I[K+1]&1)&&m.keyFrameIndex===void 0&&(m.keyFrameIndex=$),K+=4,j?(_=st(I,K),K+=4):_=y,D&&(K+=4),X&&(K+=4),b+=_,T+=_,W--);W--;)j?(_=st(I,K),K+=4):_=y,D&&(K+=4),G&&(I[K+1]&1||m.keyFrameIndex===void 0&&(m.keyFrameIndex=m.sampleCount-(W+1),m.keyFrameStart=b),K+=4),X&&(K+=4),b+=_,T+=_;!T&&y&&(T+=y*C)}m.duration+=T}if(!Object.keys(s).some(n=>s[n].duration)){let n=1/0,a=0;const u=ot(r,["sidx"]);for(let d=0;d<u.length;d++){const h=d_(u[d]);if(h!=null&&h.references){n=Math.min(n,h.earliestPresentationTime/h.timescale);const m=h.references.reduce((p,g)=>p+g.info.duration||0,0);a=Math.max(a,m+h.earliestPresentationTime/h.timescale)}}a&&Ae(a)&&Object.keys(s).forEach(d=>{s[d].duration||(s[d].duration=a*s[d].timescale-s[d].start)})}return s}function x_(r){const e={valid:null,remainder:null},t=ot(r,["moof"]);if(t.length<2)return e.remainder=r,e;const s=t[t.length-1];return e.valid=r.slice(0,s.byteOffset-8),e.remainder=r.slice(s.byteOffset-8),e}function _r(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function h0(r,e){const t=[],s=e.samples,i=e.timescale,n=e.id;let a=!1;return ot(s,["moof"]).map(d=>{const h=d.byteOffset-8;ot(d,["traf"]).map(p=>{const g=ot(p,["tfdt"]).map(v=>{const y=v[0];let S=st(v,4);return y===1&&(S*=Math.pow(2,32),S+=st(v,8)),S/i})[0];return g!==void 0&&(r=g),ot(p,["tfhd"]).map(v=>{const y=st(v,4),S=st(v,0)&16777215,b=(S&1)!==0,T=(S&2)!==0,_=(S&8)!==0;let k=0;const I=(S&16)!==0;let C=0;const $=(S&32)!==0;let N=8;y===n&&(b&&(N+=8),T&&(N+=4),_&&(k=st(v,N),N+=4),I&&(C=st(v,N),N+=4),$&&(N+=4),e.type==="video"&&(a=qc(e.codec)),ot(p,["trun"]).map(O=>{const j=O[0],D=st(O,0)&16777215,G=(D&1)!==0;let X=0;const K=(D&4)!==0,W=(D&256)!==0;let te=0;const z=(D&512)!==0;let M=0;const F=(D&1024)!==0,H=(D&2048)!==0;let Y=0;const P=st(O,4);let B=8;G&&(X=st(O,B),B+=4),K&&(B+=4);let oe=X+h;for(let ie=0;ie<P;ie++){if(W?(te=st(O,B),B+=4):te=k,z?(M=st(O,B),B+=4):M=C,F&&(B+=4),H&&(j===0?Y=st(O,B):Y=Sv(O,B),B+=4),e.type===It.VIDEO){let ne=0;for(;ne<M;){const le=st(s,oe);if(oe+=4,v_(a,s[oe])){const _e=s.subarray(oe,oe+le);Sf(_e,a?2:1,r+Y/i,t)}oe+=le,ne+=le+4}}r+=te/i}}))})})}),t}function qc(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function v_(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Sf(r,e,t,s){const i=kv(r);let n=0;n+=e;let a=0,u=0,d=0;for(;n<i.length;){a=0;do{if(n>=i.length)break;d=i[n++],a+=d}while(d===255);u=0;do{if(n>=i.length)break;d=i[n++],u+=d}while(d===255);const h=i.length-n;let m=n;if(u<h)n+=u;else if(u>h){Tt.error(`Malformed SEI payload. ${u} is too small, only ${h} bytes left to parse.`);break}if(a===4){if(i[m++]===181){const g=wv(i,m);if(m+=2,g===49){const v=st(i,m);if(m+=4,v===1195456820){const y=i[m++];if(y===3){const S=i[m++],b=31&S,T=64&S,_=T?2+b*3:0,k=new Uint8Array(_);if(T){k[0]=S;for(let I=1;I<_;I++)k[I]=i[m++]}s.push({type:y,payloadType:a,pts:t,bytes:k})}}}}}else if(a===5&&u>16){const p=[];for(let y=0;y<16;y++){const S=i[m++].toString(16);p.push(S.length==1?"0"+S:S),(y===3||y===5||y===7||y===9)&&p.push("-")}const g=u-16,v=new Uint8Array(g);for(let y=0;y<g;y++)v[y]=i[m++];s.push({payloadType:a,pts:t,uuid:p.join(""),userData:gr(v),userDataBytes:v})}}}function kv(r){const e=r.byteLength,t=[];let s=1;for(;s<e-2;)r[s]===0&&r[s+1]===0&&r[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return r;const i=e-t.length,n=new Uint8Array(i);let a=0;for(s=0;s<i;a++,s++)a===t[0]&&(a++,t.shift()),n[s]=r[a];return n}function y_(r){const e=r[0];let t="",s="",i=0,n=0,a=0,u=0,d=0,h=0;if(e===0){for(;gs(r.subarray(h,h+1))!=="\0";)t+=gs(r.subarray(h,h+1)),h+=1;for(t+=gs(r.subarray(h,h+1)),h+=1;gs(r.subarray(h,h+1))!=="\0";)s+=gs(r.subarray(h,h+1)),h+=1;s+=gs(r.subarray(h,h+1)),h+=1,i=st(r,12),n=st(r,16),u=st(r,20),d=st(r,24),h=28}else if(e===1){h+=4,i=st(r,h),h+=4;const p=st(r,h);h+=4;const g=st(r,h);for(h+=4,a=2**32*p+g,YT(a)||(a=Number.MAX_SAFE_INTEGER,Tt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=st(r,h),h+=4,d=st(r,h),h+=4;gs(r.subarray(h,h+1))!=="\0";)t+=gs(r.subarray(h,h+1)),h+=1;for(t+=gs(r.subarray(h,h+1)),h+=1;gs(r.subarray(h,h+1))!=="\0";)s+=gs(r.subarray(h,h+1)),h+=1;s+=gs(r.subarray(h,h+1)),h+=1}const m=r.subarray(h,r.byteLength);return{schemeIdUri:t,value:s,timeScale:i,presentationTime:a,presentationTimeDelta:n,eventDuration:u,id:d,payload:m}}function b_(r,...e){const t=e.length;let s=8,i=t;for(;i--;)s+=e[i].byteLength;const n=new Uint8Array(s);for(n[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=s&255,n.set(r,4),i=0,s=8;i<t;i++)n.set(e[i],s),s+=e[i].byteLength;return n}function w_(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let s,i;s=0,i=new Uint8Array;let n;s>0?(n=new Uint8Array(4),e.length>0&&new DataView(n.buffer).setUint32(0,e.length,!1)):n=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),b_([112,115,115,104],new Uint8Array([s,0,0,0]),r,n,i,a,t)}function S_(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let s=0;for(;s+32<t;){const i=new DataView(r,s),n=E_(i);e.push(n),s+=n.size}}return e}function E_(r){const e=r.getUint32(0),t=r.byteOffset,s=r.byteLength;if(s<e)return{offset:t,size:s};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const n=r.getUint32(8)>>>24;if(n!==0&&n!==1)return{offset:t,size:e};const a=r.buffer,u=Ps(new Uint8Array(a,t+12,16));let d=null,h=null,m=0;if(n===0)m=28;else{const g=r.getUint32(28);if(!g||s<32+g*16)return{offset:t,size:e};d=[];for(let v=0;v<g;v++)d.push(new Uint8Array(a,t+32+v*16,16));m=32+g*16}if(!m)return{offset:t,size:e};const p=r.getUint32(m);return e-32<p?{offset:t,size:e}:(h=new Uint8Array(a,t+m+4,p),{version:n,systemId:u,kids:d,data:h,offset:t,size:e})}const Av=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ra={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Ef(r,e){const t=Ra[e];return!!t&&!!t[r.slice(0,4)]}function $o(r,e,t=!0){return!r.split(",").some(s=>!Tf(s,e,t))}function Tf(r,e,t=!0){var s;const i=rn(t);return(s=i==null?void 0:i.isTypeSupported(Mo(r,e)))!=null?s:!1}function Mo(r,e){return`${e}/mp4;codecs=${r}`}function f0(r){if(r){const e=r.substring(0,4);return Ra.video[e]}return 2}function Cc(r){const e=Av();return r.split(",").reduce((t,s)=>{const n=e&&qc(s)?9:Ra.video[s];return n?(n*2+t)/(t?3:2):(Ra.audio[s]+t)/(t?2:1)},0)}const th={};function T_(r,e=!0){if(th[r])return th[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let i=0;i<t.length;i++){var s;if(Tf(t[i],"audio",e))return th[r]=t[i],t[i];if(t[i]==="mp3"&&(s=rn(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return r}const __=/flac|opus|mp4a\.40\.34/i;function jc(r,e=!0){return r.replace(__,t=>T_(t.toLowerCase(),e))}function k_(r,e){const t=[];if(r){const s=r.split(",");for(let i=0;i<s.length;i++)Ef(s[i],"video")||t.push(s[i])}return e&&t.push(e),t.join(",")}function yc(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(m0(r,"audio")||m0(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let s=t.length;s--;)if(t[s].substring(0,4)===r.substring(0,4))return t[s]}return t[0]}}return e||r}function m0(r,e){return Ef(r,e)&&Tf(r,e)}function A_(r){const e=r.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function I_(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return r}function p0(r){const e=rn(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Kh(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const L_={supported:!0,powerEfficient:!0,smooth:!0},R_={supported:!1,smooth:!1,powerEfficient:!1},Iv={supported:!0,configurations:[],decodingInfoResults:[L_]};function Lv(r,e){return{supported:!1,configurations:e,decodingInfoResults:[R_],error:r}}function N_(r,e,t,s,i,n){const a=r.videoCodec,u=r.audioCodec?r.audioGroups:null,d=n==null?void 0:n.audioCodec,h=n==null?void 0:n.channels,m=h?parseInt(h):d?1/0:2;let p=null;if(u!=null&&u.length)try{u.length===1&&u[0]?p=e.groups[u[0]].channels:p=u.reduce((g,v)=>{if(v){const y=e.groups[v];if(!y)throw new Error(`Audio track group ${v} not found`);Object.keys(y.channels).forEach(S=>{g[S]=(g[S]||0)+y.channels[S]})}return g},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(g=>qc(g))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(s,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(i,8e6))||!!p&&Ae(m)&&Object.keys(p).some(g=>parseInt(g)>m)}function Rv(r,e,t,s={}){const i=r.videoCodec;if(!i&&!r.audioCodec||!t)return Promise.resolve(Iv);const n=[],a=C_(r),u=a.length,d=j_(r,e,u>0),h=d.length;for(let m=u||1*h||1;m--;){const p={type:"media-source"};if(u&&(p.video=a[m%u]),h){p.audio=d[m%h];const g=p.audio.bitrate;p.video&&g&&(p.video.bitrate-=g)}n.push(p)}if(i){const m=navigator.userAgent;if(i.split(",").some(p=>qc(p))&&Av())return Promise.resolve(Lv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${m})`),n))}return Promise.all(n.map(m=>{const p=D_(m);return s[p]||(s[p]=t.decodingInfo(m))})).then(m=>({supported:!m.some(p=>!p.supported),configurations:n,decodingInfoResults:m})).catch(m=>({supported:!1,configurations:n,decodingInfoResults:[],error:m}))}function C_(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),s=Nv(r),i=r.width||640,n=r.height||480,a=r.frameRate||30,u=r.videoRange.toLowerCase();return t?t.map(d=>{const h={contentType:Mo(I_(d),"video"),width:i,height:n,bitrate:s,framerate:a};return u!=="sdr"&&(h.transferFunction=u),h}):[]}function j_(r,e,t){var s;const i=(s=r.audioCodec)==null?void 0:s.split(","),n=Nv(r);return i&&r.audioGroups?r.audioGroups.reduce((a,u)=>{var d;const h=u?(d=e.groups[u])==null?void 0:d.tracks:null;return h?h.reduce((m,p)=>{if(p.groupId===u){const g=parseFloat(p.channels||"");i.forEach(v=>{const y={contentType:Mo(v,"audio"),bitrate:t?P_(v,n):n};g&&(y.channels=""+g),m.push(y)})}return m},a):a},[]):[]}function P_(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Nv(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function D_(r){let e="";const{audio:t,video:s}=r;if(s){const i=Kh(s.contentType);e+=`${i}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const i=Kh(t.contentType);e+=`${s?"_":""}${i}_c${t.channels}`}return e}const Wh=["NONE","TYPE-0","TYPE-1",null];function O_(r){return Wh.indexOf(r)>-1}const Pc=["SDR","PQ","HLG"];function $_(r){return!!r&&Pc.indexOf(r)>-1}var bc={No:"",Yes:"YES",v2:"v2"};function g0(r){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=r,i=s<e/2;return e&&i?t?bc.v2:bc.Yes:bc.No}class x0{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Fo{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return v0(this._audioGroups,e)}hasSubtitleGroup(e){return v0(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function v0(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function M_(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function F_(r,e){let t=!1,s=[];if(r&&(t=r!=="SDR",s=[r]),e){s=e.allowedVideoRanges||Pc.slice(0);const i=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&M_(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const U_=r=>{const e=new WeakSet;return(t,s)=>{if(r&&(s=r(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Lt=(r,e)=>JSON.stringify(r,U_(e));function B_(r,e,t,s,i){const n=Object.keys(r),a=s==null?void 0:s.channels,u=s==null?void 0:s.audioCodec,d=i==null?void 0:i.videoCodec,h=a&&parseInt(a)===2;let m=!1,p=!1,g=1/0,v=1/0,y=1/0,S=1/0,b=0,T=[];const{preferHDR:_,allowedVideoRanges:k}=F_(e,i);for(let O=n.length;O--;){const j=r[n[O]];m||(m=j.channels[2]>0),g=Math.min(g,j.minHeight),v=Math.min(v,j.minFramerate),y=Math.min(y,j.minBitrate),k.filter(G=>j.videoRanges[G]>0).length>0&&(p=!0)}g=Ae(g)?g:0,v=Ae(v)?v:0;const I=Math.max(1080,g),C=Math.max(30,v);y=Ae(y)?y:t,t=Math.max(y,t),p||(e=void 0);const $=n.length>1;return{codecSet:n.reduce((O,j)=>{const D=r[j];if(j===O)return O;if(T=p?k.filter(G=>D.videoRanges[G]>0):[],$){if(D.minBitrate>t)return Qr(j,`min bitrate of ${D.minBitrate} > current estimate of ${t}`),O;if(!D.hasDefaultAudio)return Qr(j,"no renditions with default or auto-select sound found"),O;if(u&&j.indexOf(u.substring(0,4))%5!==0)return Qr(j,`audio codec preference "${u}" not found`),O;if(a&&!h){if(!D.channels[a])return Qr(j,`no renditions with ${a} channel sound found (channels options: ${Object.keys(D.channels)})`),O}else if((!u||h)&&m&&D.channels[2]===0)return Qr(j,"no renditions with stereo sound found"),O;if(D.minHeight>I)return Qr(j,`min resolution of ${D.minHeight} > maximum of ${I}`),O;if(D.minFramerate>C)return Qr(j,`min framerate of ${D.minFramerate} > maximum of ${C}`),O;if(!T.some(G=>D.videoRanges[G]>0))return Qr(j,`no variants with VIDEO-RANGE of ${Lt(T)} found`),O;if(d&&j.indexOf(d.substring(0,4))%5!==0)return Qr(j,`video codec preference "${d}" not found`),O;if(D.maxScore<b)return Qr(j,`max score of ${D.maxScore} < selected max of ${b}`),O}return O&&(Cc(j)>=Cc(O)||D.fragmentError>r[O].fragmentError)?O:(S=D.minIndex,b=D.maxScore,j)},void 0),videoRanges:T,preferHDR:_,minFramerate:v,minBitrate:y,minIndex:S}}function Qr(r,e){Tt.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function Cv(r){return r.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function z_(r,e,t,s){return r.slice(t,s+1).reduce((i,n,a)=>{if(!n.codecSet)return i;const u=n.audioGroups;let d=i[n.codecSet];d||(i[n.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,n.bitrate);const h=Math.min(n.height,n.width);return d.minHeight=Math.min(d.minHeight,h),d.minFramerate=Math.min(d.minFramerate,n.frameRate),d.minIndex=Math.min(d.minIndex,a),d.maxScore=Math.max(d.maxScore,n.score),d.fragmentError+=n.fragmentError,d.videoRanges[n.videoRange]=(d.videoRanges[n.videoRange]||0)+1,u&&u.forEach(m=>{if(!m)return;const p=e.groups[m];p&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(g=>{d.channels[g]=(d.channels[g]||0)+p.channels[g]}))}),i},{})}function y0(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:n}=r;return{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:n}}function si(r,e,t){if("attrs"in r){const s=e.indexOf(r);if(s!==-1)return s}for(let s=0;s<e.length;s++){const i=e[s];if(Rn(r,i,t))return s}return-1}function Rn(r,e,t){const{groupId:s,name:i,lang:n,assocLang:a,default:u}=r,d=r.forced;return(s===void 0||e.groupId===s)&&(i===void 0||e.name===i)&&(n===void 0||G_(n,e.lang))&&(n===void 0||e.assocLang===a)&&(u===void 0||e.default===u)&&(d===void 0||e.forced===d)&&(!("characteristics"in r)||V_(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function G_(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function V_(r,e=""){const t=r.split(","),s=e.split(",");return t.length===s.length&&!t.some(i=>s.indexOf(i)===-1)}function kn(r,e){const{audioCodec:t,channels:s}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function K_(r,e,t,s,i){const n=e[s],u=e.reduce((g,v,y)=>{const S=v.uri;return(g[S]||(g[S]=[])).push(y),g},{})[n.uri];u.length>1&&(s=Math.max.apply(Math,u));const d=n.videoRange,h=n.frameRate,m=n.codecSet.substring(0,4),p=b0(e,s,g=>{if(g.videoRange!==d||g.frameRate!==h||g.codecSet.substring(0,4)!==m)return!1;const v=g.audioGroups,y=t.filter(S=>!v||v.indexOf(S.groupId)!==-1);return si(r,y,i)>-1});return p>-1?p:b0(e,s,g=>{const v=g.audioGroups,y=t.filter(S=>!v||v.indexOf(S.groupId)!==-1);return si(r,y,i)>-1})}function b0(r,e,t){for(let s=e;s>-1;s--)if(t(r[s]))return s;for(let s=e+1;s<r.length;s++)if(t(r[s]))return s;return-1}function Dc(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class W_ extends Ar{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:i,partCurrent:n,hls:a}=this,{autoLevelEnabled:u,media:d}=a;if(!i||!d)return;const h=performance.now(),m=n?n.stats:i.stats,p=n?n.duration:i.duration,g=h-m.loading.start,v=a.minAutoLevel,y=i.level,S=this._nextAutoLevel;if(m.aborted||m.loaded&&m.loaded===m.total||y<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const b=S>-1&&S!==y,T=!!t||b;if(!T&&(d.paused||!d.playbackRate||!d.readyState))return;const _=a.mainForwardBufferInfo;if(!T&&_===null)return;const k=this.bwEstimator.getEstimateTTFB(),I=Math.abs(d.playbackRate);if(g<=Math.max(k,1e3*(p/(I*2))))return;const C=_?_.len/I:0,$=m.loading.first?m.loading.first-m.loading.start:-1,N=m.loaded&&$>-1,O=this.getBwEstimate(),j=a.levels,D=j[y],G=Math.max(m.loaded,Math.round(p*(i.bitrate||D.averageBitrate)/8));let X=N?g-$:g;X<1&&N&&(X=Math.min(g,m.loaded*8/O));const K=N?m.loaded*1e3/X:0,W=k/1e3,te=K?(G-m.loaded)/K:G*8/O+W;if(te<=C)return;const z=K?K*8:O,M=((s=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,F=this.hls.config.abrBandWidthUpFactor;let H=Number.POSITIVE_INFINITY,Y;for(Y=y-1;Y>v;Y--){const ie=j[Y].maxBitrate,ne=!j[Y].details||M;if(H=this.getTimeToLoadFrag(W,z,p*ie,ne),H<Math.min(C,p+W))break}if(H>=te||H>p*10)return;N?this.bwEstimator.sample(g-Math.min(k,$),m.loaded):this.bwEstimator.sampleTTFB(g);const P=j[Y].maxBitrate;this.getBwEstimate()*F>P&&this.resetEstimator(P);const B=this.findBestLevel(P,v,Y,0,C,1,1);B>-1&&(Y=B),this.warn(`Fragment ${i.sn}${n?" part "+n.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${C.toFixed(3)} s
      Estimated load time for current fragment: ${te.toFixed(3)} s
      Estimated load time for down switch fragment: ${H.toFixed(3)} s
      TTFB estimate: ${$|0} ms
      Current BW estimate: ${Ae(O)?O|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Y} @ ${P|0} bps`),a.nextLoadLevel=a.nextAutoLevel=Y,this.clearTimer();const oe=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===Y&&Y>0){const ie=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Y>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${ie.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,Y>v){let ne=this.findBestLevel(this.hls.levels[v].bitrate,v,Y,0,ie,1,1);ne===-1&&(ne=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ne,this.resetEstimator(this.hls.levels[ne].bitrate)}}};b||te>H*2?oe():this.timer=self.setInterval(oe,H*1e3),a.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:n,stats:m})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new XT(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(A.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var i;this.fragCurrent=s,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Z.BUFFER_ADD_CODEC_ERROR:case Z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Z.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:i,partCurrent:n}=this;if(s&&i&&s.sn===i.sn&&s.level===i.level){const a=performance.now(),u=n?n.stats:s.stats,d=a-u.loading.start,h=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&h>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(p,h),u.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,s,i){const n=e+s/t,a=i?e+this.lastLevelLoadSec:0;return n+a}onLevelLoaded(e,t){const s=this.hls.config,{loading:i}=t.stats,n=i.end-i.first;Ae(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===Ce.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const n=s?s.duration:t.duration,a=this.hls.levels[t.level],u=(a.loaded?a.loaded.bytes:0)+i.loaded,d=(a.loaded?a.loaded.duration:0)+n;a.loaded={bytes:u,duration:d},a.realBitrate=Math.round(8*u/d)}if(t.bitrateTest){const n={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(A.FRAG_BUFFERED,n),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,n=i!=null&&i.stats.loaded?i.stats:s.stats;if(n.aborted||this.ignoreFragment(s))return;const a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ce.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,n=this.findBestLevel(s,t,e,0,i,1,1);if(n>-1)return n;const a=this.hls.firstLevel,u=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const n=s&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,n)&&a[e].loadError<=a[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:n,minAutoLevel:a}=s,u=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay();let m=n.abrBandWidthFactor,p=n.abrBandWidthUpFactor;if(h){const b=this.findBestLevel(d,a,i,h,0,m,p);if(b>=0)return this.rebufferNotice=-1,b}let g=u?Math.min(u,n.maxStarvationDelay):n.maxStarvationDelay;if(!h){const b=this.bitrateTestDelay;b&&(g=(u?Math.min(u,n.maxLoadingDelay):n.maxLoadingDelay)-b,this.info(`bitrate test took ${Math.round(1e3*b)}ms, set first fragment max fetchDuration to ${Math.round(1e3*g)} ms`),m=p=1)}const v=this.findBestLevel(d,a,i,h,g,m,p);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const y=s.levels[a],S=s.loadLevelObj;return S&&(y==null?void 0:y.bitrate)<S.bitrate?a:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,i,n,a,u){var d;const h=i+n,m=this.lastLoadedFragLevel,p=m===-1?this.hls.firstLevel:m,{fragCurrent:g,partCurrent:v}=this,{levels:y,allAudioTracks:S,loadLevel:b,config:T}=this.hls;if(y.length===1)return 0;const _=y[p],k=!!((d=this.hls.latestLevelDetails)!=null&&d.live),I=b===-1||m===-1;let C,$="SDR",N=(_==null?void 0:_.frameRate)||0;const{audioPreference:O,videoPreference:j}=T,D=this.audioTracksByGroup||(this.audioTracksByGroup=Cv(S));let G=-1;if(I){if(this.firstSelection!==-1)return this.firstSelection;const z=this.codecTiers||(this.codecTiers=z_(y,D,t,s)),M=B_(z,$,e,O,j),{codecSet:F,videoRanges:H,minFramerate:Y,minBitrate:P,minIndex:B,preferHDR:oe}=M;G=B,C=F,$=oe?H[H.length-1]:H[0],N=Y,e=Math.max(e,P),this.log(`picked start tier ${Lt(M)}`)}else C=_==null?void 0:_.codecSet,$=_==null?void 0:_.videoRange;const X=v?v.duration:g?g.duration:0,K=this.bwEstimator.getEstimateTTFB()/1e3,W=[];for(let z=s;z>=t;z--){var te;const M=y[z],F=z>p;if(!M)continue;if(T.useMediaCapabilities&&!M.supportedResult&&!M.supportedPromise){const ne=navigator.mediaCapabilities;typeof(ne==null?void 0:ne.decodingInfo)=="function"&&N_(M,D,$,N,e,O)?(M.supportedPromise=Rv(M,D,ne,this.supportedCache),M.supportedPromise.then(le=>{if(!this.hls)return;M.supportedResult=le;const _e=this.hls.levels,Se=_e.indexOf(M);le.error?this.warn(`MediaCapabilities decodingInfo error: "${le.error}" for level ${Se} ${Lt(le)}`):le.supported?le.decodingInfoResults.some(Fe=>Fe.smooth===!1||Fe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Se} not smooth or powerEfficient: ${Lt(le)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Se} ${Lt(le)}`),Se>-1&&_e.length>1&&(this.log(`Removing unsupported level ${Se}`),this.hls.removeLevel(Se),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(le=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${le}`)})):M.supportedResult=Iv}if((C&&M.codecSet!==C||$&&M.videoRange!==$||F&&N>M.frameRate||!F&&N>0&&N<M.frameRate||(te=M.supportedResult)!=null&&(te=te.decodingInfoResults)!=null&&te.some(ne=>ne.smooth===!1))&&(!I||z!==G)){W.push(z);continue}const H=M.details,Y=(v?H==null?void 0:H.partTarget:H==null?void 0:H.averagetargetduration)||X;let P;F?P=u*e:P=a*e;const B=X&&i>=X*2&&n===0?M.averageBitrate:M.maxBitrate,oe=this.getTimeToLoadFrag(K,P,B*Y,H===void 0);if(P>=B&&(z===m||M.loadError===0&&M.fragmentError===0)&&(oe<=K||!Ae(oe)||k&&!this.bitrateTestDelay||oe<h)){const ne=this.forcedAutoLevel;return z!==b&&(ne===-1||ne!==b)&&(W.length&&this.trace(`Skipped level(s) ${W.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${y[W[0]].codecs}" ${y[W[0]].videoRange}; not compatible with "${C}" ${$}`),this.info(`switch candidate:${p}->${z} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-B)} ttfb:${K.toFixed(1)} avgDuration:${Y.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${oe.toFixed(1)} firstSelection:${I} codecSet:${M.codecSet} videoRange:${M.videoRange} hls.loadLevel:${b}`)),I&&(this.firstSelection=z),z}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const jv={search:function(r,e){let t=0,s=r.length-1,i=null,n=null;for(;t<=s;){i=(t+s)/2|0,n=r[i];const a=e(n);if(a>0)t=i+1;else if(a<0)s=i-1;else return n}return null}};function H_(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!Ae(e))return null;const s=r[0].programDateTime;if(e<(s||0))return null;const i=r[r.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let n=0;n<r.length;++n){const a=r[n];if(Y_(e,t,a))return a}return null}function Nn(r,e,t=0,s=0,i=.005){let n=null;if(r){n=e[1+r.sn-e[0].sn]||null;const u=r.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),n&&r.level!==n.level&&n.end<=r.end&&(n=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(n=e[0]);if(n&&((!r||r.level===n.level)&&w0(t,s,n)===0||q_(n,r,Math.min(i,s))))return n;const a=jv.search(e,w0.bind(null,t,s));return a&&(a!==r||!n)?a:n}function q_(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((i,n)=>(n[0]==="INF"&&(i+=parseFloat(n[1])),i),t);return r.start<=s}return!1}function w0(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=r?1:t.start-s>r&&t.start?-1:0}function Y_(r,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>r}function Pv(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let s=r.fragments;const{fragmentHint:i}=r;i&&(s=s.concat(i));let n;return jv.search(s,a=>a.cc<e?1:a.cc>e?-1:(n=a,a.end<=t?1:a.start>t?-1:0)),n||null}return null}function Oc(r){switch(r.details){case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_TIMEOUT:case Z.LEVEL_LOAD_TIMEOUT:case Z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Dv(r){return r.details.startsWith("key")}function Ov(r){return Dv(r)&&!!r.frag&&!r.frag.decryptdata}function S0(r,e){const t=Oc(e);return r.default[`${t?"timeout":"error"}Retry`]}function _f(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function E0(r){return Et(Et({},r),{errorRetry:null,timeoutRetry:null})}function $c(r,e,t,s){if(!r)return!1;const i=s==null?void 0:s.code,n=e<r.maxNumRetry&&(Q_(i)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,s,n):n}function Q_(r){return Hh(r)||!!r&&(r<400||r>499)}function Hh(r){return r===0&&navigator.onLine===!1}var js={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},ur={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class X_ extends Ar{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.ERROR,this.onError,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.ERROR,this.onError,this),e.off(A.ERROR,this.onErrorOut,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Ce.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var u;return(u=a.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,n=t.context;switch(t.details){case Z.FRAG_LOAD_ERROR:case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_ERROR:case Z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Z.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=ka();return}case Z.FRAG_GAP:case Z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=js.SendAlternateToPenaltyBox;return}case Z.LEVEL_EMPTY_ERROR:case Z.LEVEL_PARSING_ERROR:{var a;const d=t.parent===Ce.MAIN?t.level:i.loadLevel;t.details===Z.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case Z.LEVEL_LOAD_ERROR:case Z.LEVEL_LOAD_TIMEOUT:typeof(n==null?void 0:n.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level));return;case Z.AUDIO_TRACK_LOAD_ERROR:case Z.AUDIO_TRACK_LOAD_TIMEOUT:case Z.SUBTITLE_LOAD_ERROR:case Z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const d=i.loadLevelObj;if(d&&(n.type===ut.AUDIO_TRACK&&d.hasAudioGroup(n.groupId)||n.type===ut.SUBTITLE_TRACK&&d.hasSubtitleGroup(n.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=js.SendAlternateToPenaltyBox,t.errorAction.flags=ur.MoveAllAlternatesMatchingHost;return}}return;case Z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:js.SendAlternateToPenaltyBox,flags:ur.MoveAllAlternatesMatchingHDCP};return;case Z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Z.KEY_SYSTEM_NO_SESSION:t.errorAction={action:js.SendAlternateToPenaltyBox,flags:ur.MoveAllAlternatesMatchingKey};return;case Z.BUFFER_ADD_CODEC_ERROR:case Z.REMUX_ALLOC_ERROR:case Z.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:i.loadLevel)}return;case Z.INTERNAL_EXCEPTION:case Z.BUFFER_APPENDING_ERROR:case Z.BUFFER_FULL_ERROR:case Z.LEVEL_SWITCH_ERROR:case Z.BUFFER_STALLED_ERROR:case Z.BUFFER_SEEK_OVER_HOLE:case Z.BUFFER_NUDGE_ON_STALL:t.errorAction=ka();return}t.type===Ue.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ka())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,i=S0(s.config.playlistLoadPolicy,e),n=this.playlistError++;if($c(i,n,Oc(e),e.response))return{action:js.RetryRequest,flags:ur.None,retryConfig:i,retryCount:n};const u=this.getLevelSwitchAction(e,t);return i&&(u.retryConfig=i,u.retryCount=n),u}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:n,keyLoadPolicy:a}=t.config,u=S0(Dv(e)?a:n,e),d=t.levels.reduce((m,p)=>m+p.fragmentError,0);if(i&&(e.details!==Z.FRAG_GAP&&i.fragmentError++,!Ov(e)&&$c(u,d,Oc(e),e.response)))return{action:js.RetryRequest,flags:ur.None,retryConfig:u,retryCount:d};const h=this.getLevelSwitchAction(e,s);return u&&(h.retryConfig=u,h.retryCount=d),h}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var n,a;const h=e.details;i.loadError++,h===Z.BUFFER_APPEND_ERROR&&i.fragmentError++;let m=-1;const{levels:p,loadLevel:g,minAutoLevel:v,maxAutoLevel:y}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const S=(n=e.frag)==null?void 0:n.type,T=(S===Ce.AUDIO&&h===Z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===Z.BUFFER_ADD_CODEC_ERROR||h===Z.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:$})=>i.audioCodec!==$),k=e.sourceBufferName==="video"&&(h===Z.BUFFER_ADD_CODEC_ERROR||h===Z.BUFFER_APPEND_ERROR)&&p.some(({codecSet:$,audioCodec:N})=>i.codecSet!==$&&i.audioCodec===N),{type:I,groupId:C}=(a=e.context)!=null?a:{};for(let $=p.length;$--;){const N=($+g)%p.length;if(N!==g&&N>=v&&N<=y&&p[N].loadError===0){var u,d;const O=p[N];if(h===Z.FRAG_GAP&&S===Ce.MAIN&&e.frag){const j=p[N].details;if(j){const D=Nn(e.frag,j.fragments,e.frag.start);if(D!=null&&D.gap)continue}}else{if(I===ut.AUDIO_TRACK&&O.hasAudioGroup(C)||I===ut.SUBTITLE_TRACK&&O.hasSubtitleGroup(C))continue;if(S===Ce.AUDIO&&(u=i.audioGroups)!=null&&u.some(j=>O.hasAudioGroup(j))||S===Ce.SUBTITLE&&(d=i.subtitleGroups)!=null&&d.some(j=>O.hasSubtitleGroup(j))||T&&i.audioCodec===O.audioCodec||k&&i.codecSet===O.codecSet||!T&&i.codecSet!==O.codecSet)continue}m=N;break}}if(m>-1&&s.loadLevel!==m)return e.levelRetry=!0,this.playlistError=0,{action:js.SendAlternateToPenaltyBox,flags:ur.None,nextAutoLevel:m}}return{action:js.SendAlternateToPenaltyBox,flags:ur.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case js.DoNothing:break;case js.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i}=s,n=s.nextAutoLevel;switch(i){case ur.None:this.switchLevel(e,n);break;case ur.MoveAllAlternatesMatchingHDCP:{const d=this.getVariantLevelIndex(e.frag),h=t.levels[d],m=h==null?void 0:h.attrs["HDCP-LEVEL"];if(s.hdcpLevel=m,m==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(m){t.maxHdcpLevel=Wh[Wh.indexOf(m)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case ur.MoveAllAlternatesMatchingKey:{const d=e.decryptdata;if(d){const h=this.hls.levels,m=h.length;for(let g=m;g--;)if(this.variantHasKey(h[g],d)){var a,u;this.log(`Banned key found in level ${g} (${h[g].bitrate}bps) or audio group "${(a=h[g].audioGroups)==null?void 0:a.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${Ps(d.keyId||[])}`),h[g].fragmentError++,h[g].loadError++,this.log(`Removing level ${g} with key error (${e.error})`),this.hls.removeLevel(g)}const p=e.frag;if(this.hls.levels.length<m)s.resolved=!0;else if(p&&p.type!==Ce.MAIN){const g=p.decryptdata;g&&!d.matches(g)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Kh(e.mimeType),i=this.hls.levels;for(let n=i.length;n--;)i[n][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${n} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(n))}}}function ka(r){const e={action:js.DoNothing,flags:ur.None};return r&&(e.resolved=!0),e}var xs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class J_{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let i=s.length;i--;){const n=s[i];if(!n)break;if(n.start<=e&&e<=n.end&&n.loaded)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,n=Object.keys(i);for(let a=n.length;a--;){const u=i[n[a]];if((u==null?void 0:u.body.type)===t&&(!s||u.buffered)){const d=u.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,s,i,n){this.timeRanges&&(this.timeRanges[e]=t);const a=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const d=this.fragments[u];if(!d||a>=d.body.sn)return;if(!d.buffered&&(!d.loaded||n)){d.body.type===s&&this.removeFragment(d.body);return}const h=d.range[e];if(h){if(h.time.length===0){this.removeFragment(d.body);return}h.time.some(m=>{const p=!this.isTimeBuffered(m.startPTS,m.endPTS,t);return p&&this.removeFragment(d.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,i=fa(s),n=this.fragments[i];if(!n||n.buffered&&s.gap)return;const a=!s.relurl;Object.keys(t).forEach(u=>{const d=s.elementaryStreams[u];if(!d)return;const h=t[u],m=a||d.partial===!0;n.range[u]=this.getBufferedTimes(s,e.part,m,h)}),n.loaded=null,Object.keys(n.range).length?(this.bufferedEnd(n,s),rc(n)||this.removeParts(s.sn-1,s.type)):this.removeFragment(n.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=T0(s,i=>i.fragment.sn>=e))}fragBuffered(e,t){const s=fa(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,s,i){const n={time:[],partial:s},a=e.start,u=e.end,d=e.minEndPTS||u,h=e.maxStartPTS||a;for(let m=0;m<i.length;m++){const p=i.start(m)-this.bufferPadding,g=i.end(m)+this.bufferPadding;if(h>=p&&d<=g){n.time.push({startPTS:Math.max(a,i.start(m)),endPTS:Math.min(u,i.end(m))});break}else if(a<g&&u>p){const v=Math.max(a,i.start(m)),y=Math.min(u,i.end(m));y>v&&(n.partial=!0,n.time.push({startPTS:v,endPTS:y}))}else if(u<=p)break}return n}getPartialFragment(e){let t=null,s,i,n,a=0;const{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(h=>{const m=d[h];m&&rc(m)&&(i=m.body.start-u,n=m.body.end+u,e>=i&&e<=n&&(s=Math.min(e-i,n-e),a<=s&&(t=m.body,a=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||rc(t))}getState(e){const t=fa(e),s=this.fragments[t];return s?s.buffered?rc(s)?xs.PARTIAL:xs.OK:xs.APPENDING:xs.NOT_LOADED}isTimeBuffered(e,t,s){let i,n;for(let a=0;a<s.length;a++){if(i=s.start(a)-this.bufferPadding,n=s.end(a)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,n=fa(s);this.fragments[n]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:n,type:a}=t;if(s.sn==="initSegment")return;const u=s.type;if(i){let h=this.activePartLists[u];h||(this.activePartLists[u]=h=[]),h.push(i)}this.timeRanges=n;const d=n[a];this.detectEvictedFragments(a,d,u,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=fa(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const n=t[s[i]];if((n==null?void 0:n.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,i,n){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const u=this.fragments[a];if(!u)return;const d=u.body;d.type!==s||i&&!d.gap||d.start<t&&d.end>e&&(u.buffered||n)&&this.removeFragment(d)})}removeFragment(e){const t=fa(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const i=e.sn;this.activePartLists[e.type]=T0(s,n=>n.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function rc(r){var e,t,s;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(s=r.range.audiovideo)!=null&&s.partial)}function fa(r){return`${r.type}_${r.level}_${r.sn}`}function T0(r,e){return r.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var nn={cbc:0,ctr:1};class Z_{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case nn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case nn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function ek(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class tk{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let i=0;i<4;i++)s[i]=t.getUint32(i*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],n=s[1],a=s[2],u=s[3],d=this.invSubMix,h=d[0],m=d[1],p=d[2],g=d[3],v=new Uint32Array(256);let y=0,S=0,b=0;for(b=0;b<256;b++)b<128?v[b]=b<<1:v[b]=b<<1^283;for(b=0;b<256;b++){let T=S^S<<1^S<<2^S<<3^S<<4;T=T>>>8^T&255^99,e[y]=T,t[T]=y;const _=v[y],k=v[_],I=v[k];let C=v[T]*257^T*16843008;i[y]=C<<24|C>>>8,n[y]=C<<16|C>>>16,a[y]=C<<8|C>>>24,u[y]=C,C=I*16843009^k*65537^_*257^y*16843008,h[T]=C<<24|C>>>8,m[T]=C<<16|C>>>16,p[T]=C<<8|C>>>24,g[T]=C,y?(y=_^v[v[v[I^_]]],S^=v[v[S]]):y=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);const a=this.ksRows=(n+6+1)*4;let u,d;const h=this.keySchedule=new Uint32Array(a),m=this.invKeySchedule=new Uint32Array(a),p=this.sBox,g=this.rcon,v=this.invSubMix,y=v[0],S=v[1],b=v[2],T=v[3];let _,k;for(u=0;u<a;u++){if(u<n){_=h[u]=t[u];continue}k=_,u%n===0?(k=k<<8|k>>>24,k=p[k>>>24]<<24|p[k>>>16&255]<<16|p[k>>>8&255]<<8|p[k&255],k^=g[u/n|0]<<24):n>6&&u%n===4&&(k=p[k>>>24]<<24|p[k>>>16&255]<<16|p[k>>>8&255]<<8|p[k&255]),h[u]=_=(h[u-n]^k)>>>0}for(d=0;d<a;d++)u=a-d,d&3?k=h[u]:k=h[u-4],d<4||u<=4?m[d]=k:m[d]=y[p[k>>>24]]^S[p[k>>>16&255]]^b[p[k>>>8&255]]^T[p[k&255]],m[d]=m[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,n=this.invKeySchedule,a=this.invSBox,u=this.invSubMix,d=u[0],h=u[1],m=u[2],p=u[3],g=this.uint8ArrayToUint32Array_(s);let v=g[0],y=g[1],S=g[2],b=g[3];const T=new Int32Array(e),_=new Int32Array(T.length);let k,I,C,$,N,O,j,D,G,X,K,W,te,z;const M=this.networkToHostOrderSwap;for(;t<T.length;){for(G=M(T[t]),X=M(T[t+1]),K=M(T[t+2]),W=M(T[t+3]),N=G^n[0],O=W^n[1],j=K^n[2],D=X^n[3],te=4,z=1;z<i;z++)k=d[N>>>24]^h[O>>16&255]^m[j>>8&255]^p[D&255]^n[te],I=d[O>>>24]^h[j>>16&255]^m[D>>8&255]^p[N&255]^n[te+1],C=d[j>>>24]^h[D>>16&255]^m[N>>8&255]^p[O&255]^n[te+2],$=d[D>>>24]^h[N>>16&255]^m[O>>8&255]^p[j&255]^n[te+3],N=k,O=I,j=C,D=$,te=te+4;k=a[N>>>24]<<24^a[O>>16&255]<<16^a[j>>8&255]<<8^a[D&255]^n[te],I=a[O>>>24]<<24^a[j>>16&255]<<16^a[D>>8&255]<<8^a[N&255]^n[te+1],C=a[j>>>24]<<24^a[D>>16&255]<<16^a[N>>8&255]<<8^a[O&255]^n[te+2],$=a[D>>>24]<<24^a[N>>16&255]<<16^a[O>>8&255]<<8^a[j&255]^n[te+3],_[t]=M(k^v),_[t+1]=M($^y),_[t+2]=M(C^S),_[t+3]=M(I^b),v=G,y=X,S=K,b=W,t=t+4}return _.buffer}}class sk{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=rk(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function rk(r){switch(r){case nn.cbc:return"AES-CBC";case nn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const ik=16;class kf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?ek(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise((n,a)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,s,i);const d=this.flush();d?n(d.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:n,currentResult:a,remainderData:u}=this;if(i!==nn.cbc||t.byteLength!==16)return Tt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=_r(u,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;n&&(s=n);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new tk),h.expandKey(t);const m=a;return this.currentResult=h.decrypt(d.buffer,0,s),this.currentIV=d.slice(-16).buffer,m||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new sk(this.subtle,t,i)}return this.fastAesKey.expandKey().then(n=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Z_(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(Tt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,s,i)))}onWebCryptoError(e,t,s,i){const n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%ik;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Tt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const _0=Math.pow(2,17);class nk{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new wi({type:Ue.NETWORK_ERROR,details:Z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,n=i.fLoader,a=i.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){d(A0(e));return}else e.gap=!1;const h=this.loader=n?new n(i):new a(i),m=k0(e);e.loader=h;const p=E0(i.fragLoadPolicy.default),g={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:_0};e.stats=h.stats;const v={onSuccess:(y,S,b,T)=>{this.resetLoader(e,h);let _=y.data;b.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),u({frag:e,part:null,payload:_,networkDetails:T})},onError:(y,S,b,T)=>{this.resetLoader(e,h),d(new wi({type:Ue.NETWORK_ERROR,details:Z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Et({url:s,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:b,stats:T}))},onAbort:(y,S,b)=>{this.resetLoader(e,h),d(new wi({type:Ue.NETWORK_ERROR,details:Z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:b,stats:y}))},onTimeout:(y,S,b)=>{this.resetLoader(e,h),d(new wi({type:Ue.NETWORK_ERROR,details:Z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:b,stats:y}))}};t&&(v.onProgress=(y,S,b,T)=>t({frag:e,part:null,payload:b,networkDetails:T})),h.load(m,g,v)})}loadPart(e,t,s){this.abort();const i=this.config,n=i.fLoader,a=i.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(A0(e,t));return}const h=this.loader=n?new n(i):new a(i),m=k0(e,t);e.loader=h;const p=E0(i.fragLoadPolicy.default),g={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:_0};t.stats=h.stats,h.load(m,g,{onSuccess:(v,y,S,b)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);const T={frag:e,part:t,payload:v.data,networkDetails:b};s(T),u(T)},onError:(v,y,S,b)=>{this.resetLoader(e,h),d(new wi({type:Ue.NETWORK_ERROR,details:Z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Et({url:m.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:S,stats:b}))},onAbort:(v,y,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),d(new wi({type:Ue.NETWORK_ERROR,details:Z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:v}))},onTimeout:(v,y,S)=>{this.resetLoader(e,h),d(new wi({type:Ue.NETWORK_ERROR,details:Z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:S,stats:v}))}})})}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,n=i.total;if(s.loaded+=i.loaded,n){const d=Math.round(e.duration/t.duration),h=Math.min(Math.round(s.loaded/n),d),p=(d-h)*Math.round(s.loaded/h);s.total=s.loaded+p}else s.total=Math.max(s.loaded,s.total);const a=s.loading,u=i.loading;a.start?a.first+=u.first-u.start:(a.start=u.start,a.first=u.first),a.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function k0(r,e=null){const t=e||r,s={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(Ae(i)&&Ae(n)){var a;let u=i,d=n;if(r.sn==="initSegment"&&ak((a=r.decryptdata)==null?void 0:a.method)){const h=n-i;h%16&&(d=n+(16-h%16)),i!==0&&(s.resetIV=!0,u=i-16)}s.rangeStart=u,s.rangeEnd=d}return s}function A0(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),s={type:Ue.MEDIA_ERROR,details:Z.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(s.part=e),(e||r).stats.aborted=!0,new wi(s)}function ak(r){return r==="AES-128"||r==="AES-256"}class wi extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class $v extends Ar{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Af{constructor(e,t,s,i=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ic(),this.buffering={audio:ic(),video:ic(),audiovideo:ic()},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=n,this.partial=a}}function ic(){return{start:0,executeStart:0,executeEnd:0,end:0}}const I0={length:0,start:()=>0,end:()=>0};class rt{static isBuffered(e,t){if(e){const s=rt.getBuffered(e);for(let i=s.length;i--;)if(t>=s.start(i)&&t<=s.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=rt.getBuffered(e);return rt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=rt.bufferedRanges(e);if(i.length)return rt.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((m,p)=>m.start-p.start||p.end-m.end);let i=-1,n=[];if(s)for(let m=0;m<e.length;m++){t>=e[m].start&&t<=e[m].end&&(i=m);const p=n.length;if(p){const g=n[p-1].end;e[m].start-g<s?e[m].end>g&&(n[p-1].end=e[m].end):n.push(e[m])}else n.push(e[m])}else n=e;let a=0,u,d=t,h=t;for(let m=0;m<n.length;m++){const p=n[m].start,g=n[m].end;if(i===-1&&t>=p&&t<=g&&(i=m),t+s>=p&&t<g)d=p,h=g,a=h-t;else if(t+s<p){u=p;break}}return{len:a,start:d||0,end:h||0,nextStart:u,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||I0}catch(t){return Tt.log("failed to get media.buffered",t),I0}}}const Mv=/\{\$([a-zA-Z0-9-_]+)\}/g;function L0(r){return Mv.test(r)}function qh(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(Mv,s=>{const i=s.substring(2,s.length-1),n=t==null?void 0:t[i];return n===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),s):n})}return e}function R0(r,e,t){let s=r.variableList;s||(r.variableList=s={});let i,n;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))n=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,n=e.VALUE;i in s?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):s[i]=n||""}function ok(r,e,t){const s=e.IMPORT;if(t&&s in t){let i=r.variableList;i||(r.variableList=i={}),i[s]=t[s]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const lk=/^(\d+)x(\d+)$/,N0=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Wt{constructor(e,t){typeof e=="string"&&(e=Wt.parseAttrList(e,t)),kt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)s[i]=parseInt(t.slice(i*2,i*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((i,n)=>(i[n.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=lk.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={};for(N0.lastIndex=0;(s=N0.exec(e))!==null;){const a=s[1].trim();let u=s[2];const d=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let h=!1;if(d)u=u.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(t&&(d||h))u=qh(t,u);else if(!h&&!d)switch(a){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Tt.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=u}return i}}const ck="com.apple.hls.interstitial";function uk(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function dk(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class Fv{constructor(e,t,s=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:s,t){const n=t.attr;for(const a in n)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==n[a]){Tt.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=kt(new Wt({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Ae(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Tt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ae(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===ck}get isValid(){return!!this.id&&!this._badValueForSameId&&Ae(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const hk=10;class fk{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?Ae(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||hk}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Mc(r,e){return r.length===e.length?!r.some((t,s)=>t!==e[s]):!1}function C0(r,e){return!r&&!e?!0:!r||!e?!1:Mc(r,e)}function Aa(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function If(r){switch(r){case"AES-128":case"AES-256":return nn.cbc;case"AES-256-CTR":return nn.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function Lf(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Yh(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function mk(r){const e=Yh(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Uv(r){const e=function(s,i,n){const a=s[i];s[i]=s[n],s[n]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function Bv(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),i=s[s.length-1].split(",");if(i.length===2){const n=i[0]==="base64",a=i[1];n?(s.splice(-1,1),t=Lf(a)):t=mk(a)}}return t}const Fc=typeof self<"u"?self:void 0;var qt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ds={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function wc(r){switch(r){case Ds.FAIRPLAY:return qt.FAIRPLAY;case Ds.PLAYREADY:return qt.PLAYREADY;case Ds.WIDEVINE:return qt.WIDEVINE;case Ds.CLEARKEY:return qt.CLEARKEY}}function sh(r){switch(r){case qt.FAIRPLAY:return Ds.FAIRPLAY;case qt.PLAYREADY:return Ds.PLAYREADY;case qt.WIDEVINE:return Ds.WIDEVINE;case qt.CLEARKEY:return Ds.CLEARKEY}}function bo(r){const{drmSystems:e,widevineLicenseUrl:t}=r,s=e?[qt.FAIRPLAY,qt.WIDEVINE,qt.PLAYREADY,qt.CLEARKEY].filter(i=>!!e[i]):[];return!s[qt.WIDEVINE]&&t&&s.push(qt.WIDEVINE),s}const zv=(function(r){return Fc!=null&&(r=Fc.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function pk(r,e,t,s){let i;switch(r){case qt.FAIRPLAY:i=["cenc","sinf"];break;case qt.WIDEVINE:case qt.PLAYREADY:i=["cenc"];break;case qt.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return gk(i,e,t,s)}function gk(r,e,t,s){return[{initDataTypes:r,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(n=>({contentType:`audio/mp4; codecs=${n}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(n=>({contentType:`video/mp4; codecs=${n}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function xk(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Gv(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(a){const u=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(u){const d=Lf(u).subarray(0,16);return Uv(d),d}}return null}let ma={};class sn{static clearKeyUriToKeyIdMap(){ma={}}static setKeyIdForUri(e,t){ma[e]=t}static addKeyIdForUri(e){const t=Object.keys(ma).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),ma[e]=s,s}constructor(e,t,s,i=[1],n=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=n,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Aa(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(xv(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Mc(e.keyFormatVersions,this.keyFormatVersions)&&C0(e.iv,this.iv)&&C0(e.keyId,this.keyId)}isSupported(){if(this.method){if(Aa(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ds.FAIRPLAY:case Ds.WIDEVINE:case Ds.PLAYREADY:case Ds.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Aa(this.method)){let n=this.iv;return n||(typeof e!="number"&&(Tt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),n=yk(e)),new sn(this.method,this.uri,"identity",this.keyFormatVersions,n)}if(this.keyId){const n=ma[this.uri];if(n&&!Mc(this.keyId,n)&&sn.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=Bv(this.uri);if(s)switch(this.keyFormat){case Ds.WIDEVINE:if(this.pssh=s,!this.keyId){const n=S_(s.buffer);if(n.length){var i;const a=n[0];this.keyId=(i=a.kids)!=null&&i.length?a.kids[0]:null}}this.keyId||(this.keyId=j0(t));break;case Ds.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=w_(n,null,s),this.keyId=Gv(s);break}default:{let n=s.subarray(0,16);if(n.length!==16){const a=new Uint8Array(16);a.set(n,16-n.length),n=a}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n;n=vk(t),n||(n=j0(t),n||(n=ma[this.uri])),n&&(this.keyId=n,sn.setKeyIdForUri(this.uri,n))}return this}}function vk(r){const e=r==null?void 0:r[Ds.WIDEVINE];return e?e.keyId:null}function j0(r){const e=r==null?void 0:r[Ds.PLAYREADY];if(e){const t=Bv(e.uri);if(t)return Gv(t)}return null}function yk(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const P0=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,D0=/#EXT-X-MEDIA:(.*)/g,bk=/^#EXT(?:INF|-X-TARGETDURATION):/m,rh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),wk=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ri{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return bf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return bk.test(e)}static parseMasterPlaylist(e,t){const s=L0(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},n=[];if(P0.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let a;for(;(a=P0.exec(e))!=null;)if(a[1]){var u;const h=new Wt(a[1],i),m=qh(i,a[2]),p={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:ri.resolve(m,t)},g=h.decimalResolution("RESOLUTION");g&&(p.width=g.width,p.height=g.height),M0(h.CODECS,p);const v=h["SUPPLEMENTAL-CODECS"];v&&(p.supplemental={},M0(v,p.supplemental)),(u=p.unknownCodecs)!=null&&u.length||n.push(p),i.levels.push(p)}else if(a[3]){const h=a[3],m=a[4];switch(h){case"SESSION-DATA":{const p=new Wt(m,i),g=p["DATA-ID"];g&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[g]=p);break}case"SESSION-KEY":{const p=O0(m,t,i);p.encrypted&&p.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(p)):Tt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${m}"`);break}case"DEFINE":{{const p=new Wt(m,i);R0(i,p,t)}break}case"CONTENT-STEERING":{const p=new Wt(m,i);i.contentSteering={uri:ri.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=$0(m);break}}}const d=n.length>0&&n.length<i.levels.length;return i.levels=d?n:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,s){let i;const n={},a=s.levels,u={AUDIO:a.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:a.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(D0.lastIndex=0;(i=D0.exec(e))!==null;){const h=new Wt(i[1],s),m=h.TYPE;if(m){const p=u[m],g=n[m]||[];n[m]=g;const v=h.LANGUAGE,y=h["ASSOC-LANGUAGE"],S=h.CHANNELS,b=h.CHARACTERISTICS,T=h["INSTREAM-ID"],_={attrs:h,bitrate:0,id:d++,groupId:h["GROUP-ID"]||"",name:h.NAME||v||"",type:m,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:v,url:h.URI?ri.resolve(h.URI,t):""};if(y&&(_.assocLang=y),S&&(_.channels=S),b&&(_.characteristics=b),T&&(_.instreamId=T),p!=null&&p.length){const k=ri.findGroup(p,_.groupId)||p[0];F0(_,k,"audioCodec"),F0(_,k,"textCodec")}g.push(_)}}return n}static parseLevelPlaylist(e,t,s,i,n,a){var u;const d={url:t},h=new fk(t),m=h.fragments,p=[];let g=null,v=0,y=0,S=0,b=0,T=0,_=null,k=new Zd(i,d),I,C,$,N=-1,O=!1,j=null,D;if(rh.lastIndex=0,h.m3u8=e,h.hasVariableRefs=L0(e),((u=rh.exec(e))==null?void 0:u[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(I=rh.exec(e))!==null;){O&&(O=!1,k=new Zd(i,d),k.playlistOffset=S,k.setStart(S),k.sn=v,k.cc=b,T&&(k.bitrate=T),k.level=s,g&&(k.initSegment=g,g.rawProgramDateTime&&(k.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),j&&(k.setByteRange(j),j=null)));const W=I[1];if(W){k.duration=parseFloat(W);const te=(" "+I[2]).slice(1);k.title=te||null,k.tagList.push(te?["INF",W,te]:["INF",W])}else if(I[3]){if(Ae(k.duration)){k.playlistOffset=S,k.setStart(S),$&&B0(k,$,h),k.sn=v,k.level=s,k.cc=b,m.push(k);const te=(" "+I[3]).slice(1);k.relurl=qh(h,te),Qh(k,_,p),_=k,S+=k.duration,v++,y=0,O=!0}}else{if(I=I[0].match(wk),!I){Tt.warn("No matches on slow regex match for level playlist!");continue}for(C=1;C<I.length&&I[C]===void 0;C++);const te=(" "+I[C]).slice(1),z=(" "+I[C+1]).slice(1),M=I[C+2]?(" "+I[C+2]).slice(1):null;switch(te){case"BYTERANGE":_?k.setByteRange(z,_):k.setByteRange(z);break;case"PROGRAM-DATE-TIME":k.rawProgramDateTime=z,k.tagList.push(["PROGRAM-DATE-TIME",z]),N===-1&&(N=m.length);break;case"PLAYLIST-TYPE":h.type&&vi(h,te,I),h.type=z.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?vi(h,te,I):m.length>0&&z0(h,te,I),v=h.startSN=parseInt(z);break;case"SKIP":{h.skippedSegments&&vi(h,te,I);const F=new Wt(z,h),H=F.decimalInteger("SKIPPED-SEGMENTS");if(Ae(H)){h.skippedSegments+=H;for(let P=H;P--;)m.push(null);v+=H}const Y=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");Y&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(Y.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&vi(h,te,I),h.targetduration=Math.max(parseInt(z),1);break;case"VERSION":h.version!==null&&vi(h,te,I),h.version=parseInt(z);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||vi(h,te,I),h.live=!1;break;case"#":(z||M)&&k.tagList.push(M?[z,M]:[z]);break;case"DISCONTINUITY":b++,k.tagList.push(["DIS"]);break;case"GAP":k.gap=!0,k.tagList.push([te]);break;case"BITRATE":k.tagList.push([te,z]),T=parseInt(z)*1e3,Ae(T)?k.bitrate=T:T=0;break;case"DATERANGE":{const F=new Wt(z,h),H=new Fv(F,h.dateRanges[F.ID],h.dateRangeTagCount);h.dateRangeTagCount++,H.isValid||h.skippedSegments?h.dateRanges[H.id]=H:Tt.warn(`Ignoring invalid DATERANGE tag: "${z}"`),k.tagList.push(["EXT-X-DATERANGE",z]);break}case"DEFINE":{{const F=new Wt(z,h);"IMPORT"in F?ok(h,F,a):R0(h,F,t)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?vi(h,te,I):m.length>0&&z0(h,te,I),h.startCC=b=parseInt(z);break;case"KEY":{const F=O0(z,t,h);if(F.isSupported()){if(F.method==="NONE"){$=void 0;break}$||($={});const H=$[F.keyFormat];H!=null&&H.matches(F)||(H&&($=kt({},$)),$[F.keyFormat]=F)}else Tt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${z}"`);break}case"START":h.startTimeOffset=$0(z);break;case"MAP":{const F=new Wt(z,h);if(k.duration){const H=new Zd(i,d);U0(H,F,s,$),g=H,k.initSegment=g,g.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=g.rawProgramDateTime)}else{const H=k.byteRangeEndOffset;if(H){const Y=k.byteRangeStartOffset;j=`${H-Y}@${Y}`}else j=null;U0(k,F,s,$),g=k,O=!0}g.cc=b;break}case"SERVER-CONTROL":{D&&vi(h,te,I),D=new Wt(z),h.canBlockReload=D.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=D.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&D.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=D.optionalFloat("PART-HOLD-BACK",0),h.holdBack=D.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&vi(h,te,I);const F=new Wt(z);h.partTarget=F.decimalFloatingPoint("PART-TARGET");break}case"PART":{let F=h.partList;F||(F=h.partList=[]);const H=y>0?F[F.length-1]:void 0,Y=y++,P=new Wt(z,h),B=new o_(P,k,d,Y,H);F.push(B),k.duration+=B.duration;break}case"PRELOAD-HINT":{const F=new Wt(z,h);h.preloadHint=F;break}case"RENDITION-REPORT":{const F=new Wt(z,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(F);break}default:Tt.warn(`line parsed but not handled: ${I}`);break}}}_&&!_.relurl?(m.pop(),S-=_.duration,h.partList&&(h.fragmentHint=_)):h.partList&&(Qh(k,_,p),k.cc=b,h.fragmentHint=k,$&&B0(k,$,h)),h.targetduration||(h.playlistParsingError=new Error("Missing Target Duration"));const G=m.length,X=m[0],K=m[G-1];if(S+=h.skippedSegments*h.targetduration,S>0&&G&&K){h.averagetargetduration=S/G;const W=K.sn;h.endSN=W!=="initSegment"?W:0,h.live||(K.endList=!0),N>0&&(Ek(m,N),X&&p.unshift(X))}return h.fragmentHint&&(S+=h.fragmentHint.duration),h.totalduration=S,p.length&&h.dateRangeTagCount&&X&&Vv(p,h),h.endCC=b,h}}function Vv(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];r.push(u),t++}else return;const s=r[t-1],i=e.live?1/0:e.totalduration,n=Object.keys(e.dateRanges);for(let u=n.length;u--;){const d=e.dateRanges[n[u]],h=d.startDate.getTime();d.tagAnchor=s.ref;for(let m=t;m--;){var a;if(((a=r[m])==null?void 0:a.sn)<e.startSN)break;const p=Sk(e,h,r,m,i);if(p!==-1){d.tagAnchor=e.fragments[p].ref;break}}}}function Sk(r,e,t,s,i){const n=t[s];if(n){const u=n.programDateTime;if(e>=u||s===0){var a;const d=(((a=t[s+1])==null?void 0:a.start)||i)-n.start;if(e<=u+d*1e3){const h=t[s].sn-r.startSN;if(h<0)return-1;const m=r.fragments;if(m.length>t.length){const g=(t[s+1]||m[m.length-1]).sn-r.startSN;for(let v=g;v>h;v--){const y=m[v].programDateTime;if(e>=y&&e<y+m[v].duration*1e3)return v}}return h}}}return-1}function O0(r,e,t){var s,i;const n=new Wt(r,t),a=(s=n.METHOD)!=null?s:"",u=n.URI,d=n.hexadecimalInteger("IV"),h=n.KEYFORMATVERSIONS,m=(i=n.KEYFORMAT)!=null?i:"identity";u&&n.IV&&!d&&Tt.error(`Invalid IV: ${n.IV}`);const p=u?ri.resolve(u,e):"",g=(h||"1").split("/").map(Number).filter(Number.isFinite);return new sn(a,p,m,g,d,n.KEYID)}function $0(r){const t=new Wt(r).decimalFloatingPoint("TIME-OFFSET");return Ae(t)?t:null}function M0(r,e){let t=(r||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const i=t.filter(n=>Ef(n,s));i.length&&(e[`${s}Codec`]=i.map(n=>n.split("/")[0]).join(","),t=t.filter(n=>i.indexOf(n)===-1))}),e.unknownCodecs=t}function F0(r,e,t){const s=e[t];s&&(r[t]=s)}function Ek(r,e){let t=r[e];for(let s=e;s--;){const i=r[s];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Qh(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function U0(r,e,t,s){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",s&&(r.levelkeys=s),r.initSegment=null}function B0(r,e,t){r.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&s.push(r)}function vi(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function z0(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function ih(r,e){const t=e.startPTS;if(Ae(t)){let s=0,i;e.sn>r.sn?(s=t-r.start,i=r):(s=r.start-t,i=e),i.duration!==s&&i.setDuration(s)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function Kv(r,e,t,s,i,n,a){s-t<=0&&(a.warn("Fragment should have a positive duration",e),s=t+e.duration,n=i+e.duration);let d=t,h=s;const m=e.startPTS,p=e.endPTS;if(Ae(m)){const T=Math.abs(m-t);r&&T>r.totalduration?a.warn(`media timestamps and playlist times differ by ${T}s for level ${e.level} ${r.url}`):Ae(e.deltaPTS)?e.deltaPTS=Math.max(T,e.deltaPTS):e.deltaPTS=T,d=Math.max(t,m),t=Math.min(t,m),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,h=Math.min(s,p),s=Math.max(s,p),n=e.endDTS!==void 0?Math.max(n,e.endDTS):n}const g=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=d,e.startDTS=i,e.endPTS=s,e.minEndPTS=h,e.endDTS=n;const v=e.sn;if(!r||v<r.startSN||v>r.endSN)return 0;let y;const S=v-r.startSN,b=r.fragments;for(b[S]=e,y=S;y>0;y--)ih(b[y],b[y-1]);for(y=S;y<b.length-1;y++)ih(b[y],b[y+1]);return r.fragmentHint&&ih(b[b.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,g}function Tk(r,e,t){if(r===e)return;let s=null;const i=r.fragments;for(let m=i.length-1;m>=0;m--){const p=i[m].initSegment;if(p){s=p;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let n;Ak(r,e,(m,p,g,v)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==m.cc){const y=m.cc-p.cc;for(let S=g;S<v.length;S++)v[S].cc+=y;e.endCC=v[v.length-1].cc}Ae(m.startPTS)&&Ae(m.endPTS)&&(p.setStart(p.startPTS=m.startPTS),p.startDTS=m.startDTS,p.maxStartPTS=m.maxStartPTS,p.endPTS=m.endPTS,p.endDTS=m.endDTS,p.minEndPTS=m.minEndPTS,p.setDuration(m.endPTS-m.startPTS),p.duration&&(n=p),e.PTSKnown=e.alignedSliding=!0),m.hasStreams&&(p.elementaryStreams=m.elementaryStreams),p.loader=m.loader,m.hasStats&&(p.stats=m.stats),m.initSegment&&(p.initSegment=m.initSegment,s=m.initSegment)});const a=e.fragments,u=e.fragmentHint?a.concat(e.fragmentHint):a;if(s&&u.forEach(m=>{var p;m&&(!m.initSegment||m.initSegment.relurl===((p=s)==null?void 0:p.relurl))&&(m.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(m=>!m),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let m=e.skippedSegments;m--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=_k(r.dateRanges,e,t));const m=r.fragments.filter(p=>p.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<u.length;p++)u[p].programDateTime===null&&Qh(u[p],u[p-1],m);Vv(m,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var d;const m=qv(r,e.startSN-1);e.startCC=(d=m==null?void 0:m.cc)!=null?d:a[0].cc}kk(r.partList,e.partList,(m,p)=>{p.elementaryStreams=m.elementaryStreams,p.stats=m.stats}),n?Kv(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS,t):Wv(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const h=e.advancedDateTime;if(e.advanced&&h){const m=e.edge;e.driftStart||(e.driftStartTime=h,e.driftStart=m),e.driftEndTime=h,e.driftEnd=m}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function _k(r,e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=e,n=kt({},r);i&&i.forEach(d=>{delete n[d]});const u=Object.keys(n).length;return u?(Object.keys(s).forEach(d=>{const h=n[d],m=new Fv(s[d].attr,h);m.isValid?(n[d]=m,h||(m.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Lt(s[d].attr)}"`)}),n):s}function kk(r,e,t){if(r&&e){let s=0;for(let i=0,n=r.length;i<=n;i++){const a=r[i],u=e[i+s];a&&u&&a.index===u.index&&a.fragment.sn===u.fragment.sn?t(a,u):s--}}}function Ak(r,e,t){const s=e.skippedSegments,i=Math.max(r.startSN,e.startSN)-e.startSN,n=(r.fragmentHint?1:0)+(s?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let h=i;h<=n;h++){const m=d[a+h];let p=u[h];if(s&&!p&&m&&(p=e.fragments[h]=m),m&&p){t(m,p,h,u);const g=m.relurl,v=p.relurl;if(g&&Ik(g,v)){e.playlistParsingError=G0(`media sequence mismatch ${p.sn}:`,r,e,m,p);return}else if(m.cc!==p.cc){e.playlistParsingError=G0(`discontinuity sequence mismatch (${m.cc}!=${p.cc})`,r,e,m,p);return}}}}function G0(r,e,t,s,i){return new Error(`${r} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Wv(r,e,t=!0){const s=e.startSN+e.skippedSegments-r.startSN,i=r.fragments,n=s>=0;let a=0;if(n&&s<i.length)a=i[s].start;else if(n&&e.startSN===r.endSN+1)a=r.fragmentEnd;else if(n&&t)a=r.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=r.fragmentStart;else return;Xh(e,a)}function Xh(r,e){if(e){const t=r.fragments;for(let s=r.skippedSegments;s<t.length;s++)t[s].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function Hv(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const s=r.fragments;if(s.length&&t*4>e){const n=s[s.length-1].duration*1e3;n<t&&(t=n)}}else t/=2;return Math.round(t)}function qv(r,e,t){if(!r)return null;let s=r.fragments[e-r.startSN];return s||(s=r.fragmentHint,s&&s.sn===e)?s:e<r.startSN&&t&&t.sn===e?t:null}function V0(r,e,t){return r?Yv(r.partList,e,t):null}function Yv(r,e,t){if(r)for(let s=r.length;s--;){const i=r[s];if(i.index===t&&i.fragment.sn===e)return i}return null}function Qv(r){r.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function Ik(r,e){return r!==e&&e?K0(r)!==K0(e):!1}function K0(r){return r.replace(/\?[^?]*$/,"")}function To(r,e){for(let s=0,i=r.length;s<i;s++){var t;if(((t=r[s])==null?void 0:t.cc)===e)return r[s]}return null}function Lk(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function W0(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function Xv(r,e){const t=e.fragments;for(let s=0,i=t.length;s<i;s++)W0(t[s],r);e.fragmentHint&&W0(e.fragmentHint,r),e.alignedSliding=!0}function Rk(r,e){r&&(Jv(e,r),e.alignedSliding||Uc(e,r),!e.alignedSliding&&!e.skippedSegments&&Wv(r,e,!1))}function Jv(r,e){if(!Lk(e,r))return;const t=Math.min(e.endCC,r.endCC),s=To(e.fragments,t),i=To(r.fragments,t);if(!s||!i)return;Tt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const n=s.start-i.start;Xv(n,r)}function Uc(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,s=e.fragments;if(!t.length||!s.length)return;let i,n;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(i=To(s,a),n=To(t,a)),(!i||!n)&&(i=s[Math.floor(s.length/2)],n=To(t,i.cc)||t[Math.floor(t.length/2)]);const u=i.programDateTime,d=n.programDateTime;if(!u||!d)return;const h=(d-u)/1e3-(n.start-i.start);Xv(h,r)}function Ks(r,e,t){tr(r,e,t),r.addEventListener(e,t)}function tr(r,e,t){r.removeEventListener(e,t)}const Nk={toString:function(r){let e="";const t=r.length;for(let s=0;s<t;s++)e+=`[${r.start(s).toFixed(3)}-${r.end(s).toFixed(3)}]`;return e}},ue={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Rf extends $v{constructor(e,t,s,i,n){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ue.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:u,media:d,mediaBuffer:h,state:m}=this,p=d?d.currentTime:0,g=rt.bufferInfo(h||d,p,a.maxBufferHole),v=!g.len;if(this.log(`Media seeking to ${Ae(p)?p.toFixed(3):p}, state: ${m}, ${v?"out of":"in"} buffer`),this.state===ue.ENDED)this.resetLoadingState();else if(u){const y=a.maxFragLookUpTolerance,S=u.start-y,b=u.start+u.duration+y;if(v||b<g.start||S>g.end){const T=p>b;(p<S||T)&&(T&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const y=this.lastCurrentTime;if(p>y&&(this.lastCurrentTime=p),!this.loadingParts){const S=Math.max(g.end,p),b=this.shouldLoadParts(this.getLevelDetails(),S);b&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=b)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,v&&(this.startPosition=p)),v&&this.state===ue.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=n,this.hls=e,this.fragmentLoader=new nk(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new kf(e.config)}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ue.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ue.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const n=e.buffered;this.config.maxBufferHole&&n&&n.length>1&&(e=rt.bufferedInfo(n,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const d=t.partList;if(d!=null&&d.length){const m=d[d.length-1];return rt.isBuffered(this.media,m.start+m.duration/2)}const h=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Ks(s,"seeking",this.onMediaSeeking),Ks(s,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===ue.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),tr(i,"seeking",this.onMediaSeeking),tr(i,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ue.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const i=n=>{const a=n.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${n.part?" part: "+n.part.index:""} of ${this.fragInfo(a,!1,n.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,s,i).then(n=>{if(!n)return;const a=this.state,u=n.frag;if(this.fragContextChanged(u)){(a===ue.FRAG_LOADING||!this.fragCurrent&&a===ue.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=ue.IDLE);return}"payload"in n&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(A.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(`Frag error: ${(n==null?void 0:n.message)||n}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===xs.APPENDING){const n=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,n),u=Math.max(e.duration,a?a.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===xs.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(A.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const i=s==null?void 0:s.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:i}=this,{frag:n,payload:a}=s,u=n.decryptdata;if(a&&a.byteLength>0&&u!=null&&u.key&&u.iv&&Aa(u.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),u.key.buffer,u.iv.buffer,If(u.method)).catch(h=>{throw i.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:n}),h}).then(h=>{const m=self.performance.now();return i.trigger(A.FRAG_DECRYPTED,{frag:n,payload:h,stats:{tstart:d,tdecrypt:m}}),s.payload=h,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==ue.STOPPED&&(this.state=ue.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,i;const n=e.tracks;if(n&&!t.encrypted&&((s=n.audio)!=null&&s.encrypted||(i=n.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(u.message),!a||a.mediaKeys?!1:(this.hls.trigger(A.ERROR,{type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Nk.toString(rt.getBuffered(s)):"(detached)"})`),is(e)){var i;if(e.type!==Ce.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(u=>!!a[u])){this.state=ue.IDLE;return}}const n=(i=this.levels)==null?void 0:i[e.level];n!=null&&n.fragmentError&&(this.log(`Resetting level fragment error count of ${n.fragmentError} on frag buffered`),n.fragmentError=0)}this.state=ue.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:n}=e,a=!n||n.length===0||n.some(d=>!d),u=new Af(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,i){var n;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let u=null;if(e.encrypted&&!((n=e.decryptdata)!=null&&n.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ue.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(A.KEY_LOADED,g),this.state===ue.KEY_LOADING&&(this.state=ue.IDLE),g}),this.hls.trigger(A.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(is(e)&&(!d||e.sn!==d.sn)){const g=this.shouldLoadParts(t.details,e.end);g!==this.loadingParts&&(this.log(`LL-Part loading ${g?"ON":"OFF"} loading sn ${d==null?void 0:d.sn}->${e.sn}`),this.loadingParts=g)}if(s=Math.max(e.start,s||0),this.loadingParts&&is(e)){const g=a.partList;if(g&&i){s>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const v=this.getNextPart(g,e,s);if(v>-1){const y=g[v];e=this.fragCurrent=y.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${y.index} (${v}/${g.length-1}) of ${this.fragInfo(e,!1,y)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=y.start+y.duration,this.state=ue.FRAG_LOADING;let S;return u?S=u.then(b=>!b||this.fragContextChanged(b.frag)?null:this.doFragPartsLoad(e,y,t,i)).catch(b=>this.handleFragLoadError(b)):S=this.doFragPartsLoad(e,y,t,i).catch(b=>this.handleFragLoadError(b)),this.hls.trigger(A.FRAG_LOADING,{frag:e,part:y,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!e.url||this.loadedEndOfParts(g,s))return Promise.resolve(null)}}if(is(e)&&this.loadingParts){var h;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(h=a.partList)==null?void 0:h.filter(g=>g.loaded).map(g=>`[${g.start}-${g.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),Ae(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ue.FRAG_LOADING;const m=this.config.progressive&&e.type!==Ce.SUBTITLE;let p;return m&&u?p=u.then(g=>!g||this.fragContextChanged(g.frag)?null:this.fragmentLoader.load(e,i)).catch(g=>this.handleFragLoadError(g)):p=Promise.all([this.fragmentLoader.load(e,m?i:void 0),u]).then(([g])=>(!m&&i&&i(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(A.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,s,i){return new Promise((n,a)=>{var u;const d=[],h=(u=s.details)==null?void 0:u.partList,m=p=>{this.fragmentLoader.loadPart(e,p,i).then(g=>{d[p.index]=g;const v=g.part;this.hls.trigger(A.FRAG_LOADED,g);const y=V0(s.details,e.sn,p.index+1)||Yv(h,e.sn,p.index+1);if(y)m(y);else return n({frag:e,part:v,partsLoaded:d})}).catch(a)};m(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Ue.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(A.ERROR,t)}else this.hls.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ue.PARSING){!this.fragCurrent&&this.state!==ue.STOPPED&&this.state!==ue.ERROR&&(this.state=ue.IDLE);return}const{frag:s,part:i,level:n}=t,a=self.performance.now();s.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const u=this.getLevelDetails(),h=u&&s.sn>u.endSN||this.shouldLoadParts(u,s.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(s,i,n,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const n=e.partList[0];if(n.fragment.type===Ce.SUBTITLE)return!1;const a=n.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>n.start-n.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:n,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${n} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const u=t[i],d=u.details,h=a>-1?V0(d,n,a):null,m=h?h.fragment:qv(d,n,s);return m?(s&&s!==m&&(m.stats=s.stats),{frag:m,part:h,level:u}):null}bufferFragmentData(e,t,s,i,n){if(this.state!==ue.PARSING)return;const{data1:a,data2:u}=e;let d=a;if(u&&(d=_r(a,u)),!d.length)return;const h=this.initPTS[t.cc],m=h?-h.baseTime/h.timescale:void 0,p={type:e.type,frag:t,part:s,chunkMeta:i,offset:m,parent:t.type,data:d};if(this.hls.trigger(A.BUFFER_APPENDING,p),e.dropped&&e.independent&&!s){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!rt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,i=rt.bufferInfo(t,s,0),n=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),u=Math.max(Math.min(e.start-a,i.end-a),s+a);e.start-u>a&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var s;const i=this.getLoadPosition();if(!Ae(i))return null;const a=this.lastCurrentTime>i||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,s,i){const n=rt.bufferInfo(e,t,i);if(n.len===0&&n.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,s);if(a&&(n.nextStart<=a.end||a.gap)){const u=Math.max(Math.min(n.nextStart,a.end)-t,i);return rt.bufferInfo(e,t,u)}}return n}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),n=Math.max(e-t*3,s.maxMaxBufferLength/2,i);return n>=i?(s.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0):!1}getAppendedFrag(e,t=Ce.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:n}=this,a=s[0].start,u=n.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const p=n.initialLiveManifestSize;if(i<p)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var h;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);const g=this.hls.startPosition,v=this.hls.liveSyncPosition,y=d?(g!==-1&&g>=a?g:v)||d.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${g} liveSyncPosition: ${v} frag.start: ${(h=d)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=a&&(d=s[0]);if(!d){const p=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,p,t)}let m=this.filterReplacedPrimary(d,t);if(!m&&d){const p=d.sn-t.startSN;m=this.filterReplacedPrimary(s[p+1]||null,t)}return this.mapToInitFragWhenRequired(m)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===xs.OK||s===xs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,n){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&s.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(u!==null&&s.len+u.len>=n){const d=a.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(H0(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(H0(this.config)&&e.type!==Ce.SUBTITLE){const s=this.hls.interstitialsManager,i=s==null?void 0:s.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const n=s==null?void 0:s.playerQueue;if(n)for(let a=n.length;a--;){const u=n[a].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let i=-1,n=!1,a=!0;for(let u=0,d=e.length;u<d;u++){const h=e[u];if(a=a&&!h.independent,i>-1&&s<h.start)break;const m=h.loaded;m?i=-1:(n||(h.independent||a)&&h.fragment===t)&&(h.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${h.start}`),i=u),n=m}return i}loadedEndOfParts(e,t){let s;for(let i=e.length;i--;){if(s=e[i],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=H_(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const n=s.sn+1;if(n>=e.startSN&&n<=e.endSN){const a=t[n-e.startSN];s.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Pv(e,s.cc,s.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const n=this.hls.liveSyncPosition;n!==null&&(i=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:n}=this,{fragments:a,endSN:u}=s;const{fragmentHint:d}=s,{maxFragLookUpTolerance:h}=i,m=s.partList,p=!!(this.loadingParts&&m!=null&&m.length&&d);p&&!this.bitrateTest&&m[m.length-1].fragment.sn===d.sn&&(a=a.concat(d),u=d.sn);let g;if(e<t){var v;const S=e<this.lastCurrentTime||e>t-h||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:h;g=Nn(n,a,e,S)}else g=a[a.length-1];if(g){const y=g.sn-s.startSN,S=this.fragmentTracker.getState(g);if((S===xs.OK||S===xs.PARTIAL&&g.gap)&&(n=g),n&&g.sn===n.sn&&(!p||m[0].fragment.sn>g.sn||!s.live)&&g.level===n.level){const T=a[y+1];g.sn<u&&this.fragmentTracker.getState(T)!==xs.OK?g=T:g=null}}return g}alignPlaylists(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const n=e.fragmentStart,a=!t,u=e.alignedSliding&&Ae(n);if(a||!u&&!n){Rk(s,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),d}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const i=this.timelineOffset;if(s===-1){const n=this.startTimeOffset!==null,a=n?this.startTimeOffset:e.startTimeOffset;a!==null&&Ae(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${n?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+i}this.nextLoadPosition=s+i}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&is(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ue.FRAG_LOADING_WAITING_RETRY)&&(this.state=ue.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const T=this.getCurrentContext(t.chunkMeta);T&&(t.frag=T.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var n;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const a=t.details===Z.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const u=t.errorAction;if(!u){this.state=ue.ERROR;return}const{action:d,flags:h,retryCount:m=0,retryConfig:p}=u,g=!!p,v=g&&d===js.RetryRequest,y=g&&!u.resolved&&h===ur.MoveAllAlternatesMatchingHost,S=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!v&&y&&is(i)&&!i.endList&&S&&!Ov(t))this.resetFragmentErrors(e),this.treatAsGap(i),u.resolved=!0;else if((v||y)&&m<p.maxNumRetry){var b;const T=Hh((b=t.response)==null?void 0:b.code),_=_f(p,m);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+_,this.state=ue.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,T){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${m+1}/${p.maxNumRetry} in ${_}ms`)}else if(p)if(this.resetFragmentErrors(e),m<p.maxNumRetry)!a&&d!==js.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${m})`);return}else d===js.SendAlternateToPenaltyBox?this.state=ue.WAITING_LEVEL:this.state=ue.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!Hh(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ue.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ue.PARSING||this.state===ue.PARSED){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),n=i&&i.len>.5;n&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const a=!n;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Ce.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ue.STOPPED&&(this.state=ue.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const i=rt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===ue.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ue.STOPPED&&(this.state=ue.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const n=s.details;if(!n){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,h)=>{const m=e.elementaryStreams[h];if(m){const p=m.endPTS-m.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${p})`),d||!1;const g=i?0:Kv(n,e,m.startPTS,m.endPTS,m.startDTS,m.endDTS,this);return this.hls.trigger(A.LEVEL_PTS_UPDATED,{details:n,level:s,drift:g,type:h,frag:e,start:m.startPTS,end:m.endPTS}),!0}return d},!1)){var u;const d=((u=this.transmuxer)==null?void 0:u.error)===null;if((s.fragmentError===0||d&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),d){const h=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(h.message),this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ue.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(A.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Ce.MAIN?"level":"track"}fragInfo(e,t=!0,s){var i,n;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((i=t&&!s?e.startPTS:(s||e).start)!=null?i:NaN).toFixed(3)}-${((n=t&&!s?e.endPTS:(s||e).end)!=null?n:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function H0(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class Zv{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Ck(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Ck(r,e){const t=new Uint8Array(e);let s=0;for(let i=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}var nh={exports:{}},q0;function jk(){return q0||(q0=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(d,h,m){this.fn=d,this.context=h,this.once=m||!1}function n(d,h,m,p,g){if(typeof m!="function")throw new TypeError("The listener must be a function");var v=new i(m,p||d,g),y=t?t+h:h;return d._events[y]?d._events[y].fn?d._events[y]=[d._events[y],v]:d._events[y].push(v):(d._events[y]=v,d._eventsCount++),d}function a(d,h){--d._eventsCount===0?d._events=new s:delete d._events[h]}function u(){this._events=new s,this._eventsCount=0}u.prototype.eventNames=function(){var h=[],m,p;if(this._eventsCount===0)return h;for(p in m=this._events)e.call(m,p)&&h.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(m)):h},u.prototype.listeners=function(h){var m=t?t+h:h,p=this._events[m];if(!p)return[];if(p.fn)return[p.fn];for(var g=0,v=p.length,y=new Array(v);g<v;g++)y[g]=p[g].fn;return y},u.prototype.listenerCount=function(h){var m=t?t+h:h,p=this._events[m];return p?p.fn?1:p.length:0},u.prototype.emit=function(h,m,p,g,v,y){var S=t?t+h:h;if(!this._events[S])return!1;var b=this._events[S],T=arguments.length,_,k;if(b.fn){switch(b.once&&this.removeListener(h,b.fn,void 0,!0),T){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,m),!0;case 3:return b.fn.call(b.context,m,p),!0;case 4:return b.fn.call(b.context,m,p,g),!0;case 5:return b.fn.call(b.context,m,p,g,v),!0;case 6:return b.fn.call(b.context,m,p,g,v,y),!0}for(k=1,_=new Array(T-1);k<T;k++)_[k-1]=arguments[k];b.fn.apply(b.context,_)}else{var I=b.length,C;for(k=0;k<I;k++)switch(b[k].once&&this.removeListener(h,b[k].fn,void 0,!0),T){case 1:b[k].fn.call(b[k].context);break;case 2:b[k].fn.call(b[k].context,m);break;case 3:b[k].fn.call(b[k].context,m,p);break;case 4:b[k].fn.call(b[k].context,m,p,g);break;default:if(!_)for(C=1,_=new Array(T-1);C<T;C++)_[C-1]=arguments[C];b[k].fn.apply(b[k].context,_)}}return!0},u.prototype.on=function(h,m,p){return n(this,h,m,p,!1)},u.prototype.once=function(h,m,p){return n(this,h,m,p,!0)},u.prototype.removeListener=function(h,m,p,g){var v=t?t+h:h;if(!this._events[v])return this;if(!m)return a(this,v),this;var y=this._events[v];if(y.fn)y.fn===m&&(!g||y.once)&&(!p||y.context===p)&&a(this,v);else{for(var S=0,b=[],T=y.length;S<T;S++)(y[S].fn!==m||g&&!y[S].once||p&&y[S].context!==p)&&b.push(y[S]);b.length?this._events[v]=b.length===1?b[0]:b:a(this,v)}return this},u.prototype.removeAllListeners=function(h){var m;return h?(m=t?t+h:h,this._events[m]&&a(this,m)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,r.exports=u})(nh)),nh.exports}var Pk=jk(),Nf=n_(Pk);const Uo="1.6.15",Na={};function Dk(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Ok(){const r=Na[Uo];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return Na[Uo]=i,i}function $k(r){const e=Na[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Na[r]=i,i}function Mk(r){const e=Na[r||Uo];if(e&&e.clientCount--===1){const{worker:s,objectURL:i}=e;delete Na[r||Uo],i&&self.URL.revokeObjectURL(i),s.terminate()}}function ey(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Cf(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Yc(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Bo(r,e){const t=e;let s=0;for(;Cf(r,e);){s+=10;const i=Yc(r,e+6);s+=i,ey(r,e+10)&&(s+=10),e+=s}if(s>0)return r.subarray(t,t+s)}function Fk(r,e,t,s){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],n=e[t+2],a=n>>2&15;if(a>12){const v=new Error(`invalid ADTS sampling index:${a}`);r.emit(A.ERROR,A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const u=(n>>6&3)+1,d=e[t+3]>>6&3|(n&1)<<2,h="mp4a.40."+u,m=i[a];let p=a;(u===5||u===29)&&(p-=3);const g=[u<<3|(p&14)>>1,(p&1)<<7|d<<3];return Tt.log(`manifest codec:${s}, parsed codec:${h}, channels:${d}, rate:${m} (ADTS object type:${u} sampling index:${a})`),{config:g,samplerate:m,channelCount:d,codec:h,parsedCodec:h,manifestCodec:s}}function ty(r,e){return r[e]===255&&(r[e+1]&246)===240}function sy(r,e){return r[e+1]&1?7:9}function jf(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function Uk(r,e){return e+5<r.length}function Bc(r,e){return e+1<r.length&&ty(r,e)}function Bk(r,e){return Uk(r,e)&&ty(r,e)&&jf(r,e)<=r.length-e}function zk(r,e){if(Bc(r,e)){const t=sy(r,e);if(e+t>=r.length)return!1;const s=jf(r,e);if(s<=t)return!1;const i=e+s;return i===r.length||Bc(r,i)}return!1}function ry(r,e,t,s,i){if(!r.samplerate){const n=Fk(e,t,s,i);if(!n)return;kt(r,n)}}function iy(r){return 1024*9e4/r}function Gk(r,e){const t=sy(r,e);if(e+t<=r.length){const s=jf(r,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function ny(r,e,t,s,i){const n=iy(r.samplerate),a=s+i*n,u=Gk(e,t);let d;if(u){const{frameLength:p,headerLength:g}=u,v=g+p,y=Math.max(0,t+v-e.length);y?(d=new Uint8Array(v-g),d.set(e.subarray(t+g,e.length),0)):d=e.subarray(t+g,t+v);const S={unit:d,pts:a};return y||r.samples.push(S),{sample:S,length:v,missing:y}}const h=e.length-t;return d=new Uint8Array(h),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:a},length:h,missing:-1}}function Vk(r,e){return Cf(r,e)&&Yc(r,e+6)+10<=r.length-e}function Kk(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function ah(r,e=0,t=1/0){return Wk(r,e,t,Uint8Array)}function Wk(r,e,t,s){const i=Hk(r);let n=1;"BYTES_PER_ELEMENT"in s&&(n=s.BYTES_PER_ELEMENT);const a=qk(r)?r.byteOffset:0,u=(a+r.byteLength)/n,d=(a+e)/n,h=Math.floor(Math.max(0,Math.min(d,u))),m=Math.floor(Math.min(h+Math.max(t,0),u));return new s(i,h,m-h)}function Hk(r){return r instanceof ArrayBuffer?r:r.buffer}function qk(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function Yk(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=r.data.subarray(1).indexOf(0);if(s===-1)return;const i=gr(ah(r.data,1,s)),n=r.data[2+s],a=r.data.subarray(3+s).indexOf(0);if(a===-1)return;const u=gr(ah(r.data,3+s,a));let d;return i==="-->"?d=gr(ah(r.data,4+s+a)):d=Kk(r.data.subarray(4+s+a)),e.mimeType=i,e.pictureType=n,e.description=u,e.data=d,e}function Qk(r){if(r.size<2)return;const e=gr(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function Xk(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const s=gr(r.data.subarray(t),!0);t+=s.length+1;const i=gr(r.data.subarray(t));return{key:r.type,info:s,data:i}}const e=gr(r.data.subarray(1));return{key:r.type,info:"",data:e}}function Jk(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const s=gr(r.data.subarray(t),!0);t+=s.length+1;const i=gr(r.data.subarray(t));return{key:r.type,info:s,data:i}}const e=gr(r.data);return{key:r.type,info:"",data:e}}function Zk(r){return r.type==="PRIV"?Qk(r):r.type[0]==="W"?Jk(r):r.type==="APIC"?Yk(r):Xk(r)}function e2(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=Yc(r,4),s=10;return{type:e,size:t,data:r.subarray(s,s+t)}}const nc=10,t2=10;function ay(r){let e=0;const t=[];for(;Cf(r,e);){const s=Yc(r,e+6);r[e+5]>>6&1&&(e+=nc),e+=nc;const i=e+s;for(;e+t2<i;){const n=e2(r.subarray(e)),a=Zk(n);a&&t.push(a),e+=n.size+nc}ey(r,e)&&(e+=nc)}return t}function oy(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function s2(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function Pf(r){const e=ay(r);for(let t=0;t<e.length;t++){const s=e[t];if(oy(s))return s2(s)}}let hr=(function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r})({});function ti(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Df{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=_r(this.cachedData,e),this.cachedData=null);let s=Bo(e,0),i=s?s.length:0,n;const a=this._audioTrack,u=this._id3Track,d=s?Pf(s):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&Ae(d))&&(this.basePTS=r2(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:hr.audioId3,duration:Number.POSITIVE_INFINITY});i<h;){if(this.canParse(e,i)){const m=this.appendFrame(a,e,i);m?(this.frameIndex++,this.lastPTS=m.sample.pts,i+=m.length,n=i):i=h}else Vk(e,i)?(s=Bo(e,i),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:hr.audioId3,duration:Number.POSITIVE_INFINITY}),i+=s.length,n=i):i++;if(i===h&&n!==h){const m=e.slice(n);this.cachedData?this.cachedData=_r(this.cachedData,m):this.cachedData=m}}return{audioTrack:a,videoTrack:ti(),id3Track:u,textTrack:ti()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:ti(),id3Track:this._id3Track,textTrack:ti()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const r2=(r,e,t)=>{if(Ae(r))return r*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let ac=null;const i2=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],n2=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],a2=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],o2=[0,1,1,4];function ly(r,e,t,s,i){if(t+24>e.length)return;const n=cy(e,t);if(n&&t+n.frameLength<=e.length){const a=n.samplesPerFrame*9e4/n.sampleRate,u=s+i*a,d={unit:e.subarray(t,t+n.frameLength),pts:u,dts:u};return r.config=[],r.channelCount=n.channelCount,r.samplerate=n.sampleRate,r.samples.push(d),{sample:d,length:n.frameLength,missing:0}}}function cy(r,e){const t=r[e+1]>>3&3,s=r[e+1]>>1&3,i=r[e+2]>>4&15,n=r[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&n!==3){const a=r[e+2]>>1&1,u=r[e+3]>>6,d=t===3?3-s:s===3?3:4,h=i2[d*14+i-1]*1e3,p=n2[(t===3?0:t===2?1:2)*3+n],g=u===3?1:2,v=a2[t][s],y=o2[s],S=v*8*y,b=Math.floor(v*h/p+a)*y;if(ac===null){const k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ac=k?parseInt(k[1]):0}return!!ac&&ac<=87&&s===2&&h>=224e3&&u===0&&(r[e+3]=r[e+3]|128),{sampleRate:p,channelCount:g,frameLength:b,samplesPerFrame:S}}}function Of(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function uy(r,e){return e+1<r.length&&Of(r,e)}function l2(r,e){return Of(r,e)&&4<=r.length-e}function dy(r,e){if(e+1<r.length&&Of(r,e)){const s=cy(r,e);let i=4;s!=null&&s.frameLength&&(i=s.frameLength);const n=e+i;return n===r.length||uy(r,n)}return!1}class c2 extends Df{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Bo(e,0);let i=(s==null?void 0:s.length)||0;if(dy(e,i))return!1;for(let n=e.length;i<n;i++)if(zk(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Bk(e,t)}appendFrame(e,t,s){ry(e,this.observer,t,s,e.manifestCodec);const i=ny(e,t,s,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const hy=(r,e)=>{let t=0,s=5;e+=s;const i=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;s>0;){a[0]=r[e];const u=Math.min(s,8),d=8-u;n[0]=4278190080>>>24+d<<d,i[0]=(a[0]&n[0])>>d,t=t?t<<u|i[0]:i[0],e+=1,s-=u}return t};class u2 extends Df{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=fy(e,t,s,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Bo(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&Pf(t)!==void 0&&hy(e,s)<16}}function fy(r,e,t,s,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const n=e[t+4]>>6;if(n>=3)return-1;const u=[48e3,44100,32e3][n],d=e[t+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+n]*2;if(t+m>e.length)return-1;const p=e[t+6]>>5;let g=0;p===2?g+=2:(p&1&&p!==1&&(g+=2),p&4&&(g+=2));const v=(e[t+6]<<8|e[t+7])>>12-g&1,S=[2,1,2,3,3,4,4,5][p]+v,b=e[t+5]>>3,T=e[t+5]&7,_=new Uint8Array([n<<6|b<<1|T>>2,(T&3)<<6|p<<3|v<<2|d>>4,d<<4&224]),k=1536/u*9e4,I=s+i*k,C=e.subarray(t,t+m);return r.config=_,r.channelCount=S,r.samplerate=u,r.samples.push({unit:C,pts:I}),m}class d2 extends Df{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Bo(e,0);let s=(t==null?void 0:t.length)||0;if(t&&e[s]===11&&e[s+1]===119&&Pf(t)!==void 0&&hy(e,s)<=16)return!1;for(let i=e.length;s<i;s++)if(dy(e,s))return Tt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return l2(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return ly(e,t,s,this.basePTS,this.frameIndex)}}const h2=/\/emsg[-/]ID3/i;class f2{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const n=this.videoTrack=ti("video",1),a=this.audioTrack=ti("audio",1),u=this.txtTrack=ti("text",1);if(this.id3Track=ti("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=Ev(e);if(d.video){const{id:h,timescale:m,codec:p,supplemental:g}=d.video;n.id=h,n.timescale=u.timescale=m,n.codec=p,n.supplemental=g}if(d.audio){const{id:h,timescale:m,codec:p}=d.audio;a.id=h,a.timescale=m,a.codec=p}u.id=bv.text,n.sampleDuration=0,n.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return u_(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=_r(this.remainderData,e));const u=x_(s);this.remainderData=u.remainder,i.samples=u.valid||new Uint8Array}else i.samples=s;const a=this.extractID3Track(i,t);return n.samples=h0(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=h0(e,t),{videoTrack:t,audioTrack:ti(),id3Track:i,textTrack:ti()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=ot(e.samples,["emsg"]);i&&i.forEach(n=>{const a=y_(n);if(h2.test(a.schemeIdUri)){const u=Y0(a,t);let d=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const h=a.payload;s.samples.push({data:h,len:h.byteLength,dts:u,pts:u,type:hr.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=Y0(a,t);s.samples.push({data:a.payload,len:a.payload.byteLength,dts:u,pts:u,type:hr.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Y0(r,e){return Ae(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class m2{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new kf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,nn.cbc)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const n=i.subarray(16,i.length-i.length%16),a=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(a).then(u=>{const d=new Uint8Array(u);i.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let i=0;for(let n=32;n<e.length-16;n+=160,i+=16)s.set(e.subarray(n,n+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let n=32;n<e.length-16;n+=160,i+=16)e.set(s.subarray(i,i+16),n);return e}decryptAvcSample(e,t,s,i,n){const a=kv(n.data),u=this.getAvcEncryptedData(a);this.decryptBuffer(u.buffer).then(d=>{n.data=this.getAvcDecryptedUnit(a,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}).catch(i)}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){i();return}const n=e[t].units;for(;!(s>=n.length);s++){const a=n[s];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,s,i,a),!this.decrypter.isSync()))return}}}}class my{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,i;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const n=s.units;i=n[n.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,i=s.length;if(i){const n=s[i-1];e.pts=n.pts,e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let n=e.naluState||0;const a=n,u=[];let d=0,h,m,p,g=-1,v=0;for(n===-1&&(g=0,v=this.getNALuType(t,0),n=0,d=1);d<i;){if(h=t[d++],!n){n=h?0:1;continue}if(n===1){n=h?0:2;continue}if(!h)n=3;else if(h===1){if(m=d-n-1,g>=0){const y={data:t.subarray(g,m),type:v};u.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(a&&d<=4-a&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-a)),m>0&&(y.data=_r(y.data,t.subarray(0,m)),y.state=0))}d<i?(p=this.getNALuType(t,d),g=d,v=p,n=0):n=-1}else n=0}if(g>=0&&n>=0){const y={data:t.subarray(g,i),type:v,state:n};u.push(y)}if(u.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=_r(y.data,t))}return e.naluState=n,u}}class _o{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");i.set(e.subarray(s,s+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Tt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class p2 extends my{parsePES(e,t,s,i){const n=this.parseNALu(e,s.data,i);let a=this.VideoSample,u,d=!1;s.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.forEach(h=>{var m,p;switch(h.type){case 1:{let S=!1;u=!0;const b=h.data;if(d&&b.length>4){const T=this.readSliceType(b);(T===2||T===4||T===7||T===9)&&(S=!0)}if(S){var g;(g=a)!=null&&g.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=S;break}case 5:u=!0,(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:{u=!0,Sf(h.data,1,s.pts,t.samples);break}case 7:{var v,y;u=!0,d=!0;const S=h.data,b=this.readSPS(S);if(!e.sps||e.width!==b.width||e.height!==b.height||((v=e.pixelRatio)==null?void 0:v[0])!==b.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==b.pixelRatio[1]){e.width=b.width,e.height=b.height,e.pixelRatio=b.pixelRatio,e.sps=[S];const T=S.subarray(1,4);let _="avc1.";for(let k=0;k<3;k++){let I=T[k].toString(16);I.length<2&&(I="0"+I),_+=I}e.codec=_}break}case 8:u=!0,e.pps=[h.data];break;case 9:u=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:u=!0;break;default:u=!1;break}a&&u&&a.units.push(h)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new _o(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,i=8,n;for(let a=0;a<e;a++)i!==0&&(n=t.readEG(),i=(s+n+256)%256),s=i===0?s:i}readSPS(e){const t=new _o(e);let s=0,i=0,n=0,a=0,u,d,h;const m=t.readUByte.bind(t),p=t.readBits.bind(t),g=t.readUEG.bind(t),v=t.readBoolean.bind(t),y=t.skipBits.bind(t),S=t.skipEG.bind(t),b=t.skipUEG.bind(t),T=this.skipScalingList.bind(this);m();const _=m();if(p(5),y(3),m(),b(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const O=g();if(O===3&&y(1),b(),b(),y(1),v())for(d=O!==3?8:12,h=0;h<d;h++)v()&&(h<6?T(16,t):T(64,t))}b();const k=g();if(k===0)g();else if(k===1)for(y(1),S(),S(),u=g(),h=0;h<u;h++)S();b(),y(1);const I=g(),C=g(),$=p(1);$===0&&y(1),y(1),v()&&(s=g(),i=g(),n=g(),a=g());let N=[1,1];if(v()&&v())switch(m()){case 1:N=[1,1];break;case 2:N=[12,11];break;case 3:N=[10,11];break;case 4:N=[16,11];break;case 5:N=[40,33];break;case 6:N=[24,11];break;case 7:N=[20,11];break;case 8:N=[32,11];break;case 9:N=[80,33];break;case 10:N=[18,11];break;case 11:N=[15,11];break;case 12:N=[64,33];break;case 13:N=[160,99];break;case 14:N=[4,3];break;case 15:N=[3,2];break;case 16:N=[2,1];break;case 255:{N=[m()<<8|m(),m()<<8|m()];break}}return{width:Math.ceil((I+1)*16-s*2-i*2),height:(2-$)*(C+1)*16-($?2:4)*(n+a),pixelRatio:N}}}class g2 extends my{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const n=this.parseNALu(e,s.data,i);let a=this.VideoSample,u,d=!1;s.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.forEach(h=>{var m,p;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,d){var g;(g=a)!=null&&g.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:u=!0,(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:u=!0,Sf(h.data,2,s.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=kt(e.params,this.readVPS(h.data)),this.initVPS=h.data),e.vps=[h.data];break;case 33:if(u=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],h.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(h.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in v.params)e.params[y]=v.params[y]}this.pushParameterSet(e.sps,h.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(h.data);for(const y in v)e.params[y]=v[y]}this.pushParameterSet(e.pps,h.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:u=!1;break}a&&u&&a.units.push(h)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new _o(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:i}}readSPS(e){const t=new _o(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),n=t.readBoolean(),a=t.readBits(5),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),m=t.readUByte(),p=t.readUByte(),g=t.readUByte(),v=t.readUByte(),y=t.readUByte(),S=t.readUByte(),b=t.readUByte(),T=t.readUByte(),_=[],k=[];for(let ke=0;ke<s;ke++)_.push(t.readBoolean()),k.push(t.readBoolean());if(s>0)for(let ke=s;ke<8;ke++)t.readBits(2);for(let ke=0;ke<s;ke++)_[ke]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),k[ke]&&t.readUByte();t.readUEG();const I=t.readUEG();I==3&&t.skipBits(1);const C=t.readUEG(),$=t.readUEG(),N=t.readBoolean();let O=0,j=0,D=0,G=0;N&&(O+=t.readUEG(),j+=t.readUEG(),D+=t.readUEG(),G+=t.readUEG());const X=t.readUEG(),K=t.readUEG(),W=t.readUEG(),te=t.readBoolean();for(let ke=te?0:s;ke<=s;ke++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let be=0;be<4;be++)for(let pe=0;pe<(be===3?2:6);pe++)if(!t.readBoolean())t.readUEG();else{const Ne=Math.min(64,1<<4+(be<<1));be>1&&t.readEG();for(let nt=0;nt<Ne;nt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const F=t.readUEG();let H=0;for(let ke=0;ke<F;ke++){let be=!1;if(ke!==0&&(be=t.readBoolean()),be){ke===F&&t.readUEG(),t.readBoolean(),t.readUEG();let pe=0;for(let Ge=0;Ge<=H;Ge++){const Ne=t.readBoolean();let nt=!1;Ne||(nt=t.readBoolean()),(Ne||nt)&&pe++}H=pe}else{const pe=t.readUEG(),Ge=t.readUEG();H=pe+Ge;for(let Ne=0;Ne<pe;Ne++)t.readUEG(),t.readBoolean();for(let Ne=0;Ne<Ge;Ne++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ke=t.readUEG();for(let be=0;be<ke;be++){for(let pe=0;pe<W+4;pe++)t.readBits(1);t.readBits(1)}}let P=0,B=1,oe=1,ie=!0,ne=1,le=0;t.readBoolean(),t.readBoolean();let _e=!1;if(t.readBoolean()){if(t.readBoolean()){const it=t.readUByte(),zt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ht=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];it>0&&it<16?(B=zt[it-1],oe=ht[it-1]):it===255&&(B=t.readBits(16),oe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),_e=t.readBoolean(),_e&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ne=t.readBits(32),le=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ht=t.readBoolean(),ts=t.readBoolean();let ks=!1;(ht||ts)&&(ks=t.readBoolean(),ks&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ks&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let zs=0;zs<=s;zs++){ie=t.readBoolean();const vs=ie||t.readBoolean();let Te=!1;vs?t.readEG():Te=t.readBoolean();const ds=Te?1:t.readUEG()+1;if(ht)for(let Gt=0;Gt<ds;Gt++)t.readUEG(),t.readUEG(),ks&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ts)for(let Gt=0;Gt<ds;Gt++)t.readUEG(),t.readUEG(),ks&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let Fe=C,Ee=$;if(N){let ke=1,be=1;I===1?ke=be=2:I==2&&(ke=2),Fe=C-ke*j-ke*O,Ee=$-be*G-be*D}const at=i?["A","B","C"][i]:"",de=u<<24|d<<16|h<<8|m;let gt=0;for(let ke=0;ke<32;ke++)gt=(gt|(de>>ke&1)<<31-ke)>>>0;let Ct=gt.toString(16);return a===1&&Ct==="2"&&(Ct="6"),{codecString:`hvc1.${at}${a}.${Ct}.${n?"H":"L"}${T}.B0`,params:{general_tier_flag:n,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[u,d,h,m],general_constraint_indicator_flags:[p,g,v,y,S,b],general_level_idc:T,bit_depth:X+8,bit_depth_luma_minus8:X,bit_depth_chroma_minus8:K,min_spatial_segmentation_idc:P,chroma_format_idc:I,frame_rate:{fixed:ie,fps:le/ne}},width:Fe,height:Ee,pixelRatio:[B,oe]}}readPPS(e){const t=new _o(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),n=t.readBoolean();let a=1;return n&&i?a=0:n?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ts=188;class Ji{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=Ji.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(Ts*5,t-Ts)+1,i=0;for(;i<s;){let n=!1,a=-1,u=0;for(let d=i;d<t;d+=Ts)if(e[d]===71&&(t-d===Ts||e[d+Ts]===71)){if(u++,a===-1&&(a=d,a!==0&&(s=Math.min(a+Ts*99,e.length-Ts)+1)),n||(n=Jh(e,d)===0),n&&u>1&&(a===0&&u>2||d+Ts>s))return a}else{if(u)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:bv[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ji.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Ji.createTrack("audio",i),this._id3Track=Ji.createTrack("id3"),this._txtTrack=Ji.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){s||(this.sampleAes=null);let n;const a=this._videoTrack,u=this._audioTrack,d=this._id3Track,h=this._txtTrack;let m=a.pid,p=a.pesData,g=u.pid,v=d.pid,y=u.pesData,S=d.pesData,b=null,T=this.pmtParsed,_=this._pmtId,k=e.length;if(this.remainderData&&(e=_r(this.remainderData,e),k=e.length,this.remainderData=null),k<Ts&&!i)return this.remainderData=e,{audioTrack:u,videoTrack:a,id3Track:d,textTrack:h};const I=Math.max(0,Ji.syncOffset(e));k-=(k-I)%Ts,k<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,k,e.buffer.byteLength-k));let C=0;for(let N=I;N<k;N+=Ts)if(e[N]===71){const O=!!(e[N+1]&64),j=Jh(e,N),D=(e[N+3]&48)>>4;let G;if(D>1){if(G=N+5+e[N+4],G===N+Ts)continue}else G=N+4;switch(j){case m:O&&(p&&(n=pa(p,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,h,n,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(G,N+Ts)),p.size+=N+Ts-G);break;case g:if(O){if(y&&(n=pa(y,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,n);break;case"mp3":this.parseMPEGPES(u,n);break;case"ac3":this.parseAC3PES(u,n);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(G,N+Ts)),y.size+=N+Ts-G);break;case v:O&&(S&&(n=pa(S,this.logger))&&this.parseID3PES(d,n),S={data:[],size:0}),S&&(S.data.push(e.subarray(G,N+Ts)),S.size+=N+Ts-G);break;case 0:O&&(G+=e[G]+1),_=this._pmtId=x2(e,G);break;case _:{O&&(G+=e[G]+1);const X=v2(e,G,this.typeSupported,s,this.observer,this.logger);m=X.videoPid,m>0&&(a.pid=m,a.segmentCodec=X.segmentVideoCodec),g=X.audioPid,g>0&&(u.pid=g,u.segmentCodec=X.segmentAudioCodec),v=X.id3Pid,v>0&&(d.pid=v),b!==null&&!T&&(this.logger.warn(`MPEG-TS PMT found at ${N} after unknown PID '${b}'. Backtracking to sync byte @${I} to parse all TS packets.`),b=null,N=I-188),T=this.pmtParsed=!0;break}case 17:case 8191:break;default:b=j;break}}else C++;C>0&&Zh(this.observer,new Error(`Found ${C} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=p,u.pesData=y,d.pesData=S;const $={audioTrack:u,videoTrack:a,id3Track:d,textTrack:h};return i&&this.extractRemainingSamples($),$}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:n}=e,a=s.pesData,u=t.pesData,d=i.pesData;let h;if(a&&(h=pa(a,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,n,h,!0),s.pesData=null)):s.pesData=a,u&&(h=pa(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;d&&(h=pa(d,this.logger))?(this.parseID3PES(i,h),i.pesData=null):i.pesData=d}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),n=this.sampleAes=new m2(this.observer,this.config,t);return this.decrypt(i,n)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new p2:e==="hevc"&&(this.videoParser=new g2))}decrypt(e,t){return new Promise(s=>{const{audioTrack:i,videoTrack:n}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{s(e)}):s(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let n=t.data;if(i){this.aacOverFlow=null;const p=i.missing,g=i.sample.unit.byteLength;if(p===-1)n=_r(i.sample.unit,n);else{const v=g-p;i.sample.unit.set(n.subarray(0,p),v),e.samples.push(i.sample),s=i.missing}}let a,u;for(a=s,u=n.length;a<u-1&&!Bc(n,a);a++);if(a!==s){let p;const g=a<u-1;if(g?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",Zh(this.observer,new Error(p),g,this.logger),!g)return}ry(e,this.observer,n,a,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(i){const p=iy(e.samplerate);d=i.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,m;for(;a<u;)if(m=ny(e,n,a,d,h),a+=m.length,m.missing){this.aacOverFlow=m;break}else for(h++;a<u-1&&!Bc(n,a);a++);}parseMPEGPES(e,t){const s=t.data,i=s.length;let n=0,a=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(uy(s,a)){const d=ly(e,s,a,u,n);if(d)a+=d.length,n++;else break}else a++}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const n=s.length;let a=0,u=0,d;for(;u<n&&(d=fy(e,s,u,i,a++))>0;)u+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=kt({},t,{type:this._videoTrack?hr.emsg:hr.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Jh(r,e){return((r[e+1]&31)<<8)+r[e+2]}function x2(r,e){return(r[e+10]&31)<<8|r[e+11]}function v2(r,e,t,s,i,n){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(r[e+1]&15)<<8|r[e+2],d=e+3+u-4,h=(r[e+10]&15)<<8|r[e+11];for(e+=12+h;e<d;){const m=Jh(r,e),p=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!s){oh("ADTS AAC",n);break}case 15:a.audioPid===-1&&(a.audioPid=m);break;case 21:a.id3Pid===-1&&(a.id3Pid=m);break;case 219:if(!s){oh("H.264",n);break}case 27:a.videoPid===-1&&(a.videoPid=m);break;case 3:case 4:!t.mpeg&&!t.mp3?n.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=m,a.segmentAudioCodec="mp3");break;case 193:if(!s){oh("AC-3",n);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=m,a.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&p>0){let g=e+5,v=p;for(;v>2;){switch(r[g]){case 106:t.ac3!==!0?n.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=m,a.segmentAudioCodec="ac3");break}const S=r[g+1]+2;g+=S,v-=S}}break;case 194:case 135:return Zh(i,new Error("Unsupported EC-3 in M2TS found"),void 0,n),a;case 36:a.videoPid===-1&&(a.videoPid=m,a.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"));break}e+=p+5}return a}function Zh(r,e,t,s){s.warn(`parsing error: ${e.message}`),r.emit(A.ERROR,A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function oh(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function pa(r,e){let t=0,s,i,n,a,u;const d=r.data;if(!r||r.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=_r(d[0],d[1]),d.splice(1,1);if(s=d[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(i=(s[4]<<8)+s[5],i&&i>r.size-6)return null;const m=s[7];m&192&&(a=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,m&64?(u=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,a-u>60*9e4&&(e.warn(`${Math.round((a-u)/9e4)}s delta between PTS and DTS, align them`),a=u)):u=a),n=s[8];let p=n+9;if(r.size<=p)return null;r.size-=p;const g=new Uint8Array(r.size);for(let v=0,y=d.length;v<y;v++){s=d[v];let S=s.byteLength;if(p)if(p>S){p-=S;continue}else s=s.subarray(p),S-=p,p=0;g.set(s,t),t+=S}return i&&(i-=n+3),{data:g,pts:a,dts:u,len:i}}return null}class y2{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const qi=Math.pow(2,32)-1;class J{static init(){J.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in J.types)J.types.hasOwnProperty(e)&&(J.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);J.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);J.STTS=J.STSC=J.STCO=n,J.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),J.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),J.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),J.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);J.FTYP=J.box(J.types.ftyp,a,d,a,u),J.DINF=J.box(J.types.dinf,J.box(J.types.dref,i))}static box(e,...t){let s=8,i=t.length;const n=i;for(;i--;)s+=t[i].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(e,4),i=0,s=8;i<n;i++)a.set(t[i],s),s+=t[i].byteLength;return a}static hdlr(e){return J.box(J.types.hdlr,J.HDLR_TYPES[e])}static mdat(e){return J.box(J.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(qi+1)),i=Math.floor(t%(qi+1));return J.box(J.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return J.box(J.types.mdia,J.mdhd(e.timescale||0,e.duration||0),J.hdlr(e.type),J.minf(e))}static mfhd(e){return J.box(J.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?J.box(J.types.minf,J.box(J.types.smhd,J.SMHD),J.DINF,J.stbl(e)):J.box(J.types.minf,J.box(J.types.vmhd,J.VMHD),J.DINF,J.stbl(e))}static moof(e,t,s){return J.box(J.types.moof,J.mfhd(e),J.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=J.trak(e[t]);return J.box.apply(null,[J.types.moov,J.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(J.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=J.trex(e[t]);return J.box.apply(null,[J.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(qi+1)),i=Math.floor(t%(qi+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return J.box(J.types.mvhd,n)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,n;for(i=0;i<t.length;i++)n=t[i].flags,s[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return J.box(J.types.sdtp,s)}static stbl(e){return J.box(J.types.stbl,J.stsd(e),J.box(J.types.stts,J.STTS),J.box(J.types.stsc,J.STSC),J.box(J.types.stsz,J.STSZ),J.box(J.types.stco,J.STCO))}static avc1(e){let t=[],s=[],i,n,a;for(i=0;i<e.sps.length;i++)n=e.sps[i],a=n.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(n));for(i=0;i<e.pps.length;i++)n=e.pps[i],a=n.byteLength,s.push(a>>>8&255),s.push(a&255),s=s.concat(Array.prototype.slice.call(n));const u=J.box(J.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),d=e.width,h=e.height,m=e.pixelRatio[0],p=e.pixelRatio[1];return J.box(J.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,J.box(J.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),J.box(J.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return J.box(J.types.mp4a,J.audioStsd(e),J.box(J.types.esds,J.esds(e)))}static mp3(e){return J.box(J.types[".mp3"],J.audioStsd(e))}static ac3(e){return J.box(J.types["ac-3"],J.audioStsd(e),J.box(J.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return J.box(J.types.stsd,J.STSD,J.mp4a(e));if(t==="ac3"&&e.config)return J.box(J.types.stsd,J.STSD,J.ac3(e));if(t==="mp3"&&e.codec==="mp3")return J.box(J.types.stsd,J.STSD,J.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return J.box(J.types.stsd,J.STSD,J.avc1(e));if(t==="hevc"&&e.vps)return J.box(J.types.stsd,J.STSD,J.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,n=e.height||0,a=Math.floor(s/(qi+1)),u=Math.floor(s%(qi+1));return J.box(J.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,n>>8&255,n&255,0,0]))}static traf(e,t){const s=J.sdtp(e),i=e.id,n=Math.floor(t/(qi+1)),a=Math.floor(t%(qi+1));return J.box(J.types.traf,J.box(J.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),J.box(J.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,a>>24,a>>16&255,a>>8&255,a&255])),J.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,J.box(J.types.trak,J.tkhd(e),J.mdia(e))}static trex(e){const t=e.id;return J.box(J.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,n=12+16*i,a=new Uint8Array(n);let u,d,h,m,p,g;for(t+=8+n,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<i;u++)d=s[u],h=d.duration,m=d.size,p=d.flags,g=d.cts,a.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,g>>>24&255,g>>>16&255,g>>>8&255,g&255],12+16*u);return J.box(J.types.trun,a)}static initSegment(e){J.types||J.init();const t=J.moov(e);return _r(J.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=4,n=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let a=n.length;for(let y=0;y<s.length;y+=1){a+=3;for(let S=0;S<s[y].length;S+=1)a+=2+s[y][S].length}const u=new Uint8Array(a);u.set(n,0),a=n.length;const d=s.length-1;for(let y=0;y<s.length;y+=1){u.set(new Uint8Array([32+y|(y===d?128:0),0,s[y].length]),a),a+=3;for(let S=0;S<s[y].length;S+=1)u.set(new Uint8Array([s[y][S].length>>8,s[y][S].length&255]),a),a+=2,u.set(s[y][S],a),a+=s[y][S].length}const h=J.box(J.types.hvcC,u),m=e.width,p=e.height,g=e.pixelRatio[0],v=e.pixelRatio[1];return J.box(J.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,J.box(J.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),J.box(J.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,v>>24,v>>16&255,v>>8&255,v&255])))}}J.types=void 0;J.HDLR_TYPES=void 0;J.STTS=void 0;J.STSC=void 0;J.STCO=void 0;J.STSZ=void 0;J.VMHD=void 0;J.SMHD=void 0;J.STSD=void 0;J.FTYP=void 0;J.DINF=void 0;const py=9e4;function $f(r,e,t=1,s=!1){const i=r*e*t;return s?Math.round(i):i}function b2(r,e,t=1,s=!1){return $f(r,e,1/t,s)}function xo(r,e=!1){return $f(r,1e3,1/py,e)}function w2(r,e=1){return $f(r,py,1/e)}function Q0(r){const{baseTime:e,timescale:t,trackId:s}=r;return`${e/t} (${e}/${t}) trackId: ${s}`}const S2=10*1e3,E2=1024,T2=1152,_2=1536;let ga=null,lh=null;function X0(r,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Sc extends Ar{constructor(e,t,s,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,ga===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ga=a?parseInt(a[1]):0}if(lh===null){const n=navigator.userAgent.match(/Safari\/(\d+)/i);lh=n?parseInt(n[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Q0(t)} > ${e&&Q0(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce((n,a)=>{let u=a.pts,d=u-n;return d<-4294967296&&(t=!0,u=dr(u,s),d=u-n),d>0?n:u},s);return t&&this.debug("PTS rollover detected"),i}remux(e,t,s,i,n,a,u,d){let h,m,p,g,v,y,S=n,b=n;const T=e.pid>-1,_=t.pid>-1,k=t.samples.length,I=e.samples.length>0,C=u&&k>0||k>1;if((!T||I)&&(!_||C)||this.ISGenerated||u){if(this.ISGenerated){var N,O,j,D;const W=this.videoTrackConfig;(W&&(t.width!==W.width||t.height!==W.height||((N=t.pixelRatio)==null?void 0:N[0])!==((O=W.pixelRatio)==null?void 0:O[0])||((j=t.pixelRatio)==null?void 0:j[1])!==((D=W.pixelRatio)==null?void 0:D[1]))||!W&&C||this.nextAudioTs===null&&I)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,n,a));const G=this.isVideoContiguous;let X=-1,K;if(C&&(X=k2(t.samples),!G&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,X>0){this.warn(`Dropped ${X} out of ${k} video samples due to a missing keyframe`);const W=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(X),t.dropped+=X,b+=(t.samples[0].pts-W)/t.inputTimeScale,K=b}else X===-1&&(this.warn(`No keyframe found out of ${k} video samples`),y=!1);if(this.ISGenerated){if(I&&C){const W=this.getVideoStartPts(t.samples),z=(dr(e.samples[0].pts,W)-W)/t.inputTimeScale;S+=Math.max(0,z),b+=Math.max(0,-z)}if(I){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,n,a)),m=this.remuxAudio(e,S,this.isAudioContiguous,a,_||C||d===Ce.AUDIO?b:void 0),C){const W=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,n,a)),h=this.remuxVideo(t,b,G,W)}}else C&&(h=this.remuxVideo(t,b,G,0));h&&(h.firstKeyFrame=X,h.independent=X!==-1,h.firstKeyFramePTS=K)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(v=gy(s,n,this._initPTS,this._initDTS)),i.samples.length&&(g=xy(i,n,this._initPTS))),{audio:m,video:h,initSegment:p,independent:y,text:g,id3:v}}computeInitPts(e,t,s,i){const n=Math.round(s*t);let a=dr(e,n);if(a<n+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(n-a)/t} ${i}`);a<n+t;)a+=8589934592;return a-n}generateIS(e,t,s,i){const n=e.samples,a=t.samples,u=this.typeSupported,d={},h=this._initPTS;let m=!h||i,p="audio/mp4",g,v,y,S=-1;if(m&&(g=v=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(p="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):J.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(S=e.id,y=e.inputTimeScale,!h||y!==h.timescale?g=v=this.computeInitPts(n[0].pts,y,s,"audio"):m=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:J.initSegment([t]),metadata:{width:t.width,height:t.height}},m)if(S=t.id,y=t.inputTimeScale,!h||y!==h.timescale){const b=this.getVideoStartPts(a),T=dr(a[0].dts,b),_=this.computeInitPts(T,y,s,"video"),k=this.computeInitPts(b,y,s,"video");v=Math.min(v,_),g=Math.min(g,k)}else m=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,m?(h&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${s} ${g/y} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${g/y} (${g}/${y}) trackId: ${S}`),this._initPTS={baseTime:g,timescale:y,trackId:S},this._initDTS={baseTime:v,timescale:y,trackId:S}):g=y=void 0,{tracks:d,initPTS:g,timescale:y,trackId:S}}remuxVideo(e,t,s,i){const n=e.inputTimeScale,a=e.samples,u=[],d=a.length,h=this._initPTS,m=h.baseTime*n/h.timescale;let p=this.nextVideoTs,g=8,v=this.videoSampleDuration,y,S,b=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,_=!1;if(!s||p===null){const P=m+t*n,B=a[0].pts-dr(a[0].dts,a[0].pts);ga&&p!==null&&Math.abs(P-B-(p+m))<15e3?s=!0:p=P-B-m}const k=p+m;for(let P=0;P<d;P++){const B=a[P];B.pts=dr(B.pts,k),B.dts=dr(B.dts,k),B.dts<a[P>0?P-1:P].dts&&(_=!0)}_&&a.sort(function(P,B){const oe=P.dts-B.dts,ie=P.pts-B.pts;return oe||ie}),y=a[0].dts,S=a[a.length-1].dts;const I=S-y,C=I?Math.round(I/(d-1)):v||e.inputTimeScale/30;if(s){const P=y-k,B=P>C,oe=P<-1;if((B||oe)&&(B?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${xo(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${xo(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!oe||k>=a[0].pts||ga)){y=k;const ie=a[0].pts-P;if(B)a[0].dts=y,a[0].pts=ie;else{let ne=!0;for(let le=0;le<a.length&&!(a[le].dts>ie&&ne);le++){const _e=a[le].pts;if(a[le].dts-=P,a[le].pts-=P,le<a.length-1){const Se=a[le+1].pts,Fe=a[le].pts,Ee=Se<=Fe,at=Se<=_e;ne=Ee==at}}}this.log(`Video: Initial PTS/DTS adjusted: ${xo(ie,!0)}/${xo(y,!0)}, delta: ${xo(P,!0)} ms`)}}y=Math.max(0,y);let $=0,N=0,O=y;for(let P=0;P<d;P++){const B=a[P],oe=B.units,ie=oe.length;let ne=0;for(let le=0;le<ie;le++)ne+=oe[le].data.length;N+=ne,$+=ie,B.length=ne,B.dts<O?(B.dts=O,O+=C/4|0||1):O=B.dts,b=Math.min(B.pts,b),T=Math.max(B.pts,T)}S=a[d-1].dts;const j=N+4*$+8;let D;try{D=new Uint8Array(j)}catch(P){this.observer.emit(A.ERROR,A.ERROR,{type:Ue.MUX_ERROR,details:Z.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:j,reason:`fail allocating video mdat ${j}`});return}const G=new DataView(D.buffer);G.setUint32(0,j),D.set(J.types.mdat,4);let X=!1,K=Number.POSITIVE_INFINITY,W=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,z=Number.NEGATIVE_INFINITY;for(let P=0;P<d;P++){const B=a[P],oe=B.units;let ie=0;for(let _e=0,Se=oe.length;_e<Se;_e++){const Fe=oe[_e],Ee=Fe.data,at=Fe.data.byteLength;G.setUint32(g,at),g+=4,D.set(Ee,g),g+=at,ie+=4+at}let ne;if(P<d-1)v=a[P+1].dts-B.dts,ne=a[P+1].pts-B.pts;else{const _e=this.config,Se=P>0?B.dts-a[P-1].dts:C;if(ne=P>0?B.pts-a[P-1].pts:C,_e.stretchShortVideoTrack&&this.nextAudioTs!==null){const Fe=Math.floor(_e.maxBufferHole*n),Ee=(i?b+i*n:this.nextAudioTs+m)-B.pts;Ee>Fe?(v=Ee-Se,v<0?v=Se:X=!0,this.log(`It is approximately ${Ee/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=Se}else v=Se}const le=Math.round(B.pts-B.dts);K=Math.min(K,v),te=Math.max(te,v),W=Math.min(W,ne),z=Math.max(z,ne),u.push(X0(B.key,v,ie,le))}if(u.length){if(ga){if(ga<70){const P=u[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(lh&&z-W<te-K&&C/te<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=y;for(let B=0,oe=u.length;B<oe;B++){const ie=P+u[B].duration,ne=P+u[B].cts;if(B<oe-1){const le=ie+u[B+1].cts;u[B].duration=le-ne}else u[B].duration=B?u[B-1].duration:C;u[B].cts=0,P=ie}}}v=X||!v?C:v;const M=S+v;this.nextVideoTs=p=M-m,this.videoSampleDuration=v,this.isVideoContiguous=!0;const Y={data1:J.moof(e.sequenceNumber++,y,kt(e,{samples:u})),data2:D,startPTS:(b-m)/n,endPTS:(T+v-m)/n,startDTS:(y-m)/n,endDTS:p/n,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Y}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return T2;case"ac3":return _2;default:return E2}}remuxAudio(e,t,s,i,n){const a=e.inputTimeScale,u=e.samplerate?e.samplerate:a,d=a/u,h=this.getSamplesPerFrame(e),m=h*d,p=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],y=n!==void 0;let S=e.samples,b=g?0:8,T=this.nextAudioTs||-1;const _=p.baseTime*a/p.timescale,k=_+t*a;if(this.isAudioContiguous=s=s||S.length&&T>0&&(i&&Math.abs(k-(T+_))<9e3||Math.abs(dr(S[0].pts,k)-(T+_))<20*m),S.forEach(function(z){z.pts=dr(z.pts,k)}),!s||T<0){const z=S.length;if(S=S.filter(M=>M.pts>=0),z!==S.length&&this.warn(`Removed ${S.length-z} of ${z} samples (initPTS ${_} / ${a})`),!S.length)return;n===0?T=0:i&&!y?T=Math.max(0,k-_):T=S[0].pts-_}if(e.segmentCodec==="aac"){const z=this.config.maxAudioFramesDrift;for(let M=0,F=T+_;M<S.length;M++){const H=S[M],Y=H.pts,P=Y-F,B=Math.abs(1e3*P/a);if(P<=-z*m&&y)M===0&&(this.warn(`Audio frame @ ${(Y/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*P/a)} ms.`),this.nextAudioTs=T=Y-_,F=Y);else if(P>=z*m&&B<S2&&y){let oe=Math.round(P/m);for(F=Y-oe*m;F<0&&oe&&m;)oe--,F+=m;M===0&&(this.nextAudioTs=T=F-_),this.warn(`Injecting ${oe} audio frames @ ${((F-_)/a).toFixed(3)}s due to ${Math.round(1e3*P/a)} ms gap.`);for(let ie=0;ie<oe;ie++){let ne=y2.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ne||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=H.unit.subarray()),S.splice(M,0,{unit:ne,pts:F}),F+=m,M++}}H.pts=F,F+=m}}let I=null,C=null,$,N=0,O=S.length;for(;O--;)N+=S[O].unit.byteLength;for(let z=0,M=S.length;z<M;z++){const F=S[z],H=F.unit;let Y=F.pts;if(C!==null){const B=v[z-1];B.duration=Math.round((Y-C)/d)}else if(s&&e.segmentCodec==="aac"&&(Y=T+_),I=Y,N>0){N+=b;try{$=new Uint8Array(N)}catch(B){this.observer.emit(A.ERROR,A.ERROR,{type:Ue.MUX_ERROR,details:Z.REMUX_ALLOC_ERROR,fatal:!1,error:B,bytes:N,reason:`fail allocating audio mdat ${N}`});return}g||(new DataView($.buffer).setUint32(0,N),$.set(J.types.mdat,4))}else return;$.set(H,b);const P=H.byteLength;b+=P,v.push(X0(!0,h,P,0)),C=Y}const j=v.length;if(!j)return;const D=v[v.length-1];T=C-_,this.nextAudioTs=T+d*D.duration;const G=g?new Uint8Array(0):J.moof(e.sequenceNumber++,I/d,kt({},e,{samples:v}));e.samples=[];const X=(I-_)/a,K=this.nextAudioTs/a,te={data1:G,data2:$,startPTS:X,endPTS:K,startDTS:X,endDTS:K,type:"audio",hasAudio:!0,hasVideo:!1,nb:j};return this.isAudioContiguous=!0,te}}function dr(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function k2(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function gy(r,e,t,s){const i=r.samples.length;if(!i)return;const n=r.inputTimeScale;for(let u=0;u<i;u++){const d=r.samples[u];d.pts=dr(d.pts-t.baseTime*n/t.timescale,e*n)/n,d.dts=dr(d.dts-s.baseTime*n/s.timescale,e*n)/n}const a=r.samples;return r.samples=[],{samples:a}}function xy(r,e,t){const s=r.samples.length;if(!s)return;const i=r.inputTimeScale;for(let a=0;a<s;a++){const u=r.samples[a];u.pts=dr(u.pts-t.baseTime*i/t.timescale,e*i)/i}r.samples.sort((a,u)=>a.pts-u.pts);const n=r.samples;return r.samples=[],{samples:n}}class A2 extends Ar{constructor(e,t,s,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:n,video:a}=this.initData=Ev(e);if(t)m_(e,t);else{const d=n||a;d!=null&&d.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${d.codec}")!`)}n&&(s=J0(n,It.AUDIO,this)),a&&(i=J0(a,It.VIDEO,this));const u={};n&&a?u.audiovideo={container:"video/mp4",codec:s+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:n?u.audio={container:"audio/mp4",codec:s,encrypted:n.encrypted,initSegment:e,id:"audio"}:a?u.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,s,i,n,a){var u,d;let{initPTS:h,lastEndTime:m}=this;const p={audio:void 0,video:void 0,text:i,id3:s,initSegment:void 0};Ae(m)||(m=this.lastEndTime=n||0);const g=t.samples;if(!g.length)return p;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let y=this.initData;if((u=y)!=null&&u.length||(this.generateInitSegment(g),y=this.initData),!((d=y)!=null&&d.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const S=g_(g,y,this),b=y.audio?S[y.audio.id]:null,T=y.video?S[y.video.id]:null,_=oc(T,1/0),k=oc(b,1/0),I=oc(T,0,!0),C=oc(b,0,!0);let $=n,N=0;const O=b&&(!T||!h&&k<_||h&&h.trackId===y.audio.id),j=O?b:T;if(j){const F=j.timescale,H=j.start-n*F,Y=O?y.audio.id:y.video.id;$=j.start/F,N=O?C-k:I-_,(a||!h)&&(I2(h,$,n,N)||F!==h.timescale)&&(h&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${n} ${H/F} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${$-n} (${H}/${F}) trackId: ${Y}`),h=null,v.initPTS=H,v.timescale=F,v.trackId=Y)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${n}`);h?(v.initPTS=h.baseTime,v.timescale=h.timescale,v.trackId=h.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=$,v.timescale=1,v.trackId=-1),this.initPTS=h={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const D=$-h.baseTime/h.timescale,G=D+N;N>0?this.lastEndTime=G:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const X=!!y.audio,K=!!y.video;let W="";X&&(W+="audio"),K&&(W+="video");const te=(y.audio?y.audio.encrypted:!1)||(y.video?y.video.encrypted:!1),z={data1:g,startPTS:D,startDTS:D,endPTS:G,endDTS:G,type:W,hasAudio:X,hasVideo:K,nb:1,dropped:0,encrypted:te};p.audio=X&&!K?z:void 0,p.video=K?z:void 0;const M=T==null?void 0:T.sampleCount;if(M){const F=T.keyFrameIndex,H=F!==-1;z.nb=M,z.dropped=F===0||this.isVideoContiguous?0:H?F:M,z.independent=H,z.firstKeyFrame=F,H&&T.keyFrameStart&&(z.firstKeyFramePTS=(T.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(p.independent=H),this.isVideoContiguous||(this.isVideoContiguous=H),z.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${F}/${M} dropped: ${z.dropped} start: ${z.firstKeyFramePTS||"NA"}`)}return p.initSegment=v,p.id3=gy(s,n,h,h),i.samples.length&&(p.text=xy(i,n,h)),p}}function oc(r,e,t=!1){return(r==null?void 0:r.start)!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function I2(r,e,t,s){if(r===null)return!0;const i=Math.max(s,1),n=e-r.baseTime/r.timescale;return Math.abs(n-t)>i}function J0(r,e,t){const s=r.codec;return s&&s.length>4?s:e===It.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?jc(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let Si;try{Si=self.performance.now.bind(self.performance)}catch{Si=Date.now}const Ec=[{demux:f2,remux:A2},{demux:Ji,remux:Sc},{demux:c2,remux:Sc},{demux:d2,remux:Sc}];Ec.splice(2,0,{demux:u2,remux:Sc});class Z0{constructor(e,t,s,i,n,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=n,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const n=s.transmuxing;n.executeStart=Si();let a=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:d}=this;i&&(this.currentTransmuxState=i);const{contiguous:h,discontinuity:m,trackSwitch:p,accurateTimeOffset:g,timeOffset:v,initSegmentChange:y}=i||u,{audioCodec:S,videoCodec:b,defaultInitPts:T,duration:_,initSegmentData:k}=d,I=L2(a,t);if(I&&Aa(I.method)){const O=this.getDecrypter(),j=If(I.method);if(O.isSync()){let D=O.softwareDecrypt(a,I.key.buffer,I.iv.buffer,j);if(s.part>-1){const X=O.flush();D=X&&X.buffer}if(!D)return n.executeEnd=Si(),ch(s);a=new Uint8Array(D)}else return this.asyncResult=!0,this.decryptionPromise=O.webCryptoDecrypt(a,I.key.buffer,I.iv.buffer,j).then(D=>{const G=this.push(D,null,s);return this.decryptionPromise=null,G}),this.decryptionPromise}const C=this.needsProbing(m,p);if(C){const O=this.configureTransmuxer(a);if(O)return this.logger.warn(`[transmuxer] ${O.message}`),this.observer.emit(A.ERROR,A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!1,error:O,reason:O.message}),n.executeEnd=Si(),ch(s)}(m||p||y||C)&&this.resetInitSegment(k,S,b,_,t),(m||y||C)&&this.resetInitialTimestamp(T),h||this.resetContiguity();const $=this.transmux(a,I,v,g,s);this.asyncResult=zo($);const N=this.currentTransmuxState;return N.contiguous=!0,N.discontinuity=!1,N.trackSwitch=!1,n.executeEnd=Si(),$}flush(e){const t=e.transmuxing;t.executeStart=Si();const{decrypter:s,currentTransmuxState:i,decryptionPromise:n}=this;if(n)return this.asyncResult=!0,n.then(()=>this.flush(e));const a=[],{timeOffset:u}=i;if(s){const p=s.flush();p&&a.push(this.push(p.buffer,null,e))}const{demuxer:d,remuxer:h}=this;if(!d||!h){t.executeEnd=Si();const p=[ch(e)];return this.asyncResult?Promise.resolve(p):p}const m=d.flush(u);return zo(m)?(this.asyncResult=!0,m.then(p=>(this.flushRemux(a,p,e),a))):(this.flushRemux(a,m,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:n,id3Track:a,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===Ce.MAIN?"level":"track"} ${s.level}`);const m=this.remuxer.remux(i,n,a,u,h,d,!0,this.id);e.push({remuxResult:m,chunkMeta:s}),s.transmuxing.executeEnd=Si()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,n){const{demuxer:a,remuxer:u}=this;!a||!u||(a.resetInitSegment(e,t,s,i),u.resetInitSegment(e,t,s,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,n){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,s,i,n):a=this.transmuxUnencrypted(e,s,i,n),a}transmuxUnencrypted(e,t,s,i){const{audioTrack:n,videoTrack:a,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,a,u,d,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,n){return this.demuxer.demuxSampleAes(e,t,s).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,s,i,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let n;for(let p=0,g=Ec.length;p<g;p++){var a;if((a=Ec[p].demux)!=null&&a.probe(e,this.logger)){n=Ec[p];break}}if(!n)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,d=this.remuxer,h=n.remux,m=n.demux;(!d||!(d instanceof h))&&(this.remuxer=new h(s,t,i,this.logger)),(!u||!(u instanceof m))&&(this.demuxer=new m(s,t,i,this.logger),this.probe=m.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new kf(this.config)),e}}function L2(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const ch=r=>({remuxResult:{},chunkMeta:r});function zo(r){return"then"in r&&r.then instanceof Function}class R2{constructor(e,t,s,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=n||null}}class N2{constructor(e,t,s,i,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=a}}let ex=0;class vy{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ex++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const h=d.data,m=this.hls;if(!(!m||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var p;const g=(p=this.workerContext)==null?void 0:p.objectURL;g&&self.URL.revokeObjectURL(g);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{m.logger[h.data.logType]&&m.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,m.trigger(h.event,h.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const h=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const a=(d,h)=>{h=h||{},h.frag=this.frag||void 0,d===A.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(d,h)};this.observer=new Nf,this.observer.on(A.FRAG_DECRYPTED,a),this.observer.on(A.ERROR,a);const u=p0(n.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(n.workerPath||Dk()){try{n.workerPath?(d.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=$k(n.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=Ok());const{worker:m}=this.workerContext;m.addEventListener("message",this.onWorkerMessage),m.addEventListener("error",this.onWorkerError),m.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Lt(n)})}catch(m){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,m),this.terminateWorker(),this.error=null,this.transmuxer=new Z0(this.observer,u,n,"",t,e.logger)}return}}this.transmuxer=new Z0(this.observer,u,n,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ex++;const t=this.hls.config,s=p0(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Lt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Mk(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,n,a,u,d,h,m){var p,g;h.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:y}=this,S=a?a.start:n.start,b=n.decryptdata,T=this.frag,_=!(T&&n.cc===T.cc),k=!(T&&h.level===T.level),I=T?h.sn-T.sn:-1,C=this.part?h.part-this.part.index:-1,$=I===0&&h.id>1&&h.id===(T==null?void 0:T.stats.chunkCount),N=!k&&(I===1||I===0&&(C===1||$&&C<=0)),O=self.performance.now();(k||I||n.stats.parsing.start===0)&&(n.stats.parsing.start=O),a&&(C||!N)&&(a.stats.parsing.start=O);const j=!(T&&((p=n.initSegment)==null?void 0:p.url)===((g=T.initSegment)==null?void 0:g.url)),D=new N2(_,N,d,k,S,j);if(!N||_||j){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${n.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===Ce.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${_}
        trackSwitch: ${k}
        contiguous: ${N}
        accurateTimeOffset: ${d}
        timeOffset: ${S}
        initSegmentChange: ${j}`);const G=new R2(s,i,t,u,m);this.configureTransmuxer(G)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:b,chunkMeta:h,state:D},e instanceof ArrayBuffer?[e]:[]);else if(y){const G=y.push(e,b,h,D);zo(G)?G.then(X=>{this.handleTransmuxComplete(X)}).catch(X=>{this.transmuxerError(X,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(G)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const i=s.flush(e);zo(i)?i.then(n=>{this.handleFlushResult(n,e)}).catch(n=>{this.transmuxerError(n,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const tx=100;class C2 extends Rf{constructor(e,t,s){super(e,t,s,"audio-stream-controller",Ce.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:n,trackId:a}){if(s===Ce.MAIN){const u=t.cc,d=this.fragCurrent;if(this.initPTS[u]={baseTime:i,timescale:n,trackId:a},this.log(`InitPTS for cc: ${u} found from main: ${i/n} (${i}/${n}) trackId: ${a}`),this.mainAnchor=t,this.state===ue.WAITING_INIT_PTS){const h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==u)&&this.syncWithAnchor(t,h==null?void 0:h.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==u?(d.abortRequests(),this.syncWithAnchor(t,d)):this.state===ue.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const i=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const n=(i||e).cc,a=this.getLevelDetails(),u=this.getLoadPosition(),d=Pv(a,n,u);d&&(this.log(`Syncing with main frag at ${d.start} cc ${d.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===ue.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ue.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(tx),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=ue.IDLE):this.state=ue.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ue.IDLE:this.doTickIdle();break;case ue.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e==null?void 0:e[t],i=s==null?void 0:s.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=ue.WAITING_INIT_PTS}break}case ue.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ue.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:n}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ue.FRAG_LOADING;const u=i.flush().buffer,d={frag:t,part:s,payload:u,networkDetails:null};this._handleFragmentLoadProgress(d),n&&super._handleFragmentLoadComplete(d)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=ue.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:n}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(s!=null&&s[n]))return;const u=s[n],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d)){this.state=ue.WAITING_TRACK,this.startFragRequested=!1;return}const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,It.AUDIO,Ce.AUDIO));const m=this.getFwdBufferInfo(h,Ce.AUDIO);if(m===null)return;if(!this.switchingTrack&&this._streamEnded(m,d)){t.trigger(A.BUFFER_EOS,{type:"audio"}),this.state=ue.ENDED;return}const p=m.len,g=t.maxBufferLength,v=d.fragments,y=v[0].start,S=this.getLoadPosition(),b=this.flushing?S:m.end;if(this.switchingTrack&&i){const k=S;d.PTSKnown&&k<y&&(m.end>y||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=y+.05)}if(p>=g&&!this.switchingTrack&&b<v[v.length-1].start)return;let T=this.getNextFragment(b,d);if(T&&this.isLoopLoading(T,b)&&(T=this.getNextFragmentLoopLoading(T,d,m,Ce.MAIN,g)),!T){this.bufferFlushed=!0;return}let _=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&is(T)&&!T.endList&&(!d.live||!this.loadingParts&&b<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===xs.OK&&(this.mainFragLoading=_=null),_&&is(_))){if(T.start>_.end){const I=this.fragmentTracker.getFragAtPos(b,Ce.MAIN);I&&I.end>_.end&&(_=I,this.mainFragLoading={frag:I,targetBufferTime:null})}if(T.start>_.end)return}this.loadFragment(T,u,b)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Fo(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ue.STOPPED&&(this.setInterval(tx),this.state=ue.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(A.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:n,id:a,groupId:u,track:d}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${d.name}" of "${u}"`);return}const h=this.mainDetails;if(!h||n.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==ue.STOPPED&&(this.state=ue.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${d.name}" of "${u}" loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const m=i[a];let p=0;if(n.live||(s=m.details)!=null&&s.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;if(m.details){var g;p=this.alignPlaylists(n,m.details,(g=this.levelLastLoaded)==null?void 0:g.details)}n.alignedSliding||(Jv(n,h),n.alignedSliding||Uc(n,h),p=n.fragmentStart)}m.details=n,this.levelLastLoaded=m,this.startFragRequested||this.setStartPosition(h,p),this.hls.trigger(A.AUDIO_TRACK_UPDATED,{details:n,id:a,groupId:t.groupId}),this.state===ue.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=ue.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:n}=e,{config:a,trackId:u,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const h=d[u];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const m=h.details;if(!m){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const p=a.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let g=this.transmuxer;g||(g=this.transmuxer=new vy(this.hls,Ce.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[s.cc],y=(t=s.initSegment)==null?void 0:t.data;if(v!==void 0){const b=i?i.index:-1,T=b!==-1,_=new Af(s.level,s.sn,s.stats.chunkCount,n.byteLength,b,T);g.push(n,y,p,"",s,i,m.totalduration,!1,_,v)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${m.startSN} ,${m.endSN}],track ${u}`);const{cache:S}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new Zv,complete:!1};S.push(new Uint8Array(n)),this.state!==ue.STOPPED&&(this.state=ue.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Ce.MAIN&&is(t.frag)&&(this.mainFragLoading=t,this.state===ue.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type!==Ce.AUDIO){!this.audioOnly&&s.type===Ce.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(is(s)){this.fragPrevious=s;const n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,Et({},n)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case Z.FRAG_GAP:case Z.FRAG_PARSING_ERROR:case Z.FRAG_DECRYPT_ERROR:case Z.FRAG_LOAD_ERROR:case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_ERROR:case Z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ce.AUDIO,t);break;case Z.AUDIO_TRACK_LOAD_ERROR:case Z.AUDIO_TRACK_LOAD_TIMEOUT:case Z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===ut.AUDIO_TRACK&&(this.state=ue.IDLE);break;case Z.BUFFER_ADD_CODEC_ERROR:case Z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==It.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==It.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ue.ENDED&&(this.state=ue.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,Ce.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:n,chunkMeta:a}=e,u=this.getCurrentContext(a);if(!u){this.resetWhenMissingContext(a);return}const{frag:d,part:h,level:m}=u,{details:p}=m,{audio:g,text:v,id3:y,initSegment:S}=n;if(this.fragContextChanged(d)||!p){this.fragmentTracker.removeFragment(d);return}if(this.state=ue.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const b=d.initSegment||d;if(this.unhandledEncryptionError(S,d))return;this._bufferInitSegment(m,S.tracks,b,a),i.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:s,tracks:S.tracks})}if(g){const{startPTS:b,endPTS:T,startDTS:_,endDTS:k}=g;h&&(h.elementaryStreams[It.AUDIO]={startPTS:b,endPTS:T,startDTS:_,endDTS:k}),d.setElementaryStreamInfo(It.AUDIO,b,T,_,k),this.bufferFragmentData(g,d,h,a)}if(y!=null&&(t=y.samples)!=null&&t.length){const b=kt({id:s,frag:d,details:p},y);i.trigger(A.FRAG_PARSING_METADATA,b)}if(v){const b=kt({id:s,frag:d,details:p},v);i.trigger(A.FRAG_PARSING_USERDATA,b)}}_bufferInitSegment(e,t,s,i){if(this.state!==ue.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const n=t.audio;n.id=Ce.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${a}/${n.codec}]`),a&&a.split(",").length===1&&(n.levelCodec=a),this.hls.trigger(A.BUFFER_CODECS,t);const u=n.initSegment;if(u!=null&&u.byteLength){const d={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:u};this.hls.trigger(A.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===xs.NOT_LOADED||i===xs.PARTIAL){var n;if(!is(e))this._loadInitSegment(e,t);else if((n=t.details)!=null&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ue.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Uc(t.details,a)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:n,audioCodec:a,channels:u}=this.bufferedTrack;Rn({name:t,lang:s,assocLang:i,characteristics:n,audioCodec:a,channels:u},e,kn)||(Dc(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(A.AUDIO_TRACK_SWITCHED,Et({},e))}}class Mf extends Ar{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=t==null?void 0:t.renditionReports;if(i){let n=-1;for(let a=0;a<i.length;a++){const u=i[a];let d;try{d=new self.URL(u.URI,t.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),d=u.URI||""}if(d===e){n=a;break}else d===e.substring(0,d.length)&&(n=a)}if(n!==-1){const a=i[n],u=parseInt(a["LAST-MSN"])||t.lastPartSn;let d=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const m=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&m>t.partTarget&&(d+=1)}const h=s&&g0(s);return new x0(u,d>=0?d:void 0,h)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:i,stats:n}=t,a=self.performance.now(),u=n.loading.first?Math.max(0,a-n.loading.first):0;i.advancedDateTime=Date.now()-u;const d=this.hls.config.timelineOffset;if(d!==i.appliedTimelineOffset){const m=Math.max(d||0,0);i.appliedTimelineOffset=m,i.fragments.forEach(p=>{p.setStart(p.playlistOffset+m)})}if(i.live||s!=null&&s.live){const m="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(s),s&&i.fragments.length>0){Tk(s,i,this);const _=i.playlistParsingError;if(_){this.warn(_);const k=this.hls;if(!k.config.ignorePlaylistParsingErrors){var h;const{networkDetails:I}=t;k.trigger(A.ERROR,{type:Ue.NETWORK_ERROR,details:Z.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:_,reason:_.message,level:t.level||void 0,parent:(h=i.fragments[0])==null?void 0:h.type,networkDetails:I,stats:n});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=n.loading.start);const p=this.hls.mainForwardBufferInfo,g=p?p.end-p.len:0,v=(i.edge-g)*1e3,y=Hv(i,v);if(i.requestScheduled+y<a?i.requestScheduled=a:i.requestScheduled+=y,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let S,b,T;if(i.canBlockReload&&i.endSN&&i.advanced){const _=this.hls.config.lowLatencyMode,k=i.lastPartSn,I=i.endSN,C=i.lastPartIndex,$=C!==-1,N=k===I;$?N?(b=I+1,T=_?0:C):(b=k,T=_?C+1:i.maxPartIndex):b=I+1;const O=i.age,j=O+i.ageHeader;let D=Math.min(j-i.partTarget,i.targetduration*1.5);if(D>0){if(j>i.targetduration*3)this.log(`Playlist last advanced ${O.toFixed(2)}s ago. Omitting segment and part directives.`),b=void 0,T=void 0;else if(s!=null&&s.tuneInGoal&&j-i.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${D} with playlist age: ${i.age}`),D=0;else{const G=Math.floor(D/i.targetduration);if(b+=G,T!==void 0){const X=Math.round(D%i.targetduration/i.partTarget);T+=X}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${O.toFixed(2)}s goal: ${D} skip sn ${G} to part ${T}`)}i.tuneInGoal=D}if(S=this.getDeliveryDirectives(i,t.deliveryDirectives,b,T),_||!N){i.requestScheduled=a,this.loadingPlaylist(m,S);return}}else(i.canBlockReload||i.canSkipUntil)&&(S=this.getDeliveryDirectives(i,t.deliveryDirectives,b,T));S&&b!==void 0&&i.canBlockReload&&(i.requestScheduled=n.loading.first+Math.max(y-u*2,y/2)),this.scheduleLoading(m,S,i)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i){this.loadingPlaylist(e,t);return}const n=self.performance.now(),a=i.requestScheduled;if(n>=a){this.loadingPlaylist(e,t);return}const u=a-n;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,s,i){let n=g0(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,n=bc.No),new x0(s,i,n)}checkRetry(e){const t=e.details,s=Oc(e),i=e.errorAction,{action:n,retryCount:a=0,retryConfig:u}=i||{},d=!!i&&!!u&&(n===js.RetryRequest||!i.resolved&&n===js.SendAlternateToPenaltyBox);if(d){var h;if(a>=u.maxNumRetry)return!1;if(s&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const m=_f(u,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),m),this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" in ${m}ms`)}e.levelRetry=!0,i.resolved=!0}return d}}function yy(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Go(r[t].attrs,e[t].attrs))return!1;return!0}function Go(r,e,t){const s=r["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>r[i]!==e[i])}function ef(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class j2 extends Mf{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:n}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i){this.warn(`Audio track with id:${s} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Audio track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${n.startSN}-${n.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let n=this.currentTrack;if(!s||(i==null?void 0:i.length)!==(s==null?void 0:s.length)||s!=null&&s.some(u=>(i==null?void 0:i.indexOf(u))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(g=>!s||s.indexOf(g.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(g=>g.default)&&(this.selectDefaultTrack=!1),u.forEach((g,v)=>{g.id=v});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const d=this.hls.config.audioPreference;if(!n&&d){const g=si(d,u,kn);if(g>-1)n=u[g];else{const v=si(d,this.tracks);n=this.tracks[v]}}let h=this.findTrackId(n);h===-1&&n&&(h=this.findTrackId(null));const m={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,m);const p=this.trackId;if(h!==-1&&p===-1)this.setAudioTrack(h);else if(u.length&&p===-1){var a;const g=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${u.length}`);this.warn(g.message),this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:g})}}}onError(e,t){t.fatal||!t.context||t.context.type===ut.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&Rn(e,i,kn))return i;const n=si(e,this.tracksInGroup,kn);if(n>-1){const a=this.tracksInGroup[n];return this.setAudioTrack(n),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const u=K_(e,t.levels,s,a,kn);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const a=si(e,s);if(a>-1)return s[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],n=i.details&&!i.details.live;if(e===this.trackId&&i===s&&n||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,Et({},i)),n))return;const a=this.switchParams(i.url,s==null?void 0:s.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Rn(e,i,kn)))return s}if(e){const{name:s,lang:i,assocLang:n,characteristics:a,audioCodec:u,channels:d}=e;for(let h=0;h<t.length;h++){const m=t[h];if(Rn({name:s,lang:i,assocLang:n,characteristics:a,audioCodec:u,channels:d},m,kn))return h}for(let h=0;h<t.length;h++){const m=t[h];if(Go(e.attrs,m.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){const m=t[h];if(Go(e.attrs,m.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Dc(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,u=a==null?void 0:a.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:n,id:s,groupId:i,deliveryDirectives:t||null,track:e})}}class P2{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(n){var s;if(i.onError(n),this.queues===null||this.tracks===null)return;const a=(s=this.tracks[e])==null?void 0:s.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],i=s==null?void 0:s.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const sx=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,by="HlsJsTrackRemovedError";class D2 extends Error{constructor(e){super(e),this.name=by}}class O2 extends Ar{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:i,mediaSource:n}=this;s&&this.log("Media source opened"),!(!i||!n)&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(A.MEDIA_ATTACHED,{media:i,mediaSource:n}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:i}=this;s!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=i_(rn(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_APPENDING,this.onBufferAppending,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.BUFFER_EOS,this.onBufferEos,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.FRAG_PARSED,this.onFragParsed,this),e.on(A.FRAG_CHANGED,this.onFragChanged,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_APPENDING,this.onBufferAppending,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_EOS,this.onBufferEos,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.FRAG_PARSED,this.onFragParsed,this),e.off(A.FRAG_CHANGED,this.onFragChanged,this),e.off(A.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const n=this.isUpdating();n||this.operationQueue.removeBlockers();const a=this.isQueued();(n||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${n?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?kt(s,i.tracks):this.sourceBuffers.forEach(n=>{const[a]=n;a&&(s[a]=kt({},this.tracks[a]),this.removeBuffer(a)),n[0]=n[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const i=rn(this.appendSource);if(i){const n=!!t.mediaSource;(n||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),n)this._objectUrl=s.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{s.removeAttribute("src");const d=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||d&&a instanceof d,rx(s),$2(s,u),s.load()}catch{s.src=u}else s.src=u}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,n=i?Object.keys(i):null,a=n?n.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&n&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Lt(s,(d,h)=>d==="initSegment"?void 0:h)};
transfer tracks: ${Lt(i,(d,h)=>d==="initSegment"?void 0:h)}}`),!gv(i,s)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,h=this.details,m=Math.max(d,(h==null?void 0:h.fragments[0].start)||0);if(m-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${m}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${m} currentTime: ${d}`),this.onMediaDetaching(A.MEDIA_DETACHING,{}),this.onMediaAttaching(A.MEDIA_ATTACHING,t),e.currentTime=m;return}this.transferData=void 0,n.forEach(d=>{const h=d,m=i[h];if(m){const p=m.buffer;if(p){const g=this.fragmentTracker,v=m.id;if(g.hasFragments(v)||g.hasParts(v)){const b=rt.getBuffered(p);g.detectEvictedFragments(h,b,v,null,!0)}const y=uh(h),S=[h,p];this.sourceBuffers[y]=S,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,m)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:n,_objectUrl:a}=this;if(n){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=n.readyState==="open";try{const d=n.sourceBuffers;for(let h=d.length;h--;)u&&d[h].abort(),n.removeSourceBuffer(d[h]);u&&n.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&rx(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(A.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(n){this.warn(`onBufferReset ${e}`,n)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[uh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new P2(this.tracks)}onBufferCodecs(e,t){var s;const i=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),u=!a&&this.sourceBufferCount&&this.media&&n.some(d=>!i[d]);if(a||u){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${n}" SourceBuffers`);return}n.forEach(d=>{var h,m;const p=t[d],{id:g,codec:v,levelCodec:y,container:S,metadata:b,supplemental:T}=p;let _=i[d];const k=(h=this.transferData)==null||(h=h.tracks)==null?void 0:h[d],I=k!=null&&k.buffer?k:_,C=(I==null?void 0:I.pendingCodec)||(I==null?void 0:I.codec),$=I==null?void 0:I.levelCodec;_||(_=i[d]={buffer:void 0,listeners:[],codec:v,supplemental:T,container:S,levelCodec:y,metadata:b,id:g});const N=yc(C,$),O=N==null?void 0:N.replace(sx,"$1");let j=yc(v,y);const D=(m=j)==null?void 0:m.replace(sx,"$1");j&&N&&O!==D&&(d.slice(0,5)==="audio"&&(j=jc(j,this.appendSource)),this.log(`switching codec ${C} to ${j}`),j!==(_.pendingCodec||_.codec)&&(_.pendingCodec=j),_.container=S,this.appendChangeType(d,S,j))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,n={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const u=a.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),u.changeType(i),a.codec=s,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(n,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,Ce.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var u;const d=this.tracks.video;(this.lastVideoAppendEnd>i||d!=null&&d.buffer&&rt.isBuffered(d.buffer,i)||((u=this.fragmentTracker.getAppendedFrag(i,Ce.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:n,parent:a,frag:u,part:d,chunkMeta:h,offset:m}=t,p=h.buffering[n],{sn:g,cc:v}=u,y=self.performance.now();p.start=y;const S=u.stats.buffering,b=d?d.stats.buffering:null;S.start===0&&(S.start=y),b&&b.start===0&&(b.start=y);const T=s.audio;let _=!1;n==="audio"&&(T==null?void 0:T.container)==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const k=s.video,I=k==null?void 0:k.buffer;if(I&&g!=="initSegment"){const N=d||u,O=this.blockedAudioAppend;if(n==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(k.ending||k.ended)){const D=N.start+N.duration*.05,G=I.buffered,X=this.currentOp("video");!G.length&&!X?this.blockAudio(N):!X&&!rt.isBuffered(I,D)&&this.lastVideoAppendEnd<D&&this.blockAudio(N)}else if(n==="video"){const j=N.end;if(O){const D=O.frag.start;(j>D||j<this.lastVideoAppendEnd||rt.isBuffered(I,D))&&this.unblockAudio()}this.lastVideoAppendEnd=j}}const C=(d||u).start,$={label:`append-${n}`,execute:()=>{var N;p.executeStart=self.performance.now();const O=(N=this.tracks[n])==null?void 0:N.buffer;O&&(_?this.updateTimestampOffset(O,C,.1,n,g,v):m!==void 0&&Ae(m)&&this.updateTimestampOffset(O,m,1e-6,n,g,v)),this.appendExecutor(i,n)},onStart:()=>{},onComplete:()=>{const N=self.performance.now();p.executeEnd=p.end=N,S.first===0&&(S.first=N),b&&b.first===0&&(b.first=N);const O={};this.sourceBuffers.forEach(([j,D])=>{j&&(O[j]=rt.getBuffered(D))}),this.appendErrors[n]=0,n==="audio"||n==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(A.BUFFER_APPENDED,{type:n,frag:u,part:d,chunkMeta:h,parent:u.type,timeRanges:O})},onError:N=>{var O;const j={type:Ue.MEDIA_ERROR,parent:u.type,details:Z.BUFFER_APPEND_ERROR,sourceBufferName:n,frag:u,part:d,chunkMeta:h,error:N,err:N,fatal:!1},D=(O=this.media)==null?void 0:O.error;if(N.code===DOMException.QUOTA_EXCEEDED_ERR||N.name=="QuotaExceededError"||"quota"in N)j.details=Z.BUFFER_FULL_ERROR;else if(N.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!D)j.errorAction=ka(!0);else if(N.name===by&&this.sourceBufferCount===0)j.errorAction=ka(!0);else{const G=++this.appendErrors[n];this.warn(`Failed ${G}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${n}" sourceBuffer (${D||"no media error"})`),(G>=this.hls.config.appendErrorMaxRetry||D)&&(j.fatal=!0)}this.hls.trigger(A.ERROR,j)}};this.log(`queuing "${n}" append sn: ${g}${d?" p: "+d.index:""} of ${u.type===Ce.MAIN?"level":"track"} ${u.level} cc: ${v}`),this.append($,n,this.isPending(this.tracks[n]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(A.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:n}=t;s?this.append(this.getFlushOp(s,i,n),s):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,n),a)})}onFragParsed(e,t){const{frag:s,part:i}=t,n=[],a=i?i.elementaryStreams:s.elementaryStreams;a[It.AUDIOVIDEO]?n.push("audiovideo"):(a[It.AUDIO]&&n.push("audio"),a[It.VIDEO]&&n.push("video"));const u=()=>{const d=self.performance.now();s.stats.buffering.end=d,i&&(i.stats.buffering.end=d);const h=i?i.stats:s.stats;this.hls.trigger(A.FRAG_BUFFERED,{frag:s,part:i,stats:h,id:s.type})};n.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(u,n).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([a])=>{if(a){const u=this.tracks[a];(!t.type||t.type===a)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var u;return a&&!((u=this.tracks[a])!=null&&u.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(A.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(A.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Z.BUFFER_APPEND_ERROR&&t.frag){var s;const i=(s=t.errorAction)==null?void 0:s.nextAutoLevel;Ae(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const i=e.config,n=s.currentTime,a=t.levelTargetDuration,u=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(Ae(u)&&u>=0){const h=Math.max(u,a),m=Math.floor(n/a)*a-h;this.flushBackBuffer(n,a,m)}const d=i.frontBufferFlushThreshold;if(Ae(d)&&d>0){const h=Math.max(i.maxBufferLength,d),m=Math.max(h,a),p=Math.floor(n/a)*a+m;this.flushFrontBuffer(n,a,p)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([i,n])=>{if(n){const u=rt.getBuffered(n);if(u.length>0&&s>u.start(0)){var a;this.hls.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:s});const d=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(d!=null&&d.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:i})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([i,n])=>{if(n){const a=rt.getBuffered(n),u=a.length;if(u<2)return;const d=a.start(u-1),h=a.end(u-1);if(s>d||e>=d&&e<=h)return;this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const h=Math.max(0,t.fragmentStart),m=Math.max(h,i);return{duration:1/0,start:h,end:m}}return{duration:1/0}}const n=(e=this.overrides)==null?void 0:e.duration;if(n)return Ae(n)?{duration:n}:null;const a=this.media.duration,u=Ae(s.duration)?s.duration:0;return i>u&&i>a||!Ae(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:s}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(Ae(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${s}.`),i.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Lt(s)}`),this.tracksReady){var i;const n=(i=this.transferData)==null?void 0:i.tracks;n&&Object.keys(n).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(A.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const n in e){const a=n,u=e[a];if(this.isPending(u)){const d=this.getTrackCodec(u,a),h=`${u.container};codecs=${d}`;u.codec=d,this.log(`creating sourceBuffer(${h})${this.currentOp(a)?" Queued":""} ${Lt(u)}`);try{const m=s.addSourceBuffer(h),p=uh(a),g=[a,m];t[p]=g,u.buffer=m}catch(m){var i;this.error(`error while trying to add sourceBuffer: ${m.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:a,mimeType:h,parent:u.id});return}this.trackSourceBuffer(a,u)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&(t==="video"||t==="audiovideo")&&$o(s,"video")&&(i=k_(i,s));const n=yc(i,e.levelCodec);return n?t.slice(0,5)==="audio"?jc(n,this.appendSource):n:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(n,a)=>{const u=a.removedRanges;u!=null&&u.length&&this.hls.trigger(A.BUFFER_FLUSHED,{type:n})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const n=this.currentOp(e);n&&n.onError(i)}updateTimestampOffset(e,t,s,i,n,a){const u=t-e.timestampOffset;Math.abs(u)>=s&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${n} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:i,mediaSource:n}=this,a=this.tracks[e],u=a==null?void 0:a.buffer;if(!i||!n||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=Ae(i.duration)?i.duration:1/0,h=Ae(n.duration)?n.duration:1/0,m=Math.max(0,t),p=Math.min(s,d,h);p>m&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${m},${p}] from the ${e} SourceBuffer`),u.remove(m,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=s==null?void 0:s.buffer;if(!i)throw new D2(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const i=(s=this.tracks[t])==null?void 0:s.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const n=i.buffer;if(!n)return;const a=s.bind(this,e);i.listeners.push({event:t,listener:a}),n.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(i=>{s.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function rx(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function $2(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function uh(r){return r==="audio"?1:0}class Ff{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ae(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((i,n)=>this.isLevelAllowed(i)&&n<=e);return this.clientRect=null,Ff.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const i=(u,d)=>d?u.width!==d.width||u.height!==d.height:!0;let n=e.length-1;const a=Math.max(t,s);for(let u=0;u<e.length;u+=1){const d=e[u];if((d.width>=a||d.height>=a)&&i(d,e[u+1])){n=u;break}}return n}}const M2={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Zs=M2,F2={HLS:"h"},U2=F2;class ni{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof ni?s:new ni(s))),this.value=e,this.params=t}}const B2="Dict";function z2(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function G2(r,e,t,s){return new Error(`failed to ${r} "${z2(e)}" as ${t}`,{cause:s})}function ai(r,e,t){return G2("serialize",r,e,t)}class wy{constructor(e){this.description=e}}const ix="Bare Item",V2="Boolean";function K2(r){if(typeof r!="boolean")throw ai(r,V2);return r?"?1":"?0"}function W2(r){return btoa(String.fromCharCode(...r))}const H2="Byte Sequence";function q2(r){if(ArrayBuffer.isView(r)===!1)throw ai(r,H2);return`:${W2(r)}:`}const Y2="Integer";function Q2(r){return r<-999999999999999||999999999999999<r}function Sy(r){if(Q2(r))throw ai(r,Y2);return r.toString()}function X2(r){return`@${Sy(r.getTime()/1e3)}`}function Ey(r,e){if(r<0)return-Ey(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const i=Math.floor(r*t);return(i%2===0?i:i+1)/t}else return Math.round(r*t)/t}const J2="Decimal";function Z2(r){const e=Ey(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ai(r,J2);const t=e.toString();return t.includes(".")?t:`${t}.0`}const eA="String",tA=/[\x00-\x1f\x7f]+/;function sA(r){if(tA.test(r))throw ai(r,eA);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function rA(r){return r.description||r.toString().slice(7,-1)}const iA="Token";function nx(r){const e=rA(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ai(e,iA);return e}function tf(r){switch(typeof r){case"number":if(!Ae(r))throw ai(r,ix);return Number.isInteger(r)?Sy(r):Z2(r);case"string":return sA(r);case"symbol":return nx(r);case"boolean":return K2(r);case"object":if(r instanceof Date)return X2(r);if(r instanceof Uint8Array)return q2(r);if(r instanceof wy)return nx(r);default:throw ai(r,ix)}}const nA="Key";function sf(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw ai(r,nA);return r}function Uf(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${sf(e)}`:`;${sf(e)}=${tf(t)}`).join("")}function Ty(r){return r instanceof ni?`${tf(r.value)}${Uf(r.params)}`:tf(r)}function aA(r){return`(${r.value.map(Ty).join(" ")})${Uf(r.params)}`}function oA(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw ai(r,B2);const t=r instanceof Map?r.entries():Object.entries(r),s=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,n])=>{n instanceof ni||(n=new ni(n));let a=sf(i);return n.value===!0?a+=Uf(n.params):(a+="=",Array.isArray(n.value)?a+=aA(n):a+=Ty(n)),a}).join(`,${s}`)}function _y(r,e){return oA(r,e)}const Xr="CMCD-Object",Zt="CMCD-Request",En="CMCD-Session",Yi="CMCD-Status",lA={br:Xr,ab:Xr,d:Xr,ot:Xr,tb:Xr,tpb:Xr,lb:Xr,tab:Xr,lab:Xr,url:Xr,pb:Zt,bl:Zt,tbl:Zt,dl:Zt,ltc:Zt,mtp:Zt,nor:Zt,nrr:Zt,rc:Zt,sn:Zt,sta:Zt,su:Zt,ttfb:Zt,ttfbb:Zt,ttlb:Zt,cmsdd:Zt,cmsds:Zt,smrt:Zt,df:Zt,cs:Zt,ts:Zt,cid:En,pr:En,sf:En,sid:En,st:En,v:En,msd:En,bs:Yi,bsd:Yi,cdn:Yi,rtp:Yi,bg:Yi,pt:Yi,ec:Yi,e:Yi},cA={REQUEST:Zt};function uA(r){return Object.keys(r).reduce((e,t)=>{var s;return(s=r[t])===null||s===void 0||s.forEach(i=>e[i]=t),e},{})}function dA(r,e){const t={};if(!r)return t;const s=Object.keys(r),i=e?uA(e):{};return s.reduce((n,a)=>{var u;const d=lA[a]||i[a]||cA.REQUEST,h=(u=n[d])!==null&&u!==void 0?u:n[d]={};return h[a]=r[a],n},t)}function hA(r){return["ot","sf","st","e","sta"].includes(r)}function fA(r){return typeof r=="number"?Ae(r):r!=null&&r!==""&&r!==!1}const ky="event";function mA(r,e){const t=new URL(r),s=new URL(e);if(t.origin!==s.origin)return r;const i=t.pathname.split("/").slice(1),n=s.pathname.split("/").slice(1,-1);for(;i[0]===n[0];)i.shift(),n.shift();for(;n.length;)n.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const Tc=r=>Math.round(r),rf=(r,e)=>Array.isArray(r)?r.map(t=>rf(t,e)):r instanceof ni&&typeof r.value=="string"?new ni(rf(r.value,e),r.params):(e.baseUrl&&(r=mA(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),lc=r=>Tc(r/100)*100,pA=(r,e)=>{let t=r;return e.version>=2&&(r instanceof ni&&typeof r.value=="string"?t=new ni([r]):typeof r=="string"&&(t=[r])),rf(t,e)},gA={br:Tc,d:Tc,bl:lc,dl:lc,mtp:lc,nor:pA,rtp:lc,tb:Tc},Ay="request",Iy="response",Bf=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],xA=["e"],vA=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Qc(r){return vA.test(r)}function yA(r){return Bf.includes(r)||xA.includes(r)||Qc(r)}const Ly=["d","dl","nor","ot","rtp","su"];function bA(r){return Bf.includes(r)||Ly.includes(r)||Qc(r)}const wA=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function SA(r){return Bf.includes(r)||Ly.includes(r)||wA.includes(r)||Qc(r)}const EA=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function TA(r){return EA.includes(r)||Qc(r)}const _A={[Iy]:SA,[ky]:yA,[Ay]:bA};function Ry(r,e={}){const t={};if(r==null||typeof r!="object")return t;const s=e.version||r.v||1,i=e.reportingMode||Ay,n=s===1?TA:_A[i];let a=Object.keys(r).filter(n);const u=e.filter;typeof u=="function"&&(a=a.filter(u));const d=i===Iy||i===ky;d&&!a.includes("ts")&&a.push("ts"),s>1&&!a.includes("v")&&a.push("v");const h=kt({},gA,e.formatters),m={version:s,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(p=>{let g=r[p];const v=h[p];if(typeof v=="function"&&(g=v(g,m)),p==="v"){if(s===1)return;g=s}p=="pr"&&g===1||(d&&p==="ts"&&!Ae(g)&&(g=Date.now()),fA(g)&&(hA(p)&&typeof g=="string"&&(g=new wy(g)),t[p]=g))}),t}function kA(r,e={}){const t={};if(!r)return t;const s=Ry(r,e),i=dA(s,e==null?void 0:e.customHeaderMap);return Object.entries(i).reduce((n,[a,u])=>{const d=_y(u,{whitespace:!1});return d&&(n[a]=d),n},t)}function AA(r,e,t){return kt(r,kA(e,t))}const IA="CMCD";function LA(r,e={}){return r?_y(Ry(r,e),{whitespace:!1}):""}function RA(r,e={}){if(!r)return"";const t=LA(r,e);return encodeURIComponent(t)}function NA(r,e={}){if(!r)return"";const t=RA(r,e);return`${IA}=${t}`}const ax=/CMCD=[^&#]+/;function CA(r,e,t){const s=NA(e,t);if(!s)return r;if(ax.test(r))return r.replace(ax,s);const i=r.includes("?")?"&":"?";return`${r}${i}${s}`}class jA{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Zs.MANIFEST,su:!this.initialized})}catch(n){this.hls.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=i=>{try{const{frag:n,part:a}=i,u=this.hls.levels[n.level],d=this.getObjectType(n),h={d:(a||n).duration*1e3,ot:d};(d===Zs.VIDEO||d===Zs.AUDIO||d==Zs.MUXED)&&(h.br=u.bitrate/1e3,h.tb=this.getTopBandwidth(d)/1e3,h.bl=this.getBufferLength(d));const m=a?this.getNextPart(a):this.getNextFrag(n);m!=null&&m.url&&m.url!==n.url&&(h.nor=m.url),this.apply(i,h)}catch(n){this.hls.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:U2.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){kt(t,this.createData());const s=t.ot===Zs.INIT||t.ot===Zs.VIDEO||t.ot===Zs.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,u)=>(i.includes(u)&&(a[u]=t[u]),a),{}));const n={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),AA(e.headers,t,n)):e.url=CA(e.url,t,n)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const i=e.sn-s.startSN;return s.fragments[i+1]}}getNextPart(e){var t;const{index:s,fragment:i}=e,n=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(n){const{sn:a}=i;for(let u=n.length-1;u>=0;u--){const d=n[u];if(d.index===s&&d.fragment.sn===a)return n[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Zs.TIMED_TEXT;if(e.sn==="initSegment")return Zs.INIT;if(t==="audio")return Zs.AUDIO;if(t==="main")return this.hls.audioTracks.length?Zs.VIDEO:Zs.MUXED}getTopBandwidth(e){let t=0,s;const i=this.hls;if(e===Zs.AUDIO)s=i.audioTracks;else{const n=i.maxAutoLevel,a=n>-1?n+1:i.levels.length;s=i.levels.slice(0,a)}return s.forEach(n=>{n.bitrate>t&&(t=n.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Zs.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:rt.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new s(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,u){t(n),this.loader.load(n,a,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new s(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,u){t(n),this.loader.load(n,a,u)}}}}const PA=3e5;class DA extends Ar{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((s==null?void 0:s.action)===js.SendAlternateToPenaltyBox&&s.flags===ur.MoveAllAlternatesMatchingHost){const i=this.levels;let n=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:u,pathwayId:d,type:h}=t.context;u&&i?a=this.getPathwayForGroupId(u,h,a):d&&(a=d)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!n&&i&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),s.resolved=this.pathwayId!==a),t.details===Z.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${Lt(n)} penalized: ${Lt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach(n=>{i-s[n]>PA&&delete s[n]});for(let n=0;n<e.length;n++){const a=e[n];if(a in s)continue;if(a===this.pathwayId)return;const u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Qv(t),this.hls.trigger(A.LEVELS_UPDATED,{levels:t});const h=this.hls.levels[u];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let n=0;n<i.length;n++)if(t===ut.AUDIO_TRACK&&i[n].hasAudioGroup(e)||t===ut.SUBTITLE_TRACK&&i[n].hasSubtitleGroup(e))return i[n].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach(n=>{const{ID:a,"BASE-ID":u,"URI-REPLACEMENT":d}=n;if(t.some(m=>m.pathwayId===a))return;const h=this.getLevelsForPathway(u).map(m=>{const p=new Wt(m.attrs);p["PATHWAY-ID"]=a;const g=p.AUDIO&&`${p.AUDIO}_clone_${a}`,v=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;g&&(s[p.AUDIO]=g,p.AUDIO=g),v&&(i[p.SUBTITLES]=v,p.SUBTITLES=v);const y=Ny(m.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),S=new Fo({attrs:p,audioCodec:m.audioCodec,bitrate:m.bitrate,height:m.height,name:m.name,url:y,videoCodec:m.videoCodec,width:m.width});if(m.audioGroups)for(let b=1;b<m.audioGroups.length;b++)S.addGroupId("audio",`${m.audioGroups[b]}_clone_${a}`);if(m.subtitleGroups)for(let b=1;b<m.subtitleGroups.length;b++)S.addGroupId("text",`${m.subtitleGroups[b]}_clone_${a}`);return S});t.push(...h),ox(this.audioTracks,s,d,a),ox(this.subtitleTracks,i,d,a)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const m=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+m)}const n={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,u=a.errorRetry||a.timeoutRetry||{},d={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},h={onSuccess:(m,p,g,v)=>{this.log(`Loaded steering manifest: "${i}"`);const y=m.data;if((y==null?void 0:y.VERSION)!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":b,"PATHWAY-PRIORITY":T}=y;if(S)try{this.uri=new self.URL(S,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||g.url),b&&this.clonePathways(b);const _={steeringManifest:y,url:i.toString()};this.hls.trigger(A.STEERING_MANIFEST_LOADED,_),T&&this.updatePathwayPriority(T)},onError:(m,p,g,v)=>{if(this.log(`Error loading steering manifest: ${m.code} ${m.text} (${p.url})`),this.stopLoad(),m.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let y=this.timeToLoad*1e3;if(m.code===429){const S=this.loader;if(typeof(S==null?void 0:S.getResponseHeader)=="function"){const b=S.getResponseHeader("Retry-After");b&&(y=parseFloat(b)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,y)},onTimeout:(m,p,g)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(n,d,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const i=(s=this.hls)==null?void 0:s.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function ox(r,e,t,s){r&&Object.keys(e).forEach(i=>{const n=r.filter(a=>a.groupId===i).map(a=>{const u=kt({},a);return u.details=void 0,u.attrs=new Wt(u.attrs),u.url=u.attrs.URI=Ny(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[i],u.attrs["PATHWAY-ID"]=s,u});r.push(...n)})}function Ny(r,e,t,s){const{HOST:i,PARAMS:n,[t]:a}=s;let u;e&&(u=a==null?void 0:a[e],u&&(r=u));const d=new self.URL(r);return i&&!u&&(d.host=i),n&&Object.keys(n).sort().forEach(h=>{h&&d.searchParams.set(h,n[h])}),d.href}class Ia extends Ar{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Ia.CDMCleanupPromise?[Ia.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:i}=t,n=`"${t.type}" event: init data type: "${s}"`;if(this.debug(n),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=bo(this.config));const u=a.map(sh).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(a=>{const u=wc(a);if(s!=="sinf"||u!==qt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${u}`);return}let d;try{const v=gs(new Uint8Array(i)),y=Lf(JSON.parse(v).sinf),S=_v(y);if(!S)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(S.subarray(8,24))}catch(v){this.warn(`${n} Failed to parse sinf: ${v}`);return}const h=Ps(d),{keyIdToKeySessionPromise:m,mediaKeySessions:p}=this;let g=m[h];for(let v=0;v<p.length;v++){const y=p[v],S=y.decryptdata;if(!S.keyId)continue;const b=Ps(S.keyId);if(Mc(d,S.keyId)||S.uri.replace(/-/g,"").indexOf(h)!==-1){if(g=m[b],!g)continue;if(S.pssh)break;delete m[b],S.pssh=new Uint8Array(i),S.keyId=d,g=m[h]=g.then(()=>this.generateRequestWithPreferredKeySession(y,s,i,"encrypted-event-key-match")),g.catch(T=>this.handleError(T));break}}g||this.handleError(new Error(`Key ID ${h} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(A.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(A.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t==null?void 0:t[e];if(i)return i.licenseUrl;if(e===qt.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t==null?void 0:t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(a,u,d)=>!!a&&d.indexOf(a)===u,i=t.map(a=>a.audioCodec).filter(s),n=t.map(a=>a.videoCodec).filter(s);return i.length+n.length===0&&n.push("avc1.42e01e"),new Promise((a,u)=>{const d=h=>{const m=h.shift();this.getMediaKeysPromise(m,i,n).then(p=>a({keySystem:m,mediaKeys:p})).catch(p=>{h.length?d(h):p instanceof cr?u(p):u(new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${s}`;return zv===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return s(e,t)}getMediaKeysPromise(e,t,s){var i;const n=pk(e,t,s,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],u=(i=a)==null?void 0:i.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Lt(n)}`),u=this.requestMediaKeySystemAccess(e,n);const d=a=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(h=>{this.log(`Failed to obtain access to key-system "${e}": ${h}`)}),u.then(h=>{this.log(`Access for key-system "${h.keySystem}" obtained`);const m=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=d.mediaKeys=h.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),d.hasMediaKeys=!0,m.then(v=>v?this.setMediaKeysServerCertificate(g,e,v):g)));return p.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),p})}return u.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Ps(e.keyId||[])} keyUri: ${e.uri}`);const i=s.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=cc(t),n="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,n,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Ps(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>sh(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const n=sh(i);n?t(n):s(new Error(`Unable to find format for key-system "${i}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=bo(this.config),s=e.map(wc).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const i=OA(e,t[s]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,s=cc(t),i=this.bannedKeyIds[s];if(i||this.getKeyStatus(t)==="internal-error"){const u=lx(i||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const n=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);const a=this.keyIdToKeySessionPromise[s];if(!a){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:d,mediaKeys:h})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(d,h).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:h,decryptdata:t}))))).then(d=>{const h="cenc",m=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,h,m,"playlist-key")});return u.catch(d=>this.handleError(d,e.frag)),this.keyIdToKeySessionPromise[s]=u,u}return a.catch(u=>{if(u instanceof cr){const d=Et({},u.data);this.getKeyStatus(t)==="internal-error"&&(d.decryptdata=t);const h=new cr(d,u.message);this.handleError(h,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof cr){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Ps(s.keyId||[])})`:""}`),this.hls.trigger(A.ERROR,e.data)}else this.error(e.message),this.hls.trigger(A.ERROR,{type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=cc(e),s=this.keyIdToKeySessionPromise[t];if(!s){const i=wc(e.keyFormat),n=i?[i]:bo(this.config);return this.attemptKeySystemAccess(n)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=bo(this.config)),e.length===0)throw new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Lt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((n,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(n).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(n=>s.indexOf(n)===-1)})}generateRequestWithPreferredKeySession(e,t,s,i){var n;const a=(n=this.config.drmSystems)==null||(n=n[e.keySystem])==null?void 0:n.generateRequest;if(a)try{const y=a.call(this.hls,t,s,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");t=y.initDataType,s=y.initData?y.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(y){if(this.warn(y.message),this.hls&&this.hls.config.debug)throw y}if(s===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const u=cc(e.decryptdata),d=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${u} URI: ${d} (init data type: ${t} length: ${s.byteLength})`);const h=new Nf,m=e._onmessage=y=>{const S=e.mediaKeysSession;if(!S){h.emit("error",new Error("invalid state"));return}const{messageType:b,message:T}=y;this.log(`"${b}" message event for session "${S.sessionId}" message size: ${T.byteLength}`),b==="license-request"||b==="license-renewal"?this.renewLicense(e,T).catch(_=>{h.eventNames().length?h.emit("error",_):this.handleError(_)}):b==="license-release"?e.keySystem===qt.FAIRPLAY&&this.updateKeySession(e,Yh("acknowledged")).then(()=>this.removeSession(e)).catch(_=>this.handleError(_)):this.warn(`unhandled media key message type "${b}"`)},p=(y,S)=>{S.keyStatus=y;let b;y.startsWith("usable")?h.emit("resolved"):y==="internal-error"||y==="output-restricted"||y==="output-downscaled"?b=lx(y,S.decryptdata):y==="expired"?b=new Error(`key expired (keyId: ${u})`):y==="released"?b=new Error("key released"):y==="status-pending"||this.warn(`unhandled key status change "${y}" (keyId: ${u})`),b&&(h.eventNames().length?h.emit("error",b):this.handleError(b))},g=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){h.emit("error",new Error("invalid state"));return}const b=this.getKeyStatuses(e);if(!Object.keys(b).some(I=>b[I]!=="status-pending"))return;if(b[u]==="expired"){this.log(`Expired key ${Lt(b)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let _=b[u];if(_)p(_,e);else{var k;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(k=e.keyStatusTimeouts)[u]||(k[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const C=this.getKeyStatus(e.decryptdata);if(C&&C!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${C} from other session.`),p(C,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),_="internal-error",p(_,e)},1e3)),this.log(`No status for keyId ${u} (${Lt(b)}).`)}};Ks(e.mediaKeysSession,"message",m),Ks(e.mediaKeysSession,"keystatuseschange",g);const v=new Promise((y,S)=>{h.on("error",S),h.on("resolved",y)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${d}`)}).catch(y=>{throw new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_SESSION,error:y,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>v).catch(y=>(h.removeAllListeners(),this.removeSession(e).then(()=>{throw y}))).then(()=>(h.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,i)=>{if(typeof i=="string"&&typeof s=="object"){const u=i;i=s,s=u}const n="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===qt.PLAYREADY&&n.length===16){const u=Ps(n);t[u]=s,Uv(n)}const a=Ps(n);s==="internal-error"&&(this.bannedKeyIds[a]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,i=new s(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,u)=>{const d={responseType:"arraybuffer",url:n},h=t.certLoadPolicy.default,m={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(g,v,y,S)=>{a(g.data)},onError:(g,v,y,S)=>{u(new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:Et({url:d.url,data:void 0},g)},`"${e}" certificate request failed (${n}). Status: ${g.code} (${g.text})`))},onTimeout:(g,v,y)=>{u(new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(g,v,y)=>{u(new Error("aborted"))}};i.load(d,m,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((i,n)=>{e.setServerCertificate(s).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),i(e)}).catch(a=>{n(new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(i=>{throw new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(s,"application/xml"),n=i.querySelectorAll("HttpHeader");if(n.length>0){let m;for(let p=0,g=n.length;p<g;p++){var a,u;m=n[p];const v=(a=m.querySelector("name"))==null?void 0:a.textContent,y=(u=m.querySelector("value"))==null?void 0:u.textContent;v&&y&&e.setRequestHeader(v,y)}}const d=i.querySelector("Challenge"),h=d==null?void 0:d.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return Yh(atob(h))}setupLicenseXHR(e,t,s,i){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,s,i)}).catch(a=>{if(!s.decryptdata)throw a;return e.open("POST",t,!0),n.call(this.hls,e,t,s,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((i,n)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let d=u.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const h=this.config.licenseResponseCallback;if(h)try{d=h.call(this.hls,u,a,e)}catch(m){this.error(m)}i(d)}else{const d=s.errorRetry,h=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||u.status>=400&&u.status<500)n(new cr({type:Ue.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:a,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${a}). Status: ${u.status} (${u.statusText})`));else{const m=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${m} attempts left`),this.requestLicense(e,t).then(i,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,a,e,t).then(({xhr:d,licenseChallenge:h})=>{e.keySystem==qt.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(d,h)),d.send(h)}).catch(n)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Ks(s,"encrypted",this.onMediaEncrypted),Ks(s,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(tr(e,"encrypted",this.onMediaEncrypted),tr(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,sn.clearKeyUriToKeyIdMap();const n=i.length;Ia.CDMCleanupPromise=Promise.all(i.map(a=>this.removeSession(a)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((i,n)=>(i.indexOf(n.keyFormat)===-1&&i.push(n.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Ps((i==null?void 0:i.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(h=>self.clearTimeout(a[h]));const{drmSystemOptions:u}=this.config;return(xk(u)?new Promise((h,m)=>{self.setTimeout(()=>m(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(h).catch(m)}):Promise.resolve()).catch(h=>{this.log(`Could not remove session: ${h}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${h}`)})}).then(()=>t.close()).catch(h=>{this.log(`Could not close session: ${h}`),this.hls&&this.hls.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${h}`)})})}return Promise.resolve()}}Ia.CDMCleanupPromise=void 0;function cc(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return Ps(r.keyId)}function OA(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class cr extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function lx(r,e){const t=r==="output-restricted",s=t?Z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new cr({type:Ue.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class $A{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const n=i-this.lastTime,a=s-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*a/n,h=this.hls;if(h.trigger(A.FPS_DROP,{currentDropped:a,currentDecoded:u,totalDroppedFrames:s}),d>0&&a>h.config.fpsDroppedMonitoringThreshold*u){let m=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=m)&&(m=m-1,h.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:h.currentLevel}),h.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Cy(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function jy(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Tt.debug(`[texttrack-utils]: ${s}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,r.addCue(i)}catch(i){Tt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(r.mode=t)}function Ta(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let s=r.cues.length;s--;)e&&r.cues[s].removeEventListener("enter",e),r.removeCue(r.cues[s]);t==="disabled"&&(r.mode=t)}function nf(r,e,t,s){const i=r.mode;if(i==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const n=FA(r.cues,e,t);for(let a=0;a<n.length;a++)(!s||s(n[a]))&&r.removeCue(n[a])}i==="disabled"&&(r.mode=i)}function MA(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let s=0,i=t,n;for(;s<=i;)if(n=Math.floor((i+s)/2),e<r[n].startTime)i=n-1;else if(e>r[n].startTime&&s<t)s=n+1;else return n;return r[s].startTime-e<e-r[i].startTime?s:i}function FA(r,e,t){const s=[],i=MA(r,e);if(i>-1)for(let n=i,a=r.length;n<a;n++){const u=r[n];if(u.startTime>=e&&u.endTime<=t)s.push(u);else if(u.startTime>t)return s}return s}function _c(r){const e=[];for(let t=0;t<r.length;t++){const s=r[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(r[t])}return e}class UA extends Mf{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=_c(this.media.textTracks);for(let n=0;n<s.length;n++)if(s[n].mode==="hidden")t=s[n];else if(s[n].mode==="showing"){t=s[n];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;_c(s.textTracks).forEach(a=>{Ta(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:n}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Subtitle track ${s} "${a.name}" lang:${a.lang} group:${i} loaded [${n.startSN}-${n.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let n=this.currentTrack;if(!s||(i==null?void 0:i.length)!==(s==null?void 0:s.length)||s!=null&&s.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(m=>!s||s.indexOf(m.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(m=>m.default)&&(this.selectDefaultTrack=!1),a.forEach((m,p)=>{m.id=p});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const u=this.hls.config.subtitlePreference;if(!n&&u){this.selectDefaultTrack=!1;const m=si(u,a);if(m>-1)n=a[m];else{const p=si(u,this.tracks);n=this.tracks[p]}}let d=this.findTrackId(n);d===-1&&n&&(d=this.findTrackId(null));const h={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,h),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const n=t[i];if(!(s&&!n.default||!s&&!e)&&(!e||Rn(n,e)))return i}if(e){for(let i=0;i<t.length;i++){const n=t[i];if(Go(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const n=t[i];if(Go(e.attrs,n.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(ef(i,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ut.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Rn(e,s))return s;const i=si(e,this.tracksInGroup);if(i>-1){const n=this.tracksInGroup[i];return this.setSubtitleTrack(i),n}else{if(s)return null;{const n=si(e,t);if(n>-1)return t[n]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,u=a==null?void 0:a.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:n,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=_c(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter(n=>ef(s,n))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(n=>{n.mode!=="disabled"&&n!==i&&(n.mode="disabled")}),i){const n=this.subtitleDisplay?"showing":"hidden";i.mode!==n&&(i.mode=n)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ae(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:e});return}const n=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&n)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:u="",name:d,type:h,url:m}=i;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:a,groupId:u,name:d,type:h,url:m});const p=this.switchParams(i.url,s==null?void 0:s.details,i.details);this.loadPlaylist(p)}}function BA(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?n:n&3|8).toString(16)})}}}function ko(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const La=.025;let zc=(function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r})({});function zA(r,e,t){return`${r.identifier}-${t+1}-${ko(e)}`}class GA{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return dh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=dh(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ae(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return dh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<La))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?zc.Range:zc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return VA(this)}}function dh(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<La)?e.start:e.start+e.duration}function Py(r,e,t){const s=new self.URL(r,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function hh(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function VA(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function wa(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class KA{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(A.PLAYOUT_LIMIT_REACHED,{})};const n=this.hls=new e(t);this.interstitial=s,this.assetItem=i;const a=()=>{this.hasDetails=!0};n.once(A.LEVEL_LOADED,a),n.once(A.AUDIO_TRACK_LOADED,a),n.once(A.SUBTITLE_TRACK_LOADED,a),n.on(A.MEDIA_ATTACHING,(u,{media:d})=>{this.removeMediaListeners(),this.mediaAttached=d,this.interstitial.playoutLimit&&(d.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&n.on(A.BUFFER_APPENDED,()=>{const m=this.bufferedEnd;this.reachedPlayout(m)&&(this._bufferedEosTime=m,n.trigger(A.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Py(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,n=rt.bufferInfo(e,i,0);return this.getAssetTime(n.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=rt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,s){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,s){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${wa(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const cx=.033;class WA extends Ar{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(n=i[s])!=null&&n.event;){var n;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let n=s[i];if(t&&t!=="primary"&&(n=n[t]),e===n.start||e>n.start&&e<n.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const n=s[i].event;if(n!=null&&n.restrictions.jump&&!n.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if(((s=t[i].event)==null?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let n=0;n<i;n++){const a=s[n];if(!a.error){const u=a.timelineStart;if(t===u||t>u&&(t<u+(a.duration||0)||n===i-1))return n}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,i=s[s.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,n=this.events,a=this.parseDateRanges(i,{url:s.url},t),u=Object.keys(i),d=n?n.filter(h=>!u.includes(h.identifier)):[];a.length&&a.sort((h,m)=>{const p=h.cue.pre,g=h.cue.post,v=m.cue.pre,y=m.cue.post;if(p&&!v)return-1;if(v&&!p||g&&!y)return 1;if(y&&!g)return-1;if(!p&&!v&&!g&&!y){const S=h.startTime,b=m.startTime;if(S!==b)return S-b}return h.dateRange.tagOrder-m.dateRange.tagOrder}),this.events=a,d.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(e,d)}updateSchedule(e,t=[],s=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const n=this.items,a=this.parseSchedule(i,e);(s||t.length||(n==null?void 0:n.length)!==a.length||a.some((d,h)=>Math.abs(d.playout.start-n[h].playout.start)>.005||Math.abs(d.playout.end-n[h].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,s){const i=[],n=Object.keys(e);for(let a=0;a<n.length;a++){const u=n[a],d=e[u];if(d.isInterstitial){let h=this.eventMap[u];h?h.setDateRange(d):(h=new GA(d,t),this.eventMap[u]=h,s===!1&&(h.appendInPlace=s)),i.push(h)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,n=i.live?1/0:i.edge;let a=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,h=0;if(e.forEach((m,p)=>{const g=m.cue.pre,v=m.cue.post,y=e[p-1]||null,S=m.appendInPlace,b=v?n:m.startOffset,T=m.duration,_=m.timelineOccupancy===zc.Range?T:0,k=m.resumptionOffset,I=(y==null?void 0:y.startTime)===b,C=b+m.cumulativeDuration;let $=S?C+T:b+k;if(g||!v&&b<=0){const O=h;h+=_,m.timelineStart=C;const j=a;a+=T,s.push({event:m,start:C,end:$,playout:{start:j,end:a},integrated:{start:O,end:h}})}else if(b<=n){if(!I){const D=b-d;if(D>cx){const G=d,X=h;h+=D;const K=a;a+=D;const W={previousEvent:e[p-1]||null,nextEvent:m,start:G,end:G+D,playout:{start:K,end:a},integrated:{start:X,end:h}};s.push(W)}else D>0&&y&&(y.cumulativeDuration+=D,s[s.length-1].end=b)}v&&($=C),m.timelineStart=C;const O=h;h+=_;const j=a;a+=T,s.push({event:m,start:C,end:$,playout:{start:j,end:a},integrated:{start:O,end:h}})}else return;const N=m.resumeTime;v||N>n?d=n:d=N}),d<n){var u;const m=d,p=h,g=n-d;h+=g;const v=a;a+=g,s.push({previousEvent:((u=s[s.length-1])==null?void 0:u.event)||null,nextEvent:null,start:d,end:m+g,playout:{start:v,end:a},integrated:{start:p,end:h}})}this.setDurations(n,a,h)}else s.push({previousEvent:null,nextEvent:null,start:0,end:n,playout:{start:0,end:n},integrated:{start:0,end:n}}),this.setDurations(n,n,n);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,i=s.live?1/0:s.edge;let n=0,a=-1;e.forEach((u,d)=>{const h=u.cue.pre,m=u.cue.post,p=h?0:m?i:u.startTime;this.updateAssetDurations(u),a===p?u.cumulativeDuration=n:(n=0,a=p),!m&&u.snapOptions.in&&(u.resumeAnchor=Nn(null,s.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<cx&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const v=Ae(u.resumeOffset)?u.resumeOffset:u.duration;n+=v})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(s-i)>La?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const u=t[a].details,d=u.edge;if(s>=d)return this.log(`"${e.identifier}" resumption ${s} past ${a} playlist end ${d}`),!1;const h=Nn(null,u.fragments,s);if(!h)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${a} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const m=a==="audio"?.175:0;return Math.abs(h.start-s)<La+m||Math.abs(h.end-s)<La+m?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${a} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,n=!1;for(let a=0;a<e.assetList.length;a++){const u=e.assetList[a],d=t+s;u.startOffset=s,u.timelineStart=d,i||(i=u.duration===null),n||(n=!!u.error);const h=u.error?0:u.duration||0;s+=h}i&&!n?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Dr(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class HA{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=Py(s,this.hls.sessionId,e.baseUrl)}catch(g){const v=this.assignAssetListError(e,Z.ASSET_LIST_LOAD_ERROR,g,s);this.hls.trigger(A.ERROR,v);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const n=this.hls.config,a=n.loader,u=new a(n),d={responseType:"json",url:i.href},h=n.interstitialAssetListLoadPolicy.default,m={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(g,v,y,S)=>{const b=g.data,T=b==null?void 0:b.ASSETS;if(!Array.isArray(T)){const _=this.assignAssetListError(e,Z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,v,S);this.hls.trigger(A.ERROR,_);return}e.assetListResponse=b,this.hls.trigger(A.ASSET_LIST_LOADED,{event:e,assetListResponse:b,networkDetails:S})},onError:(g,v,y,S)=>{const b=this.assignAssetListError(e,Z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${g.code} ${g.text} (${v.url})`),v.url,S,y);this.hls.trigger(A.ERROR,b)},onTimeout:(g,v,y)=>{const S=this.assignAssetListError(e,Z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,g,y);this.hls.trigger(A.ERROR,S)}};return u.load(d,m,p),this.hls.trigger(A.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,s,i,n,a){return e.error=s,{type:Ue.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:a,stats:n}}}function ux(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function uc(r,e){return`[${r}] Advancing timeline position to ${e}`}class qA extends Ar{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const i=s-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=s,this.bufferedPos=s;const u=this.playingItem;if(!u){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(s,s-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&s<u.start||s>=u.end){var d;const v=this.findItemIndex(u);let y=this.schedule.findItemIndexAtTime(s);if(y===-1&&(y=v+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${s} (resolving from ${v} to ${y})`)),!this.isInterstitial(u)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!a&&y>v){const S=this.schedule.findJumpRestrictedIndex(v+1,y);if(S>v){this.setSchedulePosition(S);return}}this.setSchedulePosition(y);return}const h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(u)){const v=u.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,v))}return}const m=h.timelineStart,p=h.duration||0;if(a&&s<m||s>=m+p){var g;(g=u.event)!=null&&g.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,h)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(s>=i.end){this.timelinePos=i.end;const u=this.findItemIndex(i);this.setSchedulePosition(u+1)}const n=this.playingAsset;if(!n)return;const a=n.timelineStart+(n.duration||0);s>=a&&this.setScheduleToAssetAtTime(s,n)},this.onScheduleUpdate=(s,i)=>{const n=this.schedule;if(!n)return;const a=this.playingItem,u=n.events||[],d=n.items||[],h=n.durations,m=s.map(S=>S.identifier),p=!!(u.length||m.length);(p||i)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${d.map(S=>Dr(S))} pos: ${this.timelinePos}`),m.length&&this.log(`Removed events ${m}`);let g=null,v=null;a&&(g=this.updateItem(a,this.timelinePos),this.itemsMatch(a,g)?this.playingItem=g:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const y=this.bufferingItem;if(y&&(v=this.updateItem(y,this.bufferedPos),this.itemsMatch(y,v)?this.bufferingItem=v:y.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(y.event,null))),s.forEach(S=>{S.assetList.forEach(b=>{this.clearAssetPlayer(b.identifier,null)})}),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const b=S.assetItem.timelineStart,T=S.timelineOffset-b;if(T)try{S.timelineOffset=b}catch(_){Math.abs(T)>La&&this.warn(`${_} ("${S.assetId}" ${S.timelineOffset}->${b})`)}}}),p||i){if(this.hls.trigger(A.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:d.slice(0),durations:h,removedIds:m}),this.isInterstitial(a)&&m.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(g,a),y&&v!==g&&this.trimInPlace(v,y),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new HA(e),this.schedule=new WA(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(A.MEDIA_ENDED,this.onMediaEnded,this),e.on(A.ERROR,this.onError,this),e.on(A.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(A.MEDIA_ENDED,this.onMediaEnded,this),e.off(A.ERROR,this.onError,this),e.off(A.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){tr(e,"play",this.onPlay),tr(e,"pause",this.onPause),tr(e,"seeking",this.onSeeking),tr(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Ks(s,"seeking",this.onSeeking),Ks(s,"timeupdate",this.onTimeupdate),Ks(s,"play",this.onPlay),Ks(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!i){this.clearScheduleState();const n=this.findItemIndex(s);this.setSchedulePosition(n)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const n=this.getBufferingPlayer();n&&(this.log(`Removing schedule state for detachedData and ${n}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,n.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=p=>p&&e.getAssetPlayer(p.identifier),i=(p,g,v,y,S)=>{if(p){let b=p[g].start;const T=p.event;if(T){if(g==="playout"||T.timelineOccupancy!==zc.Point){const _=s(v);(_==null?void 0:_.interstitial)===T&&(b+=_.assetItem.startOffset+_[S])}}else{const _=y==="bufferedPos"?a():e[y];b+=_-p.start}return b}return 0},n=(p,g)=>{var v;if(p!==0&&g!=="primary"&&(v=e.schedule)!=null&&v.length){var y;const S=e.schedule.findItemIndexAtTime(p),b=(y=e.schedule.items)==null?void 0:y[S];if(b){const T=b[g].start-b.start;return p+T}}return p},a=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?u("primary"):Math.max(p,0)},u=p=>{var g,v;return(g=e.primaryDetails)!=null&&g.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[p])||0},d=(p,g)=>{var v,y;const S=e.effectivePlayingItem;if(S!=null&&(v=S.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${g}"`);const b=e.effectivePlayingItem,T=e.schedule.findItemIndexAtTime(p,g),_=(y=e.schedule.items)==null?void 0:y[T],k=e.getBufferingPlayer(),I=k==null?void 0:k.interstitial,C=I==null?void 0:I.appendInPlace,$=b&&e.itemsMatch(b,_);if(b&&(C||$)){const N=s(e.playingAsset),O=(N==null?void 0:N.media)||e.primaryMedia;if(O){const j=g==="primary"?O.currentTime:i(b,g,e.playingAsset,"timelinePos","currentTime"),D=p-j,G=(C?j:O.currentTime)+D;if(G>=0&&(!N||C||G<=N.duration)){O.currentTime=G;return}}}if(_){let N=p;if(g!=="primary"){const j=_[g].start,D=p-j;N=_.start+D}const O=!e.isInterstitial(_);if((!e.isInterstitial(b)||b.event.appendInPlace)&&(O||_.event.appendInPlace)){const j=e.media||(C?k==null?void 0:k.media:null);j&&(j.currentTime=N)}else if(b){const j=e.findItemIndex(b);if(T>j){const G=e.schedule.findJumpRestrictedIndex(j+1,T);if(G>j){e.setSchedulePosition(G);return}}let D=0;if(O)e.timelinePos=N,e.checkBuffer();else{const G=_.event.assetList,X=p-(_[g]||_).start;for(let K=G.length;K--;){const W=G[K];if(W.duration&&X>=W.startOffset&&X<W.startOffset+W.duration){D=K;break}}}e.setSchedulePosition(T,D)}}},h=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const g=t();return e.isInterstitial(g)?g:null},m={get bufferedEnd(){const p=t(),g=e.bufferingItem;if(g&&g===p){var v;return i(g,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-g.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const p=h(),g=e.effectivePlayingItem;return g&&g===p?i(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(p){const g=h(),v=e.effectivePlayingItem;v&&v===g&&d(p+v.playout.start,"playout")},get duration(){const p=h();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const g=(p=h())==null?void 0:p.event.assetList;return g?g.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var p;const g=(p=h())==null?void 0:p.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return h()?m:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return a()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){d(p,"primary")},get duration(){return u("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){d(p,"integrated")},get duration(){return u("integrated")},get seekableStart(){var p;return n(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,g=p==null?void 0:p.event;if(g&&!g.restrictions.skip){const v=e.findItemIndex(p);if(g.appendInPlace){const y=p.playout.start+p.event.duration;d(y+.001,"playout")}else e.advanceAfterAssetEnded(g,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const n=(t=i)==null?void 0:t.currentTime;if(!(n===void 0||!Ae(n)))return n}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const n=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Lt(n)}`),this.detachedData=n}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let n=null;const a=this.hls,u=e!==a,d=u&&e.interstitial.appendInPlace,h=(s=this.detachedData)==null?void 0:s.mediaSource;let m;if(a.media)d&&(n=a.transferMedia(),this.detachedData=n),m="Primary";else if(h){const y=this.getBufferingPlayer();y?(n=y.transferMedia(),m=`${y}`):m="detached MediaSource"}else m="detached media";if(!n){if(h)n=this.detachedData,this.log(`using detachedData: MediaSource ${Lt(n)}`);else if(!this.detachedData||a.media===t){const y=this.playerQueue;y.length>1&&y.forEach(S=>{if(u&&S.interstitial.appendInPlace!==d){const b=S.interstitial;this.clearInterstitial(S.interstitial,null),b.appendInPlace=!1,b.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${b}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=n&&"mediaSource"in n&&((i=n.mediaSource)==null?void 0:i.readyState)!=="closed",g=p&&n?n:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${m} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(g===n&&v){const y=u&&e.assetId===v.assetIdAtEnd;g.overrides={duration:v.duration,endOfStream:!u||y,cueRemoval:!u}}e.attachMedia(g)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(s===-1){const n=this.hls.startPosition;if(this.log(uc("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(n>=0||!this.primaryLive){const a=this.timelinePos=n>0?n:0,u=e.findItemIndexAtTime(a);this.setSchedulePosition(u)}}else if(i&&!this.playingItem){const n=e.findItemIndex(i);this.setSchedulePosition(n)}}advanceAssetBuffering(e,t){const s=e.event,i=s.findAssetIndex(t),n=hh(s,i);if(!s.isAssetPastPlayoutLimit(n))this.bufferedToEvent(e,n);else if(this.schedule){var a;const u=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,s){const i=hh(e,s);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const n=this.schedule.items;if(n){const a=t+1,u=n.length;if(a>=u){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.log(uc("advanceAfterAssetEnded",d)),this.timelinePos=d,e.appendInPlace&&this.advanceInPlace(d),this.checkBuffer(this.bufferedPos<d)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const n=e.assetList[i];n&&this.advanceInPlace(n.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const i=t.parentIdentifier,n=s.getEvent(i);if(n){const a=s.findEventIndex(i),u=s.findAssetIndex(n,e);this.advanceAfterAssetEnded(n,a,u-1)}}setSchedulePosition(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(!i||this.playbackDisabled)return;const n=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${n&&Dr(n)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(a)){const m=a.event,p=this.playingAsset,g=p==null?void 0:p.identifier,v=g?this.getAssetPlayer(g):null;if(v&&g&&(!this.eventItemsMatch(a,n)||t!==void 0&&g!==m.assetList[t].identifier)){var d;const y=m.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${y+1}/${m.assetList.length} ${wa(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(A.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:y,event:m,schedule:i.slice(0),scheduleIndex:e,player:v}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(m,this.findItemIndex(this.playingItem),y);return}this.retreiveMediaSource(g,n),v.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(a,n)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${m} ${Dr(a)}`),m.hasPlayed=!0,this.hls.trigger(A.INTERSTITIAL_ENDED,{event:m,schedule:i.slice(0),scheduleIndex:e}),m.cue.once)){var h;this.updateSchedule();const y=(h=this.schedule)==null?void 0:h.items;if(n&&y){const S=this.findItemIndex(n);this.advanceSchedule(S,y,t,a,u)}return}}this.advanceSchedule(e,i,t,a,u)}advanceSchedule(e,t,s,i,n){const a=this.schedule;if(!a)return;const u=t[e]||null,d=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(m=>{const p=m.interstitial,g=a.findEventIndex(p.identifier);(g<e||g>e+1)&&this.clearInterstitial(p,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const m=u.event;if(s===void 0){s=a.findAssetIndex(m,this.timelinePos);const y=hh(m,s-1);if(m.isAssetPastPlayoutLimit(y)||m.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(m,e,s);return}s=y}const p=this.waitingItem;this.assetsBuffered(u,d)||this.setBufferingItem(u);let g=this.preloadAssets(m,s);if(this.eventItemsMatch(u,p||i)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${Dr(u)} ${m.appendInPlace?"append in place":""}`),this.hls.trigger(A.INTERSTITIAL_STARTED,{event:m,schedule:t.slice(0),scheduleIndex:e})),!m.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${m}`);return}if(m.assetListLoader&&(m.assetListLoader.destroy(),m.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${m}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const v=m.assetList[s];if(!v){this.advanceAfterAssetEnded(m,e,s||0);return}if(g||(g=this.getAssetPlayer(v.identifier)),g===null||g.destroyed){const y=m.assetList.length;this.warn(`asset ${s+1}/${y} player destroyed ${m}`),g=this.createAssetPlayer(m,v,s),g.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&m.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(g,s,t,e,d),this.shouldPlay&&ux(g.media)}else u?(this.resumePrimary(u,e,i),this.shouldPlay&&ux(this.hls.media)):n&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var i,n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Dr(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(uc("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!s)return;const a=(n=this.schedule)==null?void 0:n.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Dr(e)}`),this.hls.trigger(A.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(s<i.fragmentStart||s>i.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:rt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const n=this.hls;n.media?this.checkBuffer():(this.transferMediaTo(n,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(uc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((s=i.mainForwardBufferInfo)==null?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(A.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(A.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const i=Et(Et({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Et(Et({},this.altSelection),{},{audio:s});return}const n=Et(Et({},i),{},{audio:s});this.mediaSelection=n}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Et(Et({},this.altSelection),{},{subtitles:s});return}const n=Et(Et({},i),{},{subtitles:s});this.mediaSelection=n}onAudioTrackSwitching(e,t){const s=y0(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=y0(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const n=t[i];if(n.cue.post){var s;const a=this.schedule.findEventIndex(n.identifier),u=(s=this.schedule.items)==null?void 0:s[a];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(e&&i){const n=this.findItemIndex(e,t);return i[n]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((n,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(n.identifier,null)});const s=e.end+.25,i=rt.bufferInfo(this.primaryMedia,s,0);(i.end>s||(i.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Dr(e)} (was ${Dr(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const i=rt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,s,e)}updateBufferedPos(e,t,s){const i=this.schedule,n=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],n)){this.bufferedPos=e;return}const a=this.playingItem,u=this.findItemIndex(a);let d=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var h;const m=this.findItemIndex(n),p=Math.min(m+1,t.length-1),g=t[p];if((d===-1&&n&&e>=n.end||(h=g.event)!=null&&h.appendInPlace&&e+.01>=g.start)&&(d=p),this.isInterstitial(n)){const v=n.event;if(p-u>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,d>m&&d>u)this.bufferedToItem(g);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&g.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(g)&&this.preloadAssets(g.event,0)}}else s&&a&&!this.itemsMatch(a,n)&&(d===u?this.bufferedToItem(a):d===u+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const n=this.getAssetPlayer(i.identifier);return!(n!=null&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:i,events:n}=s;if(!i||!n)return t;const a=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const d=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Dr(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const h=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((m,p)=>{const g=this.getAssetPlayer(m.identifier);g&&(p===h&&g.loadSource(),g.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering());this.hls.trigger(A.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:n.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=s.assetList.length===0&&!s.assetListLoader,n=s.cue.once;if(i||!n){const a=this.preloadAssets(s,t);if(a!=null&&a.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(a,u)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,n=i===0&&!e.assetListLoader,a=e.cue.once;if(n){const d=e.timelineStart;if(e.appendInPlace){var u;const g=this.playingItem;!this.isInterstitial(g)&&(g==null||(u=g.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let h,m=0;if(!this.playingItem&&this.primaryLive&&(m=this.hls.startPosition,m===-1&&(m=this.hls.liveSyncPosition||0)),m&&!(e.cue.pre||e.cue.post)){const g=m-d;g>0&&(h=Math.round(g*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${h?` live-start: ${m} start-offset: ${h}`:""}`),s)return this.createAsset(e,0,0,d,e.duration,s);const p=this.assetListLoader.loadAssetList(e,h);p&&(e.assetListLoader=p)}else if(!a&&i){for(let h=t;h<i;h++){const m=e.assetList[h],p=this.getAssetPlayerQueueIndex(m.identifier);(p===-1||this.playerQueue[p].destroyed)&&!m.error&&this.createAssetPlayer(e,m,h)}const d=e.assetList[t];if(d){const h=this.getAssetPlayer(d.identifier);return h&&h.loadSource(),h}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,i,n,a){const u={parentIdentifier:e.identifier,identifier:zA(e,a,t),duration:n,startOffset:s,timelineStart:i,uri:a};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,s){const i=this.hls,n=i.userConfig;let a=n.videoPreference;const u=i.loadLevelObj||i.levels[i.currentLevel];(a||u)&&(a=kt({},a),u.videoCodec&&(a.videoCodec=u.videoCodec),u.videoRange&&(a.allowedVideoRanges=[u.videoRange]));const d=i.audioTracks[i.audioTrack],h=i.subtitleTracks[i.subtitleTrack];let m=0;if(this.primaryLive||e.appendInPlace){const I=this.timelinePos-t.timelineStart;if(I>1){const C=t.duration;C&&I<C&&(m=I)}}const p=t.identifier,g=Et(Et({},n),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:m,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:d||n.audioPreference,subtitlePreference:h||n.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(g.timelineOffset=t.timelineStart));const v=g.cmcd;v!=null&&v.sessionId&&v.contentId&&(g.cmcd=kt({},v,{contentId:ko(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const y=new KA(this.HlsPlayerClass,g,e,t);this.playerQueue.push(y),e.assetList[s]=t;let S=!0;const b=I=>{if(I.live){var C;const O=new Error(`Interstitials MUST be VOD assets ${e}`),j={fatal:!0,type:Ue.OTHER_ERROR,details:Z.INTERSTITIAL_ASSET_ITEM_ERROR,error:O},D=((C=this.schedule)==null?void 0:C.findEventIndex(e.identifier))||-1;this.handleAssetItemError(j,e,D,s,O.message);return}const $=I.edge-I.fragmentStart,N=t.duration;(S||N===null||$>N)&&(S=!1,this.log(`Interstitial asset "${p}" duration change ${N} > ${$}`),t.duration=$,this.updateSchedule())};y.on(A.LEVEL_UPDATED,(I,{details:C})=>b(C)),y.on(A.LEVEL_PTS_UPDATED,(I,{details:C})=>b(C)),y.on(A.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const T=(I,C)=>{const $=this.getAssetPlayer(p);if($&&C.tracks){$.off(A.BUFFER_CODECS,T),$.tracks=C.tracks;const N=this.primaryMedia;this.bufferingAsset===$.assetItem&&N&&!$.media&&this.bufferAssetPlayer($,N)}};y.on(A.BUFFER_CODECS,T);const _=()=>{var I;const C=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${C}`),!C||!this.schedule)return;const $=this.schedule.findEventIndex(e.identifier),N=(I=this.schedule.items)==null?void 0:I[$];this.isInterstitial(N)&&this.advanceAssetBuffering(N,t)};y.on(A.BUFFERED_TO_END,_);const k=I=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const $=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,$,I)};return y.once(A.MEDIA_ENDED,k(s)),y.once(A.PLAYOUT_LIMIT_REACHED,k(1/0)),y.on(A.ERROR,(I,C)=>{if(!this.schedule)return;const $=this.getAssetPlayer(p);if(C.details===Z.BUFFER_STALLED_ERROR){if($!=null&&$.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(C,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${C.error} ${e}`)}),y.on(A.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const C=new Error(`Asset player destroyed unexpectedly ${p}`),$={fatal:!0,type:Ue.OTHER_ERROR,details:Z.INTERSTITIAL_ASSET_ITEM_ERROR,error:C};this.handleAssetItemError($,e,this.schedule.findEventIndex(e.identifier),s,C.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${wa(t)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:y}),y}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const i=this.playerQueue[s];this.log(`clear ${i} toSegment: ${t&&Dr(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,n){const{interstitial:a,assetItem:u,assetId:d}=e,h=a.assetList.length,m=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!m||m.identifier!==d)&&(m&&(this.clearAssetPlayer(m.identifier,s[i]),delete m.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${h} ${wa(u)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:a,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,n)}bufferAssetPlayer(e,t){var s,i;if(!this.schedule)return;const{interstitial:n,assetItem:a}=e,u=this.schedule.findEventIndex(n.identifier),d=(s=this.schedule.items)==null?void 0:s[u];if(!d)return;e.loadSource(),this.setBufferingItem(d),this.bufferingAsset=a;const h=this.getBufferingPlayer();if(h===e)return;const m=n.appendInPlace;if(m&&(h==null?void 0:h.interstitial.appendInPlace)===!1)return;const p=(h==null?void 0:h.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(m&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!gv(p,e.tracks)){const g=new Error(`Asset ${wa(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),v={fatal:!0,type:Ue.OTHER_ERROR,details:Z.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},y=n.findAssetIndex(a);this.handleAssetItemError(v,n,u,y,g.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const i=s.currentTime,n=t.findAssetIndex(e,i),a=e.assetList[n];if(a){const u=this.getAssetPlayer(a.identifier);if(u){const d=u.currentTime||i-a.timelineStart,h=u.duration-d;if(this.warn(`Stalled at ${d} of ${d+h} in ${u} ${e} (media.currentTime: ${i})`),d&&(h/s.playbackRate<.5||u.bufferedInPlaceToEnd(s))&&u.hls){const m=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,m,n)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,i,n){if(e.details===Z.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&wa(a)} ${e.error}`),!this.schedule)return;const u=(a==null?void 0:a.identifier)||"",d=this.getAssetPlayerQueueIndex(u),h=this.playerQueue[d]||null,m=this.schedule.items,p=kt({},e,{fatal:!1,errorAction:ka(!0),asset:a,assetListIndex:i,event:t,schedule:m,scheduleIndex:s,player:h});if(this.hls.trigger(A.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const g=this.playingAsset,v=this.bufferingAsset,y=new Error(n);if(a&&(this.clearAssetPlayer(u,null),a.error=y),!t.assetList.some(S=>!S.error))t.error=y;else for(let S=i;S<t.assetList.length;S++)this.resetAssetPlayer(t.assetList[S].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):g&&g.identifier===u?this.advanceAfterAssetEnded(t,s,i):v&&v.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let i=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${Dr(s)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const a=this.updateItem(s,i);this.itemsMatch(s,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const n=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(n)}onAssetListLoaded(e,t){var s,i;const n=t.event,a=n.identifier,u=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(a)))return;const d=n.timelineStart,h=n.duration;let m=0;u.forEach((S,b)=>{const T=parseFloat(S.DURATION);this.createAsset(n,b,m,d+m,T,S.URI),m+=T}),n.duration=m,this.log(`Loaded asset-list with duration: ${m} (was: ${h}) ${n}`);const p=this.waitingItem,g=(p==null?void 0:p.event.identifier)===a;this.updateSchedule();const v=(i=this.bufferingItem)==null?void 0:i.event;if(g){var y;const S=this.schedule.findEventIndex(a),b=(y=this.schedule.items)==null?void 0:y[S];if(b){if(!this.playingItem&&this.timelinePos>b.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){n.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${n}`),this.log(n.error.message),this.updateSchedule(!0),this.primaryFallback(n);return}this.setBufferingItem(b)}this.setSchedulePosition(S)}else if((v==null?void 0:v.identifier)===a){const S=n.assetList[0];if(S){const b=this.getAssetPlayer(S.identifier);if(v.appendInPlace){const T=this.primaryMedia;b&&T&&this.bufferAssetPlayer(b,T)}else b&&b.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Z.ASSET_LIST_PARSING_ERROR:case Z.ASSET_LIST_LOAD_ERROR:case Z.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case Z.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const dx=500;class YA extends Rf{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",Ce.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ue.IDLE,this.setInterval(dx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(this.fragContextChanged(s)||(is(s)&&(this.fragPrevious=s),this.state=ue.IDLE),!i)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let a;const u=s.start;for(let h=0;h<n.length;h++)if(u>=n[h].start&&u<=n[h].end){a=n[h];break}const d=s.start+s.duration;a?a.end=d:(a={start:u,end:d},n.push(a)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(s===0&&i!==Number.POSITIVE_INFINITY){const n=i-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(a=>{for(let u=0;u<a.length;){if(a[u].end<=n){a.shift();continue}else if(a[u].start<n)a[u].start=n;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(s,n,Ce.SUBTITLE)}}onError(e,t){const s=t.frag;(s==null?void 0:s.type)===Ce.SUBTITLE&&(t.details===Z.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ue.STOPPED&&(this.state=ue.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&yy(this.levels,t)){this.levels=t.map(s=>new Fo(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const i=new Fo(s);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ce.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==ue.STOPPED&&this.setInterval(dx)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:n}=this,{details:a,id:u}=t;if(!n){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const d=n[u];if(u>=n.length||!d)return;this.log(`Subtitle track ${u} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(a.live||(s=d.details)!=null&&s.live){if(a.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const g=p.fragments[0];if(!d.details)a.hasProgramDateTime&&p.hasProgramDateTime?(Uc(a,p),h=a.fragmentStart):g&&(h=g.start,Xh(a,h));else{var m;h=this.alignPlaylists(a,d.details,(m=this.levelLastLoaded)==null?void 0:m.details),h===0&&g&&(h=g.start,Xh(a,h))}p&&!this.startFragRequested&&this.setStartPosition(p,h)}d.details=a,this.levelLastLoaded=d,u===i&&(this.hls.trigger(A.SUBTITLE_TRACK_UPDATED,{details:a,id:u,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ue.IDLE&&(Nn(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&i!=null&&i.key&&i.iv&&Aa(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,If(i.method)).catch(u=>{throw n.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const d=performance.now();n.trigger(A.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:a,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=ue.IDLE})}}doTick(){if(!this.media){this.state=ue.IDLE;return}if(this.state===ue.IDLE){const{currentTrackId:e,levels:t}=this,s=t==null?void 0:t[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:i}=this,n=this.getLoadPosition(),a=rt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,i.maxBufferHole),{end:u,len:d}=a,h=s.details,m=this.hls.maxBufferLength+h.levelTargetDuration;if(d>m)return;const p=h.fragments,g=p.length,v=h.edge;let y=null;const S=this.fragPrevious;if(u<v){const _=i.maxFragLookUpTolerance,k=u>v-_?0:_;y=Nn(S,p,Math.max(p[0].start,u),k),!y&&S&&S.start<p[0].start&&(y=p[0])}else y=p[g-1];if(y=this.filterReplacedPrimary(y,s.details),!y)return;const b=y.sn-h.startSN,T=p[b-1];if(T&&T.cc===y.cc&&this.fragmentTracker.getState(T)===xs.NOT_LOADED&&(y=T),this.fragmentTracker.getState(y)===xs.NOT_LOADED){const _=this.mapToInitFragWhenRequired(y);_&&this.loadFragment(_,s,u)}}}loadFragment(e,t,s){is(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new QA(this.tracksBuffered[this.currentTrackId]||[])}}class QA{constructor(e){this.buffered=void 0;const t=(s,i,n)=>{if(i=i>>>0,i>n-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${n})`);return e[i][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const XA={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Dy=r=>String.fromCharCode(XA[r]||r),$r=15,yi=100,JA={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ZA={17:2,18:4,21:6,22:8,23:10,19:13,20:15},eI={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},tI={25:2,26:4,29:6,30:8,31:10,27:13,28:15},sI=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class rI{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Tt.log(`${this.time} [${e}] ${s}`)}}}const Tn=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class Oy{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class iI{constructor(){this.uchar=" ",this.penState=new Oy}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class nI{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Oy,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<yi;t++)this.chars.push(new iI);this.logger=e}equals(e){for(let t=0;t<yi;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<yi;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<yi;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>yi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=yi)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Dy(e);if(this.pos>=yi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<yi;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<yi;s++){const i=this.chars[s].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class fh{constructor(e){this.rows=[],this.currRow=$r-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<$r;t++)this.rows.push(new nI(e));this.logger=e}reset(){for(let e=0;e<$r;e++)this.rows[e].clear();this.currRow=$r-1}equals(e){let t=!0;for(let s=0;s<$r;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<$r;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<$r;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Lt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<$r;u++)this.rows[u].clear();const n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const u=a.rows[n].cueStartTime,d=this.logger.time;if(u!==null&&d!==null&&u<d)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(a.rows[n+h])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const n=e.indent,a=Math.max(n-1,0);s.setCursor(e.indent),e.color=s.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Lt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let n=0;n<$r;n++){const a=this.rows[n].getTextString();a&&(i=n+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class hx{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new fh(s),this.nonDisplayedMemory=new fh(s),this.lastOutputScreen=new fh(s),this.currRollUpRow=this.displayedMemory.rows[$r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[$r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+Lt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class fx{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=oI(),this.logger=void 0;const i=this.logger=new rI;this.channels=[null,new hx(e,t,i),new hx(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const i=t[s]&127,n=t[s+1]&127;let a=!1,u=null;if(i===0&&n===0)continue;this.logger.log(3,()=>"["+Tn([t[s],t[s+1]])+"] -> ("+Tn([i,n])+")");const d=this.cmdHistory;if(i>=16&&i<=31){if(aI(i,n,d)){dc(null,null,d),this.logger.log(3,()=>"Repeated command ("+Tn([i,n])+") is dropped");continue}dc(i,n,this.cmdHistory),a=this.parseCmd(i,n),a||(a=this.parseMidrow(i,n)),a||(a=this.parsePAC(i,n)),a||(a=this.parseBackgroundAttributes(i,n))}else dc(null,null,d);if(!a&&(u=this.parseChars(i,n),u)){const m=this.currentChannel;m&&m>0?this.channels[m].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Tn([i,n])+" orig: "+Tn([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(s||i))return!1;const n=e===20||e===21||e===23?1:2,a=this.channels[n];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Tn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,n=(e===16||e===24)&&t>=64&&t<=95;if(!(i||n))return!1;const a=e<=23?1:2;t>=64&&t<=95?s=a===1?JA[e]:eI[e]:s=a===1?ZA[e]:tI[e];const u=this.channels[a];return u?(u.setPAC(this.interpretPAC(s,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,i.underline=(s&1)===1,s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((s-16)/2)*4,i}parseChars(e,t){let s,i=null,n=null;if(e>=25?(s=2,n=e-8):(s=1,n=e),n>=17&&n<=19){let a;n===17?a=t+80:n===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+Dy(a)+"' in channel "+s),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Tn(i).join(",")),i}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(s||i))return!1;let n;const a={};e===16||e===24?(n=Math.floor((t-32)/2),a.background=sI[n],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}dc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function dc(r,e,t){t.a=r,t.b=e}function aI(r,e,t){return t.a===r&&t.b===e}function oI(){return{a:null,b:null}}var zf=(function(){if(Fc!=null&&Fc.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,d){if(typeof d!="string"||!Array.isArray(u))return!1;const h=d.toLowerCase();return~u.indexOf(h)?h:!1}function s(u){return t(r,u)}function i(u){return t(e,u)}function n(u,...d){let h=1;for(;h<arguments.length;h++){const m=arguments[h];for(const p in m)u[p]=m[p]}return u}function a(u,d,h){const m=this,p={enumerable:!0};m.hasBeenReset=!1;let g="",v=!1,y=u,S=d,b=h,T=null,_="",k=!0,I="auto",C="start",$=50,N="middle",O=50,j="middle";Object.defineProperty(m,"id",n({},p,{get:function(){return g},set:function(D){g=""+D}})),Object.defineProperty(m,"pauseOnExit",n({},p,{get:function(){return v},set:function(D){v=!!D}})),Object.defineProperty(m,"startTime",n({},p,{get:function(){return y},set:function(D){if(typeof D!="number")throw new TypeError("Start time must be set to a number.");y=D,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",n({},p,{get:function(){return S},set:function(D){if(typeof D!="number")throw new TypeError("End time must be set to a number.");S=D,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",n({},p,{get:function(){return b},set:function(D){b=""+D,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",n({},p,{get:function(){return T},set:function(D){T=D,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",n({},p,{get:function(){return _},set:function(D){const G=s(D);if(G===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=G,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",n({},p,{get:function(){return k},set:function(D){k=!!D,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",n({},p,{get:function(){return I},set:function(D){if(typeof D!="number"&&D!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");I=D,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",n({},p,{get:function(){return C},set:function(D){const G=i(D);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");C=G,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",n({},p,{get:function(){return $},set:function(D){if(D<0||D>100)throw new Error("Position must be between 0 and 100.");$=D,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",n({},p,{get:function(){return N},set:function(D){const G=i(D);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");N=G,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",n({},p,{get:function(){return O},set:function(D){if(D<0||D>100)throw new Error("Size must be between 0 and 100.");O=D,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",n({},p,{get:function(){return j},set:function(D){const G=i(D);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");j=G,this.hasBeenReset=!0}})),m.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class lI{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function $y(r){function e(s,i,n,a){return(s|0)*3600+(i|0)*60+(n|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class cI{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function My(r,e,t,s){const i=s?r.split(s):[r];for(const n in i){if(typeof i[n]!="string")continue;const a=i[n].split(t);if(a.length!==2)continue;const u=a[0],d=a[1];e(u,d)}}const af=new zf(0,0,""),hc=af.align==="middle"?"middle":"center";function uI(r,e,t){const s=r;function i(){const u=$y(r);if(u===null)throw new Error("Malformed timestamp: "+s);return r=r.replace(/^[^\sa-zA-Z-]+/,""),u}function n(u,d){const h=new cI;My(u,function(g,v){let y;switch(g){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===v){h.set(g,t[S].region);break}break;case"vertical":h.alt(g,v,["rl","lr"]);break;case"line":y=v.split(","),h.integer(g,y[0]),h.percent(g,y[0])&&h.set("snapToLines",!1),h.alt(g,y[0],["auto"]),y.length===2&&h.alt("lineAlign",y[1],["start",hc,"end"]);break;case"position":y=v.split(","),h.percent(g,y[0]),y.length===2&&h.alt("positionAlign",y[1],["start",hc,"end","line-left","line-right","auto"]);break;case"size":h.percent(g,v);break;case"align":h.alt(g,v,["start",hc,"end","left","right"]);break}},/:/,/\s/),d.region=h.get("region",null),d.vertical=h.get("vertical","");let m=h.get("line","auto");m==="auto"&&af.line===-1&&(m=-1),d.line=m,d.lineAlign=h.get("lineAlign","start"),d.snapToLines=h.get("snapToLines",!0),d.size=h.get("size",100),d.align=h.get("align",hc);let p=h.get("position","auto");p==="auto"&&af.position===50&&(p=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=p}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);r=r.slice(3),a(),e.endTime=i(),a(),n(r,e)}function Fy(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class dI{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new lI,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let n=t.buffer,a=0;for(n=Fy(n);a<n.length&&n[a]!=="\r"&&n[a]!==`
`;)++a;const u=n.slice(0,a);return n[a]==="\r"&&++a,n[a]===`
`&&++a,t.buffer=n.slice(a),u}function i(n){My(n,function(a,u){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=s();const u=n.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=s(),t.state){case"HEADER":/:/.test(n)?i(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new zf(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{uI(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=n.indexOf("-->")!==-1;if(!n||u&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const hI=/\r\n|\n\r|\n|\r/g,mh=function(e,t,s=0){return e.slice(s,s+t.length)===t},fI=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ae(t)||!Ae(s)||!Ae(i)||!Ae(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*i,t+=3600*1e3*n,t};function Gf(r,e,t){return ko(r.toString())+ko(e.toString())+ko(t)}const mI=function(e,t,s){let i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=n)!=null&&a.new;){var a;e.ccOffset+=i.start-n.start,i.new=!1,i=n,n=e[i.prevCC]}e.presentationOffset=s};function pI(r,e,t,s,i,n,a){const u=new dI,d=gr(new Uint8Array(r)).trim().replace(hI,`
`).split(`
`),h=[],m=e?w2(e.baseTime,e.timescale):0;let p="00:00.000",g=0,v=0,y,S=!0;u.oncue=function(b){const T=t[s];let _=t.ccOffset;const k=(g-m)/9e4;if(T!=null&&T.new&&(v!==void 0?_=t.ccOffset=T.start:mI(t,s,k)),k){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}_=k-t.presentationOffset}const I=b.endTime-b.startTime,C=dr((b.startTime+_-v)*9e4,i*9e4)/9e4;b.startTime=Math.max(C,0),b.endTime=Math.max(C+I,0);const $=b.text.trim();b.text=decodeURIComponent(encodeURIComponent($)),b.id||(b.id=Gf(b.startTime,b.endTime,$)),b.endTime>0&&h.push(b)},u.onparsingerror=function(b){y=b},u.onflush=function(){if(y){a(y);return}n(h)},d.forEach(b=>{if(S)if(mh(b,"X-TIMESTAMP-MAP=")){S=!1,b.slice(16).split(",").forEach(T=>{mh(T,"LOCAL:")?p=T.slice(6):mh(T,"MPEGTS:")&&(g=parseInt(T.slice(7)))});try{v=fI(p)/1e3}catch(T){y=T}return}else b===""&&(S=!1);u.parse(b+`
`)}),u.flush()}const ph="stpp.ttml.im1t",Uy=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,By=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,gI={left:"start",center:"center",right:"end",start:"start",end:"end"};function mx(r,e,t,s){const i=ot(new Uint8Array(r),["mdat"]);if(i.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const n=i.map(u=>gr(u)),a=b2(e.baseTime,1,e.timescale);try{n.forEach(u=>t(xI(u,a)))}catch(u){s(u)}}function xI(r,e){const i=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(n).reduce((p,g)=>(p[g]=i.getAttribute(`ttp:${g}`)||n[g],p),{}),u=i.getAttribute("xml:space")!=="preserve",d=px(gh(i,"styling","style")),h=px(gh(i,"layout","region")),m=gh(i,"body","[begin]");return[].map.call(m,p=>{const g=zy(p,u);if(!g||!p.hasAttribute("begin"))return null;const v=vh(p.getAttribute("begin"),a),y=vh(p.getAttribute("dur"),a);let S=vh(p.getAttribute("end"),a);if(v===null)throw gx(p);if(S===null){if(y===null)throw gx(p);S=v+y}const b=new zf(v-e,S-e,g);b.id=Gf(b.startTime,b.endTime,b.text);const T=h[p.getAttribute("region")],_=d[p.getAttribute("style")],k=vI(T,_,d),{textAlign:I}=k;if(I){const C=gI[I];C&&(b.lineAlign=C),b.align=I}return kt(b,k),b}).filter(p=>p!==null)}function gh(r,e,t){const s=r.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function px(r){return r.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function zy(r,e){return[].slice.call(r.childNodes).reduce((t,s,i)=>{var n;return s.nodeName==="br"&&i?t+`
`:(n=s.childNodes)!=null&&n.length?zy(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function vI(r,e,t){const s="http://www.w3.org/ns/ttml#styling";let i=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),n.reduce((u,d)=>{const h=xh(e,s,d)||xh(r,s,d)||xh(i,s,d);return h&&(u[d]=h),u},{})}function xh(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function gx(r){return new Error(`Could not parse ttml timestamp ${r}`)}function vh(r,e){if(!r)return null;let t=$y(r);return t===null&&(Uy.test(r)?t=yI(r,e):By.test(r)&&(t=bI(r,e))),t}function yI(r,e){const t=Uy.exec(r),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function bI(r,e){const t=By.exec(r),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class fc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class wI{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=vx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new fc(this,"textTrack1"),t=new fc(this,"textTrack2"),s=new fc(this,"textTrack3"),i=new fc(this,"textTrack4");this.cea608Parser1=new fx(1,e,t),this.cea608Parser2=new fx(3,s,i)}addCues(e,t,s,i,n){let a=!1;for(let u=n.length;u--;){const d=n[u],h=SI(d[0],d[1],t,s);if(h>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],s),a=!0,h/(s-t)>.5))return}if(a||n.push([t,s]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,s,i)}else{const u=this.Cues.newCue(null,t,s,i);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:n,trackId:a}){const{unparsedVttFrags:u}=this;s===Ce.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:n,trackId:a}),u.length&&(this.unparsedVttFrags=[],u.forEach(d=>{this.initPTS[d.frag.cc]?this.onFragLoaded(A.FRAG_LOADED,d):this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const n=s.textTracks[i];if(xx(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:n,languageCode:a}=t[e],u=this.getExistingTrack(n,a);if(u)s[e]=u,Ta(s[e]),Cy(s[e],i);else{const d=this.createTextTrack("captions",n,a);d&&(d[e]=!0,s[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,i={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach(n=>{Ta(i[n]),delete i[n]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=vx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Ta(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some(n=>n.textCodec===ph);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(yy(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const a=this.media,u=a?_c(a.textTracks):null;if(this.tracks.forEach((d,h)=>{let m;if(u){let p=null;for(let g=0;g<u.length;g++)if(u[g]&&xx(u[g],d)){p=u[g],u[g]=null;break}p&&(m=p)}if(m)Ta(m);else{const p=Gy(d);m=this.createTextTrack(p,d.name,d.lang),m&&(m.mode="disabled")}m&&this.textTracks.push(m)}),u!=null&&u.length){const d=u.filter(h=>h!==null).map(h=>h.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const i=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!i)return;const n=`textTrack${i[1]}`,a=this.captionsProperties[n];a&&(a.label=s.name,s.lang&&(a.languageCode=s.lang),a.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ce.MAIN){var s,i;const{cea608Parser1:n,cea608Parser2:a,lastSn:u}=this,{cc:d,sn:h}=t.frag,m=(s=(i=t.part)==null?void 0:i.index)!=null?s:-1;n&&a&&(h!==u+1||h===u&&m!==this.lastPartIndex+1||d!==this.lastCc)&&(n.reset(),a.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=m}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===Ce.SUBTITLE)if(i.byteLength){const n=s.decryptdata,a="stats"in t;if(n==null||!n.encrypted||a){const u=this.tracks[s.level],d=this.vttCCs;d[s.cc]||(d[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),u&&u.textCodec===ph?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;mx(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),s.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{s.logger.log(`Failed to parse IMSC1: ${i}`),s.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:s,payload:i}=e,{initPTS:n,unparsedVttFrags:a}=this,u=n.length-1;if(!n[s.cc]&&u===-1){a.push(e);return}const d=this.hls,h=(t=s.initSegment)!=null&&t.data?_r(s.initSegment.data,new Uint8Array(i)).buffer:i;pI(h,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,m=>{this._appendCues(m,s.level),d.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},m=>{const p=m.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(s,i),d.logger.log(`Failed to parse VTT cue: ${m}`),!(p&&u>s.cc)&&d.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:m})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||mx(t,this.initPTS[e.cc],()=>{s.textCodec=ph,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(n=>jy(i,n))}else{const i=this.tracks[t];if(!i)return;const n=i.default?"default":"subtitles"+t;s.trigger(A.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===Ce.SUBTITLE&&this.onFragLoaded(A.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(!(s.type===Ce.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let n=0;n<i.length;n++){const a=i[n].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(a);this.cea608Parser1.addData(i[n].pts,u[0]),this.cea608Parser2.addData(i[n].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:n}){const{media:a}=this;if(!(!a||a.currentTime<s)){if(!n||n==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(d=>nf(u[d],t,s))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(d=>nf(u[d],t,i))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let i=2;for(let n=0;n<s;n++){const a=e[i++],u=127&e[i++],d=127&e[i++];if(u===0&&d===0)continue;if((4&a)!==0){const m=3&a;(m===0||m===1)&&(t[m].push(u),t[m].push(d))}}return t}}function Gy(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function xx(r,e){return!!r&&r.kind===Gy(e)&&ef(e,r)}function SI(r,e,t,s){return Math.min(e,s)-Math.max(r,t)}function vx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const EI=/\s/,TI={newCue(r,e,t,s){const i=[];let n,a,u,d,h;const m=self.VTTCue||self.TextTrackCue;for(let g=0;g<s.rows.length;g++)if(n=s.rows[g],u=!0,d=0,h="",!n.isEmpty()){var p;for(let S=0;S<n.chars.length;S++)EI.test(n.chars[S].uchar)&&u?d++:(h+=n.chars[S].uchar,u=!1);n.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const v=Fy(h.trim()),y=Gf(e,t,v);r!=null&&(p=r.cues)!=null&&p.getCueById(y)||(a=new m(e,t,v),a.id=y,a.line=g+1,a.align="left",a.position=10+Math.min(80,Math.floor(d*8/32)*10),i.push(a))}return r&&i.length&&(i.sort((g,v)=>g.line==="auto"||v.line==="auto"?0:g.line>8&&v.line>8?v.line-g.line:g.line-v.line),i.forEach(g=>jy(r,g))),i}};function _I(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const kI=/(\d+)-(\d+)\/(\d+)/;class yx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||RI,this.controller=new self.AbortController,this.stats=new wf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const n=AI(e,this.controller.signal),a=e.responseType==="arraybuffer",u=a?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=d&&Ae(d)?d:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(zo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var g;this.response=this.loader=p;const v=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},h-(v-i.loading.start)),!p.ok){const{status:S,statusText:b}=p;throw new NI(b||"fetch, bad network response",S,p)}i.loading.first=v,i.total=LI(p.headers)||i.total;const y=(g=this.callbacks)==null?void 0:g.onProgress;return y&&Ae(t.highWaterMark)?this.loadProgressively(p,i,e,t.highWaterMark,y):a?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var g,v;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const S=p[u];S&&(i.loaded=i.total=S);const b={url:y.url,data:p,code:y.status},T=(g=this.callbacks)==null?void 0:g.onProgress;T&&!Ae(t.highWaterMark)&&T(i,e,p,y),(v=this.callbacks)==null||v.onSuccess(b,i,e,y)}).catch(p=>{var g;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const v=p&&p.code||0,y=p?p.message:null;(g=this.callbacks)==null||g.onError({code:v,text:y},e,p?p.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,n){const a=new Zv,u=e.body.getReader(),d=()=>u.read().then(h=>{if(h.done)return a.dataLength&&n(t,s,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const m=h.value,p=m.length;return t.loaded+=p,p<i||a.dataLength?(a.push(m),a.dataLength>=i&&n(t,s,a.flush().buffer,e)):n(t,s,m.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function AI(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(kt({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function II(r){const e=kI.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function LI(r){const e=r.get("Content-Range");if(e){const s=II(e);if(Ae(s))return s}const t=r.get("Content-Length");if(t)return parseInt(t)}function RI(r,e){return new self.Request(r.url,e)}class NI extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const CI=/^age:\s*[\d.]+\s*$/im;class Vy{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new wf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return n(s,t.url)}).catch(a=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),n(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(a=>{var u;(u=this.callbacks)==null||u.onError({code:s.status,text:a.message},t,s,i)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=s.loadPolicy;if(i)for(const u in i)e.setRequestHeader(u,i[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=n&&Ae(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,n=this.config;if(!s.aborted&&i>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const h=t.status,m=t.responseType==="text"?t.responseText:null;if(h>=200&&h<300){const y=m??t.response;if(y!=null){var a,u;s.loading.end=Math.max(self.performance.now(),s.loading.first);const S=t.responseType==="arraybuffer"?y.byteLength:y.length;s.loaded=s.total=S,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const b=(a=this.callbacks)==null?void 0:a.onProgress;b&&b(s,e,y,t);const T={url:t.responseURL,data:y,code:h};(u=this.callbacks)==null||u.onSuccess(T,s,e,t);return}}const p=n.loadPolicy.errorRetry,g=s.retry,v={url:e.url,data:void 0,code:h};if($c(p,g,!1,v))this.retry(p);else{var d;Tt.error(`${h} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:h,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if($c(e,t,!0))this.retry(e);else{var s;Tt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=_f(e,s.retry),s.retry++,Tt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&CI.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const jI={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},PI=Et(Et({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Vy,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:W_,bufferController:O2,capLevelController:Ff,errorController:X_,fpsController:$A,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:zv,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:jI},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},DI()),{},{subtitleStreamController:YA,subtitleTrackController:UA,timelineController:wI,audioStreamController:C2,audioTrackController:j2,emeController:Ia,cmcdController:jA,contentSteeringController:DA,interstitialsController:qA});function DI(){return{cueHandler:TI,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function OI(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=of(r),i=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const u=`${a==="level"?"playlist":a}LoadPolicy`,d=e[u]===void 0,h=[];n.forEach(m=>{const p=`${a}Loading${m}`,g=e[p];if(g!==void 0&&d){h.push(p);const v=s[u].default;switch(e[u]={default:v},m){case"TimeOut":v.maxLoadTimeMs=g,v.maxTimeToFirstByteMs=g;break;case"MaxRetry":v.errorRetry.maxNumRetry=g,v.timeoutRetry.maxNumRetry=g;break;case"RetryDelay":v.errorRetry.retryDelayMs=g,v.timeoutRetry.retryDelayMs=g;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=g,v.timeoutRetry.maxRetryDelayMs=g;break}}}),h.length&&t.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${u}": ${Lt(e[u])}`)}),Et(Et({},s),e)}function of(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(of):Object.keys(r).reduce((e,t)=>(e[t]=of(r[t]),e),{}):r}function $I(r,e){const t=r.loader;t!==yx&&t!==Vy?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):_I()&&(r.loader=yx,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const kc=2,MI=.1,FI=.05,UI=100;class BI extends $v{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(UI),this.mediaSource=t.mediaSource;const s=this.media=t.media;Ks(s,"playing",this.onMediaPlaying),Ks(s,"waiting",this.onMediaWaiting),Ks(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(tr(s,"playing",this.onMediaPlaying),tr(s,"waiting",this.onMediaWaiting),tr(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const n=(s=this.hls)==null?void 0:s.config;if(!n)return;const a=this.media;if(!a)return;const{seeking:u}=a,d=this.seeking&&!u,h=!this.seeking&&u,m=a.paused&&!u||a.ended||a.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,n.nudgeOnVideoHole&&!m&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||d){d&&this.stallResolved(e);return}if(m){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1}));return}if(!rt.getBuffered(a).length){this.nudgeRetry=0;return}const p=rt.bufferInfo(a,e,0),g=p.nextStart||0,v=this.fragmentTracker;if(u&&v&&this.hls){const $=bx(this.hls.inFlightFragments,e),N=p.len>kc,O=!g||$||g-e>kc&&!v.getPartialFragment(e);if(N||O)return;this.moved=!1}const y=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(p.len>0)&&!g)return;const N=Math.max(g,p.start||0)-e,j=!!(y!=null&&y.live)?y.targetduration*2:kc,D=mc(e,v);if(N>0&&(N<=j||D)){a.paused||this._trySkipBufferHole(D);return}}const S=n.detectStallWithCurrentTimeMs,b=self.performance.now(),T=this.waiting;let _=this.stalled;if(_===null)if(T>0&&b-T<S)_=this.stalled=T;else{this.stalled=b;return}const k=b-_;if(!u&&(k>=S||T)&&this.hls){var I;if(((I=this.mediaSource)==null?void 0:I.readyState)==="ended"&&!(y!=null&&y.live)&&Math.abs(e-((y==null?void 0:y.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const C=rt.bufferInfo(a,e,n.maxBufferHole);this._tryFixBufferStall(C,k,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(A.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&i&&i.length>1&&e>i.end(0)){const n=rt.bufferedInfo(rt.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const a=rt.timeRangesToArray(i),u=rt.bufferedInfo(a,t,0).bufferedIndex;if(u>-1&&u<a.length-1){const d=rt.bufferedInfo(a,e,0).bufferedIndex,h=a[u].end,m=a[u+1].start;if((d===-1||d>u)&&m-h<1&&e-h<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${h} -> ${m} buffered index: ${d}`);this.warn(p.message),this.media.currentTime+=1e-6;let g=mc(e,this.fragmentTracker);g&&"fragment"in g?g=g.fragment:g||(g=void 0);const v=rt.bufferInfo(this.media,e,0);this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:g,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,s){var i,n;const{fragmentTracker:a,media:u}=this,d=(i=this.hls)==null?void 0:i.config;if(!u||!a||!d)return;const h=(n=this.hls)==null?void 0:n.latestLevelDetails,m=mc(s,a);if((m||h!=null&&h.live&&s<h.fragmentStart)&&(this._trySkipBufferHole(m)||!this.media))return;const p=e.buffered,g=this.adjacentTraversal(e,s);(p&&p.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-s<d.maxBufferHole||g))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,i=e.nextStart;if(s&&i){const n=s.getFragAtPos(t,Ce.MAIN),a=s.getFragAtPos(i,Ce.MAIN);if(n&&a)return a.sn-n.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:n}=this;if(!i&&n!==null&&s&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Lt(e)})`);this.warn(a.message),t.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:n}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,n=(t=this.hls)==null?void 0:t.config;if(!i||!s||!n)return 0;const a=i.currentTime,u=rt.bufferInfo(i,a,0),d=a<u.start?u.start:u.nextStart;if(d&&this.hls){const m=u.len<=n.maxBufferHole,p=u.len>0&&u.len<1&&i.readyState<3,g=d-a;if(g>0&&(m||p)){if(g>n.maxBufferHole){let y=!1;if(a===0){const S=s.getAppendedFrag(0,Ce.MAIN);S&&d<S.end&&(y=!0)}if(!y&&e){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||bx(this.hls.inFlightFragments,d))return 0;let b=!1,T=e.end;for(;T<d;){const _=mc(T,s);if(_)T+=_.duration;else{b=!0;break}}if(b)return 0}}const v=Math.max(d+FI,a+MI);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${v}`),this.moved=!0,i.currentTime=v,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${v}`),S={type:Ue.MEDIA_ERROR,details:Z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?S.part=e:S.frag=e),this.hls.trigger(A.ERROR,S)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,n=t==null?void 0:t.config;if(!s||!n)return 0;const a=s.currentTime;if(this.nudgeRetry++,i<n.nudgeMaxRetry){const u=a+(i+1)*n.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${a} to ${u}`);this.warn(d.message),s.currentTime=u,t.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${a} after ${n.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function bx(r,e){const t=wx(r.main);if(t&&t.start<=e)return t;const s=wx(r.audio);return s&&s.start<=e?s:null}function wx(r){if(!r)return null;switch(r.state){case ue.IDLE:case ue.STOPPED:case ue.ENDED:case ue.ERROR:return null}return r.frag}function mc(r,e){return e.getAppendedFrag(r,Ce.MAIN)||e.getPartialFragment(r)}const zI=.25;function lf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function yh(r,e,t,s,i){let n=new r(e,t,"");try{n.value=s,i&&(n.type=i)}catch{n=new r(e,t,Lt(i?Et({type:i},s):s))}return n}const pc=(()=>{const r=lf();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class GI{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(A.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ta(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return Cy(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:i}=this.hls.config;if(!s&&!i)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=lf();if(a)for(let u=0;u<n.length;u++){const d=n[u].type;if(d===hr.emsg&&!s||!i)continue;const h=ay(n[u].data),m=n[u].pts;let p=m+n[u].duration;p>pc&&(p=pc),p-m<=0&&(p=m+zI);for(let v=0;v<h.length;v++){const y=h[v];if(!oy(y)){this.updateId3CueEnds(m,d);const S=yh(a,m,p,y,d);S&&this.id3Track.addCue(S)}}}}updateId3CueEnds(e,t){var s;const i=(s=this.id3Track)==null?void 0:s.cues;if(i)for(let n=i.length;n--;){const a=i[n];a.type===t&&a.startTime<e&&a.endTime===pc&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:n,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=a;if(n&&(u||d)){let h;i==="audio"?h=m=>m.type===hr.audioId3&&d:i==="video"?h=m=>m.type===hr.emsg&&u:h=m=>m.type===hr.audioId3&&d||m.type===hr.emsg&&u,nf(n,t,s,h)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:i,enableDateRangeMetadataCues:n,interstitialsController:a}=this.hls.config;if(!n)return;const u=lf();if(s&&i&&!a){const{fragmentStart:S,fragmentEnd:b}=e;let T=this.assetCue;T?(T.startTime=S,T.endTime=b):u&&(T=this.assetCue=yh(u,S,b,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),T&&(T.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(T),T.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:d}=this,{dateRanges:h}=e,m=Object.keys(h);let p=this.dateRangeCuesAppended;if(d&&t){var g;if((g=d.cues)!=null&&g.length){const S=Object.keys(p).filter(b=>!m.includes(b));for(let b=S.length;b--;){var v;const T=S[b],_=(v=p[T])==null?void 0:v.cues;delete p[T],_&&Object.keys(_).forEach(k=>{const I=_[k];if(I){I.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(I)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const y=e.fragments[e.fragments.length-1];if(!(m.length===0||!Ae(y==null?void 0:y.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let S=0;S<m.length;S++){const b=m[S],T=h[b],_=T.startTime,k=p[b],I=(k==null?void 0:k.cues)||{};let C=(k==null?void 0:k.durationKnown)||!1,$=pc;const{duration:N,endDate:O}=T;if(O&&N!==null)$=_+N,C=!0;else if(T.endOnNext&&!C){const D=m.reduce((G,X)=>{if(X!==T.id){const K=h[X];if(K.class===T.class&&K.startDate>T.startDate&&(!G||T.startDate<G.startDate))return K}return G},null);D&&($=D.startTime,C=!0)}const j=Object.keys(T.attr);for(let D=0;D<j.length;D++){const G=j[D];if(!uk(G))continue;const X=I[G];if(X)C&&!(k!=null&&k.durationKnown)?X.endTime=$:Math.abs(X.startTime-_)>.01&&(X.startTime=_,X.endTime=$);else if(u){let K=T.attr[G];dk(G)&&(K=xv(K));const te=yh(u,_,$,{key:G,data:K},hr.dateRange);te&&(te.id=b,this.id3Track.addCue(te),I[G]=te,a&&(G==="X-ASSET-LIST"||G==="X-ASSET-URL")&&te.addEventListener("enter",this.onEventCueEnter))}}p[b]={cues:I,dateRange:T,durationKnown:C}}}}}class VI{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:a}=this.config;if(!n||a===1||!s.live)return;const u=this.targetLatency;if(u===null)return;const d=i-u,h=Math.min(this.maxLatency,u+s.targetduration);if(d<h&&d>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,a)),g=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,v=Math.min(p,Math.max(1,g));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:n,liveSyncDurationCount:a,lowLatencyMode:u}=this.config,d=this.hls.userConfig;let h=u&&s||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=n!==void 0?n:a*i);const m=i;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,m)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const i=s.edge,n=e-t-this.edgeStalled,a=i-s.totalduration,u=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(a,n),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===Z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class KI extends Mf{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],n={},a={};let u=!1,d=!1,h=!1;t.levels.forEach(m=>{const p=m.attrs;let{audioCodec:g,videoCodec:v}=m;g&&(m.audioCodec=g=jc(g,s)||void 0),v&&(v=m.videoCodec=A_(v));const{width:y,height:S,unknownCodecs:b}=m,T=(b==null?void 0:b.length)||0;if(u||(u=!!(y&&S)),d||(d=!!v),h||(h=!!g),T||g&&!this.isAudioSupported(g)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":k,"HDCP-LEVEL":I,"PATHWAY-ID":C,RESOLUTION:$,"VIDEO-RANGE":N}=p,j=`${`${C||"."}-`}${m.bitrate}-${$}-${k}-${_}-${N}-${I}`;if(n[j])if(n[j].uri!==m.url&&!m.attrs["PATHWAY-ID"]){const D=a[j]+=1;m.attrs["PATHWAY-ID"]=new Array(D+1).join(".");const G=this.createLevel(m);n[j]=G,i.push(G)}else n[j].addGroupId("audio",p.AUDIO),n[j].addGroupId("text",p.SUBTITLES);else{const D=this.createLevel(m);n[j]=D,a[j]=1,i.push(D)}}),this.filterAndSortMediaOptions(i,t,u,d,h)}createLevel(e){const t=new Fo(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(i.message),t.supportedResult=Lv(i,[])}return t}isAudioSupported(e){return $o(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return $o(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,n){var a;let u=[],d=[],h=e;const m=((a=t.stats)==null?void 0:a.parsing)||{};if((s||i)&&n&&(h=h.filter(({videoCodec:_,videoRange:k,width:I,height:C})=>(!!_||!!(I&&C))&&$_(k))),h.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",k=_;t.levels.length&&(k=`one or more CODECS in variant not supported: ${Lt(t.levels.map(C=>C.attrs.CODECS).filter((C,$,N)=>N.indexOf(C)===$))}`,this.warn(k),_+=` (${k})`);const I=new Error(_);this.hls.trigger(A.ERROR,{type:Ue.MEDIA_ERROR,details:Z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:I,reason:k})}}),m.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),Sx(u)),t.subtitles&&(d=t.subtitles,Sx(d));const p=h.slice(0);h.sort((_,k)=>{if(_.attrs["HDCP-LEVEL"]!==k.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(k.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&_.height!==k.height)return _.height-k.height;if(_.frameRate!==k.frameRate)return _.frameRate-k.frameRate;if(_.videoRange!==k.videoRange)return Pc.indexOf(_.videoRange)-Pc.indexOf(k.videoRange);if(_.videoCodec!==k.videoCodec){const I=f0(_.videoCodec),C=f0(k.videoCodec);if(I!==C)return C-I}if(_.uri===k.uri&&_.codecSet!==k.codecSet){const I=Cc(_.codecSet),C=Cc(k.codecSet);if(I!==C)return C-I}return _.averageBitrate!==k.averageBitrate?_.averageBitrate-k.averageBitrate:0});let g=p[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==p.length)){for(let _=0;_<p.length;_++)if(p[_].pathwayId===h[0].pathwayId){g=p[_];break}}this._levels=h;for(let _=0;_<h.length;_++)if(h[_]===g){var v;this._firstLevel=_;const k=g.bitrate,I=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${h.length} level(s) found, first bitrate: ${k}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const C=Math.min(k,this.hls.config.abrEwmaDefaultEstimateMax);C>I&&I===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=C)}break}const y=n&&!i,S=this.hls.config,b=!!(S.audioStreamController&&S.audioTrackController),T={levels:h,audioTracks:u,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:i,altAudio:b&&!y&&u.some(_=>!!_.url)};m.end=performance.now(),this.hls.trigger(A.MANIFEST_PARSED,T)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const m=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:m,reason:m.message}),p)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,n=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],u=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,s===e&&i&&n===u)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${u?" with Pathway "+u:""} from level ${s}${n?" with Pathway "+n:""}`);const d={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(A.LEVEL_SWITCHING,d);const h=a.details;if(!h||h.live){const m=this.switchParams(a.uri,i==null?void 0:i.details,h);this.loadPlaylist(m)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===ut.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Ce.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(n=>!!s[n]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:n}=t,a=t.levelInfo;if(!a){var u;this.warn(`Invalid level index ${i}`),(u=t.deliveryDirectives)!=null&&u.skip&&(n.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let d=a.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(i,t,d)}else(s=t.deliveryDirectives)!=null&&s.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,n=e.attrs["PATHWAY-ID"],a=e.details,u=a==null?void 0:a.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${n?" Pathway "+n:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(A.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((n,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(n),n===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,n.details&&n.details.fragments.forEach(u=>u.level=-1)),!1));Qv(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(A.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(A.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Sx(r){const e={};r.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function Ky(){return self.SourceBuffer||self.WebKitSourceBuffer}function Wy(){if(!rn())return!1;const e=Ky();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function WI(){if(!Wy())return!1;const r=rn();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(Mo(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(Mo(e,"audio"))))}function HI(){var r;const e=Ky();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const qI=100;class YI extends Rf{constructor(e,t,s){super(e,t,s,"stream-controller",Ce.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,n=i?i.currentTime:null;if(n===null||!Ae(n)||(this.log(`Media seeked to ${n.toFixed(3)}`),!this.getBufferedFrag(n)))return;const a=this.getFwdBufferInfoAtPos(i,n,Ce.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${n} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(qI),this.level=-1,!this.startFragRequested){let n=i.startLevel;n===-1&&(i.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=i.firstAutoLevel),i.nextLoadLevel=n,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=ue.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ue.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ue.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e==null?void 0:e[t],i=s==null?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=ue.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ue.IDLE;break}break}case ue.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ue.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const n=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[n]))return;const a=s[n],u=this.getMainFwdBufferInfo();if(u===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(A.BUFFER_EOS,S),this.state=ue.ENDED;return}if(!this.buffering)return;e.loadLevel!==n&&e.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const h=a.details;if(!h||this.state===ue.WAITING_LEVEL||this.waitForLive(a)){this.level=n,this.state=ue.WAITING_LEVEL,this.startFragRequested=!1;return}const m=u.len,p=this.getMaxBufferLength(a.maxBitrate);if(m>=p)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const g=this.backtrackFragment?this.backtrackFragment.start:u.end;let v=this.getNextFragment(g,h);if(this.couldBacktrack&&!this.fragPrevious&&v&&is(v)&&this.fragmentTracker.getState(v)!==xs.OK){var y;const b=((y=this.backtrackFragment)!=null?y:v).sn-h.startSN,T=h.fragments[b-1];T&&v.cc===T.cc&&(v=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,g)){if(!v.gap){const b=this.audioOnly&&!this.altAudio?It.AUDIO:It.VIDEO,T=(b===It.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;T&&this.afterBufferFlushed(T,b,Ce.MAIN)}v=this.getNextFragmentLoopLoading(v,h,u,Ce.MAIN,p)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,a,g))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===xs.NOT_LOADED||i===xs.PARTIAL?is(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ce.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const n=this.getLevelDetails();if(n!=null&&n.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<n.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,d=e[u],h=this.fragLastKbps;h&&this.fragCurrent?s=this.fragCurrent.duration*d.maxBitrate/(1e3*h)+1:s=0}else s=0;const a=this.getBufferedFrag(t.currentTime+s);if(a){const u=this.followingBufferedFrag(a);if(u){this.abortCurrentFrag();const d=u.maxStartPTS?u.maxStartPTS:u.start,h=u.duration,m=Math.max(a.end,d+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ue.KEY_LOADING:case ue.FRAG_LOADING:case ue.FRAG_LOADING_WAITING_RETRY:case ue.PARSING:case ue.PARSED:this.state=ue.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Ks(s,"playing",this.onMediaPlaying),Ks(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(tr(s,"playing",this.onMediaPlaying),tr(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;for(let n=0;n<t.levels.length;n++){const a=t.levels[n].audioCodec;a&&(s=s||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&i&&!HI(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==ue.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=ue.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:n}=this,a=t.level,u=t.details,d=u.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${d}`);const h=t.levelInfo,m=this.fragCurrent;m&&(this.state===ue.FRAG_LOADING||this.state===ue.FRAG_LOADING_WAITING_RETRY)&&m.level!==t.level&&m.loader&&this.abortCurrentFrag();let p=0;if(u.live||(s=h.details)!=null&&s.live){var g;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;p=this.alignPlaylists(u,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(h.details=u,this.levelLastLoaded=h,n||this.setStartPosition(u,p),this.hls.trigger(A.LEVEL_UPDATED,{details:u,level:a}),this.state===ue.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=ue.IDLE}n&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,n=this.getLoadPosition(),a=e.fragmentStart,u=e.edge,d=n>=a-t.maxFragLookUpTolerance&&n<=u;if(i!==null&&s.duration>i&&(n<i||!d)){const m=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&s.readyState<4||n<u-m)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState))if(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;const p=rt.bufferInfo(s,i,0);if(!((h=p.buffered)!=null&&h.length)){s.currentTime=i;return}if(p.start<=n){s.currentTime=i;return}const{nextStart:v}=rt.bufferedInfo(p.buffered,n,0);v&&(s.currentTime=v)}else s.currentTime=i}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:n}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const u=a[s.level];if(!u){this.warn(`Level ${s.level} not found on progress`);return}const d=u.details;if(!d){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const h=u.videoCodec,m=d.PTSKnown||!d.live,p=(t=s.initSegment)==null?void 0:t.data,g=this._getAudioCodec(u),v=this.transmuxer=this.transmuxer||new vy(this.hls,Ce.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=i?i.index:-1,S=y!==-1,b=new Af(s.level,s.sn,s.stats.chunkCount,n.byteLength,y,S),T=this.initPTS[s.cc];v.push(n,p,g,h,s,i,d.totalduration,m,b,T)}onAudioTrackSwitching(e,t){const s=this.hls,i=this.altAudio!==0;if(Dc(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(A.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(A.AUDIO_TRACK_SWITCHED,t)}),s.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(A.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Dc(t.url,this.hls);if(s){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,n,a=!1;for(const u in s){const d=s[u];if(d.id==="main"){if(n=u,i=d,u==="video"){const h=s[u];h&&(this.videoBuffer=h.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,n=s.type===Ce.MAIN;if(n){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ue.PARSED&&(this.state=ue.IDLE);return}const u=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),is(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const a=this.media;a&&(!this._hasEnoughToStart&&rt.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),n&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case Z.FRAG_GAP:case Z.FRAG_PARSING_ERROR:case Z.FRAG_DECRYPT_ERROR:case Z.FRAG_LOAD_ERROR:case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_ERROR:case Z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ce.MAIN,t);break;case Z.LEVEL_LOAD_ERROR:case Z.LEVEL_LOAD_TIMEOUT:case Z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===ut.LEVEL&&(this.state=ue.IDLE);break;case Z.BUFFER_ADD_CODEC_ERROR:case Z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ue.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==It.AUDIO||!this.altAudio){const s=(t===It.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,Ce.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&s&&(s+=i);const n=this.getLevelDetails(),a=rt.getBuffered(e),u=a.length?a.start(0):0,d=u-s,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<h||this.loadingParts&&d<2*((n==null?void 0:n.partTarget)||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),s+=d,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${u}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:i}=this,n=s==null?void 0:s.frag;if(!n||this.fragContextChanged(n))return;t.fragmentError=0,this.state=ue.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=n.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(A.FRAG_LOADED,s),n.bitrateTest=!1}).catch(s=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:i,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:u,part:d,level:h}=a,{video:m,text:p,id3:g,initSegment:v}=i,{details:y}=h,S=this.altAudio?void 0:i.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=ue.PARSING,v){const b=v.tracks;if(b){const I=u.initSegment||u;if(this.unhandledEncryptionError(v,u))return;this._bufferInitSegment(h,b,I,n),s.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:t,tracks:b})}const T=v.initPTS,_=v.timescale,k=this.initPTS[u.cc];if(Ae(T)&&(!k||k.baseTime!==T||k.timescale!==_)){const I=v.trackId;this.initPTS[u.cc]={baseTime:T,timescale:_,trackId:I},s.trigger(A.INIT_PTS_FOUND,{frag:u,id:t,initPTS:T,timescale:_,trackId:I})}}if(m&&y){S&&m.type==="audiovideo"&&this.logMuxedErr(u);const b=y.fragments[u.sn-1-y.startSN],T=u.sn===y.startSN,_=!b||u.cc>b.cc;if(i.independent!==!1){const{startPTS:k,endPTS:I,startDTS:C,endDTS:$}=m;if(d)d.elementaryStreams[m.type]={startPTS:k,endPTS:I,startDTS:C,endDTS:$};else if(m.firstKeyFrame&&m.independent&&n.id===1&&!_&&(this.couldBacktrack=!0),m.dropped&&m.independent){const N=this.getMainFwdBufferInfo(),O=(N?N.end:this.getLoadPosition())+this.config.maxBufferHole,j=m.firstKeyFramePTS?m.firstKeyFramePTS:k;if(!T&&O<j-this.config.maxBufferHole&&!_){this.backtrack(u);return}else _&&(u.gap=!0);u.setElementaryStreamInfo(m.type,u.start,I,u.start,$,!0)}else T&&k-(y.appliedTimelineOffset||0)>kc&&(u.gap=!0);u.setElementaryStreamInfo(m.type,k,I,C,$),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(m,u,d,n,T||_)}else if(T||_)u.gap=!0;else{this.backtrack(u);return}}if(S){const{startPTS:b,endPTS:T,startDTS:_,endDTS:k}=S;d&&(d.elementaryStreams[It.AUDIO]={startPTS:b,endPTS:T,startDTS:_,endDTS:k}),u.setElementaryStreamInfo(It.AUDIO,b,T,_,k),this.bufferFragmentData(S,u,d,n)}if(y&&g!=null&&g.samples.length){const b={id:t,frag:u,details:y,samples:g.samples};s.trigger(A.FRAG_PARSING_METADATA,b)}if(y&&p){const b={id:t,frag:u,details:y,samples:p.samples};s.trigger(A.FRAG_PARSING_USERDATA,b)}}logMuxedErr(e){this.warn(`${is(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==ue.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:n,video:a,audiovideo:u}=t;if(n){const h=e.audioCodec;let m=yc(n.codec,h);m==="mp4a"&&(m="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){m&&(m.indexOf("mp4a.40.5")!==-1?m="mp4a.40.2":m="mp4a.40.5");const g=n.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(m="mp4a.40.5")}m&&m.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log(`Android: force audio codec to ${m}`)),h&&h!==m&&this.log(`Swapping manifest audio codec "${h}" for "${m}"`),n.levelCodec=m,n.id=Ce.MAIN,this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${m||""}/${h||""}/${n.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Ce.MAIN;const h=a.codec;if((h==null?void 0:h.length)===4)switch(h){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${h}]${a.codec!==h?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(A.BUFFER_CODECS,t),!this.hls)return;d.forEach(h=>{const p=t[h].initSegment;p!=null&&p.byteLength&&this.hls.trigger(A.BUFFER_APPENDING,{type:h,data:p,frag:s,part:null,chunkMeta:i,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Ce.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e==null?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ue.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(rt.isBuffered(e,s)?t=this.getAppendedFrag(s):rt.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,n=t.level;(!i||t.sn!==i.sn||i.level!==n)&&(this.fragPlaying=t,this.hls.trigger(A.FRAG_CHANGED,{frag:t}),(!i||i.level!==n)&&this.hls.trigger(A.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ae(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ae(t)){const s=this.getLevelDetails(),i=this.currentFrag||(s?Nn(null,s.fragments,t):null);if(i){const n=i.programDateTime;if(n!==null){const a=n+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class QI extends Ar{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[s].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Z.KEY_LOAD_ERROR,s,i,n){return new wi({type:Ue.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:s,networkDetails:i})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,n=t.length;i<n;i++){const a=t[i];if(e.cc<=a.cc&&(!is(e)||!is(a)||e.sn<a.sn)||!s&&i==n-1)return this.emeController.selectKeySystemFormat(a).then(u=>{if(!this.emeController)return;a.setKeyFormat(u);const d=wc(u);if(d)return this.emeController.getKeySystemAccess([d])})}if(this.config.requireKeySystemAccessOnStart){const i=bo(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Z.KEY_LOAD_ERROR,h))}const a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const u=bh(n);let d=this.keyIdToKeyInfo[u];if((s=d)!=null&&s.decryptdata.key)return n.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if(this.emeController&&(i=d)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(d.decryptdata)){case"usable":case"usable-in-future":return d.keyLoadPromise.then(m=>{const{keyInfo:p}=m;return n.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${n.keyId?" keyId: "+Ps(n.keyId):""} URI: ${n.uri} from ${e.type} ${e.level}`),d=this.keyIdToKeyInfo[u]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,Z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const a=p_(t.initSegment.data);if(a.length){let u=a[0];u.some(d=>d!==0)?(this.log(`Using keyId found in init segment ${Ps(u)}`),sn.setKeyIdForUri(e.decryptdata.uri,u)):(u=sn.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Ps(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!is(t))return Promise.resolve(s);const n=this.emeController.loadKey(s);return(e.keyLoadPromise=n.then(a=>(e.mediaKeySessionContext=a,s))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=s.loader,n=new i(s);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((a,u)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=s.keyLoadPolicy.default,m={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(g,v,y,S)=>{const{frag:b,keyInfo:T}=y,_=bh(T.decryptdata);if(!b.decryptdata||T!==this.keyIdToKeyInfo[_])return u(this.createKeyLoadError(b,Z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));T.decryptdata.key=b.decryptdata.key=new Uint8Array(g.data),b.keyLoader=null,T.loader=null,a({frag:b,keyInfo:T})},onError:(g,v,y,S)=>{this.resetLoader(v),u(this.createKeyLoadError(t,Z.KEY_LOAD_ERROR,new Error(`HTTP Error ${g.code} loading key ${g.text}`),y,Et({url:d.url,data:void 0},g)))},onTimeout:(g,v,y)=>{this.resetLoader(v),u(this.createKeyLoadError(t,Z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(g,v,y)=>{this.resetLoader(v),u(this.createKeyLoadError(t,Z.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};n.load(d,m,p)})}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,n=s.loader;t.keyLoader===n&&(t.keyLoader=null,s.loader=null);const a=bh(s.decryptdata)||i;delete this.keyIdToKeyInfo[a],n&&n.destroy()}}function bh(r){if(r.keyFormat!==Ds.FAIRPLAY){const e=r.keyId;if(e)return Ps(e)}return r.uri}function Ex(r){const{type:e}=r;switch(e){case ut.AUDIO_TRACK:return Ce.AUDIO;case ut.SUBTITLE_TRACK:return Ce.SUBTITLE;default:return Ce.MAIN}}function wh(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class XI{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,n=s||i,a=new n(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ut.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:n,url:a,deliveryDirectives:u,levelInfo:d}=t;this.load({id:s,level:i,pathwayId:n,responseType:"text",type:ut.LEVEL,url:a,deliveryDirectives:u,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:n,deliveryDirectives:a,track:u}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:ut.AUDIO_TRACK,url:n,deliveryDirectives:a,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:n,deliveryDirectives:a,track:u}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:ut.SUBTITLE_TRACK,url:n,deliveryDirectives:a,levelOrTrack:u})}onLevelsUpdated(e,t){const s=this.loaders[ut.LEVEL];if(s){const i=s.context;i&&!t.levels.some(n=>n===i.levelOrTrack)&&(s.abort(),delete this.loaders[ut.LEVEL])}}load(e){var t;const s=this.hls.config;let i=this.getInternalLoader(e);if(i){const h=this.hls.logger,m=i.context;if(m&&m.levelOrTrack===e.levelOrTrack&&(m.url===e.url||m.deliveryDirectives&&!e.deliveryDirectives)){m.url===e.url?h.log(`[playlist-loader]: ignore ${e.url} ongoing request`):h.log(`[playlist-loader]: ignore ${e.url} in favor of ${m.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let n;if(e.type===ut.MANIFEST?n=s.manifestLoadPolicy.default:n=kt({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Ae((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===ut.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===ut.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===ut.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){const m=h.partTarget,p=h.targetduration;if(m&&p){const g=Math.max(m*3,p*.8)*1e3;n=kt({},n,{maxTimeToFirstByteMs:Math.min(g,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(g,n.maxTimeToFirstByteMs)})}}}const a=n.errorRetry||n.timeoutRetry||{},u={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},d={onSuccess:(h,m,p,g)=>{const v=this.getInternalLoader(p);this.resetInternalLoader(p.type);const y=h.data;m.parsing.start=performance.now(),ri.isMediaPlaylist(y)||p.type!==ut.MANIFEST?this.handleTrackOrLevelPlaylist(h,m,p,g||null,v):this.handleMasterPlaylist(h,m,p,g)},onError:(h,m,p,g)=>{this.handleNetworkError(m,p,!1,h,g)},onTimeout:(h,m,p)=>{this.handleNetworkError(m,p,!0,void 0,h)}};i.load(e,u,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const n=this.hls,a=e.data,u=wh(e,s),d=ri.parseMasterPlaylist(a,u);if(d.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,d.playlistParsingError,i,t);return}const{contentSteering:h,levels:m,sessionData:p,sessionKeys:g,startTimeOffset:v,variableList:y}=d;this.variableList=y,m.forEach(_=>{const{unknownCodecs:k}=_;if(k){const{preferManagedMediaSource:I}=this.hls.config;let{audioCodec:C,videoCodec:$}=_;for(let N=k.length;N--;){const O=k[N];$o(O,"audio",I)?(_.audioCodec=C=C?`${C},${O}`:O,Ra.audio[C.substring(0,4)]=2,k.splice(N,1)):$o(O,"video",I)&&(_.videoCodec=$=$?`${$},${O}`:O,Ra.video[$.substring(0,4)]=2,k.splice(N,1))}}});const{AUDIO:S=[],SUBTITLES:b,"CLOSED-CAPTIONS":T}=ri.parseMasterPlaylistMedia(a,u,d);S.length&&!S.some(k=>!k.url)&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Wt({}),bitrate:0,url:""})),n.trigger(A.MANIFEST_LOADED,{levels:m,audioTracks:S,subtitles:b,captions:T,contentSteering:h,url:u,stats:t,networkDetails:i,sessionData:p,sessionKeys:g,startTimeOffset:v,variableList:y})}handleTrackOrLevelPlaylist(e,t,s,i,n){const a=this.hls,{id:u,level:d,type:h}=s,m=wh(e,s),p=Ae(d)?d:Ae(u)?u:0,g=Ex(s),v=ri.parseLevelPlaylist(e.data,m,p,g,0,this.variableList);if(h===ut.MANIFEST){const y={attrs:new Wt({}),bitrate:0,details:v,name:"",url:m};v.requestScheduled=t.loading.start+Hv(v,0),a.trigger(A.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:m,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=v,this.handlePlaylistLoaded(v,e,t,s,i,n)}handleManifestParsingError(e,t,s,i,n){this.hls.trigger(A.ERROR,{type:Ue.NETWORK_ERROR,details:Z.MANIFEST_PARSING_ERROR,fatal:t.type===ut.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:n})}handleNetworkError(e,t,s=!1,i,n){let a=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===ut.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ut.AUDIO_TRACK||e.type===ut.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let d=Z.UNKNOWN,h=!1;const m=this.getInternalLoader(e);switch(e.type){case ut.MANIFEST:d=s?Z.MANIFEST_LOAD_TIMEOUT:Z.MANIFEST_LOAD_ERROR,h=!0;break;case ut.LEVEL:d=s?Z.LEVEL_LOAD_TIMEOUT:Z.LEVEL_LOAD_ERROR,h=!1;break;case ut.AUDIO_TRACK:d=s?Z.AUDIO_TRACK_LOAD_TIMEOUT:Z.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case ut.SUBTITLE_TRACK:d=s?Z.SUBTITLE_TRACK_LOAD_TIMEOUT:Z.SUBTITLE_LOAD_ERROR,h=!1;break}m&&this.resetInternalLoader(e.type);const p={type:Ue.NETWORK_ERROR,details:d,fatal:h,url:e.url,loader:m,context:e,error:u,networkDetails:t,stats:n};if(i){const g=(t==null?void 0:t.url)||e.url;p.response=Et({url:g,data:void 0},i)}this.hls.trigger(A.ERROR,p)}handlePlaylistLoaded(e,t,s,i,n,a){const u=this.hls,{type:d,level:h,levelOrTrack:m,id:p,groupId:g,deliveryDirectives:v}=i,y=wh(t,i),S=Ex(i);let b=typeof i.level=="number"&&S===Ce.MAIN?h:void 0;const T=e.playlistParsingError;if(T){if(this.hls.logger.warn(`${T} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(A.ERROR,{type:Ue.NETWORK_ERROR,details:Z.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:T,reason:T.message,response:t,context:i,level:b,parent:S,networkDetails:n,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const _=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(A.ERROR,{type:Ue.NETWORK_ERROR,details:Z.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:_,reason:_.message,response:t,context:i,level:b,parent:S,networkDetails:n,stats:s});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case ut.MANIFEST:case ut.LEVEL:if(b){if(!m)b=0;else if(m!==u.levels[b]){const _=u.levels.indexOf(m);_>-1&&(b=_)}}u.trigger(A.LEVEL_LOADED,{details:e,levelInfo:m||u.levels[0],level:b||0,id:p||0,stats:s,networkDetails:n,deliveryDirectives:v,withoutMultiVariant:d===ut.MANIFEST});break;case ut.AUDIO_TRACK:u.trigger(A.AUDIO_TRACK_LOADED,{details:e,track:m,id:p||0,groupId:g||"",stats:s,networkDetails:n,deliveryDirectives:v});break;case ut.SUBTITLE_TRACK:u.trigger(A.SUBTITLE_TRACK_LOADED,{details:e,track:m,id:p||0,groupId:g||"",stats:s,networkDetails:n,deliveryDirectives:v});break}}}class Bs{static get version(){return Uo}static isMSESupported(){return Wy()}static isSupported(){return WI()}static getMediaSource(){return rn()}static get Events(){return A}static get MetadataSchema(){return hr}static get ErrorTypes(){return Ue}static get ErrorDetails(){return Z}static get DefaultConfig(){return Bs.defaultConfig?Bs.defaultConfig:PI}static set DefaultConfig(e){Bs.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Nf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=r_(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=OI(Bs.DefaultConfig,e,t);this.userConfig=e,s.progressive&&$I(s,t);const{abrController:i,bufferController:n,capLevelController:a,errorController:u,fpsController:d}=s,h=new u(this),m=this.abrController=new i(this),p=new J_(this),g=s.interstitialsController,v=g?this.interstitialsController=new g(this,Bs):null,y=this.bufferController=new n(this,p),S=this.capLevelController=new a(this),b=new d(this),T=new XI(this),_=s.contentSteeringController,k=_?new _(this):null,I=this.levelController=new KI(this,k),C=new GI(this),$=new QI(this.config,this.logger),N=this.streamController=new YI(this,p,$),O=this.gapController=new BI(this,p);S.setStreamController(N),b.setStreamController(N);const j=[T,I,N];v&&j.splice(1,0,v),k&&j.splice(1,0,k),this.networkControllers=j;const D=[m,y,O,S,b,C,p];this.audioTrackController=this.createController(s.audioTrackController,j);const G=s.audioStreamController;G&&j.push(this.audioStreamController=new G(this,p,$)),this.subtitleTrackController=this.createController(s.subtitleTrackController,j);const X=s.subtitleStreamController;X&&j.push(this.subtititleStreamController=new X(this,p,$)),this.createController(s.timelineController,D),$.emeController=this.emeController=this.createController(s.emeController,D),this.cmcdController=this.createController(s.cmcdController,D),this.latencyController=this.createController(VI,D),this.coreComponents=D,j.push(h);const K=h.onErrorOut;typeof K=="function"&&this.on(A.ERROR,K,h),this.on(A.MANIFEST_LOADED,T.onManifestLoaded,T)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const i=e===A.ERROR;this.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.INTERNAL_EXCEPTION,fatal:i,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const n=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(A.ERROR,{type:Ue.OTHER_ERROR,details:Z.ATTACH_MEDIA_ERROR,fatal:!0,error:n});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(A.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(A.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=bf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(A.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Ce.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Ce.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Ce.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=BA()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){O_(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,s)for(let n=i;n--;){const a=e[n].attrs["HDCP-LEVEL"];if(a&&a<=s)return n}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=Cv(t);return Rv(e,s,navigator.mediaCapabilities)}}Bs.defaultConfig=void 0;class JI extends L.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("WatchPage Error:",e,t)}render(){return this.state.hasError?l.jsxs("div",{className:"bg-black h-screen flex flex-col items-center justify-center text-white gap-4 px-4",children:[l.jsx("h2",{className:"text-2xl font-bold",children:"Errore"}),l.jsx("p",{className:"text-center max-w-md",children:"Si  verificato un errore. Ricarica la pagina."}),l.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-nebula-600 rounded hover:bg-nebula-700 transition",children:"Ricarica Pagina"})]}):this.props.children}}const gc="https://api.asknebula.it",ZI="8265bd1679663a7ea12ac168da84d2e8",ms={Play:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:l.jsx("path",{d:"M8 5v14l11-7z"})}),Pause:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:l.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),Rewind10:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:l.jsx("path",{d:"M11 19l-9-7 9-7v14z"})}),Forward10:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:l.jsx("path",{d:"M13 19l9-7-9-7v14z"})}),VolumeHigh:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:l.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),VolumeMute:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:l.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}),Settings:()=>l.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[l.jsx("circle",{cx:"12",cy:"12",r:"3"}),l.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),Fullscreen:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:l.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})}),Next:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:l.jsx("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})}),Back:()=>l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:l.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),Speed:()=>l.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("polyline",{points:"12 6 12 12 16 14"}),l.jsx("path",{d:"M22 12h-4"})," ",l.jsx("path",{d:"M6 12H2"})]}),Subtitles:()=>l.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-full h-full",children:[l.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),l.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"9"}),l.jsx("line",{x1:"9",y1:"13",x2:"15",y2:"13"})]})};function Tx(r){if(r===0||!r||isNaN(r)||!isFinite(r))return"00:00";const e=Math.floor(r/3600),t=Math.floor(r%3600/60),s=Math.floor(r%60);return e>0?`${e}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function eL(){var On;const[r,e]=L.useState(null),[t,s]=L.useState(!0),[i,n]=L.useState(""),[a,u]=L.useState(null),[d,h]=L.useState(null),[m]=L.useState(ec()),[p,g]=L.useState(null),[v,y]=L.useState(!1),{tmdb_id:S}=Pn(),[b]=kr(),T=b.get("type")||"movie",_=b.get("season"),k=b.get("episode"),{session:I,plan:C}=Mt(),$=Bt();if(!S)return l.jsxs("div",{className:"bg-black h-screen flex flex-col items-center justify-center text-white gap-4 px-4",children:[l.jsx("h2",{className:"text-2xl font-bold",children:"Errore"}),l.jsx("p",{className:"text-center max-w-md",children:"ID contenuto mancante."}),l.jsx("button",{onClick:()=>$(-1),className:"px-4 py-2 bg-white/10 rounded hover:bg-white/20 transition",children:"Indietro"})]});const N=L.useRef(null),O=L.useRef(null),j=L.useRef(null),[D,G]=L.useState(!1),[X,K]=L.useState(0),[W,te]=L.useState(0),[z,M]=L.useState(0),[F,H]=L.useState(1),[Y,P]=L.useState(!1),[B,oe]=L.useState(!1),[ie,ne]=L.useState(!1),[le,_e]=L.useState(!1),[Se,Fe]=L.useState(!1),Ee=_i(),[at,de]=L.useState(!0),[gt,Ct]=L.useState(!1),[as,ke]=L.useState(!1),be=L.useRef(null),pe=L.useRef(Date.now()),Ge=L.useRef(0),Ne=L.useRef(!1),nt=L.useRef(0),it=L.useRef(null),zt=L.useRef(0);L.useEffect(()=>{const q=()=>{const ye="ontouchstart"in window||navigator.maxTouchPoints>0,$e=document,we=!!($e.fullscreenElement||$e.webkitFullscreenElement||$e.mozFullScreenElement||$e.msFullscreenElement)?window.screen.width:window.innerWidth,lt=window.screen.width,Ie=we>=600||lt>=600,bt=we<768||lt<768;Ee&&ye?(_e(Ie),ne(Ie?!1:bt)):(_e(!1),ne(ye&&bt))};q(),window.addEventListener("resize",q);const ce=()=>{setTimeout(q,100)};return document.addEventListener("fullscreenchange",ce),document.addEventListener("webkitfullscreenchange",ce),document.addEventListener("mozfullscreenchange",ce),document.addEventListener("MSFullscreenChange",ce),()=>{window.removeEventListener("resize",q),document.removeEventListener("fullscreenchange",ce),document.removeEventListener("webkitfullscreenchange",ce),document.removeEventListener("mozfullscreenchange",ce),document.removeEventListener("MSFullscreenChange",ce)}},[Ee]);const[ht,ts]=L.useState("none"),[ks,zs]=L.useState(1),[vs,Te]=L.useState([]),[ds,Gt]=L.useState(-1),[Ws,sr]=L.useState([]),[oi,li]=L.useState(-1),[fe,Oe]=L.useState([]),[We,Qe]=L.useState(-1),vt=L.useRef({time:0,timestamp:0});L.useRef(null);const yt=L.useRef(!1),dt=L.useRef(!1),ft=L.useRef(null),ys=L.useRef(null);L.useEffect(()=>{if(!S)return;const q=setTimeout(()=>{t&&(u("Il caricamento sta richiedendo troppo tempo. Riprova o controlla la connessione."),s(!1))},6e4);async function ce(){try{s(!0),u(null),e(null);const ye=fetch(`${gc}/title/${S}?type=${T}`).catch(()=>null);let $e=Promise.resolve(null);if(I){let Ie=`${gc}/me/progress/${S}`;T==="tv"&&_&&k&&(Ie+=`?season=${_}&episode=${k}`),$e=fetch(Ie,{headers:{Authorization:`Bearer ${I.access_token}`}}).catch(()=>null)}const[je,we]=await Promise.all([ye,$e]);if(je&&je.ok){const Ie=await je.json();Ie!=null&&Ie.raw&&(h(Ie.raw),T==="tv"&&_&&k&&S&&Br(S,parseInt(_),parseInt(k),Ie.raw))}if(I&&we&&we.ok)try{const Ie=await we.json();Ie&&Ie.position_seconds&&Ie.position_seconds>0?(ft.current={position:Ie.position_seconds,duration:Ie.duration_seconds},dt.current=!1):(ft.current=null,dt.current=!1)}catch{ft.current=null,dt.current=!1}else ft.current=null,dt.current=!1;if(!S)throw new Error("TMDB ID mancante");n("Caricamento stream...");const lt=await Promise.race([qT({tmdbId:parseInt(S),isMovie:T==="movie",season:_?parseInt(_):void 0,episode:k?parseInt(k):void 0,apiKey:ZI,corsProxy:m,onLoading:n}),new Promise((Ie,bt)=>setTimeout(()=>bt(new Error("Timeout: il caricamento dello stream sta richiedendo troppo tempo.")),15e3))]);if(lt&&lt.m3u8Url)e({iframe:"",m3u_playlist_url:lt.m3u8Url});else throw new Error("Stream non disponibile al momento.")}catch(ye){const $e=(ye==null?void 0:ye.toString())||"";if($e.includes("uscira")||$e.includes("uscir")||$e.includes("breve")||$e.includes("")){y(!0),s(!1);return}console.error("Error loading watch page, falling back to iframe:",ye);const je="https://vidsrc.to/embed";let we=`${je}/movie/${S}`;T==="tv"&&_&&k&&(we=`${je}/tv/${S}/${_}/${k}`),e({iframeUrl:we}),ve(!0),u(null)}finally{clearTimeout(q),s(!1)}}return S?ce().catch(ye=>{const $e=(ye==null?void 0:ye.toString())||"";if($e.includes("uscira")||$e.includes("uscir")||$e.includes("breve")||$e.includes("")){y(!0),s(!1);return}console.error("Unhandled error in loadData:",ye);const je="https://vidsrc.to/embed";let we=`${je}/movie/${S}`;T==="tv"&&_&&k&&(we=`${je}/tv/${S}/${_}/${k}`),e({iframeUrl:we}),ve(!0),s(!1),u(null)}):(u("ID contenuto mancante."),s(!1)),()=>{clearTimeout(q)}},[S,_,k,T,m,I]);async function Br(q,ce,ye,$e){try{const je=await fetch(`${gc}/tv/${q}/season/${ce}`);if(je.ok){const we=await je.json();if(we.episodes){const lt=we.episodes.findIndex(Ie=>Ie.episode_number===ye);if(lt!==-1&&lt<we.episodes.length-1){g({season:ce,episode:ye+1});return}}}$e.seasons&&$e.seasons.find(lt=>lt.season_number===ce+1)&&g({season:ce+1,episode:1})}catch{}}const[ki,Ai]=L.useState(()=>{try{const ce=sessionStorage.getItem("nebula_verified_proxy");if(ce&&ce!=="api.allorigins.win/raw?url="){let ye=ce.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest=").replace(/\/proxy\/\?/g,"/proxy?").replace(/proxy\/\//g,"proxy/").replace(/\/\/proxy/g,"/proxy");return ye.includes("/proxy/?quest=")&&(ye=ye.replace("/proxy/?quest=","/proxy?quest=")),ye.includes("/proxy/?")||ye.includes("proxy//")?ec().replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest="):ye}}catch{}return ec().replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest=")}),[ci,zr]=L.useState(!1),[re,ve]=L.useState(!1);L.useEffect(()=>{zr(!1),ve(!1),u(null)},[S,_,k,T]),L.useEffect(()=>{s(!0),n("Caricamento..."),u(null),G(!1),te(0),K(0),M(0),e(null),Fe(!1)},[S,_,k,T]);const ze=L.useMemo(()=>{if(r!=null&&r.iframeUrl)return r.iframeUrl;const q="https://vidsrc.to/embed";return T==="movie"?`${q}/movie/${S}`:`${q}/tv/${S}/${_}/${k}`},[T,S,_,k,r]);L.useEffect(()=>{if(!(r!=null&&r.m3u_playlist_url))return;async function q(){try{const je=sessionStorage.getItem("nebula_verified_proxy");if(je&&je!=="api.allorigins.win/raw?url="&&(r!=null&&r.m3u_playlist_url))try{let we=je.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest=").replace(/\/proxy\/\?/g,"/proxy?").replace(/proxy\/\//g,"proxy/").replace(/\/\/proxy/g,"/proxy");if((we.includes("/proxy/?quest=")||we.includes("/proxy/?"))&&(we=we.replace(/\/proxy\/\?/g,"/proxy?")),we.includes("/proxy/?")||we.includes("proxy//")||we.includes("//proxy"))throw sessionStorage.removeItem("nebula_verified_proxy"),new Error("Malformed proxy cache cleared");if(we!==je)try{sessionStorage.setItem("nebula_verified_proxy",we)}catch{}const lt=we.includes("api.codetabs.com/v1/proxy?quest=")?`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(r.m3u_playlist_url)}`:`https://${we}${r.m3u_playlist_url}`,Ie=new AbortController,bt=setTimeout(()=>Ie.abort(),4e3),bs=await fetch(lt,{method:"GET",signal:Ie.signal});if(clearTimeout(bt),bs.ok&&bs.status===200&&(await bs.text()).includes("#EXTM3U")){a0(we),Ai(we),zr(!0),ve(!1);return}sessionStorage.removeItem("nebula_verified_proxy")}catch{sessionStorage.removeItem("nebula_verified_proxy")}}catch{}const ce=["api.codetabs.com/v1/proxy?quest=","api.allorigins.win/raw?url=",ec()].filter(je=>je&&!je.includes("corsproxy.io")&&!je.includes("thingproxy.freeboard.io")&&!je.includes("cors.bridged.cc")),ye=[...new Set(ce)].filter(je=>!!je).map(je=>je.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest="));n("Ricerca server ottimale..."),n("Ricerca server ottimale...");const $e=async je=>{try{if(!(r!=null&&r.m3u_playlist_url))throw new Error("No playlist URL");let we;je.includes("api.codetabs.com/v1/proxy?quest=")?we=`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(r.m3u_playlist_url)}`:je.includes("api.allorigins.win/raw?url=")?we=`https://api.allorigins.win/raw?url=${encodeURIComponent(r.m3u_playlist_url)}`:we=`https://${je}${r.m3u_playlist_url}`;const lt=new AbortController,Ie=setTimeout(()=>lt.abort(),5e3),bt=await fetch(we,{method:"GET",signal:lt.signal});if(clearTimeout(Ie),bt.ok&&bt.status===200&&(await bt.text()).includes("#EXTM3U"))return je}catch{}throw new Error("Proxy failed")};try{const we=(await Promise.any(ye.map(lt=>$e(lt)))).replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest=");a0(we),Ai(we),zr(!0),ve(!1);try{sessionStorage.setItem("nebula_verified_proxy",we)}catch{}}catch{try{sessionStorage.removeItem("nebula_verified_proxy")}catch{}ve(!0),s(!1)}}zr(!1),q().catch(ce=>{u("Errore nella ricerca del server. Riprova."),s(!1),ve(!0)})},[r]),L.useEffect(()=>{if(re||!(r!=null&&r.m3u_playlist_url)||!N.current||!ci)return;const q=N.current;let ce=null,ye=null,$e=ki.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest="),je=0;if(Bs.isSupported()){const we="https://vixsrc.to";ye=window.XMLHttpRequest,window.XMLHttpRequest=function(){const Ie=new ye,bt=Ie.open.bind(Ie);return Ie.open=function(bs,Os,At,os,As){let Ke;if(Os instanceof URL?Ke=Os.href:Ke=Os,!Ke.startsWith("http://")&&!Ke.startsWith("https://")&&(Ke.startsWith("/")?Ke=we+Ke:Ke=we+"/"+Ke),(Ke.includes("codetabs.com")||Ke.includes("allorigins.win")||Ke.includes("corsproxy.io")||Ke.includes("herokuapp"))&&!Ke.includes("vixsrc.to")&&(Ke.includes("/storage/")||Ke.includes("enc.key")||Ke.includes("/playlist/")||Ke.includes(".m3u8")||Ke.includes(".ts")))try{const vr=new URL(Ke),Dt=vr.pathname,Xt=vr.search;Dt&&(Dt.includes("/storage/")||Dt.includes("/playlist/")||Dt.includes("enc.key")||Dt.includes(".m3u8")||Dt.includes(".ts"))&&(Ke=we+Dt+Xt)}catch{let Dt="";if(Ke.includes("/storage/")){const Xt=Ke.match(/\/storage\/[^?]*/);Xt&&(Dt=Xt[0])}else if(Ke.includes("/playlist/")){const Xt=Ke.match(/\/playlist\/[^?]*/);Xt&&(Dt=Xt[0])}else if(Ke.includes("enc.key")){const Xt=Ke.match(/\/[^\/]*enc\.key[^?]*/);Xt&&(Dt=Xt[0])}else if(Ke.includes(".m3u8")){const Xt=Ke.match(/\/[^\/]*\.m3u8[^?]*/);Xt&&(Dt=Xt[0])}else if(Ke.includes(".ts")){const Xt=Ke.match(/\/[^\/]*\.ts[^?]*/);Xt&&(Dt=Xt[0])}if(Dt){const Xt=Ke.match(/\?.*$/),Da=Xt?Xt[0]:"";Ke=we+Dt+Da}}if(Ke.includes("vixsrc.to")&&!Ke.includes($e)&&!Ke.includes("codetabs.com")&&!Ke.includes("allorigins.win")){let vr=$e.replace(/\/proxy\/\?quest=/g,"/proxy?quest=").replace(/\/proxy\/quest=/g,"/proxy?quest="),Dt;return vr.includes("api.codetabs.com/v1/proxy?quest=")?Dt=`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(Ke)}`:vr.includes("api.allorigins.win/raw?url=")?Dt=`https://api.allorigins.win/raw?url=${encodeURIComponent(Ke)}`:vr.includes("corsproxy.io")?Dt=`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(Ke)}`:Dt=`https://${vr}${Ke}`,bt.call(this,bs,Dt,At!==!1,os||null,As||null)}return(Ke.includes(".ts")||Ke.includes("sc-u16-01.scws-content.net")||Ke.includes("scws-content.net"))&&!Ke.includes($e)&&!Ke.includes("codetabs.com")&&!Ke.includes("allorigins.win")?bt.call(this,bs,Ke,At!==!1,os||null,As||null):bt.call(this,bs,Ke,At!==!1,os||null,As||null)},Ie},Object.setPrototypeOf(window.XMLHttpRequest,ye),Object.setPrototypeOf(window.XMLHttpRequest.prototype,ye.prototype),ce=new Bs({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90}),O.current=ce,ce.loadSource(r.m3u_playlist_url),ce.attachMedia(q),ce.on(Bs.Events.MANIFEST_PARSED,async(Ie,bt)=>{const Os=bt.levels.map((At,os)=>({l:At,i:os})).sort((At,os)=>At.l.height-os.l.height).map(({l:At,i:os})=>{let As=`${At.height}p`;return At.height>=2160?As="4K (2160p)":At.height>=1440?As="QHD (1440p)":At.height>=1080?As="FHD (1080p)":At.height>=720&&(As="HD (720p)"),{height:At.height,index:os,bitrate:At.bitrate,name:As}});if(Te(Os),Os.length>0&&ce){const At=Os[Os.length-1].index;ce.currentLevel=At,Gt(At)}if(s(!1),I&&ft.current&&!dt.current){const At=ft.current,os=At.position,As=At.duration||q.duration||1/0;if(os>5&&os<As-10)if(q.readyState>=2)q.currentTime=os,K(os),dt.current=!0;else{const Ke=()=>{if(I&&ft.current&&!dt.current){const ln=ft.current.position,vr=ft.current.duration||q.duration||1/0;ln>5&&ln<vr-10&&(q.currentTime=ln,K(ln),dt.current=!0)}q.removeEventListener("loadedmetadata",Ke)};q.addEventListener("loadedmetadata",Ke,{once:!0})}}try{await q.play(),G(!0)}catch{if(q.muted)G(!1);else{q.muted=!0,P(!0);try{await q.play(),G(!0)}catch{G(!1)}}}}),ce.on(Bs.Events.LEVEL_LOADED,(Ie,bt)=>{const bs=bt.details.totalduration;if(bs&&!isNaN(bs)&&isFinite(bs)&&te(bs),I&&ft.current&&!dt.current){const Os=ft.current.position;Os>5&&q.readyState>=2&&(q.currentTime=Os,K(Os),dt.current=!0)}}),ce.on(Bs.Events.ERROR,(Ie,bt)=>{bt.fatal&&(bt.type===Bs.ErrorTypes.NETWORK_ERROR?(je++,je<=2?ce==null||ce.startLoad():(ve(!0),s(!1))):(ve(!0),s(!1)))}),ce.on(Bs.Events.AUDIO_TRACKS_UPDATED,(Ie,bt)=>{sr(bt.audioTracks),li(bt.audioTracks.findIndex(bs=>bs.default)||0)}),ce.on(Bs.Events.SUBTITLE_TRACKS_UPDATED,(Ie,bt)=>{Oe(bt.subtitleTracks),Qe(-1),ce&&(ce.subtitleTrack=-1)});const lt=()=>{if(I&&ft.current&&!dt.current){const Ie=ft.current.position;Ie>5&&q.readyState>=2&&(q.currentTime=Ie,dt.current=!0,K(Ie),S&&Le(Ie,ft.current.duration||q.duration||0,!0))}};q.addEventListener("loadedmetadata",()=>{I&&ft.current&&!dt.current&&q.duration!==1/0&&q.duration>0&&lt()}),q.addEventListener("canplay",()=>{ft.current&&!dt.current&&lt()}),ce.on(Bs.Events.FRAG_LOADED,(Ie,bt)=>{I&&ft.current&&!dt.current&&lt()})}else if(q.canPlayType("application/vnd.apple.mpegurl")){q.src=r.m3u_playlist_url;const we=()=>{if(I&&ft.current&&!dt.current){const lt=ft.current.position;lt>5&&q.readyState>=2&&q.duration>0&&(q.currentTime=lt,dt.current=!0,K(lt),S&&Le(lt,ft.current.duration||q.duration||0,!0))}};q.addEventListener("loadedmetadata",we),q.addEventListener("canplay",async()=>{if(we(),q.paused){/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&(q.muted=!0,P(!0));try{await q.play(),G(!0)}catch{if(!q.muted){q.muted=!0,P(!0);try{await q.play(),G(!0)}catch{}}}}}),q.onerror=()=>{ve(!0),s(!1)}}return()=>{ce&&ce.destroy(),ye&&(window.XMLHttpRequest=ye)}},[r,ci,ki,re]);const Le=L.useCallback((q,ce,ye=!1)=>{if(!S||!I)return;T==="tv"&&p&&!yt.current&&ce>0;const $e=Date.now(),je=$e-vt.current.timestamp,we=Math.abs(q-vt.current.time);if(!ye&&je<3e3&&we<5)return;vt.current={time:q,timestamp:$e};const lt={content_id:S,season:T==="tv"&&_?Number(_):void 0,episode:T==="tv"&&k?Number(k):void 0,position_seconds:isNaN(q)?0:Math.floor(q),duration_seconds:isNaN(ce)?0:Math.floor(ce),title:(d==null?void 0:d.title)||(d==null?void 0:d.name)||"Contenuto",poster:d!=null&&d.poster_path?Ze(d.poster_path):null};fetch(`${gc}/me/progress`,{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json",Authorization:`Bearer ${I.access_token}`},body:JSON.stringify(lt)}).then(Ie=>{Ie.ok}).catch(Ie=>{})},[I,S,d,_,k,p,T]);L.useEffect(()=>{const q=N.current;if(!q)return;q.paused||(G(!0),at&&Ft.current==="none"&&!Ir.current&&setTimeout(()=>{N.current&&!N.current.paused&&Ft.current==="none"&&!Ir.current&&jt()},2e3));const ce=()=>{G(!0),setTimeout(()=>{const Ie=N.current;Ie&&!Ie.paused&&Ft.current==="none"&&!Ir.current&&!be.current&&jt()},2e3)},ye=()=>{G(!0),q.currentTime>0&&Le(q.currentTime,q.duration),setTimeout(()=>{const Ie=N.current;Ie&&!Ie.paused&&Ft.current==="none"&&!Ir.current&&!be.current&&jt()},2e3)},$e=()=>{G(!1),q.currentTime>0&&Le(q.currentTime,q.duration,!0)},je=()=>{if(K(q.currentTime),!q.paused&&!D&&(G(!0),at&&Ft.current==="none"&&!Ir.current&&!be.current&&setTimeout(()=>{const Ie=N.current;Ie&&!Ie.paused&&Ft.current==="none"&&!Ir.current&&jt()},2e3)),q.buffered.length>0){for(let Ie=0;Ie<q.buffered.length;Ie++)if(q.buffered.start(Ie)<=q.currentTime&&q.buffered.end(Ie)>=q.currentTime){M(q.buffered.end(Ie));break}}Le(q.currentTime,q.duration)},we=()=>{Number.isFinite(q.duration)&&te(q.duration)},lt=()=>{G(!1),Le(q.duration,q.duration,!0)};return q.addEventListener("playing",ce),q.addEventListener("play",ye),q.addEventListener("pause",$e),q.addEventListener("timeupdate",je),q.addEventListener("durationchange",we),q.addEventListener("ended",lt),()=>{q.removeEventListener("playing",ce),q.removeEventListener("play",ye),q.removeEventListener("pause",$e),q.removeEventListener("timeupdate",je),q.removeEventListener("durationchange",we),q.removeEventListener("ended",lt)}},[I,S,d,T,_,k,Le]),L.useEffect(()=>{ys.current&&(clearInterval(ys.current),ys.current=null);let q=0;return ys.current=setInterval(()=>{const ce=N.current;if(ce&&!isNaN(ce.currentTime)&&isFinite(ce.currentTime)){const ye=ce.currentTime;K(ye),!ce.paused&&ce.currentTime>0&&(q++,q>=10&&(q=0,Le(ce.currentTime,ce.duration)))}},1e3),()=>{ys.current&&(clearInterval(ys.current),ys.current=null)}},[S,_,k,T,Le]),L.useCallback(q=>{q&&q.stopPropagation();const ce=N.current;if(!ce)return;const ye=!ce.muted;ce.muted=ye,P(ye),!ye&&F===0&&(H(1),ce.volume=1)},[F]);const mt=L.useCallback(q=>{q.stopPropagation();const ce=parseFloat(q.target.value);H(ce);const ye=N.current;ye&&(ye.volume=ce,ce===0?ye.muted||(ye.muted=!0,P(!0)):ye.muted&&(ye.muted=!1,P(!1)))},[]),wt=L.useCallback(async()=>{const q=N.current;if(q)try{q.paused?(await q.play(),G(!0)):(q.pause(),G(!1))}catch(ce){(ce.name==="NotAllowedError"||ce.name==="NotSupportedError"||ce.name!=="AbortError")&&G(!1)}},[]),ss=q=>{N.current&&(N.current.currentTime+=q)},Gr=q=>{const ce=parseFloat(q.target.value);N.current&&(N.current.currentTime=ce,K(ce),Le(ce,N.current.duration,!0))},on=async()=>{if(!j.current)return;j.current;const q=N.current,ce=document;try{if(!ce.fullscreenElement&&!ce.webkitFullscreenElement&&!ce.mozFullScreenElement&&!ce.msFullscreenElement){const ye=j.current;if(!ye)return;if(ie||Ee&&le)try{const{ScreenOrientation:$e}=await er(async()=>{const{ScreenOrientation:je}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:je}},[]);await $e.lock({orientation:"landscape"})}catch{try{"orientation"in screen&&"lock"in screen.orientation&&await screen.orientation.lock("landscape")}catch{}}if(ye.requestFullscreen)await ye.requestFullscreen();else if(ye.webkitRequestFullscreen)await ye.webkitRequestFullscreen();else if(ye.mozRequestFullScreen)await ye.mozRequestFullScreen();else if(ye.msRequestFullscreen)await ye.msRequestFullscreen();else if(q&&q.webkitEnterFullscreen){q.webkitEnterFullscreen();return}oe(!0)}else{if(ce.exitFullscreen?await ce.exitFullscreen():ce.webkitExitFullscreen?await ce.webkitExitFullscreen():ce.mozCancelFullScreen?await ce.mozCancelFullScreen():ce.msExitFullscreen&&await ce.msExitFullscreen(),ie||Ee&&le)try{const{ScreenOrientation:ye}=await er(async()=>{const{ScreenOrientation:$e}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:$e}},[]);await ye.unlock(),await new Promise($e=>setTimeout($e,100)),await ye.lock({orientation:"portrait"})}catch{try{const{ScreenOrientation:$e}=await er(async()=>{const{ScreenOrientation:je}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:je}},[]);await $e.unlock()}catch{}}oe(!1)}}catch{}};L.useEffect(()=>{const q=async()=>{const ye=document,$e=!!(ye.fullscreenElement||ye.webkitFullscreenElement||ye.mozFullScreenElement||ye.msFullscreenElement);if(oe($e),$e){if(ie||Ee&&le)try{const{ScreenOrientation:je}=await er(async()=>{const{ScreenOrientation:we}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:we}},[]);await je.lock({orientation:"landscape"})}catch{try{"orientation"in screen&&"lock"in screen.orientation&&await screen.orientation.lock("landscape")}catch{}}}else if(ie||Ee&&le)try{const{ScreenOrientation:je}=await er(async()=>{const{ScreenOrientation:we}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:we}},[]);await je.unlock(),await new Promise(we=>setTimeout(we,100)),await je.lock({orientation:"portrait"})}catch{try{const{ScreenOrientation:we}=await er(async()=>{const{ScreenOrientation:lt}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:lt}},[]);await we.unlock()}catch{}}},ce=async()=>{if(oe(!1),ie||Ee&&le)try{const{ScreenOrientation:ye}=await er(async()=>{const{ScreenOrientation:$e}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:$e}},[]);await ye.unlock(),await new Promise($e=>setTimeout($e,100)),await ye.lock({orientation:"portrait"})}catch{try{const{ScreenOrientation:$e}=await er(async()=>{const{ScreenOrientation:je}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:je}},[]);await $e.unlock()}catch{}}};return document.addEventListener("fullscreenchange",q),document.addEventListener("webkitfullscreenchange",q),document.addEventListener("mozfullscreenchange",q),document.addEventListener("MSFullscreenChange",q),N.current&&N.current.addEventListener("webkitendfullscreen",ce),()=>{document.removeEventListener("fullscreenchange",q),document.removeEventListener("webkitfullscreenchange",q),document.removeEventListener("mozfullscreenchange",q),document.removeEventListener("MSFullscreenChange",q),N.current&&N.current.removeEventListener("webkitendfullscreen",ce),(ie||Ee&&le)&&er(async()=>{const{ScreenOrientation:ye}=await import("./index-BTPDjQiS.js");return{ScreenOrientation:ye}},[]).then(({ScreenOrientation:ye})=>ye.unlock()).catch(()=>{})}},[ie,Ee,le]);const et=q=>{q.target.closest("button")||q.target.closest("input")||ie||Ee&&le||wt()},Vr=q=>{N.current&&(N.current.playbackRate=q),zs(q),ts("none")},xr=q=>{O.current&&(O.current.currentLevel=q),Gt(q),ts("none")},Wo=q=>{O.current&&(O.current.audioTrack=q),li(q),ts("none")},Pa=q=>{O.current&&(O.current.subtitleTrack=q,q===-1&&(O.current.subtitleTrack=-1)),Qe(q),ts("none")},Ho=()=>{p&&(N.current&&Le(N.current.duration,N.current.duration,!0),$(`/watch/${S}?type=tv&season=${p.season}&episode=${p.episode}`))};L.useEffect(()=>{const q=ce=>{if(N.current)switch(ce.code){case"ArrowLeft":ss(-10);break;case"ArrowRight":ss(10);break;case"Space":ce.preventDefault(),wt();break}};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[wt]);const Qt=L.useRef(D),Ft=L.useRef(ht),Ir=L.useRef(gt);L.useEffect(()=>{Qt.current=D},[D]),L.useEffect(()=>{Ft.current=ht},[ht]),L.useEffect(()=>{Ir.current=gt},[gt]);const jt=L.useCallback(()=>{be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{const q=Date.now()-Ge.current<2e4;Qt.current&&Ft.current==="none"&&(!Ir.current||q)&&de(!1)},2500)},[]),Ii=L.useCallback(()=>{de(!0),be.current&&clearTimeout(be.current),Qt.current&&Ft.current==="none"&&jt()},[jt]);L.useEffect(()=>{const q=N.current;if(!q)return;const ce=!q.paused;if(ce&&at)return Ii(),()=>{be.current&&clearTimeout(be.current)};ce||(de(!0),be.current&&(clearTimeout(be.current),be.current=null))},[D,at,Ii]),L.useRef(!1);const Dn=L.useRef(null),Pt=L.useCallback(q=>{if(Date.now()-Ge.current<2e3)return;const ce={x:q.clientX,y:q.clientY};if(Dn.current){const ye=Math.abs(ce.x-Dn.current.x),$e=Math.abs(ce.y-Dn.current.y);if(ye<5&&$e<5)return}Dn.current=ce,Ne.current=!1,Ii(),pe.current=Date.now()},[Ii]);L.useEffect(()=>(window.addEventListener("mousemove",Pt),()=>{window.removeEventListener("mousemove",Pt),be.current&&clearTimeout(be.current)}),[Pt]);const Xc=q=>{const ce=Date.now(),ye=ce-nt.current<300;let $e=0;if("touches"in q&&q.touches.length>0?$e=q.touches[0].clientX:"clientX"in q&&($e=q.clientX),ye){it.current&&clearTimeout(it.current);const je=window.innerWidth,we=$e>je/2;ss(we?10:-10),nt.current=0}else nt.current=ce,zt.current=$e,it.current=setTimeout(()=>{de(je=>je?!1:(Qt.current&&jt(),!0)),nt.current=0},300)};return a?l.jsxs("div",{className:"bg-black h-screen flex flex-col items-center justify-center text-white gap-4 px-4",children:[l.jsx("h2",{className:"text-2xl font-bold",children:"Errore"}),l.jsx("p",{className:"text-center max-w-md",children:a}),l.jsxs("div",{className:"flex gap-3 flex-wrap justify-center",children:[l.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-nebula-600 rounded hover:bg-nebula-700 transition",children:"Riprova"}),l.jsx("button",{onClick:()=>$(-1),className:"px-4 py-2 bg-white/10 rounded hover:bg-white/20 transition",children:"Indietro"})]})]}):v?l.jsxs("div",{className:"bg-black h-screen flex flex-col items-center justify-center text-white gap-6 px-4",children:[l.jsx("div",{className:"w-24 h-24 bg-white/5 rounded-full flex items-center justify-center animate-pulse",children:l.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),l.jsxs("div",{className:"text-center space-y-2",children:[l.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-nebula-400 to-nebula-500 bg-clip-text text-transparent",children:"In Arrivo"}),l.jsx("p",{className:"text-gray-400 max-w-md text-lg",children:"Il contenuto uscir a breve. Riprova pi tardi."})]}),l.jsx("button",{onClick:()=>$(-1),className:"px-6 py-3 bg-white/10 rounded-full hover:bg-white/20 transition backdrop-blur-md font-medium",children:"Torna Indietro"})]}):t||!r?l.jsxs("div",{className:"bg-black h-screen flex flex-col items-center justify-center text-white gap-4",children:[l.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-nebula-500 rounded-full border-t-transparent"}),i?l.jsx("p",{className:"text-white/70 text-sm sm:text-base max-w-md text-center px-4",children:i}):l.jsx("p",{className:"text-white/70 text-sm sm:text-base",children:"Caricamento..."})]}):re&&ze?l.jsxs("div",{className:"relative w-full h-screen bg-black",children:[l.jsx("button",{onClick:()=>$(-1),className:"absolute top-6 left-6 z-50 text-white/50 hover:text-white bg-black/50 p-2 rounded-full hover:bg-nebula-600 transition",children:l.jsx("div",{className:"w-8 h-8",children:l.jsx(ms.Back,{})})}),l.jsx("iframe",{src:ze,className:"w-full h-full border-0",allow:"autoplay; encrypted-media; fullscreen; picture-in-picture"})]}):r?l.jsxs("div",{ref:j,className:"relative w-full h-screen bg-black overflow-hidden group select-none font-sans",onDoubleClick:q=>{ie||on()},onTouchStart:q=>{if(Ge.current=Date.now(),Ne.current=!0,q.target.closest("button")||q.target.closest("input")){Ii();return}ie||Ee&&le?Xc(q):Ii()},children:[l.jsx("video",{ref:N,className:"w-full h-full object-contain bg-black",playsInline:!0,autoPlay:!0,muted:Y,preload:"auto",onCanPlay:()=>Fe(!0),onWaiting:()=>Fe(!1),onPlaying:()=>Fe(!0),onClick:q=>{q.stopPropagation(),!(ie||Ee&&le)&&(wt(),de(!0),Qt.current&&Ft.current==="none"&&jt())},style:{touchAction:"manipulation",WebkitTouchCallout:"none"}}),!Se&&!a&&l.jsx("div",{className:"absolute inset-0 z-10 bg-black flex items-center justify-center pointer-events-none",children:l.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-nebula-500 rounded-full border-t-transparent"})}),l.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 flex flex-col justify-end z-20 ${at?"opacity-100":"opacity-0"}`,style:{background:at?"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.8) 100%)":"none",pointerEvents:at?"auto":"none"},children:[l.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 sm:p-6 md:p-8 flex items-center justify-between pointer-events-auto z-50 pt-[calc(1rem+env(safe-area-inset-top))] sm:pt-[calc(1.5rem+env(safe-area-inset-top))]",children:[l.jsx("button",{onClick:()=>$("/"),className:"text-white hover:text-nebula-400 active:text-nebula-500 transition transform hover:scale-110 active:scale-95 bg-black/20 p-2 sm:p-2.5 rounded-full backdrop-blur-md touch-manipulation outline-none ring-0 focus:ring-0 shadow-sm flex-shrink-0","aria-label":"Indietro",children:l.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8",children:l.jsx(ms.Back,{})})}),d&&l.jsx("div",{className:"flex-1 text-center px-4 mx-auto max-w-[80%] sm:max-w-[70%] md:max-w-[60%]",children:l.jsxs("div",{className:"text-white text-xs sm:text-sm md:text-base font-medium truncate",style:{textShadow:"0 1px 3px rgba(0,0,0,0.8)"},children:[d.title||d.name,T==="tv"&&_&&k&&l.jsxs("span",{className:"text-white/80 ml-2 font-normal",children:["S",_," E",k,d.episode_title&&` - ${d.episode_title}`]})]})}),l.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 flex-shrink-0"})]}),l.jsx("div",{className:"absolute inset-0 z-0",onClick:q=>{const ce=q.target;(ce===q.currentTarget||ce.classList.contains("absolute")&&ce.classList.contains("inset-0")&&ce.classList.contains("z-0"))&&et(q)}}),at&&(ie||Ee&&le)&&l.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:l.jsxs("div",{className:`flex items-center ${le?"gap-10":"gap-6 sm:gap-8"} pointer-events-auto`,children:[l.jsx("button",{type:"button",onClick:q=>{q.stopPropagation(),ss(-10),Qt.current&&Ft.current==="none"&&jt()},className:`${le?"w-16 h-16":"w-12 h-12 sm:w-14 sm:h-14"} bg-black/60 rounded-full flex items-center justify-center backdrop-blur-md active:bg-nebula-600/80 transition shadow-xl active:scale-95 touch-manipulation outline-none ring-0`,"aria-label":"Indietro 10 secondi",children:l.jsx("div",{className:`${le?"w-8 h-8":"w-6 h-6 sm:w-7 sm:h-7"} text-white`,children:l.jsx(ms.Rewind10,{})})}),l.jsx("button",{type:"button",className:`${le?"w-28 h-28":"w-20 h-20 sm:w-24 sm:h-24"} bg-black/70 rounded-full flex items-center justify-center backdrop-blur-md active:bg-nebula-600/80 transition shadow-2xl active:scale-95 touch-manipulation outline-none ring-0`,onClick:q=>{q.stopPropagation(),wt(),Qt.current&&Ft.current==="none"&&jt()},onTouchEnd:q=>{q.preventDefault(),q.stopPropagation(),wt(),Qt.current&&Ft.current==="none"&&jt()},"aria-label":D?"Pausa":"Riproduci",children:l.jsx("div",{className:`${le?"w-14 h-14":"w-10 h-10 sm:w-12 sm:h-12"} text-white`,children:D?l.jsx(ms.Pause,{}):l.jsx(ms.Play,{})})}),l.jsx("button",{type:"button",onClick:q=>{q.stopPropagation(),ss(10),Qt.current&&Ft.current==="none"&&jt()},className:`${le?"w-16 h-16":"w-12 h-12 sm:w-14 sm:h-14"} bg-black/60 rounded-full flex items-center justify-center backdrop-blur-md active:bg-nebula-600/80 transition shadow-xl active:scale-95 touch-manipulation outline-none ring-0`,"aria-label":"Avanti 10 secondi",children:l.jsx("div",{className:`${le?"w-8 h-8":"w-6 h-6 sm:w-7 sm:h-7"} text-white`,children:l.jsx(ms.Forward10,{})})})]})}),l.jsx("div",{className:"absolute inset-0 hidden md:flex items-center justify-center pointer-events-none z-10",children:!D&&(((On=N.current)==null?void 0:On.paused)??!0)&&l.jsx("button",{type:"button",className:"w-20 h-20 bg-black/50 rounded-full flex items-center justify-center backdrop-blur-sm pointer-events-auto cursor-pointer hover:bg-nebula-600/80 active:bg-nebula-600/90 transition shadow-2xl scale-100 hover:scale-110 active:scale-95 touch-manipulation outline-none ring-0",onClick:q=>{q.stopPropagation(),wt()},children:l.jsx("div",{className:"w-10 h-10 text-white",children:l.jsx(ms.Play,{})})})}),p&&(X>W-60||!D)&&l.jsxs("button",{onClick:Ho,className:"absolute bottom-20 sm:bottom-28 right-4 sm:right-8 bg-white text-black font-bold px-4 sm:px-6 py-2 sm:py-3 rounded-lg flex items-center gap-2 hover:bg-gray-200 active:bg-gray-300 transition shadow-lg z-30 pointer-events-auto animate-fade-in-up touch-manipulation text-sm sm:text-base outline-none ring-0","aria-label":"Prossimo Episodio",children:[l.jsx("span",{className:"hidden sm:inline",children:"Prossimo Episodio"}),l.jsx("span",{className:"sm:hidden",children:"Prossimo"}),l.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5",children:l.jsx(ms.Next,{})})]}),l.jsx("div",{className:"px-3 sm:px-4 md:px-6 pt-12 sm:pt-16 md:pt-20 pb-[calc(1rem+env(safe-area-inset-bottom))] pointer-events-auto",children:l.jsxs("div",{className:"w-full",onMouseEnter:()=>{Date.now()-Ge.current<2e3||(Ct(!0),be.current&&(clearTimeout(be.current),be.current=null))},onMouseLeave:()=>{Ct(!1),Qt.current&&Ft.current==="none"&&jt()},children:[l.jsxs("div",{className:"group/progress relative h-3 sm:h-2 mb-3 sm:mb-4 cursor-pointer flex items-center touch-manipulation",children:[l.jsx("div",{className:"absolute w-full h-2 sm:h-1 bg-white/20 rounded-full group-hover/progress:h-2 sm:group-hover/progress:h-2 transition-all"}),l.jsx("div",{className:"absolute h-2 sm:h-1 bg-white/40 rounded-full group-hover/progress:h-2 transition-all",style:{width:`${W>0?z/W*100:0}%`}}),l.jsx("div",{className:"absolute h-2 sm:h-1 bg-nebula-500 rounded-full group-hover/progress:h-2 transition-all flex items-center justify-end",style:{width:`${W>0?X/W*100:0}%`},children:l.jsx("div",{className:"w-3 h-3 sm:w-3 sm:h-3 bg-nebula-500 rounded-full shadow-lg scale-100 sm:scale-0 sm:group-hover/progress:scale-110 transition-transform translate-x-0.5 sm:translate-x-1"})}),l.jsx("input",{type:"range",min:0,max:W>0?W:100,value:X,onChange:Gr,onMouseDown:()=>{be.current&&(clearTimeout(be.current),be.current=null)},onMouseUp:()=>{Qt.current&&Ft.current==="none"&&jt()},onTouchStart:()=>{be.current&&(clearTimeout(be.current),be.current=null)},onTouchEnd:()=>{Qt.current&&Ft.current==="none"&&jt()},className:"absolute w-full h-full opacity-0 cursor-pointer z-10 touch-manipulation",style:{WebkitAppearance:"none",appearance:"none"}})]}),l.jsxs("div",{className:"flex items-center justify-between flex-nowrap gap-2 sm:gap-4 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-4 md:gap-6 flex-shrink-0",children:[l.jsx("button",{onClick:()=>{wt(),Qt.current&&Ft.current==="none"&&jt()},className:"hidden md:flex text-white hover:text-nebula-400 active:text-nebula-500 transition w-8 h-8 items-center justify-center touch-manipulation outline-none ring-0 flex-shrink-0","aria-label":D?"Pausa":"Riproduci",children:D?l.jsx(ms.Pause,{}):l.jsx(ms.Play,{})}),l.jsx("button",{onClick:()=>{ss(-10),Qt.current&&Ft.current==="none"&&jt()},className:"hidden md:flex text-white/80 hover:text-white active:text-white/90 transition w-8 h-8 items-center justify-center group relative touch-manipulation outline-none ring-0 flex-shrink-0",title:"-10s","aria-label":"Indietro 10 secondi",children:l.jsx(ms.Rewind10,{})}),l.jsx("button",{onClick:()=>{ss(10),Qt.current&&Ft.current==="none"&&jt()},className:"hidden md:flex text-white/80 hover:text-white active:text-white/90 transition w-8 h-8 items-center justify-center group relative touch-manipulation outline-none ring-0 flex-shrink-0",title:"+10s","aria-label":"Avanti 10 secondi",children:l.jsx(ms.Forward10,{})}),l.jsxs("div",{className:"flex items-center gap-2 relative",children:[l.jsx("button",{onClick:q=>{ke(!as)},className:"text-white hover:text-white active:text-white/90 transition w-8 h-8 flex items-center justify-center touch-manipulation outline-none ring-0","aria-label":"Volume",children:Y||F===0?l.jsx(ms.VolumeMute,{}):l.jsx(ms.VolumeHigh,{})}),l.jsx("div",{className:`overflow-hidden transition-all duration-300 ${as?"w-20 sm:w-24 opacity-100":"w-0 opacity-0"}`,children:l.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:Y?0:F,onChange:mt,className:"w-16 sm:w-20 h-1.5 sm:h-1 bg-white/30 rounded-lg appearance-none cursor-pointer accent-nebula-500 ml-2 touch-manipulation",style:{WebkitAppearance:"none",appearance:"none"}})})]}),l.jsxs("div",{className:"text-white text-xs sm:text-sm font-medium tracking-wide whitespace-nowrap flex-shrink-0",children:[l.jsx("span",{className:"text-white/70",children:Tx(X)}),l.jsx("span",{className:"mx-1 sm:mx-2 text-white/40",children:"/"}),l.jsx("span",{className:"text-white/70",children:Tx(W)})]})]}),l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-4 md:gap-5 relative flex-shrink-0",children:[p&&l.jsx("button",{onClick:Ho,className:"hidden sm:flex text-white/80 hover:text-white active:text-white/90 transition w-8 h-8 sm:w-7 sm:h-7 items-center justify-center touch-manipulation outline-none ring-0",title:"Prossimo Episodio","aria-label":"Prossimo Episodio",children:l.jsx(ms.Next,{})}),l.jsxs("div",{className:"relative",children:[l.jsx("button",{onClick:()=>{ts(ht==="speed"?"none":"speed"),ht==="speed"?Qt.current&&jt():be.current&&(clearTimeout(be.current),be.current=null)},className:"text-white/80 hover:text-white active:text-white/90 transition w-8 h-8 sm:w-7 sm:h-7 flex items-center justify-center touch-manipulation outline-none ring-0 flex-shrink-0","aria-label":"Velocit riproduzione",children:l.jsx(ms.Speed,{})}),ht==="speed"&&l.jsxs("div",{className:"absolute bottom-12 right-0 bg-neutral-900/95 border border-white/10 rounded-lg p-2 min-w-[120px] backdrop-blur text-sm animate-fade-in shadow-xl z-50",children:[l.jsx("div",{className:"text-white/50 text-xs text-center mb-2 font-bold uppercase tracking-wider",children:"Velocit"}),[.5,.75,1,1.25,1.5,2].map(q=>l.jsxs("button",{onClick:()=>Vr(q),className:`block w-full text-left px-3 py-2 rounded hover:bg-white/10 ${ks===q?"text-nebula-500 font-bold":"text-white"}`,children:[q,"x"]},q))]})]}),(Ws.length>0||fe.length>0)&&l.jsxs("div",{className:"relative flex",children:[l.jsx("button",{onClick:()=>{ts(ht==="audio"?"none":"audio"),ht==="audio"?Qt.current&&jt():be.current&&(clearTimeout(be.current),be.current=null)},className:"text-white/80 hover:text-white active:text-white/90 transition w-8 h-8 sm:w-7 sm:h-7 flex items-center justify-center touch-manipulation outline-none ring-0 flex-shrink-0","aria-label":"Audio e sottotitoli",children:l.jsx(ms.Subtitles,{})}),ht==="audio"&&l.jsxs("div",{className:"absolute bottom-12 right-0 bg-neutral-900/95 border border-white/10 rounded-lg flex overflow-hidden shadow-xl animate-fade-in max-h-[60vh] z-50",children:[Ws.length>0&&l.jsxs("div",{className:"p-3 min-w-[140px] border-r border-white/10 overflow-y-auto",children:[l.jsx("div",{className:"text-white/50 text-xs mb-2 font-bold uppercase tracking-wider",children:"Audio"}),Ws.map((q,ce)=>l.jsx("button",{onClick:()=>Wo(ce),className:`block w-full text-left px-3 py-2 rounded hover:bg-white/10 text-xs truncate ${oi===ce?"text-nebula-500 font-bold":"text-white"}`,children:q.name||q.lang||`Track ${ce+1}`},`audio-${ce}`))]}),fe.length>0&&l.jsxs("div",{className:"p-3 min-w-[140px] overflow-y-auto",children:[l.jsx("div",{className:"text-white/50 text-xs mb-2 font-bold uppercase tracking-wider",children:"Sottotitoli"}),l.jsx("button",{onClick:()=>Pa(-1),className:`block w-full text-left px-3 py-2 rounded hover:bg-white/10 text-xs ${We===-1?"text-nebula-500 font-bold":"text-white"}`,children:"Off"}),fe.map((q,ce)=>l.jsx("button",{onClick:()=>Pa(ce),className:`block w-full text-left px-3 py-2 rounded hover:bg-white/10 text-xs truncate ${We===ce?"text-nebula-500 font-bold":"text-white"}`,children:q.name||q.lang||`Track ${ce+1}`},`sub-${ce}`))]})]})]}),vs.length>0&&l.jsxs("div",{className:"relative",children:[l.jsx("button",{onClick:()=>{ts(ht==="quality"?"none":"quality"),ht==="quality"?Qt.current&&jt():be.current&&(clearTimeout(be.current),be.current=null)},className:"text-white/80 hover:text-white active:text-white/90 transition w-8 h-8 sm:w-7 sm:h-7 flex items-center justify-center touch-manipulation outline-none ring-0 flex-shrink-0","aria-label":"Impostazioni qualit",children:l.jsx(ms.Settings,{})}),ht==="quality"&&l.jsxs("div",{className:"absolute bottom-12 right-0 bg-neutral-900/95 border border-white/10 rounded-lg p-2 min-w-[120px] backdrop-blur text-sm animate-fade-in shadow-xl max-h-[60vh] overflow-y-auto z-50",children:[l.jsx("div",{className:"text-white/50 text-xs text-center mb-2 font-bold uppercase tracking-wider",children:"Qualit"}),l.jsx("button",{onClick:()=>xr(-1),className:`block w-full text-left px-3 py-2 rounded hover:bg-white/10 ${ds===-1?"text-nebula-500 font-bold":"text-white"}`,children:"Auto"}),[...vs].reverse().map(q=>l.jsx("button",{onClick:()=>xr(q.index),className:`block w-full text-left px-3 py-2 rounded hover:bg-white/10 ${ds===q.index?"text-nebula-500 font-bold":"text-white"}`,children:q.name},q.index))]})]}),l.jsx("button",{onClick:()=>{on(),Qt.current&&Ft.current==="none"&&jt()},className:"text-white/80 hover:text-white active:text-white/90 transition w-8 h-8 sm:w-7 sm:h-7 flex items-center justify-center touch-manipulation outline-none ring-0 flex-shrink-0","aria-label":"Schermo intero",children:l.jsx(ms.Fullscreen,{})})]})]})]})})]})]}):l.jsxs("div",{className:"bg-black h-screen flex flex-col items-center justify-center text-white gap-4",children:[l.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-nebula-500 rounded-full border-t-transparent"}),l.jsx("p",{className:"text-white/70 text-sm sm:text-base",children:"Caricamento..."})]})}function tL(){return l.jsx(JI,{children:l.jsx(eL,{})})}const _x="https://api.asknebula.it",Sh={free:"Free","no-ads":"BASIC",premium:"PREMIUM","premium-plus":"ULTRA",pro:"Pro",ultra:"Ultra"},sL={year:"1 anno","6months":"6 mesi",month:"1 mese"};function rL(){const[r]=kr(),e=r.get("plan")??"free",t=r.get("duration")??"month",{session:s,plan:i,setPlan:n}=Mt(),[a,u]=L.useState(!1),[d,h]=L.useState(null),[m,p]=L.useState(null),g=Bt();L.useEffect(()=>{s||g("/login?mode=register")},[s,g]);async function v(){if(s){u(!0),p(null),h(null);try{if(e==="free"){const b=await fetch(`${_x}/me/plan?plan=${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`}});if(!b.ok)throw new Error("Impossibile aggiornare il piano");const T=await b.json();n(T),h("Piano Free attivato con successo."),setTimeout(()=>g("/browse"),1e3);return}const y=await fetch(`${_x}/stripe/checkout-session`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({plan:e,duration:t,success_url:`${window.location.origin}/checkout-success?plan=${encodeURIComponent(e)}&duration=${encodeURIComponent(t)}`,cancel_url:window.location.href})});if(!y.ok){const b=await y.json().catch(()=>({detail:"Errore sconosciuto"}));throw new Error(b.detail||"Impossibile creare la sessione di pagamento")}const S=await y.json();window.location.href=S.url}catch(y){p(y.message??"Errore durante l'aggiornamento del piano")}finally{u(!1)}}}return l.jsx(ns,{children:l.jsx("div",{className:"min-h-[70vh] flex items-center justify-center",children:l.jsxs("div",{className:"w-full max-w-lg rounded-3xl border border-white/10 bg-black/70 p-8 backdrop-blur-xl shadow-2xl space-y-4",children:[l.jsx("h1",{className:"text-2xl font-semibold",children:"Conferma il tuo piano"}),l.jsxs("p",{className:"text-sm text-white/60",children:["Stai per attivare il piano"," ",l.jsx("span",{className:"font-semibold text-white",children:Sh[e]??e.toUpperCase()}),". Questa  una simulazione: integra qui il tuo provider di pagamento preferito (Stripe, PayPal, ecc.). Al termine, il piano verr aggiornato nel tuo profilo Supabase."]}),l.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-white/80 space-y-2",children:[l.jsx("p",{className:"font-semibold",children:"Riepilogo piano"}),l.jsxs("p",{children:["Piano selezionato: ",Sh[e]??e]}),t&&l.jsxs("p",{children:["Durata: ",sL[t]??t]}),i&&l.jsxs("p",{children:["Piano attuale: ",Sh[i.plan]??i.plan]})]}),d&&l.jsx("p",{className:"text-xs text-emerald-400",children:d}),m&&l.jsx("p",{className:"text-xs text-red-400",children:m}),l.jsx("button",{onClick:v,disabled:a,className:"w-full rounded-full bg-nebula-600 hover:bg-nebula-500 py-2 text-sm font-medium shadow-lg shadow-nebula-600/40 disabled:opacity-60",children:a?"Aggiornamento in corso...":"Completa acquisto"})]})})})}const iL="https://api.asknebula.it";function nL(){const[r]=kr(),e=r.get("plan")??"pro",{session:t,setPlan:s}=Mt(),[i,n]=L.useState("Verifica del pagamento in corso..."),[a,u]=L.useState(null),d=Bt();return L.useEffect(()=>{async function h(){if(!t){u("Sessione non trovata. Effettua di nuovo il login.");return}try{const m=await fetch(`${iL}/me/plan?plan=${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`}});if(!m.ok)throw new Error("Impossibile applicare il piano dopo il pagamento");const p=await m.json();s(p),n("Pagamento completato, piano aggiornato. Buona visione!"),setTimeout(()=>d("/browse"),1500)}catch(m){u(m.message??"Errore durante l'aggiornamento del piano")}}h()},[t,e,d,s]),l.jsx(ns,{children:l.jsx("div",{className:"min-h-[70vh] flex items-center justify-center",children:l.jsxs("div",{className:"w-full max-w-md rounded-3xl border border-white/10 bg-black/70 p-8 backdrop-blur-xl text-sm text-white/80 space-y-3",children:[l.jsx("h1",{className:"text-2xl font-semibold",children:"Pagamento completato"}),l.jsx("p",{children:i}),a&&l.jsx("p",{className:"text-xs text-red-400",children:a})]})})})}const xc="https://api.asknebula.it";function aL(){const{genreId:r}=Pn(),[e]=kr(),t=e.get("name")||"Genere",s=e.get("type")||"both",[i,n]=L.useState([]),[a,u]=L.useState(1),[d,h]=L.useState(!0),[m,p]=L.useState(!1),[g,v]=L.useState(!0),[y,S]=L.useState(0),b=L.useRef(null),[T,_]=L.useState(1),[k,I]=L.useState(1),[C,$]=L.useState(!0),[N,O]=L.useState(!0);L.useEffect(()=>{async function D(){if(r){h(!0),u(1),_(1),I(1),$(!0),O(!0);try{const G=await fetch(`${xc}/genre/${r}/content?type=${s}&page=1`);if(G.ok){const X=await G.json(),K=X.items.map(W=>{var te;return{title:W.title,tmdb_id:W.tmdb_id,type:W.type,year:W.year,poster:W.poster,rating:(te=W.raw)==null?void 0:te.vote_average,overview:W.overview}});n(K),S(X.total_results||0),s==="both"?(v(!0),$(!0),O(!0)):v(X.page<X.total_pages)}}catch{}finally{h(!1)}}}D()},[r,s]);const j=L.useCallback(async()=>{if(!(m||!g||!r)){p(!0);try{if(s==="both"){const D=[],G=T,X=k,K=C,W=N;if(K&&D.push(fetch(`${xc}/genre/${r}/content?type=movie&page=${G+1}`).then(P=>P.ok?P.json().then(B=>({data:B,type:"movie"})):Promise.resolve({data:null,type:"movie"})).catch(()=>({data:null,type:"movie"}))),W&&D.push(fetch(`${xc}/genre/${r}/content?type=tv&page=${X+1}`).then(P=>P.ok?P.json().then(B=>({data:B,type:"tv"})):Promise.resolve({data:null,type:"tv"})).catch(()=>({data:null,type:"tv"}))),D.length===0){v(!1),p(!1);return}const te=await Promise.all(D),z=[];let M=K,F=W,H=G,Y=X;for(const P of te){if(!P)continue;const B=P.data,oe=P.type;if(B&&B.items&&B.items.length>0){const ie=B.items.map(ne=>{var le;return{title:ne.title,tmdb_id:ne.tmdb_id,type:ne.type,year:ne.year,poster:ne.poster,rating:(le=ne.raw)==null?void 0:le.vote_average,overview:ne.overview}});z.push(...ie),oe==="movie"?(H=G+1,M=H<B.total_pages):oe==="tv"&&(Y=X+1,F=Y<B.total_pages)}else oe==="movie"?M=!1:oe==="tv"&&(F=!1)}_(H),I(Y),$(M),O(F),v(M||F),z.length>0&&(z.sort((P,B)=>(B.rating||0)-(P.rating||0)),n(P=>[...P,...z]))}else{const D=a+1,G=await fetch(`${xc}/genre/${r}/content?type=${s}&page=${D}`);if(G.ok){const X=await G.json();if(X.items.length===0){v(!1),p(!1);return}const K=X.items.map(W=>{var te;return{title:W.title,tmdb_id:W.tmdb_id,type:W.type,year:W.year,poster:W.poster,rating:(te=W.raw)==null?void 0:te.vote_average,overview:W.overview}});n(W=>[...W,...K]),v(D<X.total_pages),u(D)}else v(!1)}}catch{v(!1)}finally{p(!1)}}},[m,g,r,s,a,T,k,C,N]);return L.useEffect(()=>{if(!g||m||!r)return;const D=b.current;if(!D)return;const G=new IntersectionObserver(X=>{X[0].isIntersecting&&!m&&g&&r&&j()},{threshold:.1,rootMargin:"200px"});return G.observe(D),()=>{G.unobserve(D)}},[j,m,g,r,i.length]),l.jsx(ns,{children:l.jsxs("section",{className:"max-w-7xl mx-auto px-6 py-8 overflow-x-hidden w-full",children:[l.jsxs("div",{className:"mb-8",children:[l.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:t}),l.jsx("p",{className:"text-sm text-white/70",children:y>0?`${y} contenuti disponibili`:"Caricamento..."})]}),d?l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-nebula-500"}),l.jsx("p",{className:"mt-4 text-white/60",children:"Caricamento contenuti..."})]}):i.length===0?l.jsx("div",{className:"text-center py-12",children:l.jsx("p",{className:"text-white/60",children:"Nessun contenuto trovato per questo genere."})}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex flex-wrap gap-2 lg:gap-3 w-full",children:i.map(D=>l.jsx(yf,{item:{title:D.title,tmdb_id:D.tmdb_id,type:D.type,year:D.year,poster:D.poster,backdrop:void 0,rating:D.rating,overview:D.overview}},`${D.tmdb_id}-${D.type}`))}),m&&l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-nebula-500"}),l.jsx("p",{className:"mt-2 text-sm text-white/60",children:"Caricamento altri contenuti..."})]}),g&&l.jsx("div",{ref:b,className:"h-20 w-full",style:{minHeight:"80px"}})]})]})})}function oL(){const[r]=kr(),e=r.get("email")||"",[t,s]=L.useState(e),[i,n]=L.useState(""),[a,u]=L.useState(!1),[d,h]=L.useState(null),[m,p]=L.useState(null),g=Mt(S=>S.setAuth),v=Bt();async function y(S){S.preventDefault(),h(null),p(null),u(!0);try{const{data:b,error:T}=await Ei.auth.verifyOtp({type:"signup",email:t,token:i});if(T)throw T;b.session&&g(b.session),p("Email verificata con successo! Ti stiamo reindirizzando..."),setTimeout(()=>{v("/")},1200)}catch(b){h(b.message??"Codice non valido o scaduto. Riprova.")}finally{u(!1)}}return l.jsx(ns,{children:l.jsx("div",{className:"min-h-[85vh] flex items-center justify-center bg-[#070707]",children:l.jsxs("div",{className:"w-full max-w-[400px] bg-[#1a1a1a] p-10 shadow-2xl rounded-[4px]",children:[l.jsx("h1",{className:"text-3xl font-bold mb-6 text-white text-center",children:"Verifica email"}),l.jsxs("p",{className:"text-base text-[#b3b3b3] mb-8 text-center leading-relaxed",children:["Ti abbiamo inviato un codice di 6 cifre all'indirizzo ",l.jsx("span",{className:"text-white font-medium",children:t}),". Inseriscilo qui sotto per attivare il tuo account."]}),l.jsxs("form",{onSubmit:y,className:"space-y-5",children:[l.jsx("div",{className:"space-y-2",children:l.jsx("input",{type:"text",inputMode:"numeric",maxLength:6,value:i,onChange:S=>n(S.target.value.trim()),required:!0,className:"w-full rounded-[3px] bg-[#333333] border-none px-4 py-3.5 text-center text-xl tracking-[0.5em] font-mono text-white placeholder-gray-500 outline-none focus:bg-[#454545] transition-colors",placeholder:""})}),d&&l.jsx("p",{className:"text-sm text-[#e87c03] text-center",children:d}),m&&!d&&l.jsx("p",{className:"text-sm text-green-500 text-center",children:m}),l.jsx("button",{type:"submit",disabled:a,className:"w-full rounded-[3px] bg-[#018850] hover:bg-[#016d40] py-3.5 text-base font-bold text-white shadow-none transition-colors disabled:opacity-60 mt-4",children:a?"Attendi...":"Verifica"})]}),l.jsx("div",{className:"mt-8 text-sm text-[#737373] text-center",children:l.jsxs("span",{children:["Non hai ricevuto il codice?"," ",l.jsx("button",{className:"text-white hover:underline bg-transparent border-none cursor-pointer",children:"Invia di nuovo"})]})}),l.jsx("div",{className:"mt-4 text-sm text-center",children:l.jsx(He,{to:"/login",className:"text-[#018850] hover:text-[#016d40] hover:underline font-medium",children:"Torna al login"})})]})})})}function lL(){var y,S;const{user:r,plan:e,logout:t,session:s,setPlan:i}=Mt(),[n,a]=L.useState(!1),[u,d]=L.useState(null),[h,m]=L.useState(!1);L.useEffect(()=>{async function b(){if(s)try{const _=await fetch("https://api.asknebula.it/me/plan",{headers:{Authorization:`Bearer ${s.access_token}`}});if(_.ok){const k=await _.json();i(k)}}catch{}}b()},[s,i]);async function p(){if(!(!s||h)){m(!0),d(null);try{const T=await fetch("https://api.asknebula.it/me/plan",{headers:{Authorization:`Bearer ${s.access_token}`}});if(T.ok){const _=await T.json();i(_)}else d("Impossibile aggiornare il piano")}catch(b){d(b.message??"Errore durante l'aggiornamento del piano")}finally{m(!1)}}}if(!r)return l.jsx(ns,{children:l.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:l.jsx("div",{className:"text-sm text-white/70",children:"Devi essere autenticato per vedere questa pagina."})})});const g=((y=r.user_metadata)==null?void 0:y.username)||((S=r.email)==null?void 0:S.split("@")[0])||"Utente";async function v(){var T;if(!(n||!window.confirm("Sei sicuro di voler eliminare definitivamente il tuo account Nebula Streaming? Questa azione  irreversibile."))){a(!0),d(null);try{const _=(T=(await Ei.auth.getSession()).data.session)==null?void 0:T.access_token;if(!_)throw new Error("Sessione non valida.");if(!(await fetch("https://api.asknebula.it/me/delete-account",{method:"POST",headers:{Authorization:`Bearer ${_}`}})).ok)throw new Error("Impossibile eliminare l'account in questo momento.");await Ei.auth.signOut(),t(),window.location.href="/"}catch(_){d(_.message??"Errore imprevisto durante l'eliminazione dell'account.")}finally{a(!1)}}}return l.jsx(ns,{children:l.jsx("div",{className:"min-h-[70vh] flex items-center justify-center px-4",children:l.jsxs("div",{className:"w-full max-w-3xl bg-[#111827] border border-white/10 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6 reveal-on-scroll",children:[l.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:"Account"}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"bg-black/40 border border-white/10 rounded-xl px-4 py-3 flex items-center justify-between",children:l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-white/60",children:"Nome utente"}),l.jsx("p",{className:"text-sm md:text-base",children:g})]})}),l.jsx("div",{className:"bg-black/40 border border-white/10 rounded-xl px-4 py-3 flex items-center justify-between",children:l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-white/60",children:"Email"}),l.jsx("p",{className:"text-sm md:text-base break-all",children:r.email})]})}),l.jsx("div",{className:"bg-black/40 border border-white/10 rounded-xl px-4 py-3 flex items-center justify-between",children:l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-white/60",children:"Password"}),l.jsx("p",{className:"text-sm md:text-base",children:""})]})}),e&&l.jsxs("div",{className:"bg-black/40 border border-white/10 rounded-xl px-4 py-3 flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-white/60 mb-1",children:"Piano attuale"}),l.jsx("p",{className:"text-sm md:text-base uppercase",children:e.plan})]}),l.jsx("button",{onClick:p,disabled:h,className:"px-4 py-2 text-xs bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors disabled:opacity-50",title:"Aggiorna piano",children:h?"Aggiornamento...":""})]})]}),u&&l.jsx("p",{className:"text-xs text-red-400",children:u}),l.jsx("div",{className:"flex justify-end pt-4",children:l.jsx("button",{onClick:v,disabled:n,className:"px-5 py-2 rounded-full text-sm font-medium bg-red-700/80 hover:bg-red-600 text-white disabled:opacity-60",children:n?"Eliminazione in corso...":"Elimina account"})})]})})})}function cL(){return l.jsx(ns,{children:l.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12",children:[l.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Termini e Condizioni"}),l.jsxs("div",{className:"space-y-6 text-white/80 text-sm leading-relaxed",children:[l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"1. Accettazione dei Termini"}),l.jsx("p",{children:`Accedendo e utilizzando Nebula Streaming ("il Servizio"), l'utente ("Tu", "Utente") accetta di essere vincolato da questi Termini e Condizioni ("Termini"). Se non accetti questi Termini, non utilizzare il Servizio.`})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"2. Descrizione del Servizio"}),l.jsx("p",{children:`Nebula Streaming  una piattaforma di streaming che fornisce accesso a contenuti video, inclusi film e serie TV. Il Servizio  fornito "cos com'" e pu essere modificato, sospeso o interrotto in qualsiasi momento senza preavviso.`})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"3. Account Utente"}),l.jsx("p",{children:"Per utilizzare il Servizio, devi creare un account. Sei responsabile di:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Mantenere la riservatezza delle tue credenziali di accesso"}),l.jsx("li",{children:"Tutte le attivit che si verificano sotto il tuo account"}),l.jsx("li",{children:"Fornire informazioni accurate e aggiornate"}),l.jsx("li",{children:"Notificare immediatamente qualsiasi uso non autorizzato del tuo account"})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"4. Piani di Abbonamento"}),l.jsx("p",{children:"Nebula Streaming offre diversi piani di abbonamento con caratteristiche e prezzi diversi. Gli abbonamenti vengono fatturati in base alla durata selezionata (mensile, semestrale, annuale). I prezzi possono variare e sono soggetti a modifiche con preavviso."}),l.jsx("p",{className:"mt-2",children:"Gli abbonamenti si rinnovano automaticamente alla fine del periodo di fatturazione, a meno che non vengano disdetti prima della scadenza. Puoi disdire il tuo abbonamento in qualsiasi momento dalla sezione account."}),l.jsxs("p",{className:"mt-2",children:[l.jsx("strong",{children:"Piano Free:"})," Include 1 dispositivo simultaneo, 1 riproduzione contemporanea, nessun download, massimo 5 preferiti. Accesso ai contenuti con ritardo di 2 settimane rispetto alle uscite."]}),l.jsxs("p",{className:"mt-2",children:[l.jsx("strong",{children:"Piano Basic:"})," Include 2 dispositivi simultanei, 2 riproduzioni contemporanee, fino a 3 download al giorno, preferiti illimitati, accesso anticipato ai contenuti."]}),l.jsxs("p",{className:"mt-2",children:[l.jsx("strong",{children:"Piano Premium:"})," Include 3 dispositivi simultanei, 3 riproduzioni contemporanee, download illimitati, preferiti illimitati, accesso anticipato ai contenuti, priorit elevata sulle richieste."]}),l.jsxs("p",{className:"mt-2",children:[l.jsx("strong",{children:"Piano ULTRA:"})," Include 4 dispositivi simultanei, 4 riproduzioni contemporanee, download illimitati, preferiti illimitati, accesso anticipato ai contenuti, priorit massima sulle richieste."]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"5. Pagamenti e Rimborsi"}),l.jsx("p",{children:"I pagamenti vengono elaborati tramite provider di terze parti (es. Stripe). Accettando questi Termini, autorizzi Nebula Streaming a addebitare l'importo dell'abbonamento sul metodo di pagamento fornito."}),l.jsx("p",{className:"mt-2",children:"I rimborsi sono gestiti secondo la nostra politica di rimborso. In generale, i rimborsi non sono disponibili per periodi gi utilizzati, salvo dove richiesto dalla legge."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"6. Uso Consentito"}),l.jsx("p",{children:"L'utente accetta di utilizzare il Servizio solo per scopi legali e in conformit con questi Termini.  vietato:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Riprodurre, distribuire, modificare o creare opere derivate dai contenuti"}),l.jsx("li",{children:"Utilizzare il Servizio per scopi commerciali non autorizzati"}),l.jsx("li",{children:"Tentare di accedere a parti non autorizzate del Servizio"}),l.jsx("li",{children:"Interferire con il funzionamento del Servizio"}),l.jsx("li",{children:"Condividere le credenziali di accesso con terzi"}),l.jsx("li",{children:"Utilizzare software automatizzati per accedere al Servizio"})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"7. Propriet Intellettuale"}),l.jsx("p",{children:"Tutti i contenuti disponibili sul Servizio, inclusi ma non limitati a film, serie TV, loghi, grafica e software, sono protetti da copyright, marchi registrati e altre leggi sulla propriet intellettuale. L'utente non acquisisce alcun diritto di propriet sui contenuti visualizzati."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"8. Limitazione di Responsabilit"}),l.jsx("p",{children:`Nebula Streaming non garantisce che il Servizio sar ininterrotto, privo di errori o sicuro. Il Servizio  fornito "cos com'" senza garanzie di alcun tipo, esplicite o implicite.`}),l.jsx("p",{className:"mt-2",children:"In nessun caso Nebula Streaming sar responsabile per danni diretti, indiretti, incidentali, speciali o consequenziali derivanti dall'uso o dall'impossibilit di utilizzare il Servizio."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"9. Modifiche ai Termini"}),l.jsx("p",{children:"Nebula Streaming si riserva il diritto di modificare questi Termini in qualsiasi momento. Le modifiche entreranno in vigore immediatamente dopo la pubblicazione. L'uso continuato del Servizio dopo le modifiche costituisce accettazione dei nuovi Termini."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"10. Risoluzione"}),l.jsx("p",{children:"Nebula Streaming si riserva il diritto di sospendere o terminare l'accesso al Servizio in qualsiasi momento, con o senza causa, con o senza preavviso, per qualsiasi motivo, incluso ma non limitato alla violazione di questi Termini."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"11. Legge Applicabile"}),l.jsx("p",{children:"Questi Termini sono governati dalle leggi italiane. Qualsiasi controversia derivante da o relativa a questi Termini sar soggetta alla giurisdizione esclusiva dei tribunali italiani."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"12. Contatti"}),l.jsx("p",{children:"Per domande riguardo questi Termini, contattaci tramite:"}),l.jsxs("ul",{className:"list-none mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Telegram: @asknebuladev"}),l.jsx("li",{children:"Instagram: @ask_nebuladev"}),l.jsx("li",{children:"X (Twitter): @AskNebulaDev"})]})]}),l.jsx("div",{className:"mt-8 p-4 bg-white/5 rounded-lg",children:l.jsxs("p",{className:"text-xs text-white/60",children:[l.jsx("strong",{children:"Ultimo aggiornamento:"})," ",new Date().toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric"})]})})]})]})})}function uL(){return l.jsx(ns,{children:l.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12",children:[l.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Privacy Policy"}),l.jsxs("div",{className:"space-y-6 text-white/80 text-sm leading-relaxed",children:[l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"1. Introduzione"}),l.jsx("p",{children:'Nebula Streaming ("noi", "nostro", "il Servizio") rispetta la tua privacy e si impegna a proteggere i tuoi dati personali. Questa Privacy Policy spiega come raccogliamo, utilizziamo, conserviamo e proteggiamo le tue informazioni quando utilizzi il nostro servizio.'})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"2. Dati che Raccogliamo"}),l.jsx("h3",{className:"text-xl font-semibold mb-2 text-white mt-4",children:"2.1 Dati Forniti dall'Utente"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Informazioni di account (email, password)"}),l.jsx("li",{children:"Informazioni di pagamento (processate tramite provider di terze parti)"}),l.jsx("li",{children:"Preferenze di visualizzazione e contenuti"}),l.jsx("li",{children:"Comunicazioni con il supporto"})]}),l.jsx("h3",{className:"text-xl font-semibold mb-2 text-white mt-4",children:"2.2 Dati Raccolti Automaticamente"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Indirizzo IP e informazioni sul dispositivo"}),l.jsx("li",{children:"Dati di utilizzo (contenuti visualizzati, tempo di visualizzazione)"}),l.jsx("li",{children:"Cookie e tecnologie simili"}),l.jsx("li",{children:"Informazioni sulla connessione (tipo di browser, sistema operativo)"})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"3. Come Utilizziamo i Dati"}),l.jsx("p",{children:"Utilizziamo i tuoi dati per:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Fornire e migliorare il Servizio"}),l.jsx("li",{children:"Elaborare pagamenti e gestire abbonamenti"}),l.jsx("li",{children:"Personalizzare la tua esperienza"}),l.jsx("li",{children:"Inviare comunicazioni relative al servizio"}),l.jsx("li",{children:"Rilevare e prevenire frodi e abusi"}),l.jsx("li",{children:"Rispettare obblighi legali"}),l.jsx("li",{children:"Analizzare l'utilizzo del Servizio per miglioramenti"})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"4. Condivisione dei Dati"}),l.jsx("p",{children:"Non vendiamo i tuoi dati personali. Possiamo condividere i tuoi dati con:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Provider di servizi:"})," Fornitori di pagamento (Stripe), hosting, analytics"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Autorit legali:"})," Quando richiesto dalla legge o per proteggere i nostri diritti"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Trasferimenti aziendali:"})," In caso di fusione, acquisizione o vendita di asset"]})]}),l.jsx("p",{className:"mt-2",children:"Tutti i provider di terze parti sono obbligati a proteggere i tuoi dati e utilizzarli solo per gli scopi specificati."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"5. Conservazione dei Dati"}),l.jsx("p",{children:"Conserviamo i tuoi dati personali solo per il tempo necessario a fornire il Servizio e soddisfare scopi legali, contabili o di reporting. Quando elimini il tuo account, cancelliamo i tuoi dati personali, salvo dove richiesto dalla legge."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"6. Sicurezza dei Dati"}),l.jsx("p",{children:"Implementiamo misure di sicurezza tecniche e organizzative appropriate per proteggere i tuoi dati personali contro accesso non autorizzato, alterazione, divulgazione o distruzione. Tuttavia, nessun metodo di trasmissione su Internet  completamente sicuro."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"7. I Tuoi Diritti (GDPR)"}),l.jsx("p",{children:"Hai il diritto di:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Accesso:"})," Richiedere una copia dei tuoi dati personali"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Rettifica:"})," Correggere dati inesatti o incompleti"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Cancellazione:"}),` Richiedere la cancellazione dei tuoi dati ("diritto all'oblio")`]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Limitazione:"})," Limitare l'elaborazione dei tuoi dati"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Portabilit:"})," Ricevere i tuoi dati in formato strutturato"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Opposizione:"})," Opporti all'elaborazione dei tuoi dati per scopi di marketing"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Revoca del consenso:"})," Revocare il consenso quando l'elaborazione si basa sul consenso"]})]}),l.jsx("p",{className:"mt-2",children:"Per esercitare questi diritti, contattaci tramite i canali indicati nella sezione Contatti."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"8. Cookie e Tecnologie Simili"}),l.jsx("p",{children:"Utilizziamo cookie e tecnologie simili per migliorare la tua esperienza, analizzare l'utilizzo del Servizio e personalizzare contenuti. Puoi gestire le preferenze dei cookie tramite le impostazioni del browser."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"9. Trasferimenti Internazionali"}),l.jsx("p",{children:"I tuoi dati possono essere trasferiti e conservati in paesi al di fuori dell'Unione Europea. In tali casi, assicuriamo che siano in atto garanzie appropriate per proteggere i tuoi dati secondo gli standard GDPR."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"10. Minori"}),l.jsx("p",{children:"Il Servizio non  destinato a minori di 18 anni. Non raccogliamo consapevolmente dati personali da minori. Se scopriamo di aver raccolto dati da un minore, li elimineremo immediatamente."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"11. Modifiche alla Privacy Policy"}),l.jsx("p",{children:'Possiamo aggiornare questa Privacy Policy periodicamente. Ti notificheremo eventuali modifiche significative pubblicando la nuova Privacy Policy su questa pagina e aggiornando la data di "Ultimo aggiornamento".'})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"12. Contatti"}),l.jsx("p",{children:"Per domande, richieste o reclami riguardo questa Privacy Policy o l'elaborazione dei tuoi dati personali, contattaci tramite:"}),l.jsxs("ul",{className:"list-none mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Telegram: @asknebuladev"}),l.jsx("li",{children:"Instagram: @ask_nebuladev"}),l.jsx("li",{children:"X (Twitter): @AskNebulaDev"})]}),l.jsx("p",{className:"mt-4",children:"Hai anche il diritto di presentare un reclamo all'autorit di protezione dei dati competente se ritieni che l'elaborazione dei tuoi dati personali violi il GDPR."})]}),l.jsx("div",{className:"mt-8 p-4 bg-white/5 rounded-lg",children:l.jsxs("p",{className:"text-xs text-white/60",children:[l.jsx("strong",{children:"Ultimo aggiornamento:"})," ",new Date().toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric"})]})})]})]})})}function dL(){return l.jsx(ns,{children:l.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12",children:[l.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Chi Siamo"}),l.jsxs("div",{className:"space-y-6 text-white/80 text-sm leading-relaxed",children:[l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"La Nostra Missione"}),l.jsx("p",{children:"Nebula Streaming  una piattaforma di streaming innovativa nata con l'obiettivo di offrire agli utenti un'esperienza di intrattenimento di alta qualit, accessibile e personalizzabile. Crediamo che tutti meritino di accedere a contenuti di qualit, quando e dove vogliono."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"Cosa Offriamo"}),l.jsx("p",{children:"La nostra piattaforma offre un vasto catalogo di film e serie TV, costantemente aggiornato con i contenuti pi popolari e le ultime uscite. Utilizziamo tecnologie all'avanguardia per garantire streaming fluido e di alta qualit, con supporto fino a 4K HDR per i piani premium."}),l.jsxs("ul",{className:"list-disc list-inside mt-4 space-y-2 ml-4",children:[l.jsx("li",{children:"Catalogo in continua espansione con migliaia di titoli"}),l.jsx("li",{children:"Streaming in alta qualit (fino a 4K per i piani premium)"}),l.jsx("li",{children:"Interfaccia intuitiva e moderna"}),l.jsx("li",{children:"Ripresa da dove hai interrotto su tutti i dispositivi"}),l.jsx("li",{children:"Download offline per contenuti selezionati"}),l.jsx("li",{children:"Raccomandazioni personalizzate basate sui tuoi gusti"})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"La Nostra Tecnologia"}),l.jsx("p",{children:"Nebula Streaming  costruita su un'infrastruttura robusta e scalabile, utilizzando le migliori tecnologie disponibili per garantire prestazioni ottimali e sicurezza dei dati. La nostra piattaforma  progettata per essere veloce, affidabile e sempre disponibile."}),l.jsx("p",{className:"mt-2",children:"Utilizziamo API di terze parti per fornire contenuti aggiornati e di qualit, garantendo che i nostri utenti abbiano sempre accesso ai migliori film e serie TV disponibili."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"I Nostri Valori"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[l.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Accessibilit"}),l.jsx("p",{className:"text-sm",children:"Crediamo che l'intrattenimento di qualit debba essere accessibile a tutti, con piani flessibili che si adattano a diverse esigenze e budget."})]}),l.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Qualit"}),l.jsx("p",{className:"text-sm",children:"Ci impegniamo a offrire sempre la migliore qualit possibile, sia nei contenuti che nell'esperienza utente."})]}),l.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Innovazione"}),l.jsx("p",{className:"text-sm",children:"Siamo sempre alla ricerca di nuove tecnologie e funzionalit per migliorare costantemente la nostra piattaforma."})]}),l.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Privacy"}),l.jsx("p",{className:"text-sm",children:"Rispettiamo la privacy dei nostri utenti e proteggiamo i loro dati con le migliori pratiche di sicurezza."})]})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"Il Nostro Team"}),l.jsx("p",{children:"Nebula Streaming  sviluppata e gestita da un team dedicato di professionisti appassionati di tecnologia e intrattenimento. Lavoriamo costantemente per migliorare la piattaforma e rispondere alle esigenze dei nostri utenti."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"Contattaci"}),l.jsx("p",{children:"Hai domande o suggerimenti? Saremmo felici di sentirti! Puoi contattarci tramite:"}),l.jsxs("ul",{className:"list-none mt-4 space-y-2 ml-4",children:[l.jsxs("li",{children:[" Telegram: ",l.jsx("a",{href:"https://t.me/NebulaSystem",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"@asknebuladev"})]}),l.jsxs("li",{children:[" Instagram: ",l.jsx("a",{href:"https://www.instagram.com/ask_nebuladev",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"@ask_nebuladev"})]}),l.jsxs("li",{children:[" X (Twitter): ",l.jsx("a",{href:"https://x.com/AskNebulaDev",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"@AskNebulaDev"})]})]})]})]})]})})}function hL(){return l.jsx(ns,{children:l.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12",children:[l.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Contatti"}),l.jsx("div",{className:"max-w-2xl mx-auto",children:l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"Contattaci"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Social Media"}),l.jsx("p",{className:"text-sm text-white/80 mb-3",children:"Seguici sui nostri canali social per restare aggiornato su novit e aggiornamenti. Per supporto o domande, contattaci tramite questi canali."}),l.jsxs("div",{className:"flex gap-4",children:[l.jsx("a",{href:"https://t.me/NebulaSystem",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 transition-colors",children:"Telegram"}),l.jsx("a",{href:"https://www.instagram.com/ask_nebuladev",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 transition-colors",children:"Instagram"}),l.jsx("a",{href:"https://x.com/AskNebulaDev",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 transition-colors",children:"X (Twitter)"})]})]}),l.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Tempo di Risposta"}),l.jsx("p",{className:"text-sm text-white/80",children:"Cerchiamo di rispondere a tutte le richieste entro 24-48 ore lavorative. Per questioni urgenti, ti consigliamo di contattarci tramite Telegram."})]})]})]})})]})})}const fL=[{question:"Come funziona Nebula Streaming?",answer:"Nebula Streaming  una piattaforma di streaming che ti permette di guardare film e serie TV in streaming. Devi solo creare un account, scegliere un piano di abbonamento e iniziare a guardare i contenuti disponibili nel nostro catalogo."},{question:"Quali dispositivi sono supportati?",answer:"Nebula Streaming funziona su tutti i dispositivi con un browser web moderno, inclusi computer, tablet e smartphone. Non  necessario installare app dedicate, tutto funziona direttamente dal browser."},{question:"Posso guardare contenuti offline?",answer:"S, i piani Basic, Premium e ULTRA includono la funzionalit di download per guardare contenuti offline. Il piano Basic permette fino a 3 download al giorno, mentre i piani Premium e ULTRA hanno download illimitati. Il piano Free non include la funzionalit di download."},{question:"Come posso cambiare il mio piano di abbonamento?",answer:"Puoi cambiare il tuo piano in qualsiasi momento dalla sezione 'Piani' nell'header. Seleziona il nuovo piano e completa il processo di pagamento. Il nuovo piano sar attivo immediatamente dopo il pagamento."},{question:"Posso cancellare il mio abbonamento?",answer:"S, puoi cancellare il tuo abbonamento in qualsiasi momento. L'abbonamento rimarr attivo fino alla fine del periodo di fatturazione gi pagato, dopodich non verr rinnovato automaticamente."},{question:"Cosa succede se non riesco a guardare un contenuto?",answer:"Se riscontri problemi nella riproduzione di un contenuto, prova a: 1) Ricaricare la pagina, 2) Verificare la tua connessione internet, 3) Contattare il supporto tramite i nostri canali social o il form di contatto."},{question:"Quanti dispositivi posso usare contemporaneamente?",answer:"Il numero di dispositivi che puoi usare contemporaneamente dipende dal tuo piano: Piano Free permette 1 dispositivo e 1 riproduzione contemporanea, Basic permette 2 dispositivi e 2 riproduzioni contemporanee, Premium permette 3 dispositivi e 3 riproduzioni contemporanee, ULTRA permette 4 dispositivi e 4 riproduzioni contemporanee."},{question:"I contenuti hanno sottotitoli?",answer:"S, molti contenuti includono sottotitoli in diverse lingue. La disponibilit dei sottotitoli dipende dal contenuto specifico. Puoi controllare la disponibilit dei sottotitoli nella pagina di dettaglio di ogni titolo."},{question:"Come funziona la ripresa da dove ho interrotto?",answer:"Nebula Streaming salva automaticamente la posizione di riproduzione quando guardi un contenuto. Quando riapri lo stesso contenuto, il player ripartir automaticamente dal punto in cui ti eri fermato."},{question:"Cosa significa 'Livello di priorit sulle richieste'?",answer:"Il livello di priorit determina la velocit con cui vengono elaborate le tue richieste di nuovi contenuti. I piani premium hanno priorit pi alta, quindi le loro richieste vengono elaborate prima rispetto ai piani base."},{question:"Posso condividere il mio account?",answer:"No, la condivisione dell'account  vietata dai nostri Termini e Condizioni. Ogni account  personale e non pu essere condiviso con altri utenti. La violazione di questa regola pu comportare la sospensione dell'account."},{question:"Come posso segnalare un problema tecnico?",answer:"Puoi segnalare problemi tecnici tramite i nostri canali social (Telegram, Instagram, X/Twitter). Fornisci il maggior numero di dettagli possibile per aiutarci a risolvere il problema rapidamente."},{question:"Quali sono le differenze tra i piani Free, Basic, Premium e ULTRA?",answer:"Piano Free: 1 dispositivo, 1 riproduzione contemporanea, nessun download, massimo 5 preferiti. Piano Basic: 2 dispositivi, 2 riproduzioni contemporanee, fino a 3 download al giorno, preferiti illimitati. Piano Premium: 3 dispositivi, 3 riproduzioni contemporanee, download illimitati, preferiti illimitati, accesso anticipato. Piano ULTRA: 4 dispositivi, 4 riproduzioni contemporanee, download illimitati, preferiti illimitati, accesso anticipato, priorit massima."}];function mL(){const[r,e]=L.useState(0);return l.jsx(ns,{children:l.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12",children:[l.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Domande Frequenti (FAQ)"}),l.jsx("p",{className:"text-white/60 mb-8",children:"Trova risposte alle domande pi comuni su Nebula Streaming."}),l.jsx("div",{className:"space-y-4",children:fL.map((t,s)=>l.jsxs("div",{className:"bg-white/5 rounded-lg border border-white/10 overflow-hidden",children:[l.jsxs("button",{onClick:()=>e(r===s?null:s),className:"w-full px-6 py-4 text-left flex items-center justify-between hover:bg-white/5 transition-colors",children:[l.jsx("span",{className:"font-semibold text-white pr-4",children:t.question}),l.jsx("svg",{className:`w-5 h-5 text-white/60 transition-transform flex-shrink-0 ${r===s?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r===s&&l.jsx("div",{className:"px-6 pb-4",children:l.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:t.answer})})]},s))}),l.jsx("div",{className:"mt-8 p-4 bg-white/5 rounded-lg",children:l.jsxs("p",{className:"text-sm text-white/80",children:["Non hai trovato la risposta che cercavi?"," ",l.jsx("a",{href:"/contact",className:"text-blue-400 hover:underline",children:"Contattaci"})," ","e saremo felici di aiutarti!"]})})]})})}function pL(){return l.jsx(ns,{children:l.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12",children:[l.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Cookie Policy"}),l.jsxs("div",{className:"space-y-6 text-white/80 text-sm leading-relaxed",children:[l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"1. Cosa sono i Cookie"}),l.jsx("p",{children:"I cookie sono piccoli file di testo che vengono memorizzati sul tuo dispositivo (computer, tablet o smartphone) quando visiti un sito web. I cookie permettono al sito di ricordare le tue azioni e preferenze per un periodo di tempo, cos non devi reinserirle ogni volta che torni sul sito o navighi da una pagina all'altra."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"2. Come Utilizziamo i Cookie"}),l.jsx("p",{children:"Nebula Streaming utilizza i cookie per vari scopi, tra cui:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Cookie Essenziali:"})," Necessari per il funzionamento del sito, inclusi autenticazione e sicurezza"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Cookie di Prestazioni:"})," Per analizzare come gli utenti utilizzano il sito e migliorare le prestazioni"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Cookie di Funzionalit:"})," Per ricordare le tue preferenze (lingua, qualit video, ecc.)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Cookie di Targeting:"})," Per personalizzare contenuti e pubblicit (solo per piani Free)"]})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"3. Tipi di Cookie che Utilizziamo"}),l.jsx("h3",{className:"text-xl font-semibold mb-2 text-white mt-4",children:"3.1 Cookie Essenziali"}),l.jsx("p",{children:"Questi cookie sono strettamente necessari per il funzionamento del sito e non possono essere disattivati. Includono cookie per l'autenticazione, sicurezza e funzionalit base del sito."}),l.jsx("h3",{className:"text-xl font-semibold mb-2 text-white mt-4",children:"3.2 Cookie di Sessione"}),l.jsx("p",{children:"I cookie di sessione vengono memorizzati temporaneamente e vengono eliminati quando chiudi il browser. Utilizziamo questi cookie per mantenere la tua sessione attiva durante la navigazione."}),l.jsx("h3",{className:"text-xl font-semibold mb-2 text-white mt-4",children:"3.3 Cookie Persistenti"}),l.jsx("p",{children:"I cookie persistenti rimangono sul tuo dispositivo per un periodo pi lungo (fino a 12 mesi) e vengono utilizzati per ricordare le tue preferenze e migliorare la tua esperienza."}),l.jsx("h3",{className:"text-xl font-semibold mb-2 text-white mt-4",children:"3.4 Cookie di Terze Parti"}),l.jsx("p",{children:"Utilizziamo anche cookie di terze parti per servizi come analytics, pagamenti (Stripe) e contenuti video. Questi cookie sono gestiti dalle rispettive terze parti secondo le loro policy."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"4. Gestione dei Cookie"}),l.jsx("p",{children:"Puoi gestire le preferenze dei cookie tramite le impostazioni del tuo browser. La maggior parte dei browser ti permette di:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Visualizzare quali cookie sono memorizzati"}),l.jsx("li",{children:"Eliminare cookie esistenti"}),l.jsx("li",{children:"Bloccare cookie da siti specifici"}),l.jsx("li",{children:"Bloccare tutti i cookie"}),l.jsx("li",{children:"Eliminare tutti i cookie quando chiudi il browser"})]}),l.jsxs("p",{className:"mt-4",children:[l.jsx("strong",{children:"Nota importante:"})," Disattivare alcuni cookie potrebbe limitare la funzionalit del sito e impedirti di utilizzare alcune caratteristiche."]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"5. Cookie e Pubblicit"}),l.jsx("p",{children:"Per gli utenti con piano Free, utilizziamo cookie per mostrare pubblicit rilevante. Questi cookie aiutano a personalizzare gli annunci in base ai tuoi interessi e al tuo comportamento di navigazione. Gli utenti con piani a pagamento non vedono pubblicit e quindi non vengono utilizzati cookie pubblicitari."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"6. Cookie Analytics"}),l.jsx("p",{children:"Utilizziamo cookie analytics per capire come gli utenti interagiscono con il nostro sito. Questi cookie ci aiutano a:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Comprendere quali contenuti sono pi popolari"}),l.jsx("li",{children:"Identificare problemi tecnici"}),l.jsx("li",{children:"Migliorare l'esperienza utente"}),l.jsx("li",{children:"Ottimizzare le prestazioni del sito"})]}),l.jsx("p",{className:"mt-2",children:"I dati raccolti sono aggregati e anonimi, e non vengono utilizzati per identificare singoli utenti."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"7. Durata dei Cookie"}),l.jsx("p",{children:"La durata dei cookie varia a seconda del tipo:"}),l.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 ml-4",children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Cookie di sessione:"})," Eliminati quando chiudi il browser"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Cookie persistenti:"})," Possono durare da pochi giorni fino a 12 mesi"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Cookie di autenticazione:"})," Durano fino a quando non fai logout o scadono"]})]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"8. Cookie e Privacy"}),l.jsxs("p",{children:["I cookie utilizzati da Nebula Streaming sono progettati per rispettare la tua privacy. Non utilizziamo cookie per raccogliere informazioni personali identificabili senza il tuo consenso. Per maggiori informazioni su come gestiamo i tuoi dati, consulta la nostra",l.jsx("a",{href:"/privacy",className:"text-blue-400 hover:underline",children:" Privacy Policy"}),"."]})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"9. Aggiornamenti a questa Policy"}),l.jsx("p",{children:"Possiamo aggiornare questa Cookie Policy periodicamente per riflettere cambiamenti nelle nostre pratiche o per altri motivi operativi, legali o normativi. Ti consigliamo di consultare questa pagina regolarmente per rimanere informato."})]}),l.jsxs("section",{children:[l.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"10. Contatti"}),l.jsx("p",{children:"Se hai domande riguardo questa Cookie Policy, puoi contattarci tramite:"}),l.jsxs("ul",{className:"list-none mt-2 space-y-1 ml-4",children:[l.jsx("li",{children:"Telegram: @asknebuladev"}),l.jsx("li",{children:"Instagram: @ask_nebuladev"}),l.jsx("li",{children:"X (Twitter): @AskNebulaDev"})]})]}),l.jsx("div",{className:"mt-8 p-4 bg-white/5 rounded-lg",children:l.jsxs("p",{className:"text-xs text-white/60",children:[l.jsx("strong",{children:"Ultimo aggiornamento:"})," ",new Date().toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric"})]})})]})]})})}function gL(){return l.jsx(ns,{children:l.jsx("div",{className:"min-h-[80vh] flex flex-col items-center justify-center px-4 py-16",children:l.jsxs("div",{className:"text-center max-w-2xl mx-auto",children:[l.jsx("div",{className:"mb-8",children:l.jsx("h1",{className:"text-9xl md:text-[12rem] font-black text-transparent bg-clip-text bg-gradient-to-r from-nebula-400 via-purple-400 to-fuchsia-400 leading-none",children:"404"})}),l.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Pagina non trovata"}),l.jsx("p",{className:"text-xl md:text-2xl text-white/80 mb-8 leading-relaxed",children:"Il contenuto verr fatto uscire a breve"}),l.jsx("p",{className:"text-base md:text-lg text-white/60 mb-12 max-w-md mx-auto",children:"La pagina che stai cercando potrebbe essere stata spostata, rimossa o non essere ancora disponibile."}),l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[l.jsx(He,{to:"/",className:"px-8 py-4 bg-white text-black font-bold rounded-lg hover:bg-white/90 transition-all duration-300 ease-out hover:scale-105 active:scale-95 shadow-lg",children:"Torna alla Home"}),l.jsx(He,{to:"/browse",className:"px-8 py-4 bg-white/10 text-white font-bold rounded-lg hover:bg-white/20 transition-all duration-300 ease-out hover:scale-105 active:scale-95 backdrop-blur-md border border-white/20",children:"Esplora Contenuti"})]}),l.jsx("div",{className:"mt-16 opacity-20",children:l.jsxs("svg",{className:"w-64 h-64 mx-auto",viewBox:"0 0 200 200",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("circle",{cx:"100",cy:"100",r:"80",stroke:"currentColor",strokeWidth:"2",className:"text-white"}),l.jsx("circle",{cx:"100",cy:"100",r:"50",stroke:"currentColor",strokeWidth:"1.5",className:"text-white"}),l.jsx("circle",{cx:"100",cy:"100",r:"20",stroke:"currentColor",strokeWidth:"1",className:"text-white"})]})})]})})})}function xL(){const e=Ur().pathname,t=s=>e===s||s!=="/"&&e.startsWith(s);return l.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-black/80 backdrop-blur-xl border-t border-white/5 pb-safe z-50 shadow-2xl overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent pointer-events-none"}),l.jsxs("div",{className:"flex justify-around items-center h-[72px] relative z-10 px-2",children:[l.jsxs(He,{to:"/",className:`flex flex-col items-center justify-center w-full h-full gap-1.5 transition-all duration-300 active:scale-95 group ${t("/")&&e==="/"?"text-[#059669]":"text-white/40 hover:text-white/70"}`,children:[l.jsx("div",{className:"relative p-1.5 rounded-xl transition-all duration-500",children:l.jsx("svg",{className:`w-7 h-7 transition-all duration-300 ${t("/")&&e==="/"?"text-[#059669]":"text-current"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:t("/")&&e==="/"?2.5:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),l.jsx("span",{className:`text-[10px] font-medium tracking-wide transition-opacity ${t("/")&&e==="/"?"opacity-100 font-bold":"opacity-70"}`,children:"Home"})]}),l.jsxs(He,{to:"/my-lists",className:`flex flex-col items-center justify-center w-full h-full gap-1.5 transition-all duration-300 active:scale-95 group ${t("/my-lists")?"text-[#059669]":"text-white/40 hover:text-white/70"}`,children:[l.jsx("div",{className:"relative p-1.5 rounded-xl transition-all duration-500",children:l.jsx("svg",{className:`w-7 h-7 transition-all duration-300 ${t("/my-lists")?"text-[#059669]":"text-current"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:t("/my-lists")?2.5:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}),l.jsx("span",{className:`text-[10px] font-medium tracking-wide transition-opacity ${t("/my-lists")?"opacity-100 font-bold":"opacity-70"}`,children:"Le mie liste"})]}),l.jsxs(He,{to:"/search",className:`flex flex-col items-center justify-center w-full h-full gap-1.5 transition-all duration-300 active:scale-95 group ${t("/search")?"text-[#059669]":"text-white/40 hover:text-white/70"}`,children:[l.jsx("div",{className:"relative p-1.5 rounded-xl transition-all duration-500",children:l.jsx("svg",{className:`w-7 h-7 transition-all duration-300 ${t("/search")?"text-[#059669]":"text-current"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:t("/search")?2.5:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),l.jsx("span",{className:`text-[10px] font-medium tracking-wide transition-opacity ${t("/search")?"opacity-100 font-bold":"opacity-70"}`,children:"Cerca"})]}),l.jsxs(He,{to:"/download",className:`flex flex-col items-center justify-center w-full h-full gap-1.5 transition-all duration-300 active:scale-95 group ${t("/download")?"text-[#059669]":"text-white/40 hover:text-white/70"}`,children:[l.jsx("div",{className:"relative p-1.5 rounded-xl transition-all duration-500",children:l.jsx("svg",{className:`w-7 h-7 transition-all duration-300 ${t("/download")?"text-[#059669]":"text-current"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:t("/download")?2.5:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),l.jsx("span",{className:`text-[10px] font-medium tracking-wide transition-opacity ${t("/download")?"opacity-100 font-bold":"opacity-70"}`,children:"Download"})]}),l.jsxs(He,{to:"/settings",className:`flex flex-col items-center justify-center w-full h-full gap-1.5 transition-all duration-300 active:scale-95 group ${t("/settings")?"text-[#059669]":"text-white/40 hover:text-white/70"}`,children:[l.jsx("div",{className:"relative p-1.5 rounded-xl transition-all duration-500",children:l.jsxs("svg",{className:`w-7 h-7 transition-all duration-300 ${t("/settings")?"text-[#059669]":"text-current"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:t("/settings")?2.5:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:t("/settings")?2.5:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),l.jsx("span",{className:`text-[10px] font-medium tracking-wide transition-opacity ${t("/settings")?"opacity-100 font-bold":"opacity-70"}`,children:"Impostazioni"})]})]})]})}function Yt({children:r}){return l.jsxs("div",{className:"min-h-screen bg-black text-white pb-20",children:[l.jsx("main",{className:"animate-[fade-in-up_0.5s_ease-out]",children:r}),l.jsx(xL,{})]})}function vL(r,e){let t;try{t=r()}catch{return}return{getItem:i=>{var n;const a=d=>d===null?null:JSON.parse(d,void 0),u=(n=t.getItem(i))!=null?n:null;return u instanceof Promise?u.then(a):a(u)},setItem:(i,n)=>t.setItem(i,JSON.stringify(n,void 0)),removeItem:i=>t.removeItem(i)}}const cf=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(s){return cf(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return cf(s)(t)}}}},yL=(r,e)=>(t,s,i)=>{let n={storage:vL(()=>localStorage),partialize:b=>b,version:0,merge:(b,T)=>({...T,...b}),...e},a=!1,u=0;const d=new Set,h=new Set;let m=n.storage;if(!m)return r((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...b)},s,i);const p=()=>{const b=n.partialize({...s()});return m.setItem(n.name,{state:b,version:n.version})},g=i.setState;i.setState=(b,T)=>(g(b,T),p());const v=r((...b)=>(t(...b),p()),s,i);i.getInitialState=()=>v;let y;const S=()=>{var b,T;if(!m)return;const _=++u;a=!1,d.forEach(I=>{var C;return I((C=s())!=null?C:v)});const k=((T=n.onRehydrateStorage)==null?void 0:T.call(n,(b=s())!=null?b:v))||void 0;return cf(m.getItem.bind(m))(n.name).then(I=>{if(I)if(typeof I.version=="number"&&I.version!==n.version){if(n.migrate){const C=n.migrate(I.state,I.version);return C instanceof Promise?C.then($=>[!0,$]):[!0,C]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,I.state];return[!1,void 0]}).then(I=>{var C;if(_!==u)return;const[$,N]=I;if(y=n.merge(N,(C=s())!=null?C:v),t(y,!0),$)return p()}).then(()=>{_===u&&(k==null||k(y,void 0),y=s(),a=!0,h.forEach(I=>I(y)))}).catch(I=>{_===u&&(k==null||k(void 0,I))})};return i.persist={setOptions:b=>{n={...n,...b},b.storage&&(m=b.storage)},clearStorage:()=>{m==null||m.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>S(),hasHydrated:()=>a,onHydrate:b=>(d.add(b),()=>{d.delete(b)}),onFinishHydration:b=>(h.add(b),()=>{h.delete(b)})},n.skipHydration||S(),y||v},bL=yL,Hy=fv()(bL((r,e)=>({downloads:[],addDownload:t=>{const s=`${t.tmdb_id}-${t.type}`;e().downloads.some(i=>i.id===s)||r(i=>({downloads:[{...t,id:s,addedAt:Date.now()},...i.downloads]}))},removeDownload:t=>{r(s=>({downloads:s.downloads.filter(i=>i.id!==t)}))},isDownloaded:(t,s)=>e().downloads.some(i=>i.tmdb_id===t&&i.type===s)}),{name:"nebula-downloads"})),wL=Object.freeze(Object.defineProperty({__proto__:null,useDownloadStore:Hy},Symbol.toStringTag,{value:"Module"}));function SL(){const{downloads:r,removeDownload:e}=Hy();return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black px-4 py-8 pb-24",children:[l.jsx("h1",{className:"text-3xl font-bold text-white mb-8 text-center",style:{textShadow:"0 0 20px rgba(255,255,255,0.1)"},children:"Download"}),r.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center mt-20",children:[l.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-6",children:l.jsx("svg",{className:"w-8 h-8 text-white/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),l.jsx("h2",{className:"text-xl font-bold text-white mb-2 text-center",children:"Nessun download"}),l.jsx("p",{className:"text-white/60 text-center text-sm max-w-xs leading-relaxed",children:"I tuoi contenuti scaricati appariranno qui per la visione offline."}),l.jsx(He,{to:"/browse",className:"mt-8 px-8 py-3 bg-white text-black font-bold rounded-full text-sm hover:scale-105 transition-transform",children:"Esplora Catalogo"})]}):l.jsx("div",{className:"space-y-4",children:r.map(t=>l.jsxs("div",{className:"flex items-center gap-4 bg-white/5 p-3 rounded-xl border border-white/5 active:bg-white/10 transition-colors",children:[l.jsx("div",{className:"w-16 h-24 rounded-lg overflow-hidden shrink-0 bg-white/10",children:t.poster_path?l.jsx("img",{src:Ze(t.poster_path||void 0),alt:t.title,className:"w-full h-full object-cover"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/20 text-xs",children:"No Img"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("h3",{className:"text-white font-medium text-sm truncate pr-2",children:t.title}),l.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l.jsx("span",{className:"text-[10px] text-white/60 uppercase tracking-wider border border-white/10 px-1.5 py-0.5 rounded",children:t.type==="tv"?"Serie TV":"Film"}),t.year&&l.jsx("span",{className:"text-[10px] text-white/40",children:t.year})]}),l.jsxs("div",{className:"flex items-center gap-1 mt-2 text-green-400 text-xs",children:[l.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),l.jsx("span",{children:"Scaricato"})]})]}),l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsx(He,{to:`/watch/${t.tmdb_id}?type=${t.type}`,className:"p-2 rounded-full bg-white text-black hover:scale-105 transition-transform",children:l.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})})}),l.jsx("button",{onClick:()=>e(t.id),className:"p-2 rounded-full text-white/40 hover:text-red-400 transition-colors",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id))})]})})}const EL=r=>r.slice(0,2).toUpperCase();function kx(){const{session:r,user:e}=Mt(),t=Bt(),[s,i]=L.useState(!1),n=()=>{var S;if(!e)return{name:"Ospite",email:"",avatar:null};const m=e.email||"",p=e.user_metadata||{},g=m.split("@")[0],v=p.full_name||p.name||p.display_name||g;let y=p.avatar_url||p.picture||p.avatar||null;if(!y&&((S=e.identities)!=null&&S.length)){const b=e.identities.find(T=>T.provider==="google");b!=null&&b.identity_data&&(y=b.identity_data.avatar_url||b.identity_data.picture||null)}return{name:v,email:m,avatar:y}},{name:a,email:u,avatar:d}=n(),h=async()=>{const{supabase:m}=await er(async()=>{const{supabase:p}=await Promise.resolve().then(()=>hv);return{supabase:p}},void 0);await m.auth.signOut(),t("/login")};return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black px-4 pt-8 pb-32",children:[l.jsx("div",{className:"flex items-center justify-between mb-8",children:l.jsx("h1",{className:"text-2xl font-bold text-white tracking-tight",children:"Impostazioni"})}),l.jsxs("div",{className:"mb-10",children:[l.jsx("h2",{className:"text-xs font-bold text-white/40 mb-4 uppercase tracking-widest px-1",children:"Il tuo Account"}),l.jsxs("div",{className:"relative group",children:[l.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl opacity-20 group-hover:opacity-30 transition duration-500 blur"}),l.jsxs("div",{className:"relative bg-[#121212] rounded-2xl overflow-hidden border border-white/10",children:[l.jsx("div",{className:"p-5 relative border-b border-white/5",children:l.jsxs("div",{className:"flex items-center gap-5",children:[l.jsxs(He,{to:r?"/account":"/login",className:"flex-1 flex items-center gap-4 group/avatar",children:[l.jsxs("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-[#1f1f1f] shrink-0 border-2 border-transparent group-hover/avatar:border-indigo-500/50 transition-all shadow-lg ring-2 ring-white/5",children:[d?l.jsx("img",{src:d,alt:a,className:"w-full h-full object-cover",onError:m=>{var g;const p=m.target;p.style.display="none",(g=p.nextElementSibling)==null||g.classList.remove("hidden")}}):null,l.jsx("div",{className:`w-full h-full flex items-center justify-center bg-gradient-to-br from-indigo-600 to-violet-700 ${d?"hidden":""}`,children:l.jsx("span",{className:"text-white font-bold text-2xl",children:EL(a)})})]}),l.jsxs("div",{className:"min-w-0 flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-xl leading-tight truncate mb-1",children:r?a:"Accedi"}),r&&l.jsx("p",{className:"text-white/50 text-sm truncate font-medium",children:u}),!r&&l.jsx("p",{className:"text-indigo-400 text-xs font-medium mt-1",children:"Accedi per sincronizzare"})]})]}),r&&l.jsxs("button",{onClick:h,className:"flex flex-col items-center gap-1 text-white/40 hover:text-red-500 transition-colors p-2 rounded-xl hover:bg-white/5",title:"Esci",children:[l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),l.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Esci"})]})]})}),l.jsxs(He,{to:"/plans",className:"flex items-center gap-4 p-5 bg-gradient-to-r from-yellow-500/5 to-orange-500/5 hover:from-yellow-500/10 hover:to-orange-500/10 transition-colors group",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-500/10 flex items-center justify-center shrink-0 text-yellow-500 group-hover:scale-110 transition-transform",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-semibold text-base mb-0.5",children:"Sblocca Premium"}),l.jsx("p",{className:"text-white/50 text-xs leading-relaxed",children:"Funzionalit illimitate ed esclusive per te"})]}),l.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white/30 group-hover:bg-white/10 group-hover:text-white transition-all",children:l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})]})]}),l.jsxs("div",{className:"mb-8",children:[l.jsx("h2",{className:"text-xs font-bold text-white/40 mb-4 uppercase tracking-widest px-1",children:"Applicazione"}),l.jsxs("div",{className:"bg-[#121212] rounded-2xl overflow-hidden border border-white/5 divide-y divide-white/5",children:[l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>i(!s),className:"w-full flex items-center gap-4 p-4 hover:bg-white/5 transition-colors text-left group",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center shrink-0 text-emerald-500",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-medium text-base",children:"Community"}),l.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:"Unisciti ai nostri canali social ufficiali"})]}),l.jsx("svg",{className:`w-5 h-5 text-white/20 group-hover:text-white/40 transition-transform duration-300 ${s?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),l.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${s?"max-h-64 opacity-100":"max-h-0 opacity-0"}`,children:l.jsxs("div",{className:"bg-[#181818] border-t border-white/5",children:[l.jsxs("a",{href:"https://t.me/NebulaSystem",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 pl-16 pr-4 py-3 hover:bg-white/5 font-medium text-white/80 transition-colors",children:[l.jsx("span",{className:"text-[#2AABEE]",children:l.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.62 0zm4.905 8.52c0 .09-.676 3.65-2.228 6.643-1.127 2.1-1.647 1.95-2.738.98l-3.395-2.68-1.574 1.54c-.167.17-.386.31-.57.31-.383 0-.54-.143-.808-.758l-1.99-6.38-4.904-1.503c-1.077-.33-1.096-1.09.23-1.614l17.77-6.904c.83-.3 1.564.21 1.284 1.366z"})})}),"Telegram"]}),l.jsxs("a",{href:"https://twitter.com/asknebula",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 pl-16 pr-4 py-3 hover:bg-white/5 font-medium text-white/80 transition-colors",children:[l.jsx("span",{className:"text-white",children:l.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})}),"X (Twitter)"]}),l.jsxs("a",{href:"https://instagram.com/asknebula",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 pl-16 pr-4 py-3 hover:bg-white/5 font-medium text-white/80 transition-colors",children:[l.jsx("span",{className:"text-[#E1306C]",children:l.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.069-4.85.069-3.204 0-3.584-.012-4.849-.069-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})}),"Instagram"]})]})})]}),l.jsxs(He,{to:"/faq",className:"flex items-center gap-4 p-4 hover:bg-white/5 transition-colors group",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center shrink-0 text-blue-500",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-medium text-base",children:"Supporto (FAQ)"}),l.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:"Trova risposte alle domande comuni"})]}),l.jsx("svg",{className:"w-5 h-5 text-white/20 group-hover:text-white/40 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),l.jsxs("a",{href:"mailto:support@asknebula.it",className:"flex items-center gap-4 p-4 hover:bg-white/5 transition-colors group",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center shrink-0 text-purple-500",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-medium text-base",children:"Contattaci"}),l.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:"Segnala problemi o dai suggerimenti"})]}),l.jsx("svg",{className:"w-5 h-5 text-white/20 group-hover:text-white/40 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),l.jsxs(He,{to:"/privacy",className:"flex items-center gap-4 p-4 hover:bg-white/5 transition-colors group",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-500/10 flex items-center justify-center shrink-0 text-gray-400",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-medium text-base",children:"Privacy Policy"}),l.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:"Tutto sulla protezione dei tuoi dati"})]}),l.jsx("svg",{className:"w-5 h-5 text-white/20 group-hover:text-white/40 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),l.jsxs("div",{className:"p-4 flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 flex items-center justify-center shrink-0",children:l.jsx("svg",{className:"w-5 h-5 text-white/20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),l.jsx("div",{children:l.jsx("h3",{className:"text-white/60 font-medium text-sm",children:"Versione app"})})]}),l.jsx("span",{className:"bg-[#1a1a1a] border border-white/10 text-white/40 text-[10px] font-mono px-2 py-1 rounded",children:"v1.2.0"})]})]})]})]})})}function TL(r,e){let t;return function(...s){const i=this;clearTimeout(t),t=setTimeout(()=>r.apply(i,s),e)}}const Ns="https://api.asknebula.it";function _L(){const[r,e]=kr(),[t,s]=L.useState(r.get("q")||""),[i,n]=L.useState([]),[a,u]=L.useState(!1),[d,h]=L.useState(!1),[m,p]=L.useState([]),[g,v]=L.useState([]),[y,S]=L.useState([]),[b,T]=L.useState([]),[_,k]=L.useState([]),[I,C]=L.useState([]),[$,N]=L.useState([]),[O,j]=L.useState([]),[D,G]=L.useState([]),[X,K]=L.useState([]),[W,te]=L.useState([]),[z,M]=L.useState([]),[F,H]=L.useState([]),[Y,P]=L.useState([]),[B,oe]=L.useState([]),[ie,ne]=L.useState([]),[le,_e]=L.useState(!0),Se=L.useRef(null);L.useEffect(()=>{Se.current&&Se.current.focus()},[]);const Fe=L.useCallback(TL(pe=>{pe.trim()?(e({q:pe.trim()},{replace:!0}),de(pe.trim())):(e({},{replace:!0}),n([]),h(!1),at())},500),[]);L.useEffect(()=>{const pe=r.get("q");pe&&!t&&s(pe)},[r]),L.useEffect(()=>{const pe=r.get("q");pe?de(pe):at()},[]);const Ee=pe=>{const Ge=pe.target.value;s(Ge),Fe(Ge)},at=async()=>{_e(!0);try{const[pe,Ge,Ne,nt,it,zt,ht,ts,ks,zs,vs,Te,ds,Gt,Ws,sr]=await Promise.all([fetch(`${Ns}/category/trending?limit=20`),fetch(`${Ns}/category/popular-movies?limit=20`),fetch(`${Ns}/category/popular-tv?limit=20`),fetch(`${Ns}/category/top-rated-movies?limit=15`),fetch(`${Ns}/category/action?limit=15`),fetch(`${Ns}/category/comedy?limit=15`),fetch(`${Ns}/category/drama?limit=15`),fetch(`${Ns}/category/horror?limit=15`),fetch(`${Ns}/category/thriller?limit=15`),fetch(`${Ns}/category/romance?limit=15`),fetch(`${Ns}/category/sci-fi?limit=15`),fetch(`${Ns}/category/animation?limit=15`),fetch(`${Ns}/category/adventure?limit=15`),fetch(`${Ns}/category/fantasy?limit=15`),fetch(`${Ns}/category/recent?limit=15`),fetch(`${Ns}/category/top-rated-tv?limit=15`)]);pe.ok&&p((await pe.json()).slice(0,20)),Ge.ok&&v((await Ge.json()).slice(0,20)),Ne.ok&&S((await Ne.json()).slice(0,20)),nt.ok&&T((await nt.json()).slice(0,15)),it.ok&&k((await it.json()).slice(0,15)),zt.ok&&C((await zt.json()).slice(0,15)),ht.ok&&N((await ht.json()).slice(0,15)),ts.ok&&j((await ts.json()).slice(0,15)),ks.ok&&G((await ks.json()).slice(0,15)),zs.ok&&K((await zs.json()).slice(0,15)),vs.ok&&te((await vs.json()).slice(0,15)),Te.ok&&M((await Te.json()).slice(0,15)),ds.ok&&H((await ds.json()).slice(0,15)),Gt.ok&&P((await Gt.json()).slice(0,15)),Ws.ok&&oe((await Ws.json()).slice(0,15)),sr.ok&&ne((await sr.json()).slice(0,15))}catch(pe){console.error("Error loading trending:",pe)}finally{_e(!1)}},de=async pe=>{if(!pe.trim()){n([]),h(!1);return}u(!0),h(!0);try{const Ge=await fetch(`${Ns}/search?q=${encodeURIComponent(pe)}&type=movie`);if(Ge.ok){const Ne=await Ge.json(),nt=Array.isArray(Ne)?Ne.map(it=>{let zt=it.type||"movie";return{...it,tmdb_id:it.tmdb_id||it.id,type:zt,title:it.title||it.name||"",name:it.name||"",poster:it.poster||null}}):[];n(nt)}else n([])}catch{n([])}finally{u(!1)}},gt=pe=>{pe.preventDefault(),t.trim()&&(e({q:t.trim()}),de(t.trim()))},Ct=()=>{s(""),e({}),h(!1),n([]),Se.current&&Se.current.focus(),at()},as=(pe,Ge)=>pe.length===0?null:l.jsxs("div",{className:"mb-10 animate-fade-in-up",children:[l.jsx("div",{className:"flex items-center gap-2 mb-4 px-2",children:l.jsx("h2",{className:"text-xl font-bold text-white tracking-wide border-l-4 border-[#059669] pl-3",children:Ge})}),l.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3 sm:gap-4",style:{touchAction:"pan-y"},children:pe.map(Ne=>{const nt=Ne.id,it=Ne.media_type||(Ne.release_date?"movie":"tv"),zt=Ne.title||Ne.name||"",ht=Ne.poster_path;return l.jsxs(He,{to:`/title/${nt}?type=${it}`,className:"group",children:[l.jsxs("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-gradient-to-br from-white/10 to-white/5 mb-2 border border-white/10 shadow-lg group-active:scale-95 transition-all duration-200",children:[ht?l.jsx("img",{src:Ze(ht,"medium")||void 0,alt:zt,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-[#1a1a1a] to-[#0a0a0a]",children:l.jsx("span",{className:"text-white/30 text-xs text-center px-2 font-medium",children:zt})}),Ne.vote_average&&Ne.vote_average>0&&l.jsx("div",{className:"absolute top-2 right-2 bg-black/70 backdrop-blur-sm px-2 py-1 rounded-full",children:l.jsxs("span",{className:"text-xs font-bold text-yellow-400",children:[" ",Ne.vote_average.toFixed(1)]})})]}),l.jsx("p",{className:"text-xs font-semibold text-white/90 line-clamp-1 group-hover:text-white transition-colors",children:zt})]},`${nt}-${it}`)})})]}),ke=(pe,Ge)=>pe.length===0?null:l.jsxs("div",{className:"mb-8 animate-fade-in-up",children:[l.jsx("div",{className:"flex items-center gap-2 mb-4 px-2",children:l.jsx("h2",{className:"text-lg font-bold text-white tracking-wide border-l-4 border-[#059669] pl-3",children:Ge})}),l.jsx("div",{className:"flex gap-3 overflow-x-auto pb-4 px-2 no-scrollbar scroll-smooth",style:{touchAction:"pan-y",overscrollBehaviorY:"auto",overscrollBehaviorX:"contain"},children:pe.map(Ne=>{const nt=Ne.id,it=Ne.media_type||(Ne.release_date?"movie":"tv"),zt=Ne.title||Ne.name||"",ht=Ne.poster_path;return l.jsxs(He,{to:`/title/${nt}?type=${it}`,className:"flex-shrink-0 w-32 sm:w-40 group",children:[l.jsxs("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-gradient-to-br from-white/10 to-white/5 mb-2 border border-white/10 shadow-lg group-active:scale-95 transition-all duration-200",children:[ht?l.jsx("img",{src:Ze(ht,"medium")||void 0,alt:zt,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-[#1a1a1a] to-[#0a0a0a]",children:l.jsx("span",{className:"text-white/30 text-[10px] text-center px-1",children:zt})}),Ne.vote_average&&Ne.vote_average>7&&l.jsx("div",{className:"absolute top-2 right-2 bg-gradient-to-r from-yellow-400 to-yellow-500 backdrop-blur-sm px-1.5 py-0.5 rounded-full shadow-lg",children:l.jsxs("span",{className:"text-[10px] font-bold text-black",children:[" ",Ne.vote_average.toFixed(1)]})})]}),l.jsx("p",{className:"text-xs font-semibold text-white/90 line-clamp-2 text-center group-hover:text-nebula-400 transition-colors",children:zt})]},`${nt}-${it}`)})})]}),be=[{name:"Azione",query:"action"},{name:"Commedia",query:"comedy"},{name:"Dramma",query:"drama"},{name:"Horror",query:"horror"},{name:"Thriller",query:"thriller"},{name:"Fantasy",query:"fantasy"},{name:"Romantico",query:"romance"},{name:"Animazione",query:"animation"},{name:"Sci-Fi",query:"sci-fi"},{name:"Avventura",query:"adventure"},{name:"Crime",query:"crime"},{name:"Guerra",query:"war"}];return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-[#070707] text-white pb-20",children:[l.jsx("div",{className:"sticky top-0 z-40 bg-[#0f0f0f]/95 backdrop-blur-md border-b border-white/5 px-4 py-2 shadow-xl",children:l.jsx("form",{onSubmit:gt,className:"flex items-center gap-3 max-w-4xl mx-auto w-full",children:l.jsxs("div",{className:"flex-1 relative group",children:[l.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40 group-focus-within:text-[#059669] transition-colors",children:l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),l.jsx("input",{ref:Se,type:"text",value:t,onChange:Ee,placeholder:"Cerca titolo",className:"w-full bg-[#1a1a1a] border border-white/5 rounded-[2px] px-10 py-1.5 text-white placeholder-white/30 outline-none focus:border-white/10 focus:bg-[#202020] transition-all shadow-inner text-sm"}),t&&l.jsx("button",{type:"button",onClick:Ct,className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/40 hover:text-white p-1 rounded-full hover:bg-white/5 transition-all",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),l.jsx("div",{className:"px-4 py-6 max-w-7xl mx-auto w-full",children:a?l.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#059669] mb-4"}),l.jsx("p",{className:"text-white/60 animate-pulse",children:"Ricerca in corso..."})]}):d&&i.length===0?l.jsxs("div",{className:"text-center py-20 animate-fade-in",children:[l.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-white/5 flex items-center justify-center",children:l.jsx("svg",{className:"w-10 h-10 text-white/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),l.jsx("p",{className:"text-white text-xl font-bold mb-2",children:"Nessun risultato trovato"}),l.jsx("p",{className:"text-white/60 text-sm mb-6",children:"Prova con un termine diverso o controlla l'ortografia"}),l.jsx("button",{onClick:Ct,className:"px-6 py-3 bg-[#059669] hover:bg-[#047857] rounded-xl text-white font-semibold transition-all shadow-lg hover:shadow-[#059669]/20",children:"Torna a Tendenze"})]}):d&&i.length>0?l.jsxs("div",{className:"animate-fade-in-up",children:[l.jsxs("h2",{className:"text-xl font-bold text-white mb-6 flex items-center gap-2",children:["Risultati per ",l.jsxs("span",{className:"text-[#059669]",children:['"',t,'"']}),l.jsxs("span",{className:"text-xs font-normal text-white/50 bg-white/10 px-2 py-1 rounded-full ml-2",children:[i.length," trovati"]})]}),l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2",style:{touchAction:"pan-y"},children:i.map(pe=>l.jsx(He,{to:`/title/${pe.tmdb_id||pe.id}?type=${pe.type}`,className:"group relative block overflow-hidden",children:l.jsxs("div",{className:"aspect-[2/3] w-full bg-[#141414] relative",children:[pe.poster?l.jsx("img",{src:Ze(pe.poster,"medium")||void 0,alt:pe.title||pe.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-[#141414] border border-white/5",children:l.jsx("span",{className:"text-white/20 text-xs text-center px-2",children:pe.title||pe.name})}),l.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center p-2",children:l.jsx("span",{className:"text-white text-xs font-semibold text-center line-clamp-3",children:pe.title||pe.name})})]})},`${pe.tmdb_id||pe.id}-${pe.type}`))})]}):l.jsx("div",{children:le?l.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#059669] mb-4"}),l.jsx("p",{className:"text-white/60 animate-pulse",children:"Caricamento catalogo..."})]}):l.jsxs("div",{className:"flex flex-col gap-6",children:[m.length>0&&l.jsxs("div",{className:"animate-fade-in-up",children:[l.jsx("div",{className:"flex items-center gap-2 mb-4 px-2",children:l.jsx("h2",{className:"text-2xl font-bold text-white tracking-wide border-l-4 border-[#059669] pl-3",children:"In Tendenza Ora"})}),l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4",style:{touchAction:"pan-y"},children:m.slice(0,12).map(pe=>{const Ge=pe.id,Ne=pe.media_type||(pe.release_date?"movie":"tv"),nt=pe.title||pe.name||"",it=pe.poster_path;return l.jsxs(He,{to:`/title/${Ge}?type=${Ne}`,className:"group",children:[l.jsxs("div",{className:"aspect-[2/3] rounded-xl overflow-hidden bg-gradient-to-br from-white/10 to-white/5 mb-2 border border-white/10 shadow-xl group-active:scale-95 transition-all duration-200",children:[it?l.jsx("img",{src:Ze(it,"medium")||void 0,alt:nt,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-[#1a1a1a] to-[#0a0a0a]",children:l.jsx("span",{className:"text-white/30 text-xs text-center px-2 font-medium",children:nt})}),pe.vote_average&&pe.vote_average>7&&l.jsx("div",{className:"absolute top-2 right-2 bg-gradient-to-r from-yellow-400 to-yellow-500 backdrop-blur-sm px-2 py-1 rounded-full shadow-lg",children:l.jsxs("span",{className:"text-xs font-bold text-black",children:[" ",pe.vote_average.toFixed(1)]})})]}),l.jsx("p",{className:"text-xs font-bold text-white line-clamp-1 group-hover:text-[#059669] transition-colors",children:nt})]},`${Ge}-${Ne}`)})})]}),as(g,"Film Popolari"),as(y,"Serie TV Popolari"),ke(b,"I Pi Votati - Film"),ke(ie,"I Pi Votati - Serie TV"),ke(B,"Uscite Recenti"),_.length>0&&ke(_,"Azione"),I.length>0&&ke(I,"Commedia"),$.length>0&&ke($,"Dramma"),O.length>0&&ke(O,"Horror"),D.length>0&&ke(D,"Thriller"),X.length>0&&ke(X,"Romantico"),W.length>0&&ke(W,"Sci-Fi"),z.length>0&&ke(z,"Animazione"),F.length>0&&ke(F,"Avventura"),Y.length>0&&ke(Y,"Fantasy"),l.jsxs("div",{className:"mt-10 mb-6 animate-fade-in-up",children:[l.jsx("div",{className:"flex items-center gap-2 mb-4 px-2",children:l.jsx("h2",{className:"text-xl font-bold text-white tracking-wide border-l-4 border-[#059669] pl-3",children:"Esplora per Genere"})}),l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:be.map(pe=>l.jsxs("button",{onClick:()=>{s(pe.query),Ee({target:{value:pe.query}})},className:"px-5 py-4 bg-white/5 hover:bg-white/10 active:bg-white/15 rounded-xl text-sm text-white font-medium transition-all border border-white/5 hover:border-white/10 flex items-center justify-between group",children:[l.jsx("span",{children:pe.name}),l.jsx("svg",{className:"w-5 h-5 text-white/20 group-hover:text-[#059669] transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]},pe.name))})]})]})})})]})})}const Eh=[{id:"no-ads",name:"BASIC",originalPrice:3.99,monthlyPrice:2.99,features:{earlyAccess:!1,unlimitedDownloads:!1,unlimitedFavorites:!0,screens:2}},{id:"premium",name:"PREMIUM",originalPrice:7.99,monthlyPrice:5.99,popular:!0,features:{earlyAccess:!0,unlimitedDownloads:!0,unlimitedFavorites:!0,screens:3}},{id:"premium-plus",name:"ULTRA",originalPrice:11.99,monthlyPrice:8.99,features:{earlyAccess:!0,unlimitedDownloads:!0,unlimitedFavorites:!0,screens:4}}],vc=[{id:"year",label:"Annuale",discount:45,months:12,multiplier:.55},{id:"6months",label:"Semestrale",discount:35,months:6,multiplier:.65},{id:"month",label:"Mensile",discount:25,months:1,multiplier:.75}];function kL(){const{user:r}=Mt(),e=Bt(),[t,s]=L.useState("year"),i=a=>{if(!r){e("/login");return}vc.find(u=>u.id===t),e(`/checkout?plan=${a}&duration=${t}`)},n=vc.find(a=>a.id===t)||vc[0];return l.jsx(ns,{children:l.jsx("div",{className:"min-h-screen bg-[#070707] py-12 md:py-20 animate-fade-in",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-12 space-y-4",children:[l.jsx("h1",{className:"text-3xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-white via-white to-gray-400 bg-clip-text text-transparent",children:"Scegli il piano perfetto per te"}),l.jsx("p",{className:"text-white/60 max-w-2xl mx-auto text-lg",children:"Sblocca tutto il potenziale di Nebula con Premium. Scarica i tuoi contenuti preferiti senza limiti, accedi in anteprima alle novit esclusive e goditi un'esperienza di visione premium."})]}),l.jsx("div",{className:"flex justify-center mb-16",children:l.jsx("div",{className:"inline-flex bg-white/5 p-1 rounded-xl border border-white/10",children:vc.map(a=>l.jsxs("button",{onClick:()=>s(a.id),className:`px-6 py-2.5 rounded-lg text-sm font-semibold transition-all duration-300 ${t===a.id?"bg-[#059669] text-white shadow-lg shadow-green-900/20":"text-white/60 hover:text-white hover:bg-white/5"}`,children:[a.label,l.jsxs("span",{className:`ml-2 text-xs py-0.5 px-1.5 rounded-full ${t===a.id?"bg-black/20 text-white":"bg-green-500/20 text-green-400"}`,children:["-",a.discount,"%"]})]},a.id))})}),l.jsxs("div",{className:"bg-[#121212] rounded-2xl border border-white/5 overflow-hidden shadow-2xl relative",children:[l.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-3/4 h-1 bg-gradient-to-r from-transparent via-[#059669] to-transparent opacity-50 blur-sm"}),l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full min-w-[800px]",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{className:"text-left p-6 w-1/4"}),Eh.map(a=>l.jsxs("th",{className:"p-6 text-center align-top w-1/4 relative group",children:[a.popular&&l.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-[#059669]"}),l.jsx("div",{className:`inline-block px-3 py-1 rounded text-xs font-bold mb-3 ${a.id==="premium"?"bg-[#059669] text-white":"bg-white/10 text-white/70"}`,children:a.name}),(()=>{const u=a.originalPrice*n.multiplier,d=u*n.months;return l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"text-white/40 line-through text-sm",children:["",(a.originalPrice*n.months).toFixed(2)]}),l.jsxs("div",{className:"text-3xl font-bold text-white",children:["",u.toFixed(2),l.jsx("span",{className:"text-sm text-white/50 font-normal",children:"/mese"})]}),l.jsxs("div",{className:"text-xs text-[#059669] font-medium",children:["Fatturato ",d.toFixed(2)," ogni ",n.months===1?"mese":n.months===6?"6 mesi":"anno"]})]})})()]},a.id))]})}),l.jsxs("tbody",{className:"divide-y divide-white/5",children:[l.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[l.jsxs("td",{className:"p-6 text-white/80 font-medium",children:["Preferiti",l.jsx("div",{className:"text-xs text-white/40 font-normal mt-1",children:"(Piano Gratuito: max 5)"})]}),l.jsx("td",{className:"p-6 text-center text-white font-semibold",children:"Illimitati"}),l.jsx("td",{className:"p-6 text-center text-white font-semibold",children:"Illimitati"}),l.jsx("td",{className:"p-6 text-center text-[#ffbf00] font-bold",children:"Illimitati"})]}),l.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[l.jsx("td",{className:"p-6 text-white/80 font-medium",children:"Download Offline"}),l.jsx("td",{className:"p-6 text-center text-white/60",children:"3 / giorno"}),l.jsx("td",{className:"p-6 text-center text-white font-semibold",children:"Illimitati"}),l.jsx("td",{className:"p-6 text-center text-[#ffbf00] font-bold",children:"Illimitati"})]}),l.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[l.jsx("td",{className:"p-6 text-white/80 font-medium",children:"Accesso Anticipato"}),l.jsx("td",{className:"p-6 text-center text-white/20",children:""}),l.jsx("td",{className:"p-6 text-center text-[#059669]",children:l.jsx("svg",{className:"w-6 h-6 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),l.jsx("td",{className:"p-6 text-center text-[#ffbf00]",children:l.jsx("svg",{className:"w-6 h-6 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),l.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[l.jsx("td",{className:"p-6 text-white/80 font-medium",children:"Dispositivi simultanei"}),Eh.map(a=>l.jsx("td",{className:"p-6 text-center text-white font-bold text-lg",children:a.features.screens},a.id))]}),l.jsxs("tr",{children:[l.jsx("td",{className:"p-6"}),Eh.map(a=>l.jsx("td",{className:"p-6",children:l.jsxs("button",{onClick:()=>i(a.id),className:`w-full py-3 rounded-lg font-bold transition-all duration-300 transform hover:scale-105 active:scale-95 ${a.id==="premium"?"bg-[#059669] hover:bg-[#047857] text-white shadow-lg shadow-green-900/20":"bg-white/10 hover:bg-white/20 text-white"}`,children:["Scegli ",a.name]})},a.id))]})]})]})})]}),l.jsx("div",{className:"mt-8 text-center text-white/40 text-sm",children:l.jsxs("p",{children:["I prezzi includono l'IVA applicabile. Puoi disdire in qualsiasi momento. ",l.jsx(He,{to:"/terms",className:"underline hover:text-white",children:"Termini di servizio"}),"."]})})]})})})}const AL="https://api.asknebula.it";function IL(){const{session:r}=Mt(),[e,t]=L.useState([]),[s,i]=L.useState(!0);return L.useEffect(()=>{if(!r){i(!1);return}async function n(){try{const a={Authorization:`Bearer ${r.access_token}`},u=await fetch(`${AL}/me/favorites?limit=100`,{headers:a});if(u.ok){const d=await u.json(),h=_s(d);t(h)}else t([])}catch{t([])}finally{i(!1)}}n()},[r]),r?l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black px-4 py-6",children:[l.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Le mie liste"}),s?l.jsx("div",{className:"flex items-center justify-center py-20",children:l.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-green-500"})}):e.length===0?l.jsxs("div",{className:"text-center py-20",children:[l.jsx("svg",{className:"w-16 h-16 text-white/30 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),l.jsx("p",{className:"text-white/60 text-lg mb-2",children:"Nessun contenuto nelle tue liste"}),l.jsx("p",{className:"text-white/40 text-sm",children:"Aggiungi contenuti ai preferiti per vederli qui"})]}):l.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.map(n=>l.jsxs(He,{to:`/title/${n.tmdb_id}?type=${n.type}`,className:"group",children:[l.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-white/5 mb-2",children:n.poster?l.jsx("img",{src:Ze(n.poster||void 0),alt:n.title,className:"w-full h-full object-cover group-active:scale-95 transition-transform",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center",children:l.jsx("svg",{className:"w-12 h-12 text-white/20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),l.jsx("h3",{className:"text-white font-semibold text-sm line-clamp-2 mb-1",children:n.title}),n.year&&l.jsx("p",{className:"text-white/60 text-xs",children:n.year})]},`${n.tmdb_id}-${n.type}`))})]})}):l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black flex flex-col items-center justify-center px-4",children:[l.jsx("svg",{className:"w-16 h-16 text-white/30 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),l.jsx("h2",{className:"text-xl font-bold text-white mb-2 text-center",children:"Accedi per vedere le tue liste"}),l.jsx("p",{className:"text-white/60 text-center mb-6",children:"Accedi al tuo account per gestire le tue liste personali"}),l.jsx(He,{to:"/login",className:"px-6 py-3 bg-green-500 text-white rounded-lg font-semibold active:bg-green-600 transition-colors",children:"Accedi"})]})})}function qy({children:r}){const e=Ur(),[t,s]=L.useState(e),[i,n]=L.useState("entered");return L.useEffect(()=>{if(e!==t){n("entering"),window.scrollTo({top:0,behavior:"smooth"});const a=setTimeout(()=>{s(e),n("entered")},150);return()=>clearTimeout(a)}},[e,t]),l.jsx("div",{className:`page-transition ${i==="entering"?"fade-out":""}`,style:{opacity:i==="entering"?0:1,transform:i==="entering"?"translateY(10px)":"none",transition:"opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1), transform 0.3s cubic-bezier(0.16, 1, 0.3, 1)",willChange:i==="entering"?"opacity, transform":"auto"},children:r})}/*! Capacitor: https://capacitorjs.com/ - MIT License */var Ca;(function(r){r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE"})(Ca||(Ca={}));class Th extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const LL=r=>{var e,t;return r!=null&&r.androidBridge?"android":!((t=(e=r==null?void 0:r.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},RL=r=>{const e=r.CapacitorCustomPlatform||null,t=r.Capacitor||{},s=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:LL(r),n=()=>i()!=="web",a=p=>{const g=h.get(p);return!!(g!=null&&g.platforms.has(i())||u(p))},u=p=>{var g;return(g=t.PluginHeaders)===null||g===void 0?void 0:g.find(v=>v.name===p)},d=p=>r.console.error(p),h=new Map,m=(p,g={})=>{const v=h.get(p);if(v)return console.warn(`Capacitor plugin "${p}" already registered. Cannot register plugins twice.`),v.proxy;const y=i(),S=u(p);let b;const T=async()=>(!b&&y in g?b=typeof g[y]=="function"?b=await g[y]():b=g[y]:e!==null&&!b&&"web"in g&&(b=typeof g.web=="function"?b=await g.web():b=g.web),b),_=(O,j)=>{var D,G;if(S){const X=S==null?void 0:S.methods.find(K=>j===K.name);if(X)return X.rtype==="promise"?K=>t.nativePromise(p,j.toString(),K):(K,W)=>t.nativeCallback(p,j.toString(),K,W);if(O)return(D=O[j])===null||D===void 0?void 0:D.bind(O)}else{if(O)return(G=O[j])===null||G===void 0?void 0:G.bind(O);throw new Th(`"${p}" plugin is not implemented on ${y}`,Ca.Unimplemented)}},k=O=>{let j;const D=(...G)=>{const X=T().then(K=>{const W=_(K,O);if(W){const te=W(...G);return j=te==null?void 0:te.remove,te}else throw new Th(`"${p}.${O}()" is not implemented on ${y}`,Ca.Unimplemented)});return O==="addListener"&&(X.remove=async()=>j()),X};return D.toString=()=>`${O.toString()}() { [capacitor code] }`,Object.defineProperty(D,"name",{value:O,writable:!1,configurable:!1}),D},I=k("addListener"),C=k("removeListener"),$=(O,j)=>{const D=I({eventName:O},j),G=async()=>{const K=await D;C({eventName:O,callbackId:K},j)},X=new Promise(K=>D.then(()=>K({remove:G})));return X.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await G()},X},N=new Proxy({},{get(O,j){switch(j){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return S?$:I;case"removeListener":return C;default:return k(j)}}});return s[p]=N,h.set(p,{name:p,proxy:N,platforms:new Set([...Object.keys(g),...S?[y]:[]])}),N};return t.convertFileSrc||(t.convertFileSrc=p=>p),t.getPlatform=i,t.handleError=d,t.isNativePlatform=n,t.isPluginAvailable=a,t.registerPlugin=m,t.Exception=Th,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},NL=r=>r.Capacitor=RL(r),ja=NL(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Vf=ja.registerPlugin;class Kf{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),s&&this.sendRetainedArgumentsForEvent(e);const a=async()=>this.removeListener(e,t);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const i=this.listeners[e];if(!i){if(s){let n=this.retainedEventArguments[e];n||(n=[]),n.push(t),this.retainedEventArguments[e]=n}return}i.forEach(n=>n(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:s=>{this.notifyListeners(t,s)}}}unimplemented(e="not implemented"){return new ja.Exception(e,Ca.Unimplemented)}unavailable(e="not available"){return new ja.Exception(e,Ca.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const i=s.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(s=>{this.notifyListeners(e,s)}))}}const Ax=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Ix=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class CL extends Kf{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[i,n]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=Ix(i).trim(),n=Ix(n).trim(),t[i]=n}),t}async setCookie(e){try{const t=Ax(e.key),s=Ax(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),a=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${i}; path=${n}; ${a};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Vf("CapacitorCookies",{web:()=>new CL});const jL=async r=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const i=s.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>t(i),s.readAsDataURL(r)}),PL=(r={})=>{const e=Object.keys(r);return Object.keys(r).map(i=>i.toLocaleLowerCase()).reduce((i,n,a)=>(i[n]=r[e[a]],i),{})},DL=(r,e=!0)=>r?Object.entries(r).reduce((s,i)=>{const[n,a]=i;let u,d;return Array.isArray(a)?(d="",a.forEach(h=>{u=e?encodeURIComponent(h):h,d+=`${n}=${u}&`}),d.slice(0,-1)):(u=e?encodeURIComponent(a):a,d=`${n}=${u}`),`${s}&${d}`},"").substr(1):null,OL=(r,e={})=>{const t=Object.assign({method:r.method||"GET",headers:r.headers},e),i=PL(r.headers)["content-type"]||"";if(typeof r.data=="string")t.body=r.data;else if(i.includes("application/x-www-form-urlencoded")){const n=new URLSearchParams;for(const[a,u]of Object.entries(r.data||{}))n.set(a,u);t.body=n.toString()}else if(i.includes("multipart/form-data")||r.data instanceof FormData){const n=new FormData;if(r.data instanceof FormData)r.data.forEach((u,d)=>{n.append(d,u)});else for(const u of Object.keys(r.data))n.append(u,r.data[u]);t.body=n;const a=new Headers(t.headers);a.delete("content-type"),t.headers=a}else(i.includes("application/json")||typeof r.data=="object")&&(t.body=JSON.stringify(r.data));return t};class $L extends Kf{async request(e){const t=OL(e,e.webFetchExtra),s=DL(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,n=await fetch(i,t),a=n.headers.get("content-type")||"";let{responseType:u="text"}=n.ok?e:{};a.includes("application/json")&&(u="json");let d,h;switch(u){case"arraybuffer":case"blob":h=await n.blob(),d=await jL(h);break;case"json":d=await n.json();break;case"document":case"text":default:d=await n.text()}const m={};return n.headers.forEach((p,g)=>{m[g]=p}),{data:d,headers:m,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Vf("CapacitorHttp",{web:()=>new $L});var Lx;(function(r){r.Dark="DARK",r.Light="LIGHT",r.Default="DEFAULT"})(Lx||(Lx={}));var Rx;(function(r){r.StatusBar="StatusBar",r.NavigationBar="NavigationBar"})(Rx||(Rx={}));class ML extends Kf{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}Vf("SystemBars",{web:()=>new ML});let Jr=null;try{Jr=require("@capacitor/push-notifications").PushNotifications}catch{}const Nx="https://api.asknebula.it";class FL{constructor(){Ld(this,"token",null);Ld(this,"isRegistered",!1)}async initialize(){if(ja.isNativePlatform()&&Jr)try{let e=await Jr.checkPermissions();if(e.receive==="prompt"&&(e=await Jr.requestPermissions()),e.receive!=="granted")return;await Jr.register(),Jr.addListener("registration",async t=>{this.token=t.value,await this.registerToken(t.value)}),Jr.addListener("registrationError",t=>{}),Jr.addListener("pushNotificationReceived",t=>{}),Jr.addListener("pushNotificationActionPerformed",t=>{var s;(s=t.notification.data)!=null&&s.url&&(window.location.href=t.notification.data.url)}),this.isRegistered=!0}catch{}}async registerToken(e){const t=Mt.getState().session;if(t)try{await fetch(`${Nx}/me/notification-token`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify({token:e})})}catch{}}async unregisterToken(){if(!this.token)return;const e=Mt.getState().session;if(e)try{await fetch(`${Nx}/me/notification-token`,{method:"DELETE",headers:{Authorization:`Bearer ${e.access_token}`}}),this.token=null,this.isRegistered=!1}catch{}}async toggleNotifications(e){ja.isNativePlatform()&&Jr&&(e?await this.initialize():await this.unregisterToken())}getToken(){return this.token}isNotificationsEnabled(){return this.isRegistered&&this.token!==null}}const _h=new FL,UL="https://api.asknebula.it";function ii(){var G,X;const[r,e]=L.useState(!1),[t,s]=L.useState(!1),[i,n]=L.useState([]),[a,u]=L.useState(!1),[d,h]=L.useState(!1),[m,p]=L.useState(!1),[g,v]=L.useState(!1),[y,S]=L.useState([]),[b,T]=L.useState(0),_=Bt(),k=Ur(),{user:I,session:C}=Mt(),$=_i();L.useEffect(()=>{$&&C&&(_h.initialize(),p(_h.isNotificationsEnabled()))},[$,C]);const N=async()=>{if(!$)return;const K=!m;await _h.toggleNotifications(K),p(K)},O=k.pathname.includes("/title/");L.useEffect(()=>{if(!$)return;const K=()=>{const W=window.scrollY;h(W>100)};return window.addEventListener("scroll",K,{passive:!0}),K(),()=>{window.removeEventListener("scroll",K)}},[$]),L.useEffect(()=>{async function K(){u(!0);try{const W=await fetch(`${UL}/genres`);if(W.ok){const te=await W.json();n(te.genres||[])}}catch{}finally{u(!1)}}K()},[]);const j=()=>{const K=localStorage.getItem("nebula_subscribed_list");if(K){const W=JSON.parse(K);S(W),T(W.length)}else S([]),T(0)};L.useEffect(()=>(j(),window.addEventListener("nebula-notifications-updated",j),()=>window.removeEventListener("nebula-notifications-updated",j)),[]);const D=$?`fixed top-0 left-0 right-0 z-50 transition-all duration-500 ${O?d?"bg-black/80 backdrop-blur-xl shadow-lg border-b border-white/5":"bg-transparent backdrop-blur-none":"bg-black/60 backdrop-blur-lg border-b border-white/5"}`:"fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-xl border-b border-white/5 shadow-lg";return l.jsx("header",{className:D,children:l.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>e(!r),className:"flex items-center gap-1 text-white/90 font-medium text-sm hover:text-[#059669] transition-colors active:scale-95 duration-200",children:[l.jsx("span",{children:"Generi"}),l.jsx("svg",{className:`w-4 h-4 transition-transform duration-300 ${r?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r&&i.length>0&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-40 bg-black/20 backdrop-blur-[2px]",onClick:()=>e(!1)}),l.jsxs("div",{className:"absolute top-full left-0 mt-3 w-[85vw] max-w-sm bg-black/80 backdrop-blur-2xl border border-white/10 rounded-2xl shadow-2xl p-4 z-50 max-h-[70vh] overflow-y-auto animate-fade-in-up",children:[l.jsx("h3",{className:"text-white font-bold mb-4 text-base ml-1",children:"Esplora Generi"}),l.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(K=>{const W=K.type==="both"?"both":K.type;return l.jsx(He,{to:`/genre/${K.id}?name=${encodeURIComponent(K.name)}&type=${W}`,onClick:()=>e(!1),className:"text-left text-white/70 hover:text-[#059669] hover:bg-white/5 transition-all duration-200 text-sm py-2.5 px-3 rounded-xl border border-transparent hover:border-white/5",children:K.name},K.id)})})]})]})]}),l.jsx(He,{to:"/",className:"flex items-center justify-center",children:l.jsx("img",{src:"/nebulanoback.png",alt:"Nebula Streaming",className:"w-10 h-10 object-contain",onError:K=>{var z;const W=K.target;W.style.display="none";const te=document.createElement("div");te.className="w-10 h-10 flex items-center justify-center bg-gradient-to-br from-green-500 to-green-600 rounded-lg",te.innerHTML='<span class="text-white font-black text-xl">N</span>',(z=W.parentElement)==null||z.appendChild(te)}})}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>v(!g),className:`text-white/80 hover:text-white transition-colors relative ${g?"text-[#059669]":""}`,children:[l.jsx("svg",{className:"w-6 h-6",fill:g?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),b>0&&l.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-[#059669] text-black text-[10px] font-bold flex items-center justify-center rounded-full animate-pulse",children:b})]}),g&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>v(!1)}),l.jsxs("div",{className:"absolute top-full right-0 mt-2 w-[320px] bg-black/90 backdrop-blur-2xl border border-white/10 rounded-2xl shadow-2xl p-0 z-50 overflow-hidden animate-fade-in-up max-h-[70vh] flex flex-col",children:[l.jsxs("div",{className:"p-4 border-b border-white/10 flex justify-between items-center bg-white/5",children:[l.jsx("h3",{className:"text-white font-bold text-base",children:"Le tue notifiche"}),l.jsx("button",{onClick:()=>{$&&N()},className:"text-[10px] text-white/50 uppercase tracking-widest hover:text-white",children:$?m?"Push ON":"Push OFF":"Novit"})]}),l.jsx("div",{className:"overflow-y-auto p-2",children:y.length===0?l.jsxs("div",{className:"py-8 text-center text-white/40",children:[l.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),l.jsx("p",{className:"text-sm",children:"Nessuna notifica in arrivo"}),l.jsx(He,{to:"/coming-soon",className:"text-xs text-[#059669] mt-2 inline-block hover:underline",onClick:()=>v(!1),children:'Sfoglia "In Arrivo"'})]}):l.jsx("div",{className:"space-y-2",children:y.map(K=>{const te=new Date(K.release_date)<=new Date;return l.jsxs(He,{to:`/title/${K.id}?type=${K.type}`,onClick:()=>v(!1),className:"flex gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors group relative border border-transparent hover:border-white/10",children:[l.jsx("div",{className:"w-12 h-16 shrink-0 rounded-lg overflow-hidden bg-black/50",children:l.jsx("img",{src:Ze(K.poster||void 0,"small")||void 0,alt:K.title,className:"w-full h-full object-cover"})}),l.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[l.jsx("h4",{className:"text-sm font-bold text-white leading-tight truncate pr-4",children:K.title}),l.jsx("div",{className:"flex items-center gap-2 mt-1",children:te?l.jsx("span",{className:"text-[10px] font-bold text-[#059669] bg-[#059669]/10 px-1.5 py-0.5 rounded",children:"DISPONIBILE"}):l.jsx("span",{className:"text-[10px] font-medium text-white/60",children:K.formatted_date||"Prossimamente"})})]}),l.jsx("button",{onClick:z=>{z.preventDefault(),z.stopPropagation();const M=y.filter(H=>H.id!==K.id);S(M),localStorage.setItem("nebula_subscribed_list",JSON.stringify(M)),T(M.length);const F=JSON.parse(localStorage.getItem("nebula_notifications")||"{}");delete F[K.id],localStorage.setItem("nebula_notifications",JSON.stringify(F)),window.dispatchEvent(new Event("nebula-notifications-updated"))},className:"absolute top-2 right-2 text-white/20 hover:text-white p-1",children:l.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},K.id)})})})]})]})]}),l.jsxs("div",{className:"relative",children:[l.jsx("button",{onClick:()=>s(!t),className:"text-white/80 hover:text-white transition-colors",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),t&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>s(!1)}),l.jsxs("div",{className:"absolute top-full right-0 mt-2 w-[280px] bg-black/80 backdrop-blur-2xl border border-white/10 rounded-xl shadow-2xl p-4 z-50 animate-fade-in-up",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-4 border-b border-white/10",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center flex-shrink-0",children:l.jsx("span",{className:"text-white font-bold text-sm",children:((G=I==null?void 0:I.email)==null?void 0:G.charAt(0).toUpperCase())||"U"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-white font-semibold text-sm truncate",children:((X=I==null?void 0:I.email)==null?void 0:X.split("@")[0])||"Utente"}),l.jsx("p",{className:"text-white/60 text-xs truncate",children:(I==null?void 0:I.email)||""})]})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsxs("button",{onClick:()=>{window.location.reload(),s(!1)},className:"w-full flex items-center gap-3 px-3 py-2.5 text-white/90 hover:bg-white/10 rounded-lg transition-colors text-left",children:[l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),l.jsx("span",{className:"text-sm",children:"Aggiorna contenuti"})]}),l.jsxs("button",{onClick:async()=>{const{supabase:K}=await er(async()=>{const{supabase:W}=await Promise.resolve().then(()=>hv);return{supabase:W}},void 0);await K.auth.signOut(),s(!1),_("/login")},className:"w-full flex items-center gap-3 px-3 py-2.5 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors text-left",children:[l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),l.jsx("span",{className:"text-sm font-medium",children:"Esci"})]})]})]})]})]})]})]})})}function BL(){return l.jsx("a",{href:"https://t.me/OfficialNebulaStreaming",target:"_blank",rel:"noopener noreferrer",className:"mx-4 my-6 block relative overflow-visible",children:l.jsxs("div",{className:"relative overflow-hidden rounded-[20px] bg-[#0A0A0A] border border-white/10 shadow-2xl group transition-transform duration-300 active:scale-[0.98]",children:[l.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 w-32 h-32 bg-[#0088cc] opacity-20 blur-[60px] rounded-full pointer-events-none"}),l.jsxs("div",{className:"relative flex items-center gap-5 p-5 z-10",children:[l.jsx("div",{className:"flex-shrink-0 w-14 h-14 rounded-full bg-gradient-to-br from-[#2AABEE] to-[#229ED9] flex items-center justify-center shadow-lg shadow-blue-500/30 group-active:scale-90 transition-transform duration-300 ring-1 ring-white/10",children:l.jsx("svg",{className:"w-7 h-7 text-white transform -translate-x-0.5 translate-y-0.5 drop-shadow-md",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 11.944 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})})}),l.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center gap-0.5",children:[l.jsx("h3",{className:"text-white font-bold text-[17px] leading-tight tracking-tight",children:"Entra nella nostra Community!"}),l.jsx("p",{className:"text-[#9ca3af] text-[13px] font-medium leading-snug",children:"Seguici su Telegram per news e anteprime."})]}),l.jsx("div",{className:"flex-shrink-0 text-white/30 group-hover:text-white group-hover:translate-x-1 transition-all duration-300",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 5l7 7-7 7"})})})]}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-white/0 via-white/5 to-white/0 opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"})]})})}function Cx({type:r="rows"}){return r==="hero"?l.jsxs("div",{className:"w-full relative aspect-[2/3] md:aspect-video bg-neutral-900 overflow-hidden animate-pulse",children:[l.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black to-transparent"}),l.jsxs("div",{className:"absolute bottom-10 left-4 space-y-4 w-3/4",children:[l.jsx("div",{className:"h-4 bg-neutral-800 rounded w-1/4 mb-2"}),l.jsx("div",{className:"h-8 bg-neutral-800 rounded w-3/4"}),l.jsxs("div",{className:"flex gap-3 mt-4",children:[l.jsx("div",{className:"h-10 w-28 bg-neutral-800 rounded-full"}),l.jsx("div",{className:"h-10 w-28 bg-neutral-800 rounded-full"})]})]})]}):r==="grid"?l.jsx("div",{className:"grid grid-cols-3 gap-3 p-4",children:Array.from({length:12}).map((e,t)=>l.jsx("div",{className:"aspect-[2/3] bg-neutral-900 rounded-md animate-pulse relative overflow-hidden",children:l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-shimmer"})},t))}):l.jsx("div",{className:"space-y-8 py-6",children:Array.from({length:3}).map((e,t)=>l.jsxs("div",{className:"space-y-3",children:[l.jsx("div",{className:"px-4 flex items-center justify-between",children:l.jsx("div",{className:"h-5 bg-neutral-900 rounded w-1/3 animate-pulse"})}),l.jsx("div",{className:"flex gap-3 overflow-hidden px-4",children:Array.from({length:4}).map((s,i)=>l.jsx("div",{className:"flex-shrink-0 w-[110px] sm:w-[140px] aspect-[2/3] bg-neutral-900 rounded-md animate-pulse relative overflow-hidden",children:l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-shimmer"})},i))})]},t))})}const xa="https://api.asknebula.it",zL={trending:"Tendenze della settimana",recent:"Aggiunti di recente",top10:"Top 10","popular-movies":"Film popolari","popular-tv":"Serie TV popolari","top-rated-movies":"Film meglio valutati","top-rated-tv":"Serie TV meglio valutate",action:"Azione",comedy:"Commedia",drama:"Drammatici","sci-fi":"Fantascienza",horror:"Horror",thriller:"Thriller",romance:"Romantici",animation:"Animazione","tv-action":"Serie TV - Azione","tv-comedy":"Serie TV - Commedia","tv-drama":"Serie TV - Drammatiche"};function GL(){const{user:r,session:e}=Mt(),t=Bt(),[s,i]=L.useState({}),[n,a]=L.useState(!0),[u,d]=L.useState([]),[h,m]=L.useState(0),[p,g]=L.useState([]),[v,y]=L.useState(!1),[S,b]=L.useState(!1),[T,_]=L.useState(0),k=L.useRef(null),I=L.useRef(0),C=L.useRef(0),$=L.useRef(null);L.useEffect(()=>{const M=()=>{requestAnimationFrame(()=>_(window.scrollY))};return window.addEventListener("scroll",M,{passive:!0}),()=>window.removeEventListener("scroll",M)},[]),L.useEffect(()=>{async function M(){try{const F=Math.floor(Date.now()/864e5),H=await fetch(`${xa}/home-rows?page=1&variation=${F}`);if(H.ok){const Y=await H.json(),P={};for(const[oe,ie]of Object.entries(Y)){const ne=ie.map(le=>{var _e,Se;return{title:le.title,tmdb_id:le.tmdb_id,type:le.type,year:le.year,poster:le.poster,backdrop:((_e=le.raw)==null?void 0:_e.backdrop_path)||le.backdrop||null,rating:(Se=le.raw)==null?void 0:Se.vote_average,overview:le.overview}});P[oe]=_s(ne)}i(P);const B=P.trending||P["popular-movies"]||P.top10;if(B&&B.length>0){const oe=B.slice(0,10).filter(ie=>ie.backdrop||ie.poster);d(oe),m(0)}}}catch{}finally{a(!1)}}M()},[]);const[N,O]=L.useState([]);L.useEffect(()=>{async function M(){try{const F=await fetch(`${xa}/home-rows?page=1`);if(F.ok){const H=await F.json();let Y=[];H["popular-movies"]&&(Y=[...Y,...H["popular-movies"]]),H.trending&&(Y=[...Y,...H.trending]),Y=Y.sort(()=>.5-Math.random()).slice(0,10),O(_s(Y))}}catch(F){console.error(F)}}M()},[]);const j=L.useCallback(async()=>{if(!e){g([]);return}try{const M={Authorization:`Bearer ${e.access_token}`},F=await fetch(`${xa}/me/progress?limit=50`,{headers:M});if(F.ok){const Y=(await F.json()).filter(oe=>{if(!oe||!oe.position_seconds||oe.position_seconds<10)return!1;if(!oe.duration_seconds||oe.duration_seconds<=0)return!0;const ie=oe.position_seconds/oe.duration_seconds,ne=oe.duration_seconds-oe.position_seconds;return!(ie>=.98&&ne<=10)});Y.sort((oe,ie)=>{const ne=oe.updated_at?new Date(oe.updated_at).getTime():0;return(ie.updated_at?new Date(ie.updated_at).getTime():0)-ne});const P=new Set,B=Y.filter(oe=>P.has(oe.content_id)?!1:(P.add(oe.content_id),!0));g(B)}else g([])}catch{g([])}},[e]);L.useEffect(()=>{j()},[j]),L.useEffect(()=>{if(u.length<=1)return;const M=()=>{m(F=>(F+1)%u.length)};return $.current=setInterval(M,5e3),()=>{$.current&&clearInterval($.current)}},[u.length]);const D=M=>{I.current=M.touches[0].clientX},G=M=>{C.current=M.touches[0].clientX},X=()=>{if(!I.current||!C.current)return;const M=I.current-C.current;Math.abs(M)>50&&(M>0?m(H=>(H+1)%u.length):m(H=>(H-1+u.length)%u.length),$.current&&clearInterval($.current),$.current=setInterval(()=>{m(H=>(H+1)%u.length)},5e3)),I.current=0,C.current=0},K=u[h]||null;L.useEffect(()=>{if(!K||!e)return;(async()=>{try{const F=await fetch(`${xa}/me/favorites/${K.tmdb_id}?type=${K.type}`,{headers:{Authorization:`Bearer ${e.access_token}`}});if(F.ok){const H=await F.json();y(H.is_favorite)}}catch(F){console.error("Error checking favorite",F)}})()},[K,e]);const W=async()=>{if(!(!K||!e||S)){b(!0);try{const M={Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"};v?(await fetch(`${xa}/me/favorites/${K.tmdb_id}?type=${K.type}`,{method:"DELETE",headers:M})).ok&&y(!1):(await fetch(`${xa}/me/favorites`,{method:"POST",headers:M,body:JSON.stringify({tmdb_id:K.tmdb_id,type:K.type,title:K.title,poster:K.poster||K.backdrop})})).ok&&y(!0)}catch(M){console.error("Error toggling favorite",M)}finally{b(!1)}}};L.useEffect(()=>{const M=()=>{j()};return window.addEventListener("progress-updated",M),()=>{window.removeEventListener("progress-updated",M)}},[j]);const te=L.useMemo(()=>Object.keys(s),[s]);if(n)return l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsx(Cx,{type:"hero"}),l.jsx(Cx,{type:"rows"})]});let z=!1;return l.jsxs(Yt,{children:[l.jsx(ii,{}),K&&u.length>0&&l.jsxs("div",{ref:k,className:"relative w-full h-[75vh] mb-6 overflow-hidden",onTouchStart:D,onTouchMove:G,onTouchEnd:X,style:{transformStyle:"preserve-3d"},children:[l.jsx("div",{className:"absolute inset-0 will-change-transform",style:{transform:`translate3d(0, ${T*.3}px, 0)`},children:u.map((M,F)=>l.jsxs("div",{className:`absolute inset-0 bg-cover bg-center transition-opacity duration-1000 ${F===h?"opacity-100 z-10":"opacity-0 z-0"}`,style:{backgroundImage:`url(${Ze(M.backdrop||M.poster||void 0,"original")})`},children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/60 via-transparent to-black"})]},`${M.tmdb_id}-${F}`))}),l.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 flex flex-col items-center text-center z-20 pb-12",children:[l.jsx("h2",{className:"text-6xl font-black text-white mb-3 leading-none tracking-tight drop-shadow-xl font-heading scale-100",style:{textShadow:"0 2px 20px rgba(0,0,0,0.8)"},children:K.title}),l.jsxs("div",{className:"flex items-center gap-3 text-white/90 text-sm font-semibold mb-8",children:[l.jsx("span",{className:"bg-white/10 backdrop-blur-md px-3 py-1 rounded-full text-white border border-white/10 uppercase text-xs tracking-wider",children:K.type==="tv"?"Serie":"Film"}),K.year&&l.jsxs("span",{children:[" ",K.year]}),K.rating&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("svg",{className:"w-4 h-4 text-yellow-400 fill-current",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),K.rating.toFixed(1)]})]}),l.jsxs("div",{className:"flex gap-4 w-full max-w-sm",children:[l.jsxs(He,{to:`/title/${K.tmdb_id}?type=${K.type}`,className:"flex-1 bg-white/10 hover:bg-white/20 backdrop-blur-xl text-white font-bold py-4 rounded-full flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all border border-white/20",children:[l.jsx("svg",{className:"w-6 h-6 fill-current",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})}),l.jsx("span",{className:"text-lg",children:"Scopri"})]}),l.jsx("button",{onClick:W,disabled:S,className:`w-14 h-14 rounded-full backdrop-blur-md border flex items-center justify-center active:scale-95 transition-all
                                    ${v?"bg-[#059669]/20 border-[#059669] text-[#059669]":"bg-white/10 border-white/20 hover:bg-white/20 text-white"}`,children:v?l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})}):l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]})]})]}),r&&p.length>0&&l.jsxs("div",{className:"space-y-4 pl-4 mb-8",children:[l.jsxs("h3",{className:"text-xl font-bold text-white tracking-wide flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-5 bg-[#059669] rounded-full inline-block"}),"Guardati di recente"]}),l.jsx(ei,{category:"continue-watching",items:_s(p.slice(0,10).map(M=>{let F=0;if(M.duration_seconds&&M.duration_seconds>0)F=Math.min(100,M.position_seconds/M.duration_seconds*100);else if(M.position_seconds>0){const B=M.season&&M.episode?2700:5400;F=Math.min(95,M.position_seconds/B*100)}const H=M.season!==null&&M.season!==void 0&&M.season!==-1,Y=parseInt(M.content_id),P=H?`S${M.season} E${M.episode}`:void 0;return{title:M.title||"Contenuto",tmdb_id:isNaN(Y)?0:Y,type:H?"tv":"movie",poster:M.poster||void 0,overview:"",progressPercent:F,episodeInfo:P}}).filter(M=>M.tmdb_id>0)),onCardClick:(M,F)=>{const H=p.find(Y=>{const P=parseInt(Y.content_id);return!isNaN(P)&&P===M.tmdb_id});if(H){const P=H.season!==null&&H.season!==void 0&&H.season!==-1?`/watch/${M.tmdb_id}?type=tv&season=${H.season}&episode=${H.episode}`:`/watch/${M.tmdb_id}?type=movie`;t(P)}else t(`/title/${M.tmdb_id}?type=${M.type}`)}})]}),N.length>0&&l.jsxs("div",{className:"space-y-4 pl-4 mb-8",children:[l.jsxs("div",{className:"flex items-center justify-between pr-4",children:[l.jsxs("h3",{className:"text-xl font-bold text-white tracking-wide flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-5 bg-[#059669] rounded-full inline-block"}),"In arrivo"]}),l.jsxs(He,{to:"/coming-soon",className:"text-xs font-bold text-[#059669] flex items-center gap-1 hover:underline",children:["MOSTRA TUTTO",l.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),l.jsx(ei,{category:"upcoming",items:N})]}),l.jsx("div",{className:`flex flex-col gap-6 pb-24 ${K?"":"pt-20"}`,children:te.map((M,F)=>{const H=!z&&(M==="trending"||M==="top10"||F===1);return H&&(z=!0),l.jsxs("div",{className:"space-y-0",children:[s[M].length>0&&l.jsxs("div",{className:"space-y-4 pl-4 mb-2",children:[l.jsxs("h3",{className:"text-xl font-bold text-white tracking-wide flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-5 bg-[#059669] rounded-full inline-block"}),zL[M]||M]}),l.jsx(ei,{category:M,items:_s(s[M])})]}),H&&l.jsx(BL,{})]},M)})})]})}const or="https://api.asknebula.it";function VL(){var yt,dt,ft,ys,Br,ki,Ai,ci,zr;const{tmdb_id:r}=Pn(),[e]=kr(),t=e.get("type")||"movie",{session:s,plan:i}=Mt(),[n,a]=L.useState(null),[u,d]=L.useState(!0),[h,m]=L.useState(null),[p,g]=L.useState(1),[v,y]=L.useState(null),[S,b]=L.useState(!1),[T,_]=L.useState(null),[k,I]=L.useState(!1),[C,$]=L.useState(!1),[N,O]=L.useState(!1),[j,D]=L.useState(!1),[G,X]=L.useState(!1),[K,W]=L.useState(!1),[te,z]=L.useState(!1),[M,F]=L.useState([]),[H,Y]=L.useState([]),[P,B]=L.useState(null),[oe,ie]=L.useState(!1),[ne,le]=L.useState("video"),[_e,Se]=L.useState(null),Fe=Bt(),Ee=_i(),at=L.useRef(null),de=L.useRef(null),gt=L.useRef(null),[Ct,as]=L.useState(0);L.useEffect(()=>{const re=()=>{requestAnimationFrame(()=>as(window.scrollY))};return window.addEventListener("scroll",re,{passive:!0}),()=>window.removeEventListener("scroll",re)},[]),L.useEffect(()=>{window.scrollTo(0,0)},[r,t]),L.useEffect(()=>{async function re(){var ve;if(!r){m("TMDB ID mancante"),d(!1);return}try{const ze=parseInt(r);if(isNaN(ze))throw new Error("TMDB ID non valido");const Le=await fetch(`${or}/title/${ze}?type=${t}`);if(!Le.ok){if(Le.status===404)throw new Error(`Titolo non trovato. L'ID ${ze} potrebbe non esistere pi su TMDB.`);const wt=await Le.text().catch(()=>""),ss=wt?JSON.parse(wt).detail||wt:`Errore ${Le.status}`;throw new Error(`Errore ${Le.status}: ${ss}`)}const mt=await Le.json();if(!mt||!mt.raw)throw new Error("Dati del titolo non validi dal server");if(a(mt),(ve=mt.raw.credits)!=null&&ve.cast&&F(Ee?mt.raw.credits.cast:mt.raw.credits.cast.slice(0,10)),mt.raw.type==="tv"&&mt.raw.seasons&&mt.raw.seasons.length>0){const wt=mt.raw.seasons.find(ss=>ss.season_number===1)||mt.raw.seasons[0];g(wt.season_number),Ge(wt.season_number,ze)}s&&(Ne(ze.toString()),nt(ze),it(ze),zt(ze))}catch(ze){m(ze.message??"Errore nel caricamento del titolo.")}finally{d(!1)}}re()},[r,t,s]),L.useEffect(()=>{async function re(){if(!(!(n!=null&&n.raw)||!r))try{const ve=await fetch(`${or}/title/${r}/similar?type=${t}`);if(ve.ok){const ze=await ve.json();Y(ze.slice(0,15))}}catch{}}re()},[n,r,t]),L.useEffect(()=>{var re;if(at.current&&((re=n==null?void 0:n.raw)!=null&&re.seasons)){const ze=n.raw.seasons.filter(Le=>Le.season_number>0).findIndex(Le=>Le.season_number===p);if(ze>=0){const Le=at.current.children[ze];Le&&Le.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}}},[p,(yt=n==null?void 0:n.raw)==null?void 0:yt.seasons]);const ke=re=>{de.current=re.touches[0].clientX,gt.current=re.touches[0].clientY},be=re=>{if(de.current===null||gt.current===null||!at.current)return;const ve=re.touches[0],ze=ve.clientX-de.current,Le=ve.clientY-gt.current,mt=Math.abs(ze),wt=Math.abs(Le);mt>wt&&mt>10&&re.preventDefault()},pe=()=>{de.current=null,gt.current=null};async function Ge(re,ve){b(!0);try{const ze=await fetch(`${or}/tv/${ve}/season/${re}`);if(ze.ok){const Le=await ze.json();y(Le)}}catch{}finally{b(!1)}}async function Ne(re){if(s)try{const ve={Authorization:`Bearer ${s.access_token}`},ze=await fetch(`${or}/me/progress/${re}`,{headers:ve});if(ze.ok){const Le=await ze.json();Le&&_(Le)}}catch{}}async function nt(re){if(s)try{const ve={Authorization:`Bearer ${s.access_token}`},ze=await fetch(`${or}/me/favorites/${re}?type=${t}`,{headers:ve});if(ze.ok){const Le=await ze.json();I(Le.is_favorite)}}catch{}}async function it(re){if(s)try{const ve={Authorization:`Bearer ${s.access_token}`},ze=await fetch(`${or}/me/watchlist/${re}?type=${t}`,{headers:ve});if(ze.ok){const Le=await ze.json();$(Le.is_in_watchlist)}}catch{}}async function zt(re){if(s)try{const ve={Authorization:`Bearer ${s.access_token}`},ze=await fetch(`${or}/me/progress/${re}`,{headers:ve});if(ze.ok){const Le=await ze.json();if(Le&&Le.position_seconds&&Le.duration_seconds){const mt=Le.position_seconds/Le.duration_seconds*100;O(mt>=90)}}}catch{}}async function ht(){if(!(!s||!(n!=null&&n.raw)||j)){D(!0),B(null);try{const re={Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"};if(k)(await fetch(`${or}/me/favorites/${r}?type=${t}`,{method:"DELETE",headers:re})).ok&&I(!1);else{const ve=n.raw,ze=(ve==null?void 0:ve.poster)||(ve==null?void 0:ve.poster_path)||null,Le={tmdb_id:parseInt(r),type:t,title:(ve==null?void 0:ve.title)||(ve==null?void 0:ve.name)||"Titolo sconosciuto",poster:ze},mt=await fetch(`${or}/me/favorites`,{method:"POST",headers:re,body:JSON.stringify(Le)});mt.ok?I(!0):mt.status===403&&ie(!0)}}catch(re){B(re.message||"Errore durante l'operazione")}finally{D(!1)}}}async function ts(){if(!(!s||!(n!=null&&n.raw)||G)){X(!0);try{const re={Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"};if(C)(await fetch(`${or}/me/watchlist/${r}?type=${t}`,{method:"DELETE",headers:re})).ok&&$(!1);else{const ve=n.raw,ze=(ve==null?void 0:ve.poster)||(ve==null?void 0:ve.poster_path)||null,Le={tmdb_id:parseInt(r),type:t,title:(ve==null?void 0:ve.title)||(ve==null?void 0:ve.name)||"Titolo sconosciuto",poster:ze};(await fetch(`${or}/me/watchlist`,{method:"POST",headers:re,body:JSON.stringify(Le)})).ok&&$(!0)}}catch{}finally{X(!1)}}}async function ks(){if(!(!s||!(n!=null&&n.raw)||K)){W(!0);try{const re=n.raw,ve=(re==null?void 0:re.type)==="tv",ze={Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"};if(N)try{const Le=await fetch(`${or}/me/progress/${r}?type=${t}`,{method:"DELETE",headers:ze});O(!1)}catch{O(!1)}else{const Le=n.raw,mt=(Le==null?void 0:Le.poster)||(Le==null?void 0:Le.poster_path)||null,wt={content_id:r,position_seconds:90,duration_seconds:100,title:(Le==null?void 0:Le.title)||(Le==null?void 0:Le.name)||"Titolo sconosciuto",poster:mt?Ze(mt):null};if(ve&&v&&v.episodes.length>0){const Gr=v.episodes[v.episodes.length-1];wt.season=p,wt.episode=Gr.episode_number}(await fetch(`${or}/me/progress`,{method:"POST",headers:ze,body:JSON.stringify(wt)})).ok&&O(!0)}}catch{}finally{W(!1)}}}async function zs(){if(!(n!=null&&n.raw)||!Ee)return;const re=n.raw,ve=(re==null?void 0:re.title)||(re==null?void 0:re.name)||"Titolo",ze=`https://asknebula.it/film/${r}`;try{navigator.share?await navigator.share({title:`Dai un'occhiata a ${ve}!`,text:`Dai un'occhiata a ${ve}! Lo trovi su Nebula Streaming.`,url:ze}):(await navigator.clipboard.writeText(ze),alert("Link copiato!"))}catch(Le){Le.name!=="AbortError"&&console.error("Errore nella condivisione:",Le)}}function vs(re,ve){const ze=n==null?void 0:n.raw,Le=(ze==null?void 0:ze.type)==="tv";Fe(Le&&re&&ve?`/watch/${r}?type=tv&season=${re}&episode=${ve}`:Le&&v?`/watch/${r}?type=tv&season=${p}&episode=1`:`/watch/${r}?type=${t}`)}if(u)return l.jsx(Yt,{children:l.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})})});if(h||!n||!n.raw)return l.jsx(Yt,{children:l.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Contenuto non disponibile"}),l.jsx("p",{className:"text-white/80 mb-6",children:h??"Il contenuto richiesto non  stato trovato."}),l.jsx("button",{onClick:()=>Fe("/"),className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-xl",children:"Torna alla Home"})]})})});const Te=n.raw,ds=(Te==null?void 0:Te.type)==="tv";Ze((Te==null?void 0:Te.poster)||(Te==null?void 0:Te.poster_path));const Gt=Ze((Te==null?void 0:Te.backdrop_path)||(Te==null?void 0:Te.backdrop),"original"),Ws=(Te==null?void 0:Te.runtime)||((dt=Te==null?void 0:Te.episode_run_time)==null?void 0:dt[0])||null,sr=Ws?`${Ws}min`:null,oi=Te!=null&&Te.vote_average?Te.vote_average.toFixed(1):null,li=((ft=Te==null?void 0:Te.release_date)==null?void 0:ft.split("-")[0])||((ys=Te==null?void 0:Te.first_air_date)==null?void 0:ys.split("-")[0])||null,fe=((Br=Te==null?void 0:Te.genres)==null?void 0:Br.map(re=>re.name||re))||[],Oe=(Te==null?void 0:Te.overview)??(Te==null?void 0:Te.plot)??(Te==null?void 0:Te.description)??"",We=((ki=Te==null?void 0:Te.videos)==null?void 0:ki.results)||[],Qe=We.find(re=>re.type==="Trailer"&&re.site==="YouTube"),vt=Qe==null?void 0:Qe.key;return l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsx("button",{onClick:()=>Fe(-1),className:`fixed ${Ee?"top-12":"top-16"} left-4 z-40 w-12 h-12 rounded-full flex items-center justify-center text-white transition-all duration-300 active:scale-90 ${Ct>100?"bg-black/60 backdrop-blur-md shadow-lg border border-white/10":"bg-black/30 backdrop-blur-sm"}`,children:l.jsx("svg",{className:"w-6 h-6 drop-shadow-md",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M15 19l-7-7 7-7"})})}),l.jsxs("div",{className:`relative w-full h-[85vh] overflow-hidden ${Ee?"":"mt-14"}`,style:{transformStyle:"preserve-3d"},children:[Gt&&l.jsxs("div",{className:"absolute inset-0 will-change-transform",style:{transform:`translate3d(0, ${Ct*.4}px, 0) scale(1.1)`},children:[l.jsx("img",{src:Gt,alt:(Te==null?void 0:Te.title)||(Te==null?void 0:Te.name),className:"w-full h-full object-cover"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-black/30"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black"})]}),l.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 z-20 pb-10",children:[l.jsx("div",{className:"flex flex-col gap-3 mb-8",children:l.jsxs("div",{className:"w-full",children:[l.jsx("h1",{className:"text-6xl font-black text-white mb-4 leading-[0.9] tracking-tighter drop-shadow-2xl font-heading",style:{textShadow:"0 4px 30px rgba(0,0,0,0.9)"},children:(Te==null?void 0:Te.title)||(Te==null?void 0:Te.name)}),l.jsxs("div",{className:"flex items-center gap-4 text-white/95 text-base font-semibold mt-4",children:[l.jsxs("div",{className:"flex items-center gap-1.5 bg-black/40 backdrop-blur-md px-3 py-1 rounded-full border border-white/10",children:[l.jsx("svg",{className:"w-4 h-4 text-yellow-500 fill-current drop-shadow-sm",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),l.jsx("span",{className:"tracking-wide",children:oi})]}),l.jsx("span",{className:"text-white/40",children:""}),l.jsx("span",{className:"tracking-wide",children:li}),sr&&l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-white/40",children:""}),l.jsx("span",{className:"tracking-wide",children:sr})]})]}),fe.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2.5 mt-5",children:fe.slice(0,3).map((re,ve)=>l.jsx("span",{className:"px-4 py-1.5 bg-white/10 backdrop-blur-xl text-white font-medium text-xs uppercase tracking-wider rounded-full border border-white/20 shadow-sm",children:re},ve))})]})}),l.jsxs("button",{onClick:()=>vs(),className:"w-full bg-[#059669] hover:bg-[#00E676] text-white font-bold py-5 rounded-full flex items-center justify-center gap-3 shadow-lg shadow-green-900/40 active:scale-[0.98] transition-all duration-300 mb-8 overflow-hidden relative group",children:[l.jsx("div",{className:"absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-500 ease-out blur-xl"}),l.jsx("svg",{className:"w-8 h-8 fill-current relative z-10",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})}),l.jsx("span",{className:"text-xl tracking-wide relative z-10",children:"Riproduci"})]}),l.jsxs("div",{className:"flex justify-between items-start px-2",children:[l.jsxs("button",{onClick:()=>{vt&&window.open(`https://www.youtube.com/watch?v=${vt}`,"_blank")},className:"flex flex-col items-center gap-2 text-white hover:text-white transition-colors group active:scale-95 duration-200",children:[l.jsx("div",{className:"w-14 h-14 rounded-full border border-white/20 bg-black/40 backdrop-blur-md flex items-center justify-center shadow-lg group-hover:bg-white/10 transition-all",children:l.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),l.jsx("span",{className:"text-xs font-medium tracking-wide opacity-80",children:"Trailer"})]}),l.jsxs("button",{onClick:ts,disabled:G,className:"flex flex-col items-center gap-2 text-white hover:text-white transition-colors group active:scale-95 duration-200",children:[l.jsx("div",{className:`w-14 h-14 rounded-full border flex items-center justify-center shadow-lg transition-all ${C?"border-[#059669] text-[#059669] bg-[#059669]/10 backdrop-blur-md":"border-white/20 bg-black/40 backdrop-blur-md hover:bg-white/10"}`,children:l.jsx("svg",{className:"w-6 h-6",fill:C?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:C?0:1.5,d:"M12 4v16m8-8H4"})})}),l.jsx("span",{className:`text-xs font-medium tracking-wide ${C?"text-[#059669]":"opacity-80"}`,children:"Watchlist"})]}),l.jsxs("button",{onClick:ht,disabled:j,className:"flex flex-col items-center gap-2 text-white hover:text-white transition-colors group active:scale-95 duration-200",children:[l.jsx("div",{className:`w-14 h-14 rounded-full border flex items-center justify-center shadow-lg transition-all ${k?"border-[#059669] text-[#059669] bg-[#059669]/10 backdrop-blur-md":"border-white/20 bg-black/40 backdrop-blur-md hover:bg-white/10"}`,children:l.jsx("svg",{className:"w-6 h-6",fill:k?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:k?0:1.5,d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"})})}),l.jsx("span",{className:`text-xs font-medium tracking-wide ${k?"text-[#059669]":"opacity-80"}`,children:"Mi piace"})]}),l.jsxs("button",{onClick:ks,disabled:K,className:"flex flex-col items-center gap-2 text-white hover:text-white transition-colors group active:scale-95 duration-200",children:[l.jsx("div",{className:`w-14 h-14 rounded-full border flex items-center justify-center shadow-lg transition-all ${N?"border-[#059669] text-[#059669] bg-[#059669]/10 backdrop-blur-md":"border-white/20 bg-black/40 backdrop-blur-md hover:bg-white/10"}`,children:l.jsxs("svg",{className:"w-6 h-6",fill:N?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:N?0:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:N?0:1.5,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),l.jsx("span",{className:`text-xs font-medium tracking-wide ${N?"text-[#059669]":"opacity-80"}`,children:"Guardato"})]}),l.jsxs("button",{onClick:zs,className:"flex flex-col items-center gap-2 text-white hover:text-white transition-colors group active:scale-95 duration-200",children:[l.jsx("div",{className:"w-14 h-14 rounded-full border border-white/20 bg-black/40 backdrop-blur-md flex items-center justify-center shadow-lg group-hover:bg-white/10 transition-all",children:l.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),l.jsx("span",{className:"text-xs font-medium tracking-wide opacity-80",children:"Condividi"})]})]}),P&&!oe&&l.jsx("div",{className:"mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg",children:l.jsx("p",{className:"text-red-400 text-xs text-center",children:P})})]})]}),Oe&&l.jsxs("div",{className:"px-6 py-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-3",children:"Trama"}),l.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:Oe.length>192?`${Oe.substring(0,189)}...`:Oe})]}),M.length>0&&l.jsxs("div",{className:"px-6 py-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-lg font-bold text-white",children:"Cast"}),Ee&&l.jsx("button",{onClick:()=>Fe(`/title/${r}/characters?type=${t}`),className:"text-green-400 text-sm font-medium",children:"Mostra tutti "})]}),Ee?l.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-2 scroll-smooth",children:(zr=(ci=(Ai=n==null?void 0:n.raw)==null?void 0:Ai.credits)==null?void 0:ci.cast)==null?void 0:zr.map(re=>l.jsxs("div",{className:"flex-shrink-0 text-center",children:[l.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden mb-2 border-2 border-white/20",children:re.profile_path?l.jsx("img",{src:Ze(re.profile_path)||"",alt:re.name,className:"w-full h-full object-cover"}):l.jsx("div",{className:"w-full h-full bg-white/10 flex items-center justify-center",children:l.jsx("span",{className:"text-white/50 text-xs",children:"?"})})}),l.jsx("p",{className:"text-white text-xs font-medium mb-0.5",children:re.name}),l.jsx("p",{className:"text-white/60 text-[10px]",children:re.character})]},re.id))}):l.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-2",children:M.map(re=>l.jsxs("div",{className:"flex-shrink-0 text-center",children:[l.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden mb-2 border-2 border-white/20",children:re.profile_path?l.jsx("img",{src:Ze(re.profile_path)||"",alt:re.name,className:"w-full h-full object-cover"}):l.jsx("div",{className:"w-full h-full bg-white/10 flex items-center justify-center",children:l.jsx("span",{className:"text-white/50 text-xs",children:"?"})})}),l.jsx("p",{className:"text-white text-xs font-medium mb-0.5",children:re.name}),l.jsx("p",{className:"text-white/60 text-[10px]",children:re.character})]},re.id))})]}),ds&&l.jsxs("div",{className:"px-6 py-4",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Episodi"}),(Te==null?void 0:Te.seasons)&&Te.seasons.length>0&&l.jsx("div",{className:"relative mb-4",children:l.jsx("div",{ref:at,className:"flex gap-2 overflow-x-auto no-scrollbar pb-2",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",overscrollBehaviorY:"none",touchAction:"pan-x pinch-zoom",willChange:"scroll-position",scrollBehavior:"auto",transform:"translateZ(0)",WebkitBackfaceVisibility:"hidden",backfaceVisibility:"hidden"},onTouchStart:ke,onTouchMove:be,onTouchEnd:pe,children:Te.seasons.filter(re=>re.season_number>0).map((re,ve)=>l.jsx("button",{onClick:()=>{g(re.season_number),Ge(re.season_number,parseInt(r))},className:`px-5 py-2.5 rounded-full text-sm font-semibold transition-all whitespace-nowrap flex-shrink-0 border ${p===re.season_number?"bg-[#059669] text-white border-[#059669] shadow-lg shadow-green-500/20":"bg-white/5 text-white/70 border-white/10 hover:bg-white/10"}`,style:{transform:"translateZ(0)",willChange:"transform"},children:re.name||`Stagione ${re.season_number}`},re.season_number))})}),S?l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"})}):v&&v.episodes.length>0?l.jsx("div",{className:"space-y-3",children:v.episodes.map(re=>{const ve=(T==null?void 0:T.season)===p&&(T==null?void 0:T.episode)===re.episode_number?T:null;return l.jsxs("div",{className:"flex gap-3 bg-white/5 rounded-lg p-3 active:bg-white/10 transition-colors",onClick:()=>vs(p,re.episode_number),children:[l.jsx("div",{className:"w-32 h-20 rounded-lg overflow-hidden flex-shrink-0",children:re.still_path?l.jsx("img",{src:Ze(re.still_path)||"",alt:re.name,className:"w-full h-full object-cover"}):l.jsx("div",{className:"w-full h-full bg-white/10 flex items-center justify-center",children:l.jsx("span",{className:"text-white/30 text-xs",children:re.episode_number})})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[l.jsxs("h4",{className:"text-white font-semibold text-sm flex-1",children:[re.episode_number,". ",re.name]}),re.vote_average&&l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),l.jsx("span",{className:"text-white/80 text-xs",children:re.vote_average.toFixed(1)})]})]}),re.overview&&l.jsx("p",{className:"text-white/60 text-xs line-clamp-2 mb-2",children:re.overview}),ve&&l.jsx("div",{className:"h-1 bg-white/20 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-green-500",style:{width:ve.duration_seconds?`${ve.position_seconds/ve.duration_seconds*100}%`:"0%"}})})]}),l.jsx("button",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-green-600 flex items-center justify-center active:scale-95 transition-transform",children:l.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})})})]},re.id)})}):null]}),l.jsx("div",{className:"px-6 py-4",children:l.jsxs("button",{onClick:()=>{Ee?Fe(`/title/${r}/details?type=${t}`):z(!te)},className:"w-full bg-white/5 border border-white/10 rounded-xl py-3 flex items-center justify-center gap-2 text-white/80 hover:text-white transition-colors",children:[l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),l.jsx("span",{className:"font-medium",children:"Maggiori informazioni"}),l.jsx("svg",{className:`w-5 h-5 transition-transform ${te&&!Ee?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),te&&!Ee&&(n==null?void 0:n.raw)&&(()=>{var ve,ze,Le,mt,wt,ss,Gr,on;const re=n.raw;return l.jsxs("div",{className:"px-6 pb-4 space-y-6",children:[((Le=(ze=(ve=re==null?void 0:re.watch_providers)==null?void 0:ve.results)==null?void 0:ze.IT)==null?void 0:Le.rent)&&re.watch_providers.results.IT.rent.length>0&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Dove guardarlo"}),l.jsx("div",{className:"space-y-3",children:re.watch_providers.results.IT.rent.map(et=>l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-white/10 flex items-center justify-center flex-shrink-0",children:et.logo_path?l.jsx("img",{src:Ze(et.logo_path)||"",alt:et.provider_name,className:"w-full h-full object-contain"}):l.jsx("span",{className:"text-white/50 text-xs",children:"?"})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"text-white font-semibold",children:et.provider_name}),l.jsx("p",{className:"text-green-400 text-sm",children:"Noleggia"})]})]},et.provider_id))})]}),((mt=re==null?void 0:re.credits)==null?void 0:mt.crew)&&(()=>{const et=re.credits.crew.find(Vr=>Vr.job==="Director");return et?l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Regista"}),l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex items-center gap-4",children:[et.profile_path?l.jsx("img",{src:Ze(et.profile_path)||"",alt:et.name,className:"w-16 h-16 rounded-full object-cover"}):l.jsx("div",{className:"w-16 h-16 rounded-full bg-white/10 flex items-center justify-center",children:l.jsx("span",{className:"text-white/50 text-xs",children:"?"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-semibold",children:et.name}),l.jsx("p",{className:"text-white/60 text-sm",children:"Director"})]})]})]}):null})(),((re==null?void 0:re.budget)||(re==null?void 0:re.revenue))&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Dati finanziari"}),l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex justify-between",children:[re.budget>0&&l.jsxs("div",{children:[l.jsxs("p",{className:"text-white font-semibold text-lg",children:["$",re.budget.toLocaleString()]}),l.jsx("p",{className:"text-white/60 text-sm",children:"Budget"})]}),re.revenue>0&&l.jsxs("div",{className:"text-right",children:[l.jsxs("p",{className:"text-white font-semibold text-lg",children:["$",re.revenue.toLocaleString()]}),l.jsx("p",{className:"text-white/60 text-sm",children:"Incassi"})]})]})]}),(re==null?void 0:re.production_companies)&&re.production_companies.length>0&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Studi di produzione"}),l.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar",children:re.production_companies.slice(0,3).map(et=>l.jsx("div",{className:"bg-white/5 rounded-xl p-4 flex-shrink-0 min-w-[120px]",children:et.logo_path?l.jsx("img",{src:Ze(et.logo_path)||"",alt:et.name,className:"h-12 object-contain"}):l.jsx("p",{className:"text-white/80 text-xs text-center",children:et.name})},et.id))})]}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Media"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:()=>le("video"),className:`px-5 py-2.5 rounded-full text-sm font-medium transition-colors border ${ne==="video"?"bg-[#059669] text-white border-[#059669]":"bg-white/5 text-white/70 border-white/10"}`,children:"Video"}),l.jsx("button",{onClick:()=>le("poster"),className:`px-5 py-2.5 rounded-full text-sm font-medium transition-colors border ${ne==="poster"?"bg-[#059669] text-white border-[#059669]":"bg-white/5 text-white/70 border-white/10"}`,children:"Poster"}),l.jsx("button",{onClick:()=>le("sfondi"),className:`px-5 py-2.5 rounded-full text-sm font-medium transition-colors border ${ne==="sfondi"?"bg-[#059669] text-white border-[#059669]":"bg-white/5 text-white/70 border-white/10"}`,children:"Sfondi"})]}),ne==="video"&&We.length>0&&l.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-2 scroll-smooth",children:We.filter(et=>et.site==="YouTube").slice(0,Ee?void 0:10).map(et=>l.jsxs("div",{className:"flex-shrink-0 w-full max-w-md",children:[Ee&&_e===et.key?l.jsxs("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[l.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${et.key}?autoplay=1&rel=0&modestbranding=1`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:et.name}),l.jsx("button",{onClick:()=>Se(null),className:"absolute top-2 right-2 w-8 h-8 bg-black/70 rounded-full flex items-center justify-center text-white",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):l.jsxs("div",{className:"relative aspect-video bg-white/5 rounded-lg overflow-hidden cursor-pointer",onClick:()=>{Ee?Se(et.key):window.open(`https://www.youtube.com/watch?v=${et.key}`,"_blank")},children:[l.jsx("img",{src:`https://img.youtube.com/vi/${et.key}/maxresdefault.jpg`,alt:et.name,className:"w-full h-full object-cover"}),l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:l.jsx("div",{className:"w-12 h-12 rounded-full bg-white/90 flex items-center justify-center",children:l.jsx("svg",{className:"w-6 h-6 text-black ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M8 5v14l11-7z"})})})})]}),l.jsx("p",{className:"text-white/80 text-xs mt-2 line-clamp-2",children:et.name})]},et.id))}),ne==="poster"&&(re==null?void 0:re.poster_path)&&l.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{path:re.poster_path,name:"Poster principale"},...(((ss=(wt=re.images)==null?void 0:wt.posters)==null?void 0:ss.slice(0,2))||[]).map(et=>({path:et.file_path,name:"Poster alternativo"}))].slice(0,3).map((et,Vr)=>l.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden",children:l.jsx("img",{src:Ze(et.path)||"",alt:et.name,className:"w-full h-full object-cover"})},Vr))}),ne==="sfondi"&&l.jsx("div",{className:"grid grid-cols-1 gap-3",children:[{path:(re==null?void 0:re.backdrop_path)||(re==null?void 0:re.backdrop),name:"Sfondo principale"},...(((on=(Gr=re==null?void 0:re.images)==null?void 0:Gr.backdrops)==null?void 0:on.slice(0,2))||[]).map(et=>({path:et.file_path,name:"Sfondo alternativo"}))].filter(et=>et.path).slice(0,3).map((et,Vr)=>l.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:l.jsx("img",{src:Ze(et.path,"original")||"",alt:et.name,className:"w-full h-full object-cover"})},Vr))})]})]}),Ee&&l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex items-center gap-4",children:[l.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.84-.179-.84-.66 0-.359.24-.66.54-.779 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.24 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"})}),l.jsx("div",{className:"flex-1",children:l.jsx("p",{className:"text-white text-sm",children:"Trova la colonna sonora ufficiale su Spotify."})}),l.jsx("button",{onClick:()=>{const et=(re==null?void 0:re.title)||(re==null?void 0:re.name)||"",xr=`https://open.spotify.com/search/${encodeURIComponent(`${et} soundtrack`)}`;window.open(xr,"_blank")},className:"px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-medium active:bg-green-600 transition-colors",children:"Apri"})]})]})})(),H.length>0&&l.jsxs("div",{className:"px-6 py-4",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Correlati"}),l.jsx(ei,{category:"related",items:H.map(re=>({title:re.title,tmdb_id:re.tmdb_id,type:re.type,poster:re.poster,overview:re.overview||""}))})]}),l.jsx("div",{className:"h-20"})," ",Ee&&l.jsx("div",{className:"pb-8 text-center",children:l.jsx("span",{className:"text-[10px] text-white/20",children:"v1.4 (User Logic)"})}),l.jsx(vf,{isOpen:oe,onClose:()=>ie(!1),currentPlan:(i==null?void 0:i.plan)||"free"})]})}const kh="https://api.asknebula.it";function KL(){const{session:r}=Mt();_i();const[e,t]=L.useState("watchlist"),[s,i]=L.useState([]),[n,a]=L.useState([]),[u,d]=L.useState([]),[h,m]=L.useState(!0);if(L.useEffect(()=>{if(!r){m(!1);return}async function _(){try{const k={Authorization:`Bearer ${r.access_token}`},I=await fetch(`${kh}/me/favorites?limit=100`,{headers:k});if(I.ok){const N=await I.json();i(N)}const C=await fetch(`${kh}/me/watchlist?limit=100`,{headers:k});if(C.ok){const N=await C.json();a(N)}const $=await fetch(`${kh}/me/progress?limit=100`,{headers:k});if($.ok){const O=(await $.json()).filter(j=>!j.position_seconds||j.position_seconds<10||!j.duration_seconds||j.duration_seconds<=0?!1:j.position_seconds/j.duration_seconds>=.9);d(O)}}catch{}finally{m(!1)}}_()},[r]),!r)return l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsxs("div",{className:"min-h-screen bg-black flex flex-col items-center justify-center px-4 mt-14",children:[l.jsx("svg",{className:"w-16 h-16 text-white/30 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),l.jsx("h2",{className:"text-xl font-bold text-white mb-2 text-center",children:"Accedi per vedere le tue liste"}),l.jsx("p",{className:"text-white/60 text-center mb-6",children:"Accedi al tuo account per gestire le tue liste personali"}),l.jsx(He,{to:"/login",className:"px-6 py-3 bg-green-500 text-white rounded-lg font-semibold active:bg-green-600 transition-colors",children:"Accedi"})]})]});const[p,g]=L.useState("all"),[v,y]=L.useState(!1),S=_=>p==="all"?_:_.filter(k=>k.type===p),b=e==="watchlist"?n:e==="favorites"?s:u.map(_=>{const k=parseInt(_.content_id);return{tmdb_id:isNaN(k)?0:k,type:_.season!==null&&_.season!==void 0&&_.season!==-1?"tv":"movie",title:_.title||"Contenuto",poster:_.poster,year:void 0}}).filter(_=>_.tmdb_id>0),T=S(b);return l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsxs("div",{className:"min-h-screen bg-black px-4 py-6 mt-14",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h1",{className:"text-2xl font-bold text-white",children:"Le mie liste"}),l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>y(!v),className:"flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-lg text-sm font-medium text-white border border-white/10",children:[p==="all"?"Tutti":p==="movie"?"Film":"Serie TV",l.jsx("svg",{className:`w-4 h-4 transition-transform ${v?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>y(!1)}),l.jsxs("div",{className:"absolute right-0 top-full mt-2 w-32 bg-[#1a1a1a] border border-white/10 rounded-xl shadow-xl z-20 overflow-hidden animate-fade-in-up",children:[l.jsx("button",{onClick:()=>{g("all"),y(!1)},className:`w-full text-left px-4 py-3 text-sm hover:bg-white/10 ${p==="all"?"text-[#059669]":"text-white"}`,children:"Tutti"}),l.jsx("button",{onClick:()=>{g("movie"),y(!1)},className:`w-full text-left px-4 py-3 text-sm hover:bg-white/10 ${p==="movie"?"text-[#059669]":"text-white"}`,children:"Film"}),l.jsx("button",{onClick:()=>{g("tv"),y(!1)},className:`w-full text-left px-4 py-3 text-sm hover:bg-white/10 ${p==="tv"?"text-[#059669]":"text-white"}`,children:"Serie TV"})]})]})]})]}),l.jsxs("div",{className:"flex gap-2 mb-6 border-b border-white/10",children:[l.jsx("button",{onClick:()=>t("watchlist"),className:`px-4 py-2 text-sm font-medium transition-colors ${e==="watchlist"?"text-green-400 border-b-2 border-green-400":"text-white/60"}`,children:"Watchlist"}),l.jsx("button",{onClick:()=>t("favorites"),className:`px-4 py-2 text-sm font-medium transition-colors ${e==="favorites"?"text-green-400 border-b-2 border-green-400":"text-white/60"}`,children:"Preferiti"}),l.jsx("button",{onClick:()=>t("watched"),className:`px-4 py-2 text-sm font-medium transition-colors ${e==="watched"?"text-green-400 border-b-2 border-green-400":"text-white/60"}`,children:"Visti"})]}),h?l.jsx("div",{className:"flex items-center justify-center py-20",children:l.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-green-500"})}):T.length===0?l.jsxs("div",{className:"text-center py-20",children:[l.jsx("svg",{className:"w-16 h-16 text-white/30 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),l.jsx("p",{className:"text-white/60 text-lg mb-2",children:"Nessun contenuto in questa lista"}),l.jsxs("p",{className:"text-white/40 text-sm",children:[e==="watchlist"&&"Aggiungi contenuti alla watchlist per vederli qui",e==="favorites"&&"Aggiungi contenuti ai preferiti per vederli qui",e==="watched"&&"I contenuti che hai guardato appariranno qui"]})]}):l.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:T.map(_=>l.jsxs(He,{to:`/title/${_.tmdb_id}?type=${_.type}`,className:"group",children:[l.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-white/5 mb-2",children:_.poster?l.jsx("img",{src:Ze(_.poster||void 0),alt:_.title,className:"w-full h-full object-cover group-active:scale-95 transition-transform",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center",children:l.jsx("svg",{className:"w-12 h-12 text-white/20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),l.jsx("h3",{className:"text-white font-semibold text-sm line-clamp-2 mb-1",children:_.title}),_.year&&l.jsx("p",{className:"text-white/60 text-xs",children:_.year})]},`${_.tmdb_id}-${_.type}`))})]})]})}const WL="https://api.asknebula.it";function HL(){const{tmdb_id:r}=Pn(),[e]=kr(),t=e.get("type")||"movie",[s,i]=L.useState([]),[n,a]=L.useState(!0),u=Bt(),d=_i();return L.useEffect(()=>{if(!d){u(`/title/${r}?type=${t}`);return}async function h(){var m,p;if(!r){a(!1);return}try{const g=await fetch(`${WL}/title/${r}?type=${t}`);if(g.ok){const v=await g.json();(p=(m=v==null?void 0:v.raw)==null?void 0:m.credits)!=null&&p.cast&&i(v.raw.credits.cast)}}catch(g){console.error("Errore nel caricamento cast:",g)}finally{a(!1)}}h()},[r,t,u,d]),!d||n?l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})})]}):l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsx("div",{className:"sticky top-14 z-40 bg-black/95 backdrop-blur-md border-b border-white/10 px-4 py-4",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>u(-1),className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),l.jsx("h1",{className:"text-xl font-bold text-white",children:"Cast"})]})}),l.jsx("div",{className:"px-4 py-6",children:l.jsx("div",{className:"grid grid-cols-3 gap-4",children:s.map(h=>l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-full aspect-square rounded-full overflow-hidden mb-3 border-2 border-white/20",children:h.profile_path?l.jsx("img",{src:Ze(h.profile_path),alt:h.name,className:"w-full h-full object-cover"}):l.jsx("div",{className:"w-full h-full bg-white/10 flex items-center justify-center",children:l.jsx("span",{className:"text-white/50 text-lg",children:"?"})})}),l.jsx("p",{className:"text-white text-sm font-medium mb-1 line-clamp-1",children:h.name}),l.jsx("p",{className:"text-white/60 text-xs line-clamp-2",children:h.character})]},h.id))})}),l.jsx("div",{className:"h-20"})," "]})}const qL="https://api.asknebula.it";function YL(){const r=Bt(),{session:e}=Mt(),[t,s]=L.useState("movie"),[i,n]=L.useState("most_anticipated"),[a,u]=L.useState(!1),[d,h]=L.useState([]),[m,p]=L.useState(!0),[g,v]=L.useState({});L.useEffect(()=>{async function b(){p(!0);try{const _=await fetch(`${qL}/home-rows?page=1`);if(_.ok){const k=await _.json();let I=[];k["popular-movies"]&&(I=[...I,...k["popular-movies"]]),k["popular-tv"]&&(I=[...I,...k["popular-tv"]]),k.trending&&(I=[...I,...k.trending]);const C=new Set;I=I.filter(N=>{const O=`${N.tmdb_id}-${N.type}`;return C.has(O)?!1:(C.add(O),!0)});const $=I.map((N,O)=>{const j=new Date,D=7+O*3+Math.floor(Math.random()*100);j.setDate(j.getDate()+D);const G={day:"numeric",month:"long",year:"numeric"},X=j.toLocaleDateString("it-IT",G).toUpperCase();return{...N,release_date_obj:j,start_date_formatted:N.type==="tv"?`IN ONDA IL ${X}`:X,season_info:N.type==="tv"?`S${Math.floor(Math.random()*5)+1} E${Math.floor(Math.random()*20)+1} - Episodio ${Math.floor(Math.random()*20)+1}`:void 0,popularity:N.popularity||100-O}});h($)}}catch(_){console.error(_)}finally{p(!1)}}b();const T=localStorage.getItem("nebula_notifications");T&&v(JSON.parse(T))},[]);const y=b=>{const T=!g[b.tmdb_id],_={...g,[b.tmdb_id]:T};v(_),localStorage.setItem("nebula_notifications",JSON.stringify(_));const k=localStorage.getItem("nebula_subscribed_list");let I=k?JSON.parse(k):[];T?I.find(C=>C.id===b.tmdb_id)||I.push({id:b.tmdb_id,title:b.title,poster:b.poster||b.backdrop,type:b.type,release_date:b.release_date_obj,formatted_date:b.start_date_formatted}):I=I.filter(C=>C.id!==b.tmdb_id),localStorage.setItem("nebula_subscribed_list",JSON.stringify(I)),window.dispatchEvent(new Event("nebula-notifications-updated")),T&&"Notification"in window&&Notification.permission==="granted"&&new Notification(`Promemoria impostato: ${b.title}`,{body:"Ti avviseremo quando sar disponibile!",icon:"/icon-192.png"})},S=d.filter(b=>b.type===t).sort((b,T)=>i==="most_anticipated"?(T.popularity||0)-(b.popularity||0):b.release_date_obj.getTime()-T.release_date_obj.getTime());return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black pb-20",children:[l.jsxs("div",{className:"sticky top-0 z-50 bg-black/95 backdrop-blur-md border-b border-white/10 px-4 h-14 flex items-center justify-between",children:[l.jsx("button",{onClick:()=>r("/"),className:"p-1 -ml-2 text-white/80 hover:text-white",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),l.jsx("h1",{className:"text-lg font-bold text-white",children:"In arrivo"}),l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>u(!a),className:"flex items-center gap-1 text-xs font-semibold bg-white/10 px-3 py-1.5 rounded-full text-white/90",children:[i==="most_anticipated"?"Pi attesi":"Data di uscita",l.jsx("svg",{className:`w-3 h-3 transition-transform ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>u(!1)}),l.jsxs("div",{className:"absolute right-0 top-full mt-2 w-40 bg-[#1a1a1a] border border-white/10 rounded-xl shadow-xl z-20 overflow-hidden animate-fade-in-up",children:[l.jsx("button",{onClick:()=>{n("most_anticipated"),u(!1)},className:`w-full text-left px-4 py-3 text-sm hover:bg-white/10 ${i==="most_anticipated"?"text-[#059669]":"text-white"}`,children:"Pi attesi"}),l.jsx("button",{onClick:()=>{n("release_date"),u(!1)},className:`w-full text-left px-4 py-3 text-sm hover:bg-white/10 ${i==="release_date"?"text-[#059669]":"text-white"}`,children:"Data di uscita"})]})]})]})]}),l.jsx("div",{className:"px-4 mt-4 mb-6",children:l.jsxs("div",{className:"flex bg-white/5 rounded-full p-1 border border-white/10",children:[l.jsx("button",{onClick:()=>s("movie"),className:`flex-1 overflow-hidden relative rounded-full py-2 text-sm font-bold text-center transition-all duration-300 ${t==="movie"?"bg-[#059669] text-white shadow-lg":"text-white/60 hover:text-white"}`,children:"Film"}),l.jsx("button",{onClick:()=>s("tv"),className:`flex-1 overflow-hidden relative rounded-full py-2 text-sm font-bold text-center transition-all duration-300 ${t==="tv"?"bg-[#059669] text-white shadow-lg":"text-white/60 hover:text-white"}`,children:"Serie TV"})]})}),l.jsx("div",{className:"px-4 space-y-6",children:m?l.jsx("div",{className:"flex justify-center py-10",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#059669]"})}):S.length===0?l.jsx("div",{className:"text-center py-10 text-white/50",children:"Nessun contenuto in arrivo"}):S.map(b=>l.jsx("div",{children:t==="movie"?l.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-white/5 border border-white/10",children:[l.jsx("div",{className:"shrink-0 w-24 sm:w-28 aspect-[2/3] rounded-lg overflow-hidden bg-white/10 shadow-lg",children:l.jsx("img",{src:Ze(b.poster||b.backdrop||void 0,"large")||void 0,alt:b.title,className:"w-full h-full object-cover",loading:"lazy"})}),l.jsxs("div",{className:"flex-1 flex flex-col justify-center relative pr-8",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-2 leading-tight",children:b.title}),l.jsxs("div",{className:"flex items-center gap-2 text-white/60 text-xs font-semibold bg-white/5 px-2 py-1 rounded w-fit mb-2",children:[l.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),b.start_date_formatted]}),b.overview&&l.jsx("p",{className:"text-white/50 text-xs line-clamp-2 leading-relaxed",children:b.overview}),l.jsx("button",{onClick:()=>y(b),className:`absolute top-0 right-0 w-8 h-8 flex items-center justify-center rounded-full transition-colors ${g[b.tmdb_id]?"text-white":"text-white/40 hover:text-white"}`,children:g[b.tmdb_id]?l.jsx("svg",{className:"w-5 h-5 fill-current",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}):l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})})]})]}):l.jsxs("div",{className:"bg-[#1a1a1a] rounded-xl overflow-hidden shadow-lg border border-white/5",children:[l.jsxs("div",{className:"aspect-video w-full relative",children:[l.jsx("img",{src:Ze(b.backdrop||b.poster||void 0,"original")||void 0,alt:b.title,className:"w-full h-full object-cover",loading:"lazy"}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-60"})]}),l.jsxs("div",{className:"p-4 relative",children:[l.jsxs("div",{className:"flex justify-between items-start mb-2",children:[l.jsx("h3",{className:"text-xl font-bold text-white leading-tight pr-8",children:b.title}),l.jsx("button",{onClick:()=>y(b),className:`w-8 h-8 flex items-center justify-center rounded-full transition-colors ${g[b.tmdb_id]?"text-white":"text-white/40 hover:text-white"}`,children:g[b.tmdb_id]?l.jsx("svg",{className:"w-6 h-6 fill-current",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}):l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})})]}),b.season_info&&l.jsx("p",{className:"text-white/70 text-sm font-medium mb-3",children:b.season_info}),l.jsxs("div",{className:"inline-flex items-center gap-2 bg-[#1d3326] border border-[#2d4a36] px-3 py-1.5 rounded-lg",children:[l.jsx("svg",{className:"w-4 h-4 text-[#059669]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),l.jsx("span",{className:"text-xs font-bold text-[#059669] uppercase tracking-wide",children:b.start_date_formatted})]})]})]})},b.tmdb_id))})]})})}const QL="https://api.asknebula.it";function XL(){var p,g,v,y,S,b,T,_,k;const{tmdb_id:r}=Pn(),[e]=kr(),t=e.get("type")||"movie",[s,i]=L.useState(null),[n,a]=L.useState(!0),u=Bt(),d=_i();if(L.useEffect(()=>{if(!d){u(`/title/${r}?type=${t}`);return}async function I(){if(!r){a(!1);return}try{const C=await fetch(`${QL}/title/${r}?type=${t}`);if(C.ok){const $=await C.json();i($==null?void 0:$.raw)}}catch(C){console.error("Errore nel caricamento dettagli:",C)}finally{a(!1)}}I()},[r,t,u,d]),!d||n)return l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#059669]"})})]});if(!s)return l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Contenuto non disponibile"}),l.jsx("button",{onClick:()=>u(-1),className:"px-6 py-3 bg-[#059669] hover:bg-[#047857] text-white font-semibold rounded-xl",children:"Torna indietro"})]})})]});const h=s,m=((p=h==null?void 0:h.videos)==null?void 0:p.results)||[];return l.jsxs(Yt,{children:[l.jsx(ii,{}),l.jsx("div",{className:"sticky top-14 z-40 bg-black/95 backdrop-blur-md border-b border-white/10 px-4 py-4",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>u(-1),className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),l.jsx("h1",{className:"text-xl font-bold text-white",children:"Maggiori informazioni"})]})}),l.jsxs("div",{className:"px-6 py-6 space-y-6",children:[((y=(v=(g=h==null?void 0:h.watch_providers)==null?void 0:g.results)==null?void 0:v.IT)==null?void 0:y.rent)&&h.watch_providers.results.IT.rent.length>0&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Dove guardarlo"}),l.jsx("div",{className:"space-y-3",children:h.watch_providers.results.IT.rent.map(I=>l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-white/10 flex items-center justify-center flex-shrink-0",children:I.logo_path?l.jsx("img",{src:Ze(I.logo_path),alt:I.provider_name,className:"w-full h-full object-contain"}):l.jsx("span",{className:"text-white/50 text-xs",children:"?"})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"text-white font-semibold",children:I.provider_name}),l.jsx("p",{className:"text-[#059669] text-sm",children:"Noleggia"})]})]},I.provider_id))})]}),((S=h==null?void 0:h.credits)==null?void 0:S.crew)&&(()=>{const I=h.credits.crew.find(C=>C.job==="Director");return I?l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Regista"}),l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex items-center gap-4",children:[I.profile_path?l.jsx("img",{src:Ze(I.profile_path),alt:I.name,className:"w-16 h-16 rounded-full object-cover"}):l.jsx("div",{className:"w-16 h-16 rounded-full bg-white/10 flex items-center justify-center",children:l.jsx("span",{className:"text-white/50 text-xs",children:"?"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-semibold",children:I.name}),l.jsx("p",{className:"text-white/60 text-sm",children:"Director"})]})]})]}):null})(),((h==null?void 0:h.budget)||(h==null?void 0:h.revenue))&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Dati finanziari"}),l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex justify-between",children:[h.budget>0&&l.jsxs("div",{children:[l.jsxs("p",{className:"text-white font-semibold text-lg",children:["$",h.budget.toLocaleString()]}),l.jsx("p",{className:"text-white/60 text-sm",children:"Budget"})]}),h.revenue>0&&l.jsxs("div",{className:"text-right",children:[l.jsxs("p",{className:"text-white font-semibold text-lg",children:["$",h.revenue.toLocaleString()]}),l.jsx("p",{className:"text-white/60 text-sm",children:"Incassi"})]})]})]}),(h==null?void 0:h.production_companies)&&h.production_companies.length>0&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Studi di produzione"}),l.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar",children:h.production_companies.map(I=>l.jsx("div",{className:"bg-white/5 rounded-xl p-4 flex-shrink-0 min-w-[120px]",children:I.logo_path?l.jsx("img",{src:Ze(I.logo_path),alt:I.name,className:"h-12 object-contain"}):l.jsx("p",{className:"text-white/80 text-xs text-center",children:I.name})},I.id))})]}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Media"}),l.jsxs("div",{className:"space-y-4",children:[m.length>0&&l.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-2 scroll-smooth",children:m.filter(I=>I.site==="YouTube").map(I=>l.jsxs("div",{className:"flex-shrink-0 w-full max-w-md",children:[l.jsx("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:l.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${I.key}?rel=0&modestbranding=1`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:I.name})}),l.jsx("p",{className:"text-white/80 text-xs mt-2 line-clamp-2",children:I.name})]},I.id))}),(h==null?void 0:h.poster_path)&&l.jsxs("div",{children:[l.jsx("h4",{className:"text-md font-semibold text-white mb-2",children:"Poster"}),l.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{path:h.poster_path,name:"Poster principale"},...(((T=(b=h.images)==null?void 0:b.posters)==null?void 0:T.slice(0,2))||[]).map(I=>({path:I.file_path,name:"Poster alternativo"}))].slice(0,3).map((I,C)=>l.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden",children:l.jsx("img",{src:Ze(I.path),alt:I.name,className:"w-full h-full object-cover"})},C))})]}),(h==null?void 0:h.backdrop_path)&&l.jsxs("div",{children:[l.jsx("h4",{className:"text-md font-semibold text-white mb-2",children:"Sfondi"}),l.jsx("div",{className:"grid grid-cols-1 gap-3",children:[{path:h.backdrop_path||h.backdrop,name:"Sfondo principale"},...(((k=(_=h.images)==null?void 0:_.backdrops)==null?void 0:k.slice(0,2))||[]).map(I=>({path:I.file_path,name:"Sfondo alternativo"}))].filter(I=>I.path).slice(0,3).map((I,C)=>l.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:l.jsx("img",{src:Ze(I.path,"original"),alt:I.name,className:"w-full h-full object-cover"})},C))})]})]})]}),l.jsxs("div",{className:"bg-white/5 rounded-xl p-4 flex items-center gap-4",children:[l.jsx("svg",{className:"w-8 h-8 text-[#059669]",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.84-.179-.84-.66 0-.359.24-.66.54-.779 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.24 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"})}),l.jsx("div",{className:"flex-1",children:l.jsx("p",{className:"text-white text-sm",children:"Trova la colonna sonora ufficiale su Spotify."})}),l.jsx("button",{onClick:()=>{const I=(h==null?void 0:h.title)||(h==null?void 0:h.name)||"",$=`https://open.spotify.com/search/${encodeURIComponent(`${I} soundtrack`)}`;window.open($,"_blank")},className:"px-4 py-2 bg-[#059669] text-white rounded-lg text-sm font-medium active:bg-[#059669] transition-colors",children:"Apri"})]})]}),l.jsx("div",{className:"h-20"})," "]})}const JL="https://api.asknebula.it";function ZL(){var C,$,N,O,j,D,G,X,K,W,te,z;const{personId:r}=Pn(),e=Bt(),[t,s]=L.useState(null),[i,n]=L.useState(!0),[a,u]=L.useState(!1),[d,h]=L.useState("movie"),[m,p]=L.useState("popularity"),[g,v]=L.useState(!1);if(L.useEffect(()=>{window.scrollTo(0,0);async function M(){var F,H,Y,P;if(r){n(!0);try{const B=await fetch(`${JL}/person/${r}?append_to_response=images,combined_credits,external_ids`);if(B.ok){const oe=await B.json(),ie=oe.raw||oe;if(console.log("[PersonPage] Fetched person data:",{name:ie.name,hasBiography:!!ie.biography,biographyLength:((F=ie.biography)==null?void 0:F.length)||0,biographyPreview:((H=ie.biography)==null?void 0:H.substring(0,100))||"N/A",hasCredits:!!ie.combined_credits,creditsCount:((P=(Y=ie.combined_credits)==null?void 0:Y.cast)==null?void 0:P.length)||0}),!ie||!ie.name){console.error("[PersonPage] Invalid person data received:",ie),s(null);return}ie.biography||console.warn("[PersonPage] No biography found for person:",ie.name),s(ie),setTimeout(()=>{window.scrollTo(0,0)},100)}else{const oe=await B.text().catch(()=>"");console.error("[PersonPage] Failed to fetch person:",B.status,oe),s(null)}}catch(B){console.error("[PersonPage] Error fetching person:",B),s(null)}finally{n(!1)}}}M()},[r]),i)return l.jsx(Yt,{children:l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-white/30"})})});if(!t)return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black flex flex-col items-center justify-center text-white px-4",children:[l.jsx("p",{className:"text-lg font-semibold mb-2",children:"Persona non trovata"}),l.jsx("p",{className:"text-white/60 text-sm text-center mb-4",children:"La persona cercata potrebbe non esistere o essere temporaneamente non disponibile."}),l.jsx("button",{onClick:()=>e(-1),className:"px-4 py-2 bg-white/10 rounded-lg text-white hover:bg-white/20 transition-colors",children:"Torna indietro"})]})});const y=t.birthday?new Date(t.birthday):null,S=y?new Date().getFullYear()-y.getFullYear():null,b=y?y.toLocaleDateString("it-IT",{day:"numeric",month:"long",year:"numeric"}):"",T=((C=t.combined_credits)==null?void 0:C.cast)||[],k=[...T.filter(M=>M.media_type===d)].sort((M,F)=>{if(m==="popularity")return(F.popularity||0)-(M.popularity||0);{const H=new Date(M.release_date||M.first_air_date||0).getTime();return new Date(F.release_date||F.first_air_date||0).getTime()-H}}),I=[...T].sort((M,F)=>(F.vote_average||0)*(F.popularity||0)-(M.vote_average||0)*(M.popularity||0)).slice(0,10);return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black pb-20 text-white",children:[l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 flex items-center p-4 bg-gradient-to-b from-black/80 to-transparent",children:l.jsx("button",{onClick:()=>e(-1),className:"p-2 bg-black/50 rounded-full backdrop-blur-md",children:l.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})}),l.jsxs("div",{className:"relative",children:[l.jsxs("div",{className:"h-[40vh] w-full overflow-hidden bg-black/50",children:[(((O=(N=($=t.images)==null?void 0:$.profiles)==null?void 0:N[1])==null?void 0:O.file_path)||t.profile_path)&&l.jsx("img",{src:Ze(((G=(D=(j=t.images)==null?void 0:j.profiles)==null?void 0:D[1])==null?void 0:G.file_path)||t.profile_path,"original")||void 0,alt:t.name,className:"w-full h-full object-cover opacity-60",onError:M=>{M.target.style.display="none"}}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"})]}),l.jsx("div",{className:"px-4 -mt-20 relative z-10",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden border-2 border-white/10 shadow-2xl mb-4 bg-[#1a1a1a]",children:t.profile_path?l.jsx("img",{src:Ze(t.profile_path,"medium")||void 0,alt:t.name,className:"w-full h-full object-cover",onError:M=>{const F=M.target;F.style.display="none";const H=F.parentElement;H&&(H.innerHTML='<svg class="w-16 h-16 text-white/40 m-auto" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" /></svg>')}}):l.jsx("div",{className:"w-full h-full flex items-center justify-center",children:l.jsx("svg",{className:"w-16 h-16 text-white/40",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})})}),l.jsx("h1",{className:"text-3xl font-bold text-center mb-2",children:t.name}),t.known_for_department&&l.jsx("span",{className:"bg-white/10 px-3 py-1 rounded-full text-sm backdrop-blur-md mb-4 border border-white/5",children:t.known_for_department==="Acting"?"Recitazione":t.known_for_department}),t.birthday&&l.jsxs("div",{className:"text-center text-white/70 text-sm mb-1",children:["Nato il: ",b," (",S," anni)"]}),t.place_of_birth&&l.jsxs("div",{className:"text-center text-white/70 text-sm mb-4",children:["Luogo: ",t.place_of_birth]}),l.jsxs("div",{className:"flex gap-6 mb-8 text-white/80",children:[((X=t.external_ids)==null?void 0:X.imdb_id)&&l.jsx("a",{href:`https://www.imdb.com/name/${t.external_ids.imdb_id}`,target:"_blank",rel:"noopener noreferrer",children:l.jsx("svg",{className:"w-6 h-6 hover:text-[#f5c518] transition-colors",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M13.634 11.758l-.66-.027h-1.39l-.49 2.7h1.46c.55 0 .85-.22.95-.55l.13-.75c.08-.43-.1-.97-.88-1.373zm8.366 3.692h-1.12l-1.07-5.05h1.16l.5 3.32.72-3.32h1.15l-1.34 5.05zm-4.335.03c-.933 0-1.5-.54-1.573-1.4l-.2-2.31c-.04-.51.275-.89.875-.92l.8.026c.49.03.73.34.77.89l.16 2.1c.08.57-.3.92-.832.92v.695zm-3.865-.015c-.47 0-.77-.18-.84-.52l-.4-2.22h1.22l.14 1.76c.03.22.18.3.4.3.26 0 .42-.14.48-.48l.18-1.58h1.27l-.23 3.09c-.21 1.09-1.03 1.65-2.22 1.65zm-2.825 0l-.33-2.1c-.056-.41.16-.62.53-.62.33 0 .5.2.53.5l.34 2.22h1.21l-.54-3.66c-.22-1.01-1.06-1.51-2.23-1.51-1.03 0-1.63.5-1.78 1.48l-.51 3.69h1.22l.18-2.22c.04-.3.2-.44.49-.44.25 0 .39.14.44.44l.23 2.22h1.22zm-7.97-.03h-1.2l.62-5.02h2.46c.92 0 1.5.54 1.58 1.43l.14 1.34c.05.51-.15.94-.56 1.18l.74 2.41h-1.28l-.62-2.24h-.73l-.33 2.24h1.18v.66zm19.95-6.07c.03-.22.18-.3.4-.3.26 0 .42-.14.48-.48l.18-1.58h1.27l-.24 3.09c-.21 1.09-1.03 1.65-2.22 1.65-.47 0-.77-.18-.84-.52l-.4-2.22h1.22l.14 1.76v.6zm-4.22.6c.08-.43-.1-.97-.88-1.37h-.82l-.66-.03h-1.39l-.49 2.7h1.46c.55 0 .85-.22.95-.55l.13-.75.7 2.1h1.72l-.72-2.1z"})})}),((K=t.external_ids)==null?void 0:K.instagram_id)&&l.jsx("a",{href:`https://instagram.com/${t.external_ids.instagram_id}`,target:"_blank",rel:"noopener noreferrer",children:l.jsx("svg",{className:"w-6 h-6 hover:text-[#E1306C] transition-colors",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})}),((W=t.external_ids)==null?void 0:W.twitter_id)&&l.jsx("a",{href:`https://twitter.com/${t.external_ids.twitter_id}`,target:"_blank",rel:"noopener noreferrer",children:l.jsx("svg",{className:"w-6 h-6 hover:text-[#1DA1F2] transition-colors",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})})}),((te=t.external_ids)==null?void 0:te.facebook_id)&&l.jsx("a",{href:`https://facebook.com/${t.external_ids.facebook_id}`,target:"_blank",rel:"noopener noreferrer",children:l.jsx("svg",{className:"w-6 h-6 hover:text-[#1877F2] transition-colors",fill:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{d:"M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"})})})]}),l.jsxs("div",{className:"w-full text-left bg-transparent mb-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:"Biografia"}),t.biography&&t.biography.trim()?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:`text-white/70 text-sm leading-relaxed ${a?"":"line-clamp-4"}`,children:t.biography}),t.biography.length>200&&l.jsx("button",{onClick:()=>u(!a),className:"text-[#059669] text-sm font-semibold mt-2",children:a?"Mostra meno":"Mostra tutto"})]}):l.jsx("p",{className:"text-white/50 text-sm italic",children:"Biografia non disponibile per questa persona."})]})]})})]}),I.length>0&&l.jsxs("div",{className:"mt-8 px-4",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Conosciuto per"}),l.jsx("div",{className:"flex gap-3 overflow-x-auto pb-4 no-scrollbar",children:I.map(M=>l.jsxs(He,{to:`/title/${M.id}?type=${M.media_type}`,className:"flex-shrink-0 w-32 group",children:[l.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-white/10 mb-2",children:l.jsx("img",{src:Ze(M.poster_path,"medium")||void 0,alt:M.title||M.name,className:"w-full h-full object-cover group-active:scale-95 transition-transform"})}),l.jsx("p",{className:"text-xs font-semibold text-white/90 line-clamp-2 text-center",children:M.title||M.name})]},`known-${M.id}`))})]}),l.jsxs("div",{className:"mt-6 px-4",children:[l.jsxs("div",{className:"flex bg-white/5 rounded-lg p-1 border border-white/10 mb-4",children:[l.jsx("button",{onClick:()=>h("movie"),className:`flex-1 py-2 text-sm font-bold text-center rounded-md transition-all ${d==="movie"?"bg-[#059669] text-white":"text-white/60 hover:text-white"}`,children:"Film"}),l.jsx("button",{onClick:()=>h("tv"),className:`flex-1 py-2 text-sm font-bold text-center rounded-md transition-all ${d==="tv"?"bg-[#059669] text-white":"text-white/60 hover:text-white"}`,children:"Programmi TV"})]}),l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("span",{className:"text-white/60 text-sm font-medium",children:[k.length," Titoli"]}),l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>v(!g),className:"flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-lg text-sm text-white border border-white/10",children:[m==="popularity"?"Popolarit":"Data uscita",l.jsx("svg",{className:`w-3 h-3 transition-transform ${g?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-20",onClick:()=>v(!1)}),l.jsxs("div",{className:"absolute right-0 top-full mt-2 w-36 bg-[#1a1a1a] border border-white/10 rounded-xl shadow-xl z-30 overflow-hidden",children:[l.jsx("button",{onClick:()=>{p("popularity"),v(!1)},className:`w-full text-left px-4 py-2 text-sm ${m==="popularity"?"text-green-500 bg-white/5":"text-white"}`,children:"Popolarit"}),l.jsx("button",{onClick:()=>{p("date"),v(!1)},className:`w-full text-left px-4 py-2 text-sm ${m==="date"?"text-green-500 bg-white/5":"text-white"}`,children:"Data uscita"})]})]})]})]}),l.jsx("div",{className:"grid grid-cols-3 gap-3",children:k.map((M,F)=>l.jsxs(He,{to:`/title/${M.id}?type=${M.media_type}`,className:"group",children:[l.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-white/10 mb-2",children:M.poster_path?l.jsx("img",{src:Ze(M.poster_path,"medium")||void 0,alt:M.title||M.name,className:"w-full h-full object-cover group-active:scale-95 transition-transform",loading:"lazy"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 text-center text-[10px] text-white/40 bg-zinc-800",children:M.title||M.name})}),l.jsx("p",{className:"text-xs font-medium text-white/80 line-clamp-1",children:M.title||M.name})]},`${M.id}_${F}`))})]}),((z=t.images)==null?void 0:z.profiles)&&t.images.profiles.length>0&&l.jsxs("div",{className:"mt-8 px-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h3",{className:"text-xl font-bold text-white",children:["Foto di ",t.name]}),l.jsx("button",{className:"text-green-500 text-sm font-semibold",children:"Mostra tutto"})]}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:t.images.profiles.slice(0,9).map((M,F)=>l.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden bg-white/10",children:l.jsx("img",{src:Ze(M.file_path,"medium")||void 0,className:"w-full h-full object-cover",loading:"lazy"})},F))})]})]})})}const eR=[{question:"Come funziona Nebula Streaming?",answer:"Nebula Streaming  una piattaforma di streaming che ti permette di guardare film e serie TV in streaming. Devi solo creare un account, scegliere un piano di abbonamento e iniziare a guardare i contenuti disponibili nel nostro catalogo."},{question:"Quali dispositivi sono supportati?",answer:"Nebula Streaming funziona su tutti i dispositivi con un browser web moderno, inclusi computer, tablet e smartphone. Non  necessario installare app dedicate, tutto funziona direttamente dal browser."},{question:"Posso guardare contenuti offline?",answer:"S, i piani Basic, Premium e ULTRA includono la funzionalit di download per guardare contenuti offline. Il piano Basic permette fino a 3 download al giorno, mentre i piani Premium e ULTRA hanno download illimitati. Il piano Free non include la funzionalit di download."},{question:"Come posso cambiare il mio piano di abbonamento?",answer:"Puoi cambiare il tuo piano in qualsiasi momento dalla sezione 'Piani' o 'Abbonamento' nelle impostazioni. Seleziona il nuovo piano e completa il processo per aggiornare il tuo status immediatamente."},{question:"Posso cancellare il mio abbonamento?",answer:"S, puoi cancellare il tuo abbonamento in qualsiasi momento. L'abbonamento rimarr attivo fino alla fine del periodo di fatturazione gi pagato, dopodich non verr rinnovato automaticamente."},{question:"Cosa succede se non riesco a guardare un contenuto?",answer:"Se riscontri problemi nella riproduzione di un contenuto, prova a: 1) Ricaricare la pagina, 2) Verificare la tua connessione internet, 3) Contattare il supporto tramite i nostri canali social (Telegram) o via email."},{question:"Quanti dispositivi posso usare contemporaneamente?",answer:"Il numero di dispositivi dipende dal tuo piano: Piano Free (1), Basic (2), Premium (3), ULTRA (4). Ogni piano offre un numero diverso di riproduzioni simultanee."},{question:"Come segnalare un problema?",answer:"Puoi segnalare problemi tecnici tramite i nostri canali social o via email a support@asknebula.it. Fornisci dettagli per aiutarci a risolvere rapidamente."}];function tR(){const[r,e]=L.useState(null),t=Bt();return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black px-4 pt-4 pb-24",children:[l.jsxs("div",{className:"flex items-center gap-4 mb-6 sticky top-0 bg-black/80 backdrop-blur-xl z-20 py-4 border-b border-white/5 -mx-4 px-4",children:[l.jsx("button",{onClick:()=>t(-1),className:"p-2 -ml-2 text-white/80 hover:text-white",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),l.jsx("h1",{className:"text-xl font-bold text-white tracking-wide",children:"Domande Frequenti"})]}),l.jsx("div",{className:"space-y-3",children:eR.map((s,i)=>l.jsxs("div",{className:"bg-[#1a1a1a] rounded-xl overflow-hidden border border-white/5",children:[l.jsxs("button",{onClick:()=>e(r===i?null:i),className:"w-full px-4 py-4 text-left flex items-center justify-between active:bg-white/5 transition-colors",children:[l.jsx("span",{className:"font-semibold text-white/90 text-sm pr-4",children:s.question}),l.jsx("svg",{className:`w-5 h-5 text-emerald-500 transition-transform flex-shrink-0 ${r===i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r===i&&l.jsx("div",{className:"px-4 pb-4 pt-0 animate-fade-in-down",children:l.jsx("p",{className:"text-white/60 text-xs leading-relaxed border-t border-white/5 pt-3",children:s.answer})})]},i))}),l.jsxs("div",{className:"mt-8 p-4 bg-gradient-to-br from-emerald-900/10 to-transparent rounded-xl border border-emerald-500/10 text-center",children:[l.jsx("p",{className:"text-sm text-white/80 mb-3",children:"Non hai trovato quello che cercavi?"}),l.jsx("a",{href:"mailto:support@asknebula.it",className:"inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-6 rounded-full text-sm transition-colors shadow-lg shadow-emerald-600/20",children:"Contatta il Supporto"})]})]})})}function sR(){const r=Bt();return l.jsx(Yt,{children:l.jsxs("div",{className:"min-h-screen bg-black px-4 pt-4 pb-24",children:[l.jsxs("div",{className:"flex items-center gap-4 mb-6 sticky top-0 bg-black/80 backdrop-blur-xl z-20 py-4 border-b border-white/5 -mx-4 px-4 shadow-lg",children:[l.jsx("button",{onClick:()=>r(-1),className:"p-2 -ml-2 text-white/80 hover:text-white transition-colors rounded-full active:bg-white/10",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),l.jsx("h1",{className:"text-xl font-bold text-white tracking-wide",children:"Informativa Privacy"})]}),l.jsxs("div",{className:"prose prose-invert prose-sm max-w-none text-white/80",children:[l.jsxs("div",{className:"bg-[#1a1a1a] rounded-xl p-6 border border-white/5 shadow-inner",children:[l.jsxs("section",{className:"mb-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-2 pb-2 border-b border-white/10",children:"1. Introduzione"}),l.jsx("p",{className:"text-sm leading-relaxed mb-4",children:'Nebula Streaming ("noi", "nostro", "il Servizio") rispetta la tua privacy e si impegna a proteggere i tuoi dati personali. Questa Privacy Policy spiega come raccogliamo e trattiamo le tue informazioni.'})]}),l.jsxs("section",{className:"mb-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-2 pb-2 border-b border-white/10",children:"2. Dati che Raccogliamo"}),l.jsx("p",{className:"text-sm mb-2 font-semibold",children:"Dati forniti:"}),l.jsxs("ul",{className:"list-disc list-inside text-sm pl-2 mb-4 space-y-1 marker:text-emerald-500",children:[l.jsx("li",{children:"Informazioni di account (email)"}),l.jsx("li",{children:"Preferenze di visualizzazione"}),l.jsx("li",{children:"Dati di navigazione e utilizzo"})]}),l.jsx("p",{className:"text-sm mb-2 font-semibold",children:"Uso dei dati:"}),l.jsxs("ul",{className:"list-disc list-inside text-sm pl-2 space-y-1 marker:text-emerald-500",children:[l.jsx("li",{children:"Fornitura del servizio"}),l.jsx("li",{children:"Personalizzazione dell'esperienza"}),l.jsx("li",{children:"Analisi per miglioramento del servizio"})]})]}),l.jsxs("section",{className:"mb-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-2 pb-2 border-b border-white/10",children:"3. I Tuoi Diritti"}),l.jsx("p",{className:"text-sm leading-relaxed mb-4",children:"In conformit con il GDPR, hai diritto di accesso, rettifica, cancellazione e portabilit dei tuoi dati. Puoi esercitare questi diritti contattandoci direttamente."})]}),l.jsxs("section",{className:"mb-2",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-2 pb-2 border-b border-white/10",children:"4. Contatti"}),l.jsx("p",{className:"text-sm leading-relaxed",children:"Per qualsiasi richiesta sulla privacy o per l'eliminazione dei dati:"}),l.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[l.jsx("a",{href:"mailto:support@asknebula.it",className:"text-emerald-400 font-medium hover:underline",children:"support@asknebula.it"}),l.jsx("a",{href:"https://t.me/NebulaSystem",className:"text-[#0088cc] font-medium hover:underline",children:"Telegram: @asknebuladev"})]})]})]}),l.jsxs("p",{className:"text-xs text-center text-white/40 mt-8",children:["Ultimo aggiornamento: 1 Gennaio 2026",l.jsx("br",{}),"Versione documento: 1.2-mobile"]})]})]})})}function rR(){const r=_i(),e=Bt(),t=Ur();L.useEffect(()=>{if(!r)return;let s=0;const i=2e3;let n=null;const a=async()=>{if(t.pathname==="/"){const u=new Date().getTime();if(u-s<i){const{App:d}=await er(async()=>{const{App:h}=await import("@capacitor/app");return{App:h}},[]);d.exitApp()}else{const d=document.createElement("div");d.innerText="Premi ancora per uscire",Object.assign(d.style,{position:"fixed",bottom:"80px",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"rgba(20, 20, 20, 0.9)",backdropFilter:"blur(10px)",color:"white",padding:"12px 24px",borderRadius:"50px",zIndex:"10000",fontSize:"14px",fontWeight:"500",pointerEvents:"none",opacity:"0",transition:"opacity 0.3s ease",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"}),document.body.appendChild(d),d.offsetWidth,d.style.opacity="1",setTimeout(()=>{d.style.opacity="0",setTimeout(()=>{document.body.contains(d)&&document.body.removeChild(d)},300)},2e3),s=u}}else e(-1)};return er(async()=>{const{App:u}=await import("@capacitor/app");return{App:u}},[]).then(({App:u})=>u.addListener("backButton",()=>{a()})).then(u=>{n=u}).catch(()=>{}),()=>{n&&n.then(u=>u.remove()).catch(()=>{})}},[r,e,t])}function iR({isNative:r}){const e=Ur();return l.jsx(qy,{children:l.jsxs(N1,{location:e,children:[l.jsx(_t,{path:"/",element:r?l.jsx(GL,{}):l.jsx(Yd,{})}),l.jsx(_t,{path:"/login",element:l.jsx(FT,{})}),l.jsx(_t,{path:"/browse",element:l.jsx(BT,{})}),l.jsx(_t,{path:"/title/:tmdb_id",element:r?l.jsx(VL,{}):l.jsx(Xd,{})}),l.jsx(_t,{path:"/title/:tmdb_id/characters",element:r?l.jsx(HL,{}):l.jsx(Xd,{})}),l.jsx(_t,{path:"/title/:tmdb_id/details",element:r?l.jsx(XL,{}):l.jsx(Xd,{})}),l.jsx(_t,{path:"/watch/:tmdb_id",element:l.jsx(tL,{})}),l.jsx(_t,{path:"/checkout",element:l.jsx(rL,{})}),l.jsx(_t,{path:"/checkout-success",element:l.jsx(nL,{})}),l.jsx(_t,{path:"/genre/:genreId",element:l.jsx(aL,{})}),l.jsx(_t,{path:"/verify-email",element:l.jsx(oL,{})}),l.jsx(_t,{path:"/account",element:l.jsx(lL,{})}),l.jsx(_t,{path:"/terms",element:l.jsx(cL,{})}),l.jsx(_t,{path:"/privacy",element:r?l.jsx(sR,{}):l.jsx(uL,{})}),l.jsx(_t,{path:"/about",element:l.jsx(dL,{})}),l.jsx(_t,{path:"/contact",element:l.jsx(hL,{})}),l.jsx(_t,{path:"/faq",element:r?l.jsx(tR,{}):l.jsx(mL,{})}),l.jsx(_t,{path:"/cookies",element:l.jsx(pL,{})}),l.jsx(_t,{path:"/download",element:l.jsx(SL,{})}),l.jsx(_t,{path:"/plans",element:l.jsx(kL,{})}),l.jsx(_t,{path:"/settings",element:l.jsx(kx,{})}),l.jsx(_t,{path:"/settings/*",element:l.jsx(kx,{})}),l.jsx(_t,{path:"/search",element:l.jsx(_L,{})}),l.jsx(_t,{path:"/coming-soon",element:r?l.jsx(YL,{}):l.jsx(Yd,{})}),l.jsx(_t,{path:"/my-lists",element:r?l.jsx(KL,{}):l.jsx(IL,{})}),l.jsx(_t,{path:"/person/:personId",element:r?l.jsx(ZL,{}):l.jsx(Yd,{})}),l.jsx(_t,{path:"*",element:l.jsx(gL,{})})]},e.pathname+e.search)})}function nR(){const r=Mt(n=>n.setAuth),e=Mt(n=>n.setPlan),t=Mt(n=>n.session),s=Ur(),i=_i();return rR(),L.useEffect(()=>{Ei.auth.getSession().then(({data:a})=>{a.session&&r(a.session)});const{data:{subscription:n}}=Ei.auth.onAuthStateChange((a,u)=>{r(u)});return()=>n.unsubscribe()},[r]),L.useEffect(()=>{const n="https://api.asknebula.it";async function a(){if(!t){e(null);return}try{const u=await fetch(`${n}/me/plan`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(u.ok){const d=await u.json();e(d)}else e(null)}catch{e(null)}}if(a(),t){const u=setInterval(a,3e5);return()=>clearInterval(u)}},[t,e]),L.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[s.pathname]),L.useEffect(()=>{const a=setTimeout(()=>{document.querySelectorAll("a[href]").forEach(d=>{const h=d.getAttribute("href");if(h&&h.startsWith("/")&&!h.startsWith("//")){const m=new IntersectionObserver(p=>{p.forEach(g=>{if(g.isIntersecting){const v=g.target;v.addEventListener("mouseenter",()=>{const y=v.getAttribute("href");if(y){const S=document.createElement("link");S.rel="prefetch",S.href=y,document.head.appendChild(S)}},{once:!0}),m.unobserve(g.target)}})},{rootMargin:"100px"});m.observe(d)}})},500);return()=>clearTimeout(a)},[s]),l.jsx(qy,{children:l.jsx(iR,{isNative:i})})}document.addEventListener("contextmenu",r=>(r.preventDefault(),!1));"requestIdleCallback"in window&&requestIdleCallback(()=>{["https://image.tmdb.org"].forEach(e=>{const t=document.createElement("link");t.rel="preconnect",t.href=e,t.crossOrigin="anonymous",document.head.appendChild(t)})});let Ah=!1;const aR=()=>{Ah||(window.requestAnimationFrame(()=>{Ah=!1}),Ah=!0)};window.addEventListener("scroll",aR,{passive:!0});const oR=()=>{};document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",oR);if("serviceWorker"in navigator){const r="nebula_cache_expiry",t=()=>{const s=localStorage.getItem(r),i=Date.now();!s||i>parseInt(s)?navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(n=>{console.log("[SW] Service Worker registrato:",n.scope),(!s||i>parseInt(s))&&(localStorage.setItem(r,(i+6048e5).toString()),n.active&&n.update(),n.waiting&&(n.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload()))}).catch(n=>{console.error("[SW] Errore registrazione Service Worker:",n)}):navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(n=>{console.log("[SW] Service Worker gi attivo, cache valida fino a:",new Date(parseInt(s)))}).catch(n=>{console.error("[SW] Errore registrazione Service Worker:",n)})};window.addEventListener("load",()=>{t()}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[SW] Nuovo Service Worker attivo")})}const lR=ja.isNativePlatform()?U1:F1;Uw.createRoot(document.getElementById("root")).render(l.jsx(Sa.StrictMode,{children:l.jsx(lR,{children:l.jsx(nR,{})})}));export{Kf as W,er as _,Vf as r};
